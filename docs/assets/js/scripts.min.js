"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bind(o){$("[data-id]").each(function(){var e=$(this),t=e.data("id"),n=o[t];"precio"===t?e.html(formatAmount(n)):"saldo"===t?"false"===n&&setTimeout(function(){showAdvice(e,!0)},500):e.html(n)})}function changeScreen(e,t){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),t()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var t=e.target,n=e.keyCode,o=$(t.parentNode);8===n?0<o.prev().length&&((e=o.prev().find("input")).val(""),e.focus()):47<n&&n<58&&""!==t.value&&0<o.next().length&&o.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function request(e,t,n,o,i){var s=new Headers;s.append("Authorization","Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7")),s.append("Content-Type","application/x-www-form-urlencoded"),s.append("Cookie","XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"),fetch("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token",{method:"POST",headers:s,body:"grant_type=client_credentials",redirect:"follow"}).then(function(e){return e.text()}).then(function(e){return console.log(e)}).catch(function(e){return console.log("error",e)})}function fakeRequest(e,t){setTimeout(function(){t("000001"===e)},1500)}function searchToJson(){for(var e,t=location.search.substring(1).split("&"),n={},o=0;o<t.length;o++)""!==t[o]&&(e=t[o].split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return n}function showAdvice(e,t){t?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var t=$(".loader");e?(t.length<=0&&(t=$('<div class="loader">')),$("body").append(t),setTimeout(function(){return t.addClass("loader-visible")},10)):(t.removeClass("loader-visible"),setTimeout(function(){return t.remove()},375))}function validateCode(){var t=$(".auth-screen .code"),n=$(".auth-screen .digit input"),e="";n.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(t.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),t.addClass("invalid"),setTimeout(function(){n.each(function(){$(this).val("")}),n.eq(0).focus()},100))})):t.removeClass("valid invalid")}!function(d){d.fn.swipe=function(e){var a=d.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var t=d(this),n=0,o=0,i=!1,s=t.find(".slider"),c=t.find(".text");s.on("mousedown touchstart",function(e){i=!0,o=t.width()-d(this).width()+10,n=e.clientX||e.originalEvent.touches[0].pageX}),d(document.body,s).on("mouseup touchend",function(e){if(i){if(i=!1,(e.clientX||e.changedTouches[0].pageX)-n<o)return c.fadeTo(300,1),void s.animate({left:"-10px"},300);a.cb()}}),d(document.body).on("mousemove touchmove",function(e){var t;i&&(e=1-(t=(e.clientX||e.originalEvent.touches[0].pageX)-n)/o,c.fadeTo(0,e),t<=0?s.css({left:"-10px"}):o+10<=t?s.css({left:o+"px"}):s.css({left:t-10}))})})}}(jQuery),bind(searchToJson());var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),"function"!=typeof showDigitalSign&&"object"!==("undefined"==typeof showDigitalSign?"undefined":_typeof(showDigitalSign))||showDigitalSign(function(e){e?($code.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),$code.addClass("invalid"),setTimeout(function(){$digits.each(function(){$(this).val("")}),$digits.eq(0).focus()},100))})},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),$(".detail-screen main").prepend("typeof closeMoviePayment"+("undefined"==typeof closeMoviePayment?"undefined":_typeof(closeMoviePayment))),"function"!=typeof closeMoviePayment&&"object"!==("undefined"==typeof closeMoviePayment?"undefined":_typeof(closeMoviePayment))||closeMoviePayment()}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),"function"!=typeof shareTicket&&"object"!==("undefined"==typeof shareTicket?"undefined":_typeof(shareTicket))||shareTicket()}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),"function"!=typeof playMovie&&"object"!==("undefined"==typeof playMovie?"undefined":_typeof(playMovie))||playMovie()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMuanMiLCJqcXVlcnkuc3dpcGUuanMiXSwibmFtZXMiOlsiYmluZCIsInZhbHVlcyIsIiQiLCJlYWNoIiwiJHRhZyIsInRoaXMiLCJpZCIsImRhdGEiLCJ2YWx1ZSIsImh0bWwiLCJmb3JtYXRBbW91bnQiLCJzZXRUaW1lb3V0Iiwic2hvd0FkdmljZSIsImNoYW5nZVNjcmVlbiIsIiRzY3JlZW4iLCJjYWxsYmFjayIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJhbW91bnQiLCJOdW1iZXIiLCJ0b0ZpeGVkIiwicmVwbGFjZSIsImhhbmRsZURpZ2l0S2V5dXAiLCJfcmVmIiwidGFyZ2V0Iiwia2V5Q29kZSIsIiRwYXJlbnQiLCJwYXJlbnROb2RlIiwicHJldiIsImxlbmd0aCIsIiRpbnB1dCIsImZpbmQiLCJ2YWwiLCJmb2N1cyIsIm5leHQiLCJ2YWxpZGF0ZUNvZGUiLCJudW1iZXJGaWx0ZXIiLCJldmVudCIsInRlc3QiLCJvbGRWYWx1ZSIsIm9sZFNlbGVjdGlvblN0YXJ0Iiwic2VsZWN0aW9uU3RhcnQiLCJvbGRTZWxlY3Rpb25FbmQiLCJzZWxlY3Rpb25FbmQiLCJoYXNPd25Qcm9wZXJ0eSIsInNldFNlbGVjdGlvblJhbmdlIiwicmVxdWVzdCIsInVybCIsIm1ldGhvZCIsImJvZHkiLCJoZWFkZXJzIiwibXlIZWFkZXJzIiwiSGVhZGVycyIsImFwcGVuZCIsImJ0b2EiLCJmZXRjaCIsInJlZGlyZWN0IiwidGhlbiIsInJlc3BvbnNlIiwidGV4dCIsInJlc3VsdCIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsImZha2VSZXF1ZXN0IiwiY29kZSIsInNlYXJjaFRvSnNvbiIsInBhcnRzIiwicGFpcnMiLCJsb2NhdGlvbiIsInNlYXJjaCIsInN1YnN0cmluZyIsInNwbGl0Iiwib2JqZWN0IiwiaSIsImRlY29kZVVSSUNvbXBvbmVudCIsIiRlbCIsImZsYWciLCJzaG93TG9hZGVyIiwic2hvdyIsIiRsb2FkZXIiLCJyZW1vdmUiLCIkY29kZSIsIiRkaWdpdHMiLCJzdWNjZXNzIiwiZXEiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsIiR0ZXh0Iiwib24iLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJjaGFuZ2VkVG91Y2hlcyIsImZhZGVUbyIsImFuaW1hdGUiLCJsZWZ0IiwicmVsYXRpdmVNb3VzZSIsInNsaWRlUGVyY2VudCIsImNzcyIsImpRdWVyeSIsIiRhZHZpY2VzIiwiJGFkdmljZSIsInNob3dEaWdpdGFsU2lnbiIsIl90eXBlb2YiLCJwcmVwZW5kIiwiY2xvc2VNb3ZpZVBheW1lbnQiLCJzaGFyZVRpY2tldCIsInBsYXlNb3ZpZSJdLCJtYXBwaW5ncyI6IjhQQUlBLFNBQUFBLEtBQUFDLEdBQ0FDLEVBQUEsYUFFQUMsS0FBQSxXQUNBLElBQUFDLEVBQUFGLEVBQUFHLE1BQ0FDLEVBQUFGLEVBQUFHLEtBQUEsTUFDQUMsRUFBQVAsRUFBQUssR0FFQSxXQUFBQSxFQUNBRixFQUFBSyxLQUFBQyxhQUFBRixJQUNBLFVBQUFGLEVBQ0EsVUFBQUUsR0FDQUcsV0FBQSxXQUFBQyxXQUFBUixHQUFBLElBQUEsS0FHQUEsRUFBQUssS0FBQUQsS0FVQSxTQUFBSyxhQUFBQyxFQUFBQyxHQUNBYixFQUFBLFdBQUFjLFNBQUEsY0FDQUYsRUFBQUcsWUFBQSxjQUVBRixJQVFBLFNBQUFMLGFBQUFRLEdBQ0EsTUFBQSxLQUFBQyxPQUFBRCxHQUFBRSxRQUFBLEdBQUFDLFFBQUEsd0JBQUEsS0FPQSxTQUFBQyxpQkFBQUMsR0FBQSxJQUFBQyxFQUFBRCxFQUFBQyxPQUFBQyxFQUFBRixFQUFBRSxRQUNBQyxFQUFBeEIsRUFBQXNCLEVBQUFHLFlBRUEsSUFBQUYsRUFDQSxFQUFBQyxFQUFBRSxPQUFBQyxVQUNBQyxFQUFB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SUFBQSxpQ0FFQSxtQkFBQXFELGlCQUFBLFlBQUEsb0JBQUFBLGdCQUFBLFlBQUFDLFFBQUFELG1CQUNBQSxnQkFBQSxTQUFBL0IsR0FDQUEsR0FDQUYsTUFBQWxFLFNBQUEsU0FFQUgsYUFBQVgsRUFBQSxrQkFBQSxXQUNBNEUsWUFBQSxPQUdBQSxZQUFBLEdBQ0FJLE1BQUFsRSxTQUFBLFdBRUFMLFdBQUEsV0FDQXdFLFFBQUFoRixLQUFBLFdBQUFELEVBQUFHLE1BQUEyQixJQUFBLE1BQ0FtRCxRQUFBRSxHQUFBLEdBQUFwRCxTQUNBLFNBU0EsUUFNQSxJQUFBa0QsUUFBQWpGLEVBQUEsNkJBRUFpRixRQUFBZSxHQUFBLDRDQUFBOUQsY0FDQStDLFFBQUFlLEdBQUEsUUFBQTVFLGtCQUVBNkQsUUFBQUUsR0FBQSxHQUFBcEQsUUFJQS9CLEVBQUEsNkJBQUFnRyxHQUFBLFFBQUEsV0FDQXJDLFFBQUFDLElBQUEsK0JBQ0E1RCxFQUFBLHVCQUFBbUgsUUFBQSw0QkFBQSxvQkFBQUMsa0JBQUEsWUFBQUYsUUFBQUUscUJBQ0EsbUJBQUFBLG1CQUFBLFlBQUEsb0JBQUFBLGtCQUFBLFlBQUFGLFFBQUFFLHFCQUNBQSxzQkFNQXBILEVBQUEsY0FBQWdHLEdBQUEsUUFBQSxXQUNBckMsUUFBQUMsSUFBQSw4QkFFQSxtQkFBQXlELGFBQUEsWUFBQSxvQkFBQUEsWUFBQSxZQUFBSCxRQUFBRyxlQUNBQSxnQkFNQXJILEVBQUEsY0FBQWdHLEdBQUEsUUFBQSxXQUNBckMsUUFBQUMsSUFBQSwwQkFFQSxtQkFBQTBELFdBQUEsWUFBQSxvQkFBQUEsVUFBQSxZQUFBSixRQUFBSSxhQUNBQSIsImZpbGUiOiJzY3JpcHRzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBCaW5kIEpTT04gdG8gSFRNTC5cclxuICogQHBhcmFtIHtvYmplY3R9IHZhbHVlc1xyXG4gKi9cclxuZnVuY3Rpb24gYmluZCh2YWx1ZXMpIHtcclxuICAgIGNvbnN0ICR0YWdzID0gJCgnW2RhdGEtaWRdJyk7XHJcblxyXG4gICAgJHRhZ3MuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgJHRhZyA9ICQodGhpcyk7XHJcbiAgICAgICAgY29uc3QgaWQgPSAkdGFnLmRhdGEoJ2lkJyk7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbaWRdO1xyXG5cclxuICAgICAgICBpZiAoaWQgPT09ICdwcmVjaW8nKSB7XHJcbiAgICAgICAgICAgICR0YWcuaHRtbChmb3JtYXRBbW91bnQodmFsdWUpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGlkID09PSAnc2FsZG8nKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJ2ZhbHNlJykge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHNob3dBZHZpY2UoJHRhZywgdHJ1ZSk7IH0sIDUwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkdGFnLmh0bWwodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogQ2hhbmdlIHNjcmVlbi5cclxuICogQHBhcmFtIHtqUXVlcnl9ICRzY3JlZW5cclxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcclxuICovXHJcbmZ1bmN0aW9uIGNoYW5nZVNjcmVlbigkc2NyZWVuLCBjYWxsYmFjaykge1xyXG4gICAgJCgnLnNjcmVlbicpLmFkZENsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICAkc2NyZWVuLnJlbW92ZUNsYXNzKCduby12aXNpYmxlJyk7XHJcblxyXG4gICAgY2FsbGJhY2soKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBhbW91bnQgd2l0aCBjdXJyZW5jeSBmb3JtYXQuXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBhbW91bnQgXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAqL1xyXG5mdW5jdGlvbiBmb3JtYXRBbW91bnQoYW1vdW50KSB7XHJcbiAgICByZXR1cm4gJyQgJyArIE51bWJlcihhbW91bnQpLnRvRml4ZWQoMikucmVwbGFjZSgvXFxCKD89KFxcZHszfSkrKD8hXFxkKSkvZywgJywnKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEhhbmRsZSBkaWdpdCBrZXl1cCBldmVudC5cclxuICogQHBhcmFtIHtLZXlib2FyZEV2ZW50fSBldmVudFxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlRGlnaXRLZXl1cCh7IHRhcmdldCwga2V5Q29kZSB9KSB7XHJcbiAgICBjb25zdCAkcGFyZW50ID0gJCh0YXJnZXQucGFyZW50Tm9kZSk7XHJcblxyXG4gICAgaWYgKGtleUNvZGUgPT09IDgpIHtcclxuICAgICAgICBpZiAoJHBhcmVudC5wcmV2KCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCAkaW5wdXQgPSAkcGFyZW50LnByZXYoKS5maW5kKCdpbnB1dCcpO1xyXG5cclxuICAgICAgICAgICAgJGlucHV0LnZhbCgnJyk7XHJcbiAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9IGVsc2UgaWYgKGtleUNvZGUgPiA0NyAmJiBrZXlDb2RlIDwgNTgpIHtcclxuICAgICAgICBpZiAodGFyZ2V0LnZhbHVlICE9PSAnJykge1xyXG4gICAgICAgICAgICBpZiAoJHBhcmVudC5uZXh0KCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJHBhcmVudC5uZXh0KCkuZmluZCgnaW5wdXQnKTtcclxuICAgICAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHZhbGlkYXRlQ29kZSgpO1xyXG59XHJcblxyXG4vKipcclxuICogQXBwbHkgbnVtYmVyIGZpbHRlci5cclxuICogQHBhcmFtIHtFdmVudH0gZXZlbnRcclxuICovXHJcbmZ1bmN0aW9uIG51bWJlckZpbHRlcihldmVudCkge1xyXG4gICAgY29uc3QgZmlsdGVyID0gL15cXGR7MCwxfSQvO1xyXG5cclxuICAgIGlmIChmaWx0ZXIudGVzdCh0aGlzLnZhbHVlKSkge1xyXG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xyXG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uU3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xyXG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uRW5kID0gdGhpcy5zZWxlY3Rpb25FbmQ7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoJ29sZFZhbHVlJykpIHtcclxuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcclxuICAgICAgICB0aGlzLnNldFNlbGVjdGlvblJhbmdlKHRoaXMub2xkU2VsZWN0aW9uU3RhcnQsIHRoaXMub2xkU2VsZWN0aW9uRW5kKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9ICcnO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogTWFrZSByZXF1ZXN0LlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsIFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBib2R5XHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBoZWFkZXJzIFxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBcclxuICovXHJcbmZ1bmN0aW9uIHJlcXVlc3QodXJsLCBtZXRob2QsIGJvZHksIGhlYWRlcnMsIGNhbGxiYWNrKSB7XHJcbiAgICB2YXIgbXlIZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcclxuICAgIG15SGVhZGVycy5hcHBlbmQoXCJBdXRob3JpemF0aW9uXCIsIFwiQmFzaWMgXCIgKyBidG9hKFwiMThoOHZhbnZyaDRwdWkxbHJudGMxbmlsamZcIiArIFwiOlwiICsgXCIxZ2UzMWJoanJkazlkMGphMTRtZnQ4cWVwaTRjbGt0ODA1anFiMnN2cXZtYjRzbzF2NGc3XCIpKTtcclxuICAgIG15SGVhZGVycy5hcHBlbmQoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIik7XHJcbiAgICBteUhlYWRlcnMuYXBwZW5kKFwiQ29va2llXCIsIFwiWFNSRi1UT0tFTj1iNGE1NGYxYi1hZmU1LTRhZWUtOWE3Ni0wMGY5MjA0MThiNmVcIik7XHJcblxyXG4gICAgLyogdmFyIHVybGVuY29kZWQgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XHJcbiAgICB1cmxlbmNvZGVkLmFwcGVuZChcImdyYW50X3R5cGVcIiwgXCJjbGllbnRfY3JlZGVudGlhbHNcIik7ICovXHJcblxyXG4gICAgdmFyIHJlcXVlc3RPcHRpb25zID0ge1xyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIGhlYWRlcnM6IG15SGVhZGVycyxcclxuICAgICAgICBib2R5OiBcImdyYW50X3R5cGU9Y2xpZW50X2NyZWRlbnRpYWxzXCIsXHJcbiAgICAgICAgcmVkaXJlY3Q6ICdmb2xsb3cnXHJcbiAgICB9O1xyXG5cclxuICAgIGZldGNoKFwiaHR0cHM6Ly9vbW02b3VnNXBnLmV4ZWN1dGUtYXBpLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL2Rlc2Fycm9sbG8vb2F1dGgyL3YxL3Rva2VuXCIsIHJlcXVlc3RPcHRpb25zKVxyXG4gICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLnRleHQoKSlcclxuICAgICAgICAudGhlbihyZXN1bHQgPT4gY29uc29sZS5sb2cocmVzdWx0KSlcclxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5sb2coJ2Vycm9yJywgZXJyb3IpKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIERvIGZha2UgcmVxdWVzdC5cclxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcclxuICovXHJcbmZ1bmN0aW9uIGZha2VSZXF1ZXN0KGNvZGUsIGNhbGxiYWNrKSB7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBjYWxsYmFjayhjb2RlID09PSAnMDAwMDAxJyk7XHJcbiAgICB9LCAxNTAwKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFBhcnNlIGxvY2F0aW9uLnNlYXJjaCB0byBKU09OLlxyXG4gKiBAcmV0dXJucyBvYmplY3RcclxuICovXHJcbmZ1bmN0aW9uIHNlYXJjaFRvSnNvbigpIHtcclxuICAgIGNvbnN0IHBhaXJzID0gbG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKS5zcGxpdCgnJicpO1xyXG4gICAgY29uc3Qgb2JqZWN0ID0ge307XHJcbiAgICBsZXQgaSA9IDA7XHJcblxyXG4gICAgZm9yICg7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGlmIChwYWlyc1tpXSA9PT0gJycpIHtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwYXJ0cyA9IHBhaXJzW2ldLnNwbGl0KCc9Jyk7XHJcbiAgICAgICAgb2JqZWN0W2RlY29kZVVSSUNvbXBvbmVudChwYXJ0c1swXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzFdKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gb2JqZWN0O1xyXG59XHJcblxyXG4vKipcclxuICogU2hvdyBvciBoaWRlIGFkdmljZS5cclxuICogQHBhcmFtIHtqUXVlcnl9ICRlbCBcclxuICogQHBhcmFtIHtib29sZWFufSBmbGFnIFxyXG4gKi9cclxuZnVuY3Rpb24gc2hvd0FkdmljZSgkZWwsIGZsYWcpIHtcclxuICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgJGVsLmFkZENsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICRlbC5yZW1vdmVDbGFzcygnbm8tdmlzaWJsZScpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogU2hvdyBvciBoaWRlIGxvYWRlci5cclxuICogQHBhcmFtIHtib29sZWFufSBzaG93XHJcbiAqL1xyXG5mdW5jdGlvbiBzaG93TG9hZGVyKHNob3cpIHtcclxuICAgIGxldCAkbG9hZGVyID0gJCgnLmxvYWRlcicpO1xyXG5cclxuICAgIGlmIChzaG93KSB7XHJcbiAgICAgICAgaWYgKCRsb2FkZXIubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgJGxvYWRlciA9ICQoJzxkaXYgY2xhc3M9XCJsb2FkZXJcIj4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJGxvYWRlcik7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiAkbG9hZGVyLmFkZENsYXNzKCdsb2FkZXItdmlzaWJsZScpLCAxMCk7XHJcblxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkbG9hZGVyLnJlbW92ZUNsYXNzKCdsb2FkZXItdmlzaWJsZScpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gJGxvYWRlci5yZW1vdmUoKSwgMzc1KTtcclxuXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZGF0ZSBjb2RlIGZyb20gY2xpZW50LlxyXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuICovXHJcbmZ1bmN0aW9uIHZhbGlkYXRlQ29kZSgpIHtcclxuICAgIGNvbnN0ICRjb2RlID0gJCgnLmF1dGgtc2NyZWVuIC5jb2RlJyk7XHJcbiAgICBjb25zdCAkZGlnaXRzID0gJCgnLmF1dGgtc2NyZWVuIC5kaWdpdCBpbnB1dCcpO1xyXG4gICAgbGV0IGNvZGUgPSBcIlwiO1xyXG5cclxuICAgICRkaWdpdHMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29kZSArPSB0aGlzLnZhbHVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGNvZGUubGVuZ3RoID09PSA2KSB7XHJcbiAgICAgICAgc2hvd0xvYWRlcih0cnVlKTtcclxuXHJcbiAgICAgICAgZmFrZVJlcXVlc3QoY29kZSwgc3VjY2VzcyA9PiB7XHJcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAkY29kZS5hZGRDbGFzcygndmFsaWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjaGFuZ2VTY3JlZW4oJCgnLnJlc3VtZS1zY3JlZW4nKSwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCdpbnZhbGlkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHsgJCh0aGlzKS52YWwoJycpOyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVxKDApLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICRjb2RlLnJlbW92ZUNsYXNzKCd2YWxpZCBpbnZhbGlkJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4vLyBJbml0aWFsaXplIERldGFpbCBTY3JlZW4gY29tcG9uZW50cy5cclxuYmluZChzZWFyY2hUb0pzb24oKSk7XHJcblxyXG5jb25zdCAkYWR2aWNlcyA9ICQoJy5hZHZpY2UuZml4ZWQnKTtcclxuXHJcbiRhZHZpY2VzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3QgJGFkdmljZSA9ICQodGhpcyk7XHJcbiAgICBjb25zdCAkY2xvc2VCdG4gPSAkYWR2aWNlLmZpbmQoJy5jbG9zZS1idG4nKTtcclxuXHJcbiAgICAkY2xvc2VCdG4ub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNob3dBZHZpY2UoJGFkdmljZSwgZmFsc2UpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuJCgnLmRldGFpbC1zY3JlZW4gLnN3aXBlLWJ0bicpLnN3aXBlKHtcclxuICAgIGNiOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc2hvd0xvYWRlcih0cnVlKTtcclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBPcGVuIGRpZ2l0YWwgc2lnbicpXHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHNob3dEaWdpdGFsU2lnbiA9PT0gJ2Z1bmN0aW9uJyB8fCB0eXBlb2Ygc2hvd0RpZ2l0YWxTaWduID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgc2hvd0RpZ2l0YWxTaWduKGZ1bmN0aW9uIChzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ3ZhbGlkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VTY3JlZW4oJCgnLnJlc3VtZS1zY3JlZW4nKSwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkY29kZS5hZGRDbGFzcygnaW52YWxpZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkgeyAkKHRoaXMpLnZhbCgnJyk7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lcSgwKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8qIGNoYW5nZVNjcmVlbigkKCcuYXV0aC1zY3JlZW4nKSwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKS5lcSgwKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfSk7ICovXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCA1MDApO1xyXG4gICAgfVxyXG59KTtcclxuXHJcblxyXG4vLyBJbml0aWFsaXplIEF1dGggU2NyZWVuIGNvbXBvbmVudHMuXHJcbmNvbnN0ICRkaWdpdHMgPSAkKCcuYXV0aC1zY3JlZW4gLmRpZ2l0IGlucHV0Jyk7XHJcblxyXG4kZGlnaXRzLm9uKCdrZXlwcmVzcyBrZXlkb3duIGtleXVwIGlucHV0IGNoYW5nZSBwYXN0ZScsIG51bWJlckZpbHRlcilcclxuJGRpZ2l0cy5vbigna2V5dXAnLCBoYW5kbGVEaWdpdEtleXVwKTtcclxuXHJcbiRkaWdpdHMuZXEoMCkuZm9jdXMoKTtcclxuXHJcblxyXG4vLyBJbml0aWFsaXplIGNsb3NlIGJ1dHRvbnMuXHJcbiQoJy5zY3JlZW4gaGVhZGVyIC5jbG9zZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogQ2xvc2luZyBXZWJWaWV3Jyk7XHJcbiAgICAkKCcuZGV0YWlsLXNjcmVlbiBtYWluJykucHJlcGVuZCgndHlwZW9mIGNsb3NlTW92aWVQYXltZW50JyArIHR5cGVvZiBjbG9zZU1vdmllUGF5bWVudCk7XHJcbiAgICBpZiAodHlwZW9mIGNsb3NlTW92aWVQYXltZW50ID09PSAnZnVuY3Rpb24nIHx8IHR5cGVvZiBjbG9zZU1vdmllUGF5bWVudCA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICBjbG9zZU1vdmllUGF5bWVudCgpO1xyXG4gICAgfVxyXG59KTtcclxuXHJcblxyXG4vLyBJbml0aWFsaXplIHNoYXJlIGJ1dHRvbi5cclxuJCgnLnNoYXJlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBTaGFyaW5nIHRpY2tldCcpO1xyXG5cclxuICAgIGlmICh0eXBlb2Ygc2hhcmVUaWNrZXQgPT09ICdmdW5jdGlvbicgfHwgdHlwZW9mIHNoYXJlVGlja2V0ID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIHNoYXJlVGlja2V0KCk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgbW92aWUgYnV0dG9uLlxyXG4kKCcubW92aWUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IFBsYXkgbW92aWUnKTtcclxuXHJcbiAgICBpZiAodHlwZW9mIHBsYXlNb3ZpZSA9PT0gJ2Z1bmN0aW9uJyB8fCB0eXBlb2YgcGxheU1vdmllID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIHBsYXlNb3ZpZSgpO1xyXG4gICAgfVxyXG59KTtcclxuIiwiLy8gUmVmZXJlbmNlOiBodHRwczovL2NvZGVwZW4uaW8vZ3ByZXNzdXR0bzUvcGVuL05qSm9iRz9lZGl0b3JzPTAwMTBcclxuXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgJC5mbi5zd2lwZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgdmFyIHNldHRpbmdzID0gJC5leHRlbmQoe1xyXG4gICAgICAgICAgICBjYjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc3dpcGUgZG9uZScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgb3B0aW9ucyk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICB2YXIgaW5pdGlhbE1vdXNlID0gMDtcclxuICAgICAgICAgICAgdmFyIHNsaWRlTW92ZW1lbnRUb3RhbCA9IDA7XHJcbiAgICAgICAgICAgIHZhciBtb3VzZUlzRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgJHNsaWRlciA9ICR0aGlzLmZpbmQoJy5zbGlkZXInKTtcclxuICAgICAgICAgICAgdmFyICR0ZXh0ID0gJHRoaXMuZmluZCgnLnRleHQnKTtcclxuXHJcbiAgICAgICAgICAgICRzbGlkZXIub24oJ21vdXNlZG93biB0b3VjaHN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBtb3VzZUlzRG93biA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBzbGlkZU1vdmVtZW50VG90YWwgPSAkdGhpcy53aWR0aCgpIC0gJCh0aGlzKS53aWR0aCgpICsgMTA7XHJcbiAgICAgICAgICAgICAgICBpbml0aWFsTW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXS5wYWdlWDtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKGRvY3VtZW50LmJvZHksICRzbGlkZXIpLm9uKCdtb3VzZXVwIHRvdWNoZW5kJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW1vdXNlSXNEb3duKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIG1vdXNlSXNEb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWDtcclxuICAgICAgICAgICAgICAgIHZhciByZWxhdGl2ZU1vdXNlID0gY3VycmVudE1vdXNlIC0gaW5pdGlhbE1vdXNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlIDwgc2xpZGVNb3ZlbWVudFRvdGFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRleHQuZmFkZVRvKDMwMCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5hbmltYXRlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogXCItMTBweFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLyogJHNsaWRlci5hZGRDbGFzcygndW5sb2NrZWQnKTtcclxuICAgICAgICAgICAgICAgICQoJyNsb2NrZXInKS50ZXh0KCdsb2NrX291dGxpbmUnKTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIub24oJ2NsaWNrIHRhcCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISRzbGlkZXIuaGFzQ2xhc3MoJ3VubG9ja2VkJykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzbGlkZXIucmVtb3ZlQ2xhc3MoJ3VubG9ja2VkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNsb2NrZXInKS50ZXh0KCdsb2NrX29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5vZmYoJ2NsaWNrIHRhcCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSwgMCk7ICovXHJcblxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuY2IoKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSkub24oJ21vdXNlbW92ZSB0b3VjaG1vdmUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghbW91c2VJc0Rvd24pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50TW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXS5wYWdlWDtcclxuICAgICAgICAgICAgICAgIHZhciByZWxhdGl2ZU1vdXNlID0gY3VycmVudE1vdXNlIC0gaW5pdGlhbE1vdXNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNsaWRlUGVyY2VudCA9IDEgLSAocmVsYXRpdmVNb3VzZSAvIHNsaWRlTW92ZW1lbnRUb3RhbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHRleHQuZmFkZVRvKDAsIHNsaWRlUGVyY2VudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIuY3NzKHsgJ2xlZnQnOiAnLTEwcHgnIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlID49IHNsaWRlTW92ZW1lbnRUb3RhbCArIDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6IHNsaWRlTW92ZW1lbnRUb3RhbCArICdweCcgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6IHJlbGF0aXZlTW91c2UgLSAxMCB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pKGpRdWVyeSk7XHJcbiJdfQ==

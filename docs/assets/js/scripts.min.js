"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bind(o){$("[data-id]").each(function(){var e=$(this),t=e.data("id"),n=o[t];"precio"===t?e.html(formatAmount(n)):"saldo"===t?"false"===n&&setTimeout(function(){showAdvice(e,!0)},500):e.html(n)})}function changeScreen(e,t){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),t()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var t=e.target,n=e.keyCode,o=$(t.parentNode);8===n?0<o.prev().length&&((e=o.prev().find("input")).val(""),e.focus()):47<n&&n<58&&""!==t.value&&0<o.next().length&&o.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function request(e,t,n,o,i){var s=new Headers;s.append("Authorization","Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7")),s.append("Content-Type","application/x-www-form-urlencoded"),s.append("Cookie","XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"),fetch("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token",{method:"POST",headers:s,body:"grant_type=client_credentials",redirect:"follow"}).then(function(e){return e.text()}).then(function(e){return console.log(e)}).catch(function(e){return console.log("error",e)})}function fakeRequest(e,t){setTimeout(function(){t("000001"===e)},1500)}function searchToJson(){for(var e,t=location.search.substring(1).split("&"),n={},o=0;o<t.length;o++)""!==t[o]&&(e=t[o].split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return n}function showAdvice(e,t){t?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var t=$(".loader");e?(t.length<=0&&(t=$('<div class="loader">')),$("body").append(t),setTimeout(function(){return t.addClass("loader-visible")},10)):(t.removeClass("loader-visible"),setTimeout(function(){return t.remove()},375))}function validateCode(){var t=$(".auth-screen .code"),n=$(".auth-screen .digit input"),e="";n.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(t.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),t.addClass("invalid"),setTimeout(function(){n.each(function(){$(this).val("")}),n.eq(0).focus()},100))})):t.removeClass("valid invalid")}!function(d){d.fn.swipe=function(e){var c=d.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var t=d(this),n=0,o=0,i=!1,s=t.find(".slider"),a=t.find(".text");s.on("mousedown touchstart",function(e){i=!0,o=t.width()-d(this).width()+10,n=e.clientX||e.originalEvent.touches[0].pageX}),d(document.body,s).on("mouseup touchend",function(e){if(i){if(i=!1,(e.clientX||e.changedTouches[0].pageX)-n<o)return a.fadeTo(300,1),void s.animate({left:"-10px"},300);c.cb()}}),d(document.body).on("mousemove touchmove",function(e){var t;i&&(e=1-(t=(e.clientX||e.originalEvent.touches[0].pageX)-n)/o,a.fadeTo(0,e),t<=0?s.css({left:"-10px"}):o+10<=t?s.css({left:o+"px"}):s.css({left:t-10}))})})}}(jQuery),bind(searchToJson());var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),"function"!=typeof showDigitalSign&&"object"!==("undefined"==typeof showDigitalSign?"undefined":_typeof(showDigitalSign))||showDigitalSign(function(e){e?($code.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),$code.addClass("invalid"),setTimeout(function(){$digits.each(function(){$(this).val("")}),$digits.eq(0).focus()},100))})},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),"webkit"in window&&window.webkit.messageHandlers.closeMoviePayment.postMessage("closeMoviePayment")}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),"function"!=typeof shareTicket&&"object"!==("undefined"==typeof shareTicket?"undefined":_typeof(shareTicket))||shareTicket()}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),"function"!=typeof playMovie&&"object"!==("undefined"==typeof playMovie?"undefined":_typeof(playMovie))||playMovie()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMuanMiLCJqcXVlcnkuc3dpcGUuanMiXSwibmFtZXMiOlsiYmluZCIsInZhbHVlcyIsIiQiLCJlYWNoIiwiJHRhZyIsInRoaXMiLCJpZCIsImRhdGEiLCJ2YWx1ZSIsImh0bWwiLCJmb3JtYXRBbW91bnQiLCJzZXRUaW1lb3V0Iiwic2hvd0FkdmljZSIsImNoYW5nZVNjcmVlbiIsIiRzY3JlZW4iLCJjYWxsYmFjayIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJhbW91bnQiLCJOdW1iZXIiLCJ0b0ZpeGVkIiwicmVwbGFjZSIsImhhbmRsZURpZ2l0S2V5dXAiLCJfcmVmIiwidGFyZ2V0Iiwia2V5Q29kZSIsIiRwYXJlbnQiLCJwYXJlbnROb2RlIiwicHJldiIsImxlbmd0aCIsIiRpbnB1dCIsImZpbmQiLCJ2YWwiLCJmb2N1cyIsIm5leHQiLCJ2YWxpZGF0ZUNvZGUiLCJudW1iZXJGaWx0ZXIiLCJldmVudCIsInRlc3QiLCJvbGRWYWx1ZSIsIm9sZFNlbGVjdGlvblN0YXJ0Iiwic2VsZWN0aW9uU3RhcnQiLCJvbGRTZWxlY3Rpb25FbmQiLCJzZWxlY3Rpb25FbmQiLCJoYXNPd25Qcm9wZXJ0eSIsInNldFNlbGVjdGlvblJhbmdlIiwicmVxdWVzdCIsInVybCIsIm1ldGhvZCIsImJvZHkiLCJoZWFkZXJzIiwibXlIZWFkZXJzIiwiSGVhZGVycyIsImFwcGVuZCIsImJ0b2EiLCJmZXRjaCIsInJlZGlyZWN0IiwidGhlbiIsInJlc3BvbnNlIiwidGV4dCIsInJlc3VsdCIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsImZha2VSZXF1ZXN0IiwiY29kZSIsInNlYXJjaFRvSnNvbiIsInBhcnRzIiwicGFpcnMiLCJsb2NhdGlvbiIsInNlYXJjaCIsInN1YnN0cmluZyIsInNwbGl0Iiwib2JqZWN0IiwiaSIsImRlY29kZVVSSUNvbXBvbmVudCIsIiRlbCIsImZsYWciLCJzaG93TG9hZGVyIiwic2hvdyIsIiRsb2FkZXIiLCJyZW1vdmUiLCIkY29kZSIsIiRkaWdpdHMiLCJzdWNjZXNzIiwiZXEiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsIiR0ZXh0Iiwib24iLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJjaGFuZ2VkVG91Y2hlcyIsImZhZGVUbyIsImFuaW1hdGUiLCJsZWZ0IiwicmVsYXRpdmVNb3VzZSIsInNsaWRlUGVyY2VudCIsImNzcyIsImpRdWVyeSIsIiRhZHZpY2VzIiwiJGFkdmljZSIsInNob3dEaWdpdGFsU2lnbiIsIl90eXBlb2YiLCJ3aW5kb3ciLCJ3ZWJraXQiLCJtZXNzYWdlSGFuZGxlcnMiLCJjbG9zZU1vdmllUGF5bWVudCIsInBvc3RNZXNzYWdlIiwic2hhcmVUaWNrZXQiLCJwbGF5TW92aWUiXSwibWFwcGluZ3MiOiI4UEFJQSxTQUFBQSxLQUFBQyxHQUNBQyxFQUFBLGFBRUFDLEtBQUEsV0FDQSxJQUFBQyxFQUFBRixFQUFBRyxNQUNBQyxFQUFBRixFQUFBRyxLQUFBLE1BQ0FDLEVBQUFQLEVBQUFLLEdBRUEsV0FBQUEsRUFDQUYsRUFBQUssS0FBQUMsYUFBQUYsSUFDQSxVQUFBRixFQUNBLFVBQUFFLEdBQ0FHLFdBQUEsV0FBQUMsV0FBQVIsR0FBQSxJQUFBLEtBR0FBLEVBQUFLLEtBQUFELEtBVUEsU0FBQUssYUFBQUMsRUFBQUMsR0FDQWIsRUFBQSxXQUFBYyxTQUFBLGNBQ0FGLEVBQUFHLFlBQUEsY0FFQUYsSUFRQSxTQUFBTCxhQUFBUSxHQUNBLE1BQUEsS0FBQUMsT0FBQUQsR0FBQUUsUUFBQSxHQUFBQyxRQUFBLHdCQUFBLEtBT0EsU0FBQUMsaUJBQUFDLEdBQUEsSUFBQUMsRUFBQUQsRUFBQUMsT0FBQUMsRUFBQUYsRUFBQUUsUUFDQUMsRUFBQXhCLEVBQUFzQixFQUFBRyxZQUVB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QUFBLFdBQ0FiLFlBQUEsR0FFQW5FLFdBQUEsV0FDQWtELFFBQUFDLElBQUEsaUNBRUEsbUJBQUFxRCxpQkFBQSxZQUFBLG9CQUFBQSxnQkFBQSxZQUFBQyxRQUFBRCxtQkFDQUEsZ0JBQUEsU0FBQS9CLEdBQ0FBLEdBQ0FGLE1BQUFsRSxTQUFBLFNBRUFILGFBQUFYLEVBQUEsa0JBQUEsV0FDQTRFLFlBQUEsT0FHQUEsWUFBQSxHQUNBSSxNQUFBbEUsU0FBQSxXQUVBTCxXQUFBLFdBQ0F3RSxRQUFBaEYsS0FBQSxXQUFBRCxFQUFBRyxNQUFBMkIsSUFBQSxNQUNBbUQsUUFBQUUsR0FBQSxHQUFBcEQsU0FDQSxTQVNBLFFBTUEsSUFBQWtELFFBQUFqRixFQUFBLDZCQUVBaUYsUUFBQWUsR0FBQSw0Q0FBQTlELGNBQ0ErQyxRQUFBZSxHQUFBLFFBQUE1RSxrQkFFQTZELFFBQUFFLEdBQUEsR0FBQXBELFFBSUEvQixFQUFBLDZCQUFBZ0csR0FBQSxRQUFBLFdBQ0FyQyxRQUFBQyxJQUFBLCtCQUVBLFdBQUF1RCxRQUNBQSxPQUFBQyxPQUFBQyxnQkFBQUMsa0JBQUFDLFlBQUEsdUJBTUF2SCxFQUFBLGNBQUFnRyxHQUFBLFFBQUEsV0FDQXJDLFFBQUFDLElBQUEsOEJBRUEsbUJBQUE0RCxhQUFBLFlBQUEsb0JBQUFBLFlBQUEsWUFBQU4sUUFBQU0sZUFDQUEsZ0JBTUF4SCxFQUFBLGNBQUFnRyxHQUFBLFFBQUEsV0FDQXJDLFFBQUFDLElBQUEsMEJBRUEsbUJBQUE2RCxXQUFBLFlBQUEsb0JBQUFBLFVBQUEsWUFBQVAsUUFBQU8sYUFDQUEiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQmluZCBKU09OIHRvIEhUTUwuXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXNcclxuICovXHJcbmZ1bmN0aW9uIGJpbmQodmFsdWVzKSB7XHJcbiAgICBjb25zdCAkdGFncyA9ICQoJ1tkYXRhLWlkXScpO1xyXG5cclxuICAgICR0YWdzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0ICR0YWcgPSAkKHRoaXMpO1xyXG4gICAgICAgIGNvbnN0IGlkID0gJHRhZy5kYXRhKCdpZCcpO1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2lkXTtcclxuXHJcbiAgICAgICAgaWYgKGlkID09PSAncHJlY2lvJykge1xyXG4gICAgICAgICAgICAkdGFnLmh0bWwoZm9ybWF0QW1vdW50KHZhbHVlKSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChpZCA9PT0gJ3NhbGRvJykge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09ICdmYWxzZScpIHtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBzaG93QWR2aWNlKCR0YWcsIHRydWUpOyB9LCA1MDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJHRhZy5odG1sKHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENoYW5nZSBzY3JlZW4uXHJcbiAqIEBwYXJhbSB7alF1ZXJ5fSAkc2NyZWVuXHJcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXHJcbiAqL1xyXG5mdW5jdGlvbiBjaGFuZ2VTY3JlZW4oJHNjcmVlbiwgY2FsbGJhY2spIHtcclxuICAgICQoJy5zY3JlZW4nKS5hZGRDbGFzcygnbm8tdmlzaWJsZScpO1xyXG4gICAgJHNjcmVlbi5yZW1vdmVDbGFzcygnbm8tdmlzaWJsZScpO1xyXG5cclxuICAgIGNhbGxiYWNrKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgYW1vdW50IHdpdGggY3VycmVuY3kgZm9ybWF0LlxyXG4gKiBAcGFyYW0ge251bWJlcn0gYW1vdW50IFxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gKi9cclxuZnVuY3Rpb24gZm9ybWF0QW1vdW50KGFtb3VudCkge1xyXG4gICAgcmV0dXJuICckICcgKyBOdW1iZXIoYW1vdW50KS50b0ZpeGVkKDIpLnJlcGxhY2UoL1xcQig/PShcXGR7M30pKyg/IVxcZCkpL2csICcsJyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBIYW5kbGUgZGlnaXQga2V5dXAgZXZlbnQuXHJcbiAqIEBwYXJhbSB7S2V5Ym9hcmRFdmVudH0gZXZlbnRcclxuICovXHJcbmZ1bmN0aW9uIGhhbmRsZURpZ2l0S2V5dXAoeyB0YXJnZXQsIGtleUNvZGUgfSkge1xyXG4gICAgY29uc3QgJHBhcmVudCA9ICQodGFyZ2V0LnBhcmVudE5vZGUpO1xyXG5cclxuICAgIGlmIChrZXlDb2RlID09PSA4KSB7XHJcbiAgICAgICAgaWYgKCRwYXJlbnQucHJldigpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJHBhcmVudC5wcmV2KCkuZmluZCgnaW5wdXQnKTtcclxuXHJcbiAgICAgICAgICAgICRpbnB1dC52YWwoJycpO1xyXG4gICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSBlbHNlIGlmIChrZXlDb2RlID4gNDcgJiYga2V5Q29kZSA8IDU4KSB7XHJcbiAgICAgICAgaWYgKHRhcmdldC52YWx1ZSAhPT0gJycpIHtcclxuICAgICAgICAgICAgaWYgKCRwYXJlbnQubmV4dCgpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0ICRpbnB1dCA9ICRwYXJlbnQubmV4dCgpLmZpbmQoJ2lucHV0Jyk7XHJcbiAgICAgICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB2YWxpZGF0ZUNvZGUoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEFwcGx5IG51bWJlciBmaWx0ZXIuXHJcbiAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50XHJcbiAqL1xyXG5mdW5jdGlvbiBudW1iZXJGaWx0ZXIoZXZlbnQpIHtcclxuICAgIGNvbnN0IGZpbHRlciA9IC9eXFxkezAsMX0kLztcclxuXHJcbiAgICBpZiAoZmlsdGVyLnRlc3QodGhpcy52YWx1ZSkpIHtcclxuICAgICAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy52YWx1ZTtcclxuICAgICAgICB0aGlzLm9sZFNlbGVjdGlvblN0YXJ0ID0gdGhpcy5zZWxlY3Rpb25TdGFydDtcclxuICAgICAgICB0aGlzLm9sZFNlbGVjdGlvbkVuZCA9IHRoaXMuc2VsZWN0aW9uRW5kO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmhhc093blByb3BlcnR5KCdvbGRWYWx1ZScpKSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMub2xkVmFsdWU7XHJcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb25SYW5nZSh0aGlzLm9sZFNlbGVjdGlvblN0YXJ0LCB0aGlzLm9sZFNlbGVjdGlvbkVuZCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSAnJztcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIE1ha2UgcmVxdWVzdC5cclxuICogQHBhcmFtIHtzdHJpbmd9IHVybCBcclxuICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZFxyXG4gKiBAcGFyYW0ge29iamVjdH0gYm9keVxyXG4gKiBAcGFyYW0ge29iamVjdH0gaGVhZGVycyBcclxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgXHJcbiAqL1xyXG5mdW5jdGlvbiByZXF1ZXN0KHVybCwgbWV0aG9kLCBib2R5LCBoZWFkZXJzLCBjYWxsYmFjaykge1xyXG4gICAgdmFyIG15SGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XHJcbiAgICBteUhlYWRlcnMuYXBwZW5kKFwiQXV0aG9yaXphdGlvblwiLCBcIkJhc2ljIFwiICsgYnRvYShcIjE4aDh2YW52cmg0cHVpMWxybnRjMW5pbGpmXCIgKyBcIjpcIiArIFwiMWdlMzFiaGpyZGs5ZDBqYTE0bWZ0OHFlcGk0Y2xrdDgwNWpxYjJzdnF2bWI0c28xdjRnN1wiKSk7XHJcbiAgICBteUhlYWRlcnMuYXBwZW5kKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIpO1xyXG4gICAgbXlIZWFkZXJzLmFwcGVuZChcIkNvb2tpZVwiLCBcIlhTUkYtVE9LRU49YjRhNTRmMWItYWZlNS00YWVlLTlhNzYtMDBmOTIwNDE4YjZlXCIpO1xyXG5cclxuICAgIC8qIHZhciB1cmxlbmNvZGVkID0gbmV3IFVSTFNlYXJjaFBhcmFtcygpO1xyXG4gICAgdXJsZW5jb2RlZC5hcHBlbmQoXCJncmFudF90eXBlXCIsIFwiY2xpZW50X2NyZWRlbnRpYWxzXCIpOyAqL1xyXG5cclxuICAgIHZhciByZXF1ZXN0T3B0aW9ucyA9IHtcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBoZWFkZXJzOiBteUhlYWRlcnMsXHJcbiAgICAgICAgYm9keTogXCJncmFudF90eXBlPWNsaWVudF9jcmVkZW50aWFsc1wiLFxyXG4gICAgICAgIHJlZGlyZWN0OiAnZm9sbG93J1xyXG4gICAgfTtcclxuXHJcbiAgICBmZXRjaChcImh0dHBzOi8vb21tNm91ZzVwZy5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9kZXNhcnJvbGxvL29hdXRoMi92MS90b2tlblwiLCByZXF1ZXN0T3B0aW9ucylcclxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS50ZXh0KCkpXHJcbiAgICAgICAgLnRoZW4ocmVzdWx0ID0+IGNvbnNvbGUubG9nKHJlc3VsdCkpXHJcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUubG9nKCdlcnJvcicsIGVycm9yKSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEbyBmYWtlIHJlcXVlc3QuXHJcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXHJcbiAqL1xyXG5mdW5jdGlvbiBmYWtlUmVxdWVzdChjb2RlLCBjYWxsYmFjaykge1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgY2FsbGJhY2soY29kZSA9PT0gJzAwMDAwMScpO1xyXG4gICAgfSwgMTUwMCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBQYXJzZSBsb2NhdGlvbi5zZWFyY2ggdG8gSlNPTi5cclxuICogQHJldHVybnMgb2JqZWN0XHJcbiAqL1xyXG5mdW5jdGlvbiBzZWFyY2hUb0pzb24oKSB7XHJcbiAgICBjb25zdCBwYWlycyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSkuc3BsaXQoJyYnKTtcclxuICAgIGNvbnN0IG9iamVjdCA9IHt9O1xyXG4gICAgbGV0IGkgPSAwO1xyXG5cclxuICAgIGZvciAoOyBpIDwgcGFpcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpZiAocGFpcnNbaV0gPT09ICcnKSB7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGFydHMgPSBwYWlyc1tpXS5zcGxpdCgnPScpO1xyXG4gICAgICAgIG9iamVjdFtkZWNvZGVVUklDb21wb25lbnQocGFydHNbMF0pXSA9IGRlY29kZVVSSUNvbXBvbmVudChwYXJ0c1sxXSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG9iamVjdDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNob3cgb3IgaGlkZSBhZHZpY2UuXHJcbiAqIEBwYXJhbSB7alF1ZXJ5fSAkZWwgXHJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gZmxhZyBcclxuICovXHJcbmZ1bmN0aW9uIHNob3dBZHZpY2UoJGVsLCBmbGFnKSB7XHJcbiAgICBpZiAoZmxhZykge1xyXG4gICAgICAgICRlbC5hZGRDbGFzcygnbm8tdmlzaWJsZScpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkZWwucmVtb3ZlQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFNob3cgb3IgaGlkZSBsb2FkZXIuXHJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gc2hvd1xyXG4gKi9cclxuZnVuY3Rpb24gc2hvd0xvYWRlcihzaG93KSB7XHJcbiAgICBsZXQgJGxvYWRlciA9ICQoJy5sb2FkZXInKTtcclxuXHJcbiAgICBpZiAoc2hvdykge1xyXG4gICAgICAgIGlmICgkbG9hZGVyLmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgICRsb2FkZXIgPSAkKCc8ZGl2IGNsYXNzPVwibG9hZGVyXCI+Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkKCdib2R5JykuYXBwZW5kKCRsb2FkZXIpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gJGxvYWRlci5hZGRDbGFzcygnbG9hZGVyLXZpc2libGUnKSwgMTApO1xyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGxvYWRlci5yZW1vdmVDbGFzcygnbG9hZGVyLXZpc2libGUnKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+ICRsb2FkZXIucmVtb3ZlKCksIDM3NSk7XHJcblxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogVmFsaWRhdGUgY29kZSBmcm9tIGNsaWVudC5cclxuICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAqL1xyXG5mdW5jdGlvbiB2YWxpZGF0ZUNvZGUoKSB7XHJcbiAgICBjb25zdCAkY29kZSA9ICQoJy5hdXRoLXNjcmVlbiAuY29kZScpO1xyXG4gICAgY29uc3QgJGRpZ2l0cyA9ICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKTtcclxuICAgIGxldCBjb2RlID0gXCJcIjtcclxuXHJcbiAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvZGUgKz0gdGhpcy52YWx1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChjb2RlLmxlbmd0aCA9PT0gNikge1xyXG4gICAgICAgIHNob3dMb2FkZXIodHJ1ZSk7XHJcblxyXG4gICAgICAgIGZha2VSZXF1ZXN0KGNvZGUsIHN1Y2Nlc3MgPT4ge1xyXG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ3ZhbGlkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgY2hhbmdlU2NyZWVuKCQoJy5yZXN1bWUtc2NyZWVuJyksICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAkY29kZS5hZGRDbGFzcygnaW52YWxpZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICRkaWdpdHMuZWFjaChmdW5jdGlvbiAoKSB7ICQodGhpcykudmFsKCcnKTsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lcSgwKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkY29kZS5yZW1vdmVDbGFzcygndmFsaWQgaW52YWxpZCcpO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBEZXRhaWwgU2NyZWVuIGNvbXBvbmVudHMuXHJcbmJpbmQoc2VhcmNoVG9Kc29uKCkpO1xyXG5cclxuY29uc3QgJGFkdmljZXMgPSAkKCcuYWR2aWNlLmZpeGVkJyk7XHJcblxyXG4kYWR2aWNlcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0ICRhZHZpY2UgPSAkKHRoaXMpO1xyXG4gICAgY29uc3QgJGNsb3NlQnRuID0gJGFkdmljZS5maW5kKCcuY2xvc2UtYnRuJyk7XHJcblxyXG4gICAgJGNsb3NlQnRuLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBzaG93QWR2aWNlKCRhZHZpY2UsIGZhbHNlKTtcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbiQoJy5kZXRhaWwtc2NyZWVuIC5zd2lwZS1idG4nKS5zd2lwZSh7XHJcbiAgICBjYjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNob3dMb2FkZXIodHJ1ZSk7XHJcblxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogT3BlbiBkaWdpdGFsIHNpZ24nKVxyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzaG93RGlnaXRhbFNpZ24gPT09ICdmdW5jdGlvbicgfHwgdHlwZW9mIHNob3dEaWdpdGFsU2lnbiA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgIHNob3dEaWdpdGFsU2lnbihmdW5jdGlvbiAoc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCd2YWxpZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlU2NyZWVuKCQoJy5yZXN1bWUtc2NyZWVuJyksICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ2ludmFsaWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHsgJCh0aGlzKS52YWwoJycpOyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaWdpdHMuZXEoMCkuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvKiBjaGFuZ2VTY3JlZW4oJCgnLmF1dGgtc2NyZWVuJyksICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcuYXV0aC1zY3JlZW4gLmRpZ2l0IGlucHV0JykuZXEoMCkuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH0pOyAqL1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgNTAwKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBBdXRoIFNjcmVlbiBjb21wb25lbnRzLlxyXG5jb25zdCAkZGlnaXRzID0gJCgnLmF1dGgtc2NyZWVuIC5kaWdpdCBpbnB1dCcpO1xyXG5cclxuJGRpZ2l0cy5vbigna2V5cHJlc3Mga2V5ZG93biBrZXl1cCBpbnB1dCBjaGFuZ2UgcGFzdGUnLCBudW1iZXJGaWx0ZXIpXHJcbiRkaWdpdHMub24oJ2tleXVwJywgaGFuZGxlRGlnaXRLZXl1cCk7XHJcblxyXG4kZGlnaXRzLmVxKDApLmZvY3VzKCk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBjbG9zZSBidXR0b25zLlxyXG4kKCcuc2NyZWVuIGhlYWRlciAuY2xvc2UtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IENsb3NpbmcgV2ViVmlldycpO1xyXG4gICAgXHJcbiAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XHJcbiAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuY2xvc2VNb3ZpZVBheW1lbnQucG9zdE1lc3NhZ2UoXCJjbG9zZU1vdmllUGF5bWVudFwiKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBzaGFyZSBidXR0b24uXHJcbiQoJy5zaGFyZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogU2hhcmluZyB0aWNrZXQnKTtcclxuXHJcbiAgICBpZiAodHlwZW9mIHNoYXJlVGlja2V0ID09PSAnZnVuY3Rpb24nIHx8IHR5cGVvZiBzaGFyZVRpY2tldCA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICBzaGFyZVRpY2tldCgpO1xyXG4gICAgfVxyXG59KTtcclxuXHJcblxyXG4vLyBJbml0aWFsaXplIG1vdmllIGJ1dHRvbi5cclxuJCgnLm1vdmllLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBQbGF5IG1vdmllJyk7XHJcblxyXG4gICAgaWYgKHR5cGVvZiBwbGF5TW92aWUgPT09ICdmdW5jdGlvbicgfHwgdHlwZW9mIHBsYXlNb3ZpZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICBwbGF5TW92aWUoKTtcclxuICAgIH1cclxufSk7XHJcbiIsIi8vIFJlZmVyZW5jZTogaHR0cHM6Ly9jb2RlcGVuLmlvL2dwcmVzc3V0dG81L3Blbi9OakpvYkc/ZWRpdG9ycz0wMDEwXHJcblxyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgICQuZm4uc3dpcGUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHtcclxuICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N3aXBlIGRvbmUnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgdmFyIGluaXRpYWxNb3VzZSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBzbGlkZU1vdmVtZW50VG90YWwgPSAwO1xyXG4gICAgICAgICAgICB2YXIgbW91c2VJc0Rvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyICRzbGlkZXIgPSAkdGhpcy5maW5kKCcuc2xpZGVyJyk7XHJcbiAgICAgICAgICAgIHZhciAkdGV4dCA9ICR0aGlzLmZpbmQoJy50ZXh0Jyk7XHJcblxyXG4gICAgICAgICAgICAkc2xpZGVyLm9uKCdtb3VzZWRvd24gdG91Y2hzdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgbW91c2VJc0Rvd24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgc2xpZGVNb3ZlbWVudFRvdGFsID0gJHRoaXMud2lkdGgoKSAtICQodGhpcykud2lkdGgoKSArIDEwO1xyXG4gICAgICAgICAgICAgICAgaW5pdGlhbE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVg7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5LCAkc2xpZGVyKS5vbignbW91c2V1cCB0b3VjaGVuZCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtb3VzZUlzRG93bilcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICBtb3VzZUlzRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVg7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVsYXRpdmVNb3VzZSA9IGN1cnJlbnRNb3VzZSAtIGluaXRpYWxNb3VzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA8IHNsaWRlTW92ZW1lbnRUb3RhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICR0ZXh0LmZhZGVUbygzMDAsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIuYW5pbWF0ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IFwiLTEwcHhcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8qICRzbGlkZXIuYWRkQ2xhc3MoJ3VubG9ja2VkJyk7XHJcbiAgICAgICAgICAgICAgICAkKCcjbG9ja2VyJykudGV4dCgnbG9ja19vdXRsaW5lJyk7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLm9uKCdjbGljayB0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2xpZGVyLmhhc0NsYXNzKCd1bmxvY2tlZCcpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLnJlbW92ZUNsYXNzKCd1bmxvY2tlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjbG9ja2VyJykudGV4dCgnbG9ja19vcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzbGlkZXIub2ZmKCdjbGljayB0YXAnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0sIDApOyAqL1xyXG5cclxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmNiKCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKGRvY3VtZW50LmJvZHkpLm9uKCdtb3VzZW1vdmUgdG91Y2htb3ZlJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW1vdXNlSXNEb3duKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVg7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVsYXRpdmVNb3VzZSA9IGN1cnJlbnRNb3VzZSAtIGluaXRpYWxNb3VzZTtcclxuICAgICAgICAgICAgICAgIHZhciBzbGlkZVBlcmNlbnQgPSAxIC0gKHJlbGF0aXZlTW91c2UgLyBzbGlkZU1vdmVtZW50VG90YWwpO1xyXG5cclxuICAgICAgICAgICAgICAgICR0ZXh0LmZhZGVUbygwLCBzbGlkZVBlcmNlbnQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0JzogJy0xMHB4JyB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA+PSBzbGlkZU1vdmVtZW50VG90YWwgKyAxMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIuY3NzKHsgJ2xlZnQnOiBzbGlkZU1vdmVtZW50VG90YWwgKyAncHgnIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzbGlkZXIuY3NzKHsgJ2xlZnQnOiByZWxhdGl2ZU1vdXNlIC0gMTAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KShqUXVlcnkpO1xyXG4iXX0=

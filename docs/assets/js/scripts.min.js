"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(r){r.fn.swipe=function(e){var c=r.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var t=r(this),n=0,o=0,i=!1,s=t.find(".slider"),a=t.find(".text");s.on("mousedown touchstart",function(e){i=!0,o=t.width()-r(this).width()+10,n=e.clientX||e.originalEvent.touches[0].pageX}),r(document.body,s).on("mouseup touchend",function(e){if(i){if(i=!1,(e.clientX||e.changedTouches[0].pageX)-n<o)return a.fadeTo(300,1),void s.animate({left:"-10px"},300);c.cb()}}),r(document.body).on("mousemove touchmove",function(e){var t;i&&(e=1-(t=(e.clientX||e.originalEvent.touches[0].pageX)-n)/o,a.fadeTo(0,e),t<=0?s.css({left:"-10px"}):o+10<=t?s.css({left:o+"px"}):s.css({left:t-10}))})})}}(jQuery);var request={auth:function(e,t){var n={Authorization:"Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7"),"Content-Type":"application/x-www-form-urlencoded",Cookie:"XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"};request.send("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token","POST","grant_type=client_credentials",n,e,t)},pay:function(e,t,n,o,i){n=JSON.stringify(n);t.Authorization="Bearer "+e,request.send("https://apigateway.superappbaz.com/integracion/superapp/pagos/captacion/traspasos/v1/boton-pago","POST",n,t,o,i)},send:function(e,t,n,o,i,s){var a,c=new Headers;for(a in o)c.append(a,o[a]);fetch(e,{method:t,headers:c,body:n,redirect:"follow"}).then(function(e){return e.json()}).then(i).catch(s)}};function bind(o){$("[data-id]").each(function(){var e=$(this),t=e.data("id"),n=o[t];"precio"===t?e.html(formatAmount(n)):"saldo"===t?"false"===n&&setTimeout(function(){showAdvice(e,!0)},500):e.html(n)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,t){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),t()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var t=e.target,n=e.keyCode,o=$(t.parentNode);8===n?0<o.prev().length&&((e=o.prev().find("input")).val(""),e.focus()):47<n&&n<58&&""!==t.value&&0<o.next().length&&o.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function fakeRequest(e,t){setTimeout(function(){t("000001"===e)},1500)}function payMovie(e){function t(e){e="object"===_typeof(e)?e.message:e,console.log(JSON.stringify({message:e})),"webkit"in window&&window.webkit.messageHandlers.errorPaymentResponse.postMessage("errorPaymentResponse|"+JSON.stringify(e))}try{var n=JSON.parse(e);request.auth(function(e){"string"==typeof e.access_token?request.pay(e.access_token,n.headers,n.requestBodyy,function(e){"201"==e.codigo?"webkit"in window&&window.webkit.messageHandlers.paymentResponse.postMessage("paymentResponse|"+JSON.stringify({error:{code:0,message:e.mensaje}})):t({error:{code:e.codigo,message:e.mensaje}})},function(e){t({error:{code:500,message:e.message}})}):t(e)},t)}catch(e){t(e)}}function searchToJson(){for(var e,t=location.search.substring(1).split("&"),n={},o=0;o<t.length;o++)""!==t[o]&&(e=t[o].split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return n}function showAdvice(e,t){t?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var t=$(".loader");e?(t.length<=0&&(t=$('<div class="loader">')),$("body").append(t),setTimeout(function(){return t.addClass("loader-visible")},10)):(t.removeClass("loader-visible"),setTimeout(function(){return t.remove()},375))}function validateCode(){var t=$(".auth-screen .code"),n=$(".auth-screen .digit input"),e="";n.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(t.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),t.addClass("invalid"),setTimeout(function(){n.each(function(){$(this).val("")}),n.eq(0).focus()},100))})):t.removeClass("valid invalid")}bind(searchToJson());var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),"webkit"in window&&window.webkit.messageHandlers.showDigitalSign.postMessage("showDigitalSign")},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),"webkit"in window&&window.webkit.messageHandlers.closeMoviePayment.postMessage("closeMoviePayment")}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),"webkit"in window&&window.webkit.messageHandlers.shareTicket.postMessage("shareTicket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),"webkit"in window&&window.webkit.messageHandlers.playMovie.postMessage("playMovie")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5zd2lwZS5qcyIsInJlcXVlc3QuanMiLCJzY3JpcHRzLmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCJjb25zb2xlIiwibG9nIiwidGhpcyIsImVhY2giLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsImZpbmQiLCIkdGV4dCIsIm9uIiwiZXZlbnQiLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJib2R5IiwiY2hhbmdlZFRvdWNoZXMiLCJmYWRlVG8iLCJhbmltYXRlIiwibGVmdCIsInJlbGF0aXZlTW91c2UiLCJzbGlkZVBlcmNlbnQiLCJjc3MiLCJqUXVlcnkiLCJyZXF1ZXN0IiwiYXV0aCIsInN1Y2Nlc3MiLCJlcnJvciIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYnRvYSIsIkNvbnRlbnQtVHlwZSIsIkNvb2tpZSIsInNlbmQiLCJwYXkiLCJhY2Nlc3NUb2tlbiIsInJhdyIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1cmwiLCJtZXRob2QiLCJqc29uSGVhZGVycyIsInByb3AiLCJIZWFkZXJzIiwiYXBwZW5kIiwiZmV0Y2giLCJyZWRpcmVjdCIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJiaW5kIiwidmFsdWVzIiwiJHRhZyIsImlkIiwiZGF0YSIsInZhbHVlIiwiaHRtbCIsImZvcm1hdEFtb3VudCIsInNldFRpbWVvdXQiLCJzaG93QWR2aWNlIiwiYmluZEZyb21TdHIiLCJzdHJKc29uIiwicGFyc2UiLCJlcnIiLCJjaGFuZ2VTY3JlZW4iLCIkc2NyZWVuIiwiY2FsbGJhY2siLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwiYW1vdW50IiwiTnVtYmVyIiwidG9GaXhlZCIsInJlcGxhY2UiLCJoYW5kbGVEaWdpdEtleXVwIiwiX3JlZiIsInRhcmdldCIsImtleUNvZGUiLCIkcGFyZW50IiwicGFyZW50Tm9kZSIsInByZXYiLCJsZW5ndGgiLCIkaW5wdXQiLCJ2YWwiLCJmb2N1cyIsIm5leHQiLCJ2YWxpZGF0ZUNvZGUiLCJudW1iZXJGaWx0ZXIiLCJ0ZXN0Iiwib2xkVmFsdWUiLCJvbGRTZWxlY3Rpb25TdGFydCIsInNlbGVjdGlvblN0YXJ0Iiwib2xkU2VsZWN0aW9uRW5kIiwic2VsZWN0aW9uRW5kIiwiaGFzT3duUHJvcGVydHkiLCJzZXRTZWxlY3Rpb25SYW5nZSIsImZha2VSZXF1ZXN0IiwiY29kZSIsInBheU1vdmllIiwiaGFuZGxlRXJyIiwibWVzc2FnZSIsIl90eXBlb2YiLCJ3aW5kb3ciLCJ3ZWJraXQiLCJtZXNzYWdlSGFuZGxlcnMiLCJlcnJvclBheW1lbnRSZXNwb25zZSIsInBvc3RNZXNzYWdlIiwiYXV0aFJlcyIsInBheVJlcyIsImNvZGlnbyIsInBheW1lbnRSZXNwb25zZSIsIm1lbnNhamUiLCJzZWFyY2hUb0pzb24iLCJwYXJ0cyIsInBhaXJzIiwibG9jYXRpb24iLCJzZWFyY2giLCJzdWJzdHJpbmciLCJzcGxpdCIsIm9iamVjdCIsImkiLCJkZWNvZGVVUklDb21wb25lbnQiLCIkZWwiLCJmbGFnIiwic2hvd0xvYWRlciIsInNob3ciLCIkbG9hZGVyIiwicmVtb3ZlIiwiJGNvZGUiLCIkZGlnaXRzIiwiZXEiLCIkYWR2aWNlcyIsIiRhZHZpY2UiLCJzaG93RGlnaXRhbFNpZ24iLCJjbG9zZU1vdmllUGF5bWVudCIsInNoYXJlVGlja2V0IiwicGxheU1vdmllIl0sIm1hcHBpbmdzIjoiK1BBRUEsU0FBQUEsR0FDQUEsRUFBQUMsR0FBQUMsTUFBQSxTQUFBQyxHQUNBLElBQUFDLEVBQUFKLEVBQUFLLE9BQUEsQ0FDQUMsR0FBQSxXQUNBQyxRQUFBQyxJQUFBLGdCQUVBTCxHQUVBLE9BQUFNLEtBQUFDLEtBQUEsV0FDQSxJQUFBQyxFQUFBWCxFQUFBUyxNQUNBRyxFQUFBLEVBQ0FDLEVBQUEsRUFD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RUFULFdBQUEsV0FDQXNFLEVBQUFqSSxLQUFBLFdBQUFWLEVBQUFTLE1BQUFvRixJQUFBLE1BQ0E4QyxFQUFBQyxHQUFBLEdBQUE5QyxTQUNBLFNBSUE0QyxFQUFBM0QsWUFBQSxpQkFNQWxCLEtBQUE2RCxnQkFFQSxJQUFBbUIsU0FBQTdJLEVBQUEsaUJBRUE2SSxTQUFBbkksS0FBQSxXQUNBLElBQUFvSSxFQUFBOUksRUFBQVMsTUFDQXFJLEVBQUE5SCxLQUFBLGNBRUFFLEdBQUEsUUFBQSxXQUNBb0QsV0FBQXdFLEdBQUEsT0FJQTlJLEVBQUEsNkJBQUFFLE1BQUEsQ0FDQUksR0FBQSxXQUNBZ0ksWUFBQSxHQUVBakUsV0FBQSxXQUNBOUQsUUFBQUMsSUFBQSxpQ0FFQSxXQUFBd0csUUFDQUEsT0FBQUMsT0FBQUMsZ0JBQUE2QixnQkFBQTNCLFlBQUEsb0JBRUEsUUFNQSxJQUFBdUIsUUFBQTNJLEVBQUEsNkJBRUEySSxRQUFBekgsR0FBQSw0Q0FBQStFLGNBQ0EwQyxRQUFBekgsR0FBQSxRQUFBa0Usa0JBRUF1RCxRQUFBQyxHQUFBLEdBQUE5QyxRQUlBOUYsRUFBQSw2QkFBQWtCLEdBQUEsUUFBQSxXQUNBWCxRQUFBQyxJQUFBLCtCQUVBLFdBQUF3RyxRQUNBQSxPQUFBQyxPQUFBQyxnQkFBQThCLGtCQUFBNUIsWUFBQSx1QkFNQXBILEVBQUEsY0FBQWtCLEdBQUEsUUFBQSxXQUNBWCxRQUFBQyxJQUFBLDhCQUVBLFdBQUF3RyxRQUNBQSxPQUFBQyxPQUFBQyxnQkFBQStCLFlBQUE3QixZQUFBLGlCQU1BcEgsRUFBQSxjQUFBa0IsR0FBQSxRQUFBLFdBQ0FYLFFBQUFDLElBQUEsMEJBRUEsV0FBQXdHLFFBQ0FBLE9BQUFDLE9BQUFDLGdCQUFBZ0MsVUFBQTlCLFlBQUEiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBSZWZlcmVuY2U6IGh0dHBzOi8vY29kZXBlbi5pby9ncHJlc3N1dHRvNS9wZW4vTmpKb2JHP2VkaXRvcnM9MDAxMFxyXG5cclxuKGZ1bmN0aW9uICgkKSB7XHJcbiAgICAkLmZuLnN3aXBlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7XHJcbiAgICAgICAgICAgIGNiOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzd2lwZSBkb25lJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBpbml0aWFsTW91c2UgPSAwO1xyXG4gICAgICAgICAgICB2YXIgc2xpZGVNb3ZlbWVudFRvdGFsID0gMDtcclxuICAgICAgICAgICAgdmFyIG1vdXNlSXNEb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciAkc2xpZGVyID0gJHRoaXMuZmluZCgnLnNsaWRlcicpO1xyXG4gICAgICAgICAgICB2YXIgJHRleHQgPSAkdGhpcy5maW5kKCcudGV4dCcpO1xyXG5cclxuICAgICAgICAgICAgJHNsaWRlci5vbignbW91c2Vkb3duIHRvdWNoc3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIG1vdXNlSXNEb3duID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHNsaWRlTW92ZW1lbnRUb3RhbCA9ICR0aGlzLndpZHRoKCkgLSAkKHRoaXMpLndpZHRoKCkgKyAxMDtcclxuICAgICAgICAgICAgICAgIGluaXRpYWxNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSwgJHNsaWRlcikub24oJ21vdXNldXAgdG91Y2hlbmQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghbW91c2VJc0Rvd24pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgbW91c2VJc0Rvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50TW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0aXZlTW91c2UgPSBjdXJyZW50TW91c2UgLSBpbml0aWFsTW91c2U7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPCBzbGlkZU1vdmVtZW50VG90YWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdGV4dC5mYWRlVG8oMzAwLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmFuaW1hdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBcIi0xMHB4XCJcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvKiAkc2xpZGVyLmFkZENsYXNzKCd1bmxvY2tlZCcpO1xyXG4gICAgICAgICAgICAgICAgJCgnI2xvY2tlcicpLnRleHQoJ2xvY2tfb3V0bGluZScpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5vbignY2xpY2sgdGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHNsaWRlci5oYXNDbGFzcygndW5sb2NrZWQnKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5yZW1vdmVDbGFzcygndW5sb2NrZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2xvY2tlcicpLnRleHQoJ2xvY2tfb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLm9mZignY2xpY2sgdGFwJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9LCAwKTsgKi9cclxuXHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYigpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5KS5vbignbW91c2Vtb3ZlIHRvdWNobW92ZScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtb3VzZUlzRG93bilcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0aXZlTW91c2UgPSBjdXJyZW50TW91c2UgLSBpbml0aWFsTW91c2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2xpZGVQZXJjZW50ID0gMSAtIChyZWxhdGl2ZU1vdXNlIC8gc2xpZGVNb3ZlbWVudFRvdGFsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkdGV4dC5mYWRlVG8oMCwgc2xpZGVQZXJjZW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6ICctMTBweCcgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPj0gc2xpZGVNb3ZlbWVudFRvdGFsICsgMTApIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0Jzogc2xpZGVNb3ZlbWVudFRvdGFsICsgJ3B4JyB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0JzogcmVsYXRpdmVNb3VzZSAtIDEwIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSkoalF1ZXJ5KTtcclxuIiwiY29uc3QgcmVxdWVzdCA9IHtcclxuICAgIC8qKlxyXG4gICAgICogQXV0aGVudGljYXRlLlxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2Vzc1xyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZXJyb3JcclxuICAgICAqL1xyXG4gICAgYXV0aDogZnVuY3Rpb24gKHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgY29uc3QgdXJsID0gXCJodHRwczovL29tbTZvdWc1cGcuZXhlY3V0ZS1hcGkudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vZGVzYXJyb2xsby9vYXV0aDIvdjEvdG9rZW5cIjtcclxuICAgICAgICBjb25zdCBoZWFkZXJzID0ge1xyXG4gICAgICAgICAgICBcIkF1dGhvcml6YXRpb25cIjogXCJCYXNpYyBcIiArIGJ0b2EoXCIxOGg4dmFudnJoNHB1aTFscm50YzFuaWxqZlwiICsgXCI6XCIgKyBcIjFnZTMxYmhqcmRrOWQwamExNG1mdDhxZXBpNGNsa3Q4MDVqcWIyc3Zxdm1iNHNvMXY0ZzdcIiksXHJcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIsXHJcbiAgICAgICAgICAgIFwiQ29va2llXCI6IFwiWFNSRi1UT0tFTj1iNGE1NGYxYi1hZmU1LTRhZWUtOWE3Ni0wMGY5MjA0MThiNmVcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgYm9keSA9IFwiZ3JhbnRfdHlwZT1jbGllbnRfY3JlZGVudGlhbHNcIjtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5zZW5kKHVybCwgJ1BPU1QnLCBib2R5LCBoZWFkZXJzLCBzdWNjZXNzLCBlcnJvcik7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUGF5LlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGFjY2Vzc1Rva2VuXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gaGVhZGVyc1xyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGJvZHlcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1Y2Nlc3NcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXHJcbiAgICAgKi9cclxuICAgIHBheTogZnVuY3Rpb24gKGFjY2Vzc1Rva2VuLCBoZWFkZXJzLCBib2R5LCBzdWNjZXNzLCBlcnJvcikge1xyXG4gICAgICAgIGNvbnN0IHVybCA9IFwiaHR0cHM6Ly9hcGlnYXRld2F5LnN1cGVyYXBwYmF6LmNvbS9pbnRlZ3JhY2lvbi9zdXBlcmFwcC9wYWdvcy9jYXB0YWNpb24vdHJhc3Bhc29zL3YxL2JvdG9uLXBhZ29cIjtcclxuICAgICAgICBjb25zdCByYXcgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcclxuXHJcbiAgICAgICAgaGVhZGVyc1tcIkF1dGhvcml6YXRpb25cIl0gPSBcIkJlYXJlciBcIiArIGFjY2Vzc1Rva2VuO1xyXG4gICAgICAgIHJlcXVlc3Quc2VuZCh1cmwsICdQT1NUJywgcmF3LCBoZWFkZXJzLCBzdWNjZXNzLCBlcnJvcik7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogTWFrZSByZXF1ZXN0LlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCBcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtZXRob2RcclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBib2R5XHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0ganNvbkhlYWRlcnMgXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzIFxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZXJyb3JcclxuICAgICAqL1xyXG4gICAgc2VuZDogZnVuY3Rpb24gKHVybCwgbWV0aG9kLCBib2R5LCBqc29uSGVhZGVycywgc3VjY2VzcywgZXJyb3IpIHtcclxuICAgICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgcHJvcCBpbiBqc29uSGVhZGVycykge1xyXG4gICAgICAgICAgICBoZWFkZXJzLmFwcGVuZChwcm9wLCBqc29uSGVhZGVyc1twcm9wXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmZXRjaCh1cmwsIHsgbWV0aG9kLCBoZWFkZXJzLCBib2R5LCByZWRpcmVjdDogJ2ZvbGxvdycgfSlcclxuICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAgICAgICAudGhlbihzdWNjZXNzKVxyXG4gICAgICAgICAgICAuY2F0Y2goZXJyb3IpO1xyXG4gICAgfVxyXG59OyIsIi8qKlxyXG4gKiBCaW5kIEpTT04gdG8gSFRNTC5cclxuICogQHBhcmFtIHtvYmplY3R9IHZhbHVlc1xyXG4gKi9cclxuZnVuY3Rpb24gYmluZCh2YWx1ZXMpIHtcclxuICAgIGNvbnN0ICR0YWdzID0gJCgnW2RhdGEtaWRdJyk7XHJcblxyXG4gICAgJHRhZ3MuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgJHRhZyA9ICQodGhpcyk7XHJcbiAgICAgICAgY29uc3QgaWQgPSAkdGFnLmRhdGEoJ2lkJyk7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbaWRdO1xyXG5cclxuICAgICAgICBpZiAoaWQgPT09ICdwcmVjaW8nKSB7XHJcbiAgICAgICAgICAgICR0YWcuaHRtbChmb3JtYXRBbW91bnQodmFsdWUpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGlkID09PSAnc2FsZG8nKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJ2ZhbHNlJykge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHNob3dBZHZpY2UoJHRhZywgdHJ1ZSk7IH0sIDUwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkdGFnLmh0bWwodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogUGFyc2Ugc3RyaW5nIHRvIG9iamVjdCBhbmQgdGhlbiBiaW5kLlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RySnNvbiBcclxuICovXHJcbmZ1bmN0aW9uIGJpbmRGcm9tU3RyKHN0ckpzb24pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2Uoc3RySnNvbik7XHJcbiAgICAgICAgYmluZChqc29uKTtcclxuICAgIH0gY2F0Y2ggKGVycikgeyBjb25zb2xlLmxvZyhlcnIpOyB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDaGFuZ2Ugc2NyZWVuLlxyXG4gKiBAcGFyYW0ge2pRdWVyeX0gJHNjcmVlblxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xyXG4gKi9cclxuZnVuY3Rpb24gY2hhbmdlU2NyZWVuKCRzY3JlZW4sIGNhbGxiYWNrKSB7XHJcbiAgICAkKCcuc2NyZWVuJykuYWRkQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgICRzY3JlZW4ucmVtb3ZlQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuXHJcbiAgICBjYWxsYmFjaygpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGFtb3VudCB3aXRoIGN1cnJlbmN5IGZvcm1hdC5cclxuICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudCBcclxuICogQHJldHVybnMge3N0cmluZ31cclxuICovXHJcbmZ1bmN0aW9uIGZvcm1hdEFtb3VudChhbW91bnQpIHtcclxuICAgIHJldHVybiAnJCAnICsgTnVtYmVyKGFtb3VudCkudG9GaXhlZCgyKS5yZXBsYWNlKC9cXEIoPz0oXFxkezN9KSsoPyFcXGQpKS9nLCAnLCcpO1xyXG59XHJcblxyXG4vKipcclxuICogSGFuZGxlIGRpZ2l0IGtleXVwIGV2ZW50LlxyXG4gKiBAcGFyYW0ge0tleWJvYXJkRXZlbnR9IGV2ZW50XHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVEaWdpdEtleXVwKHsgdGFyZ2V0LCBrZXlDb2RlIH0pIHtcclxuICAgIGNvbnN0ICRwYXJlbnQgPSAkKHRhcmdldC5wYXJlbnROb2RlKTtcclxuXHJcbiAgICBpZiAoa2V5Q29kZSA9PT0gOCkge1xyXG4gICAgICAgIGlmICgkcGFyZW50LnByZXYoKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0ICRpbnB1dCA9ICRwYXJlbnQucHJldigpLmZpbmQoJ2lucHV0Jyk7XHJcblxyXG4gICAgICAgICAgICAkaW5wdXQudmFsKCcnKTtcclxuICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0gZWxzZSBpZiAoa2V5Q29kZSA+IDQ3ICYmIGtleUNvZGUgPCA1OCkge1xyXG4gICAgICAgIGlmICh0YXJnZXQudmFsdWUgIT09ICcnKSB7XHJcbiAgICAgICAgICAgIGlmICgkcGFyZW50Lm5leHQoKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCAkaW5wdXQgPSAkcGFyZW50Lm5leHQoKS5maW5kKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGVDb2RlKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBcHBseSBudW1iZXIgZmlsdGVyLlxyXG4gKiBAcGFyYW0ge0V2ZW50fSBldmVudFxyXG4gKi9cclxuZnVuY3Rpb24gbnVtYmVyRmlsdGVyKGV2ZW50KSB7XHJcbiAgICBjb25zdCBmaWx0ZXIgPSAvXlxcZHswLDF9JC87XHJcblxyXG4gICAgaWYgKGZpbHRlci50ZXN0KHRoaXMudmFsdWUpKSB7XHJcbiAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMudmFsdWU7XHJcbiAgICAgICAgdGhpcy5vbGRTZWxlY3Rpb25TdGFydCA9IHRoaXMuc2VsZWN0aW9uU3RhcnQ7XHJcbiAgICAgICAgdGhpcy5vbGRTZWxlY3Rpb25FbmQgPSB0aGlzLnNlbGVjdGlvbkVuZDtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eSgnb2xkVmFsdWUnKSkge1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLm9sZFZhbHVlO1xyXG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uUmFuZ2UodGhpcy5vbGRTZWxlY3Rpb25TdGFydCwgdGhpcy5vbGRTZWxlY3Rpb25FbmQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnZhbHVlID0gJyc7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEbyBmYWtlIHJlcXVlc3QuXHJcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXHJcbiAqL1xyXG5mdW5jdGlvbiBmYWtlUmVxdWVzdChjb2RlLCBjYWxsYmFjaykge1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgY2FsbGJhY2soY29kZSA9PT0gJzAwMDAwMScpO1xyXG4gICAgfSwgMTUwMCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RySnNvblxyXG4gKi9cclxuZnVuY3Rpb24gcGF5TW92aWUoc3RySnNvbikge1xyXG4gICAgY29uc3QgaGFuZGxlRXJyID0gZXJyID0+IHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gdHlwZW9mIGVyciA9PT0gJ29iamVjdCcgPyBlcnIubWVzc2FnZSA6IGVycjtcclxuICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2UgfSkpO1xyXG4gICAgICAgIGlmICgnd2Via2l0JyBpbiB3aW5kb3cpIHtcclxuICAgICAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuZXJyb3JQYXltZW50UmVzcG9uc2UucG9zdE1lc3NhZ2UoXCJlcnJvclBheW1lbnRSZXNwb25zZXxcIiArIEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShzdHJKc29uKTtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5hdXRoKGZ1bmN0aW9uIChhdXRoUmVzKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgYXV0aFJlc1snYWNjZXNzX3Rva2VuJ10gPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnBheShhdXRoUmVzWydhY2Nlc3NfdG9rZW4nXSwganNvblsnaGVhZGVycyddLCBqc29uWydyZXF1ZXN0Qm9keXknXSwgZnVuY3Rpb24gKHBheVJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXlSZXMuY29kaWdvID09ICcyMDEnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgnd2Via2l0JyBpbiB3aW5kb3cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnBheW1lbnRSZXNwb25zZS5wb3N0TWVzc2FnZShcInBheW1lbnRSZXNwb25zZXxcIiArIEpTT04uc3RyaW5naWZ5KHsgZXJyb3I6IHsgY29kZTogMCwgbWVzc2FnZTogcGF5UmVzLm1lbnNhamUgfSB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVFcnIoeyBlcnJvcjogeyBjb2RlOiBwYXlSZXMuY29kaWdvLCBtZXNzYWdlOiBwYXlSZXMubWVuc2FqZSB9IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUVycih7IGVycm9yOiB7IGNvZGU6IDUwMCwgbWVzc2FnZTogZXJyLm1lc3NhZ2UgfSB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgeyBoYW5kbGVFcnIoYXV0aFJlcyk7IH1cclxuICAgICAgICB9LCBoYW5kbGVFcnIpO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycikgeyBoYW5kbGVFcnIoZXJyKTsgfVxyXG59XHJcblxyXG4vKipcclxuICogUGFyc2UgbG9jYXRpb24uc2VhcmNoIHRvIEpTT04uXHJcbiAqIEByZXR1cm5zIG9iamVjdFxyXG4gKi9cclxuZnVuY3Rpb24gc2VhcmNoVG9Kc29uKCkge1xyXG4gICAgY29uc3QgcGFpcnMgPSBsb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpLnNwbGl0KCcmJyk7XHJcbiAgICBjb25zdCBvYmplY3QgPSB7fTtcclxuICAgIGxldCBpID0gMDtcclxuXHJcbiAgICBmb3IgKDsgaSA8IHBhaXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKHBhaXJzW2ldID09PSAnJykge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHBhcnRzID0gcGFpcnNbaV0uc3BsaXQoJz0nKTtcclxuICAgICAgICBvYmplY3RbZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzBdKV0gPSBkZWNvZGVVUklDb21wb25lbnQocGFydHNbMV0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBvYmplY3Q7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTaG93IG9yIGhpZGUgYWR2aWNlLlxyXG4gKiBAcGFyYW0ge2pRdWVyeX0gJGVsIFxyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGZsYWcgXHJcbiAqL1xyXG5mdW5jdGlvbiBzaG93QWR2aWNlKCRlbCwgZmxhZykge1xyXG4gICAgaWYgKGZsYWcpIHtcclxuICAgICAgICAkZWwuYWRkQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGVsLnJlbW92ZUNsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTaG93IG9yIGhpZGUgbG9hZGVyLlxyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHNob3dcclxuICovXHJcbmZ1bmN0aW9uIHNob3dMb2FkZXIoc2hvdykge1xyXG4gICAgbGV0ICRsb2FkZXIgPSAkKCcubG9hZGVyJyk7XHJcblxyXG4gICAgaWYgKHNob3cpIHtcclxuICAgICAgICBpZiAoJGxvYWRlci5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICAkbG9hZGVyID0gJCgnPGRpdiBjbGFzcz1cImxvYWRlclwiPicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJCgnYm9keScpLmFwcGVuZCgkbG9hZGVyKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+ICRsb2FkZXIuYWRkQ2xhc3MoJ2xvYWRlci12aXNpYmxlJyksIDEwKTtcclxuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICRsb2FkZXIucmVtb3ZlQ2xhc3MoJ2xvYWRlci12aXNpYmxlJyk7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiAkbG9hZGVyLnJlbW92ZSgpLCAzNzUpO1xyXG5cclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFZhbGlkYXRlIGNvZGUgZnJvbSBjbGllbnQuXHJcbiAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gKi9cclxuZnVuY3Rpb24gdmFsaWRhdGVDb2RlKCkge1xyXG4gICAgY29uc3QgJGNvZGUgPSAkKCcuYXV0aC1zY3JlZW4gLmNvZGUnKTtcclxuICAgIGNvbnN0ICRkaWdpdHMgPSAkKCcuYXV0aC1zY3JlZW4gLmRpZ2l0IGlucHV0Jyk7XHJcbiAgICBsZXQgY29kZSA9IFwiXCI7XHJcblxyXG4gICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb2RlICs9IHRoaXMudmFsdWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoY29kZS5sZW5ndGggPT09IDYpIHtcclxuICAgICAgICBzaG93TG9hZGVyKHRydWUpO1xyXG5cclxuICAgICAgICBmYWtlUmVxdWVzdChjb2RlLCBzdWNjZXNzID0+IHtcclxuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCd2YWxpZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNoYW5nZVNjcmVlbigkKCcucmVzdW1lLXNjcmVlbicpLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ2ludmFsaWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkgeyAkKHRoaXMpLnZhbCgnJyk7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICRkaWdpdHMuZXEoMCkuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGNvZGUucmVtb3ZlQ2xhc3MoJ3ZhbGlkIGludmFsaWQnKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgRGV0YWlsIFNjcmVlbiBjb21wb25lbnRzLlxyXG5iaW5kKHNlYXJjaFRvSnNvbigpKTtcclxuXHJcbmNvbnN0ICRhZHZpY2VzID0gJCgnLmFkdmljZS5maXhlZCcpO1xyXG5cclxuJGFkdmljZXMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCAkYWR2aWNlID0gJCh0aGlzKTtcclxuICAgIGNvbnN0ICRjbG9zZUJ0biA9ICRhZHZpY2UuZmluZCgnLmNsb3NlLWJ0bicpO1xyXG5cclxuICAgICRjbG9zZUJ0bi5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc2hvd0FkdmljZSgkYWR2aWNlLCBmYWxzZSk7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG4kKCcuZGV0YWlsLXNjcmVlbiAuc3dpcGUtYnRuJykuc3dpcGUoe1xyXG4gICAgY2I6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBzaG93TG9hZGVyKHRydWUpO1xyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IE9wZW4gZGlnaXRhbCBzaWduJylcclxuXHJcbiAgICAgICAgICAgIGlmICgnd2Via2l0JyBpbiB3aW5kb3cpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnNob3dEaWdpdGFsU2lnbi5wb3N0TWVzc2FnZShcInNob3dEaWdpdGFsU2lnblwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIDUwMCk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgQXV0aCBTY3JlZW4gY29tcG9uZW50cy5cclxuY29uc3QgJGRpZ2l0cyA9ICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKTtcclxuXHJcbiRkaWdpdHMub24oJ2tleXByZXNzIGtleWRvd24ga2V5dXAgaW5wdXQgY2hhbmdlIHBhc3RlJywgbnVtYmVyRmlsdGVyKVxyXG4kZGlnaXRzLm9uKCdrZXl1cCcsIGhhbmRsZURpZ2l0S2V5dXApO1xyXG5cclxuJGRpZ2l0cy5lcSgwKS5mb2N1cygpO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgY2xvc2UgYnV0dG9ucy5cclxuJCgnLnNjcmVlbiBoZWFkZXIgLmNsb3NlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBDbG9zaW5nIFdlYlZpZXcnKTtcclxuXHJcbiAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XHJcbiAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuY2xvc2VNb3ZpZVBheW1lbnQucG9zdE1lc3NhZ2UoXCJjbG9zZU1vdmllUGF5bWVudFwiKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBzaGFyZSBidXR0b24uXHJcbiQoJy5zaGFyZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogU2hhcmluZyB0aWNrZXQnKTtcclxuXHJcbiAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XHJcbiAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuc2hhcmVUaWNrZXQucG9zdE1lc3NhZ2UoXCJzaGFyZVRpY2tldFwiKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBtb3ZpZSBidXR0b24uXHJcbiQoJy5tb3ZpZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogUGxheSBtb3ZpZScpO1xyXG5cclxuICAgIGlmICgnd2Via2l0JyBpbiB3aW5kb3cpIHtcclxuICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5wbGF5TW92aWUucG9zdE1lc3NhZ2UoXCJwbGF5TW92aWVcIik7XHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=

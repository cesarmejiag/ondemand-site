"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bind(o){$("[data-id]").each(function(){var e=$(this),t=e.data("id"),n=o[t];"precio"===t?e.html(formatAmount(n)):"saldo"===t?"false"===n&&setTimeout(function(){showAdvice(e,!0)},500):e.html(n)})}function changeScreen(e,t){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),t()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var t=e.target,n=e.keyCode,o=$(t.parentNode);8===n?0<o.prev().length&&((e=o.prev().find("input")).val(""),e.focus()):47<n&&n<58&&""!==t.value&&0<o.next().length&&o.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function request(e,t,n,o,i){var s=new Headers;s.append("Authorization","Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7")),s.append("Content-Type","application/x-www-form-urlencoded"),s.append("Cookie","XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"),fetch("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token",{method:"POST",headers:s,body:"grant_type=client_credentials",redirect:"follow"}).then(function(e){return e.text()}).then(function(e){return console.log(e)}).catch(function(e){return console.log("error",e)})}function fakeRequest(e,t){setTimeout(function(){t("000001"===e)},1500)}function searchToJson(){for(var e,t=location.search.substring(1).split("&"),n={},o=0;o<t.length;o++)""!==t[o]&&(e=t[o].split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return n}function showAdvice(e,t){t?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var t=$(".loader");e?(t.length<=0&&(t=$('<div class="loader">')),$("body").append(t),setTimeout(function(){return t.addClass("loader-visible")},10)):(t.removeClass("loader-visible"),setTimeout(function(){return t.remove()},375))}function validateCode(){var t=$(".auth-screen .code"),n=$(".auth-screen .digit input"),e="";n.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(t.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),t.addClass("invalid"),setTimeout(function(){n.each(function(){$(this).val("")}),n.eq(0).focus()},100))})):t.removeClass("valid invalid")}!function(d){d.fn.swipe=function(e){var a=d.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var t=d(this),n=0,o=0,i=!1,s=t.find(".slider"),c=t.find(".text");s.on("mousedown touchstart",function(e){i=!0,o=t.width()-d(this).width()+10,n=e.clientX||e.originalEvent.touches[0].pageX}),d(document.body,s).on("mouseup touchend",function(e){if(i){if(i=!1,(e.clientX||e.changedTouches[0].pageX)-n<o)return c.fadeTo(300,1),void s.animate({left:"-10px"},300);a.cb()}}),d(document.body).on("mousemove touchmove",function(e){var t;i&&(e=1-(t=(e.clientX||e.originalEvent.touches[0].pageX)-n)/o,c.fadeTo(0,e),t<=0?s.css({left:"-10px"}):o+10<=t?s.css({left:o+"px"}):s.css({left:t-10}))})})}}(jQuery),bind(searchToJson());var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),"function"!=typeof showDigitalSign&&"object"!==("undefined"==typeof showDigitalSign?"undefined":_typeof(showDigitalSign))||showDigitalSign(function(e){e?($code.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),$code.addClass("invalid"),setTimeout(function(){$digits.each(function(){$(this).val("")}),$digits.eq(0).focus()},100))})},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),"function"!=typeof closeMoviePayment&&"object"!==("undefined"==typeof closeMoviePayment?"undefined":_typeof(closeMoviePayment))||closeMoviePayment()}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),"function"!=typeof shareTicket&&"object"!==("undefined"==typeof shareTicket?"undefined":_typeof(shareTicket))||shareTicket()}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),"function"!=typeof playMovie&&"object"!==("undefined"==typeof playMovie?"undefined":_typeof(playMovie))||playMovie()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMuanMiLCJqcXVlcnkuc3dpcGUuanMiXSwibmFtZXMiOlsiYmluZCIsInZhbHVlcyIsIiQiLCJlYWNoIiwiJHRhZyIsInRoaXMiLCJpZCIsImRhdGEiLCJ2YWx1ZSIsImh0bWwiLCJmb3JtYXRBbW91bnQiLCJzZXRUaW1lb3V0Iiwic2hvd0FkdmljZSIsImNoYW5nZVNjcmVlbiIsIiRzY3JlZW4iLCJjYWxsYmFjayIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJhbW91bnQiLCJOdW1iZXIiLCJ0b0ZpeGVkIiwicmVwbGFjZSIsImhhbmRsZURpZ2l0S2V5dXAiLCJfcmVmIiwidGFyZ2V0Iiwia2V5Q29kZSIsIiRwYXJlbnQiLCJwYXJlbnROb2RlIiwicHJldiIsImxlbmd0aCIsIiRpbnB1dCIsImZpbmQiLCJ2YWwiLCJmb2N1cyIsIm5leHQiLCJ2YWxpZGF0ZUNvZGUiLCJudW1iZXJGaWx0ZXIiLCJldmVudCIsInRlc3QiLCJvbGRWYWx1ZSIsIm9sZFNlbGVjdGlvblN0YXJ0Iiwic2VsZWN0aW9uU3RhcnQiLCJvbGRTZWxlY3Rpb25FbmQiLCJzZWxlY3Rpb25FbmQiLCJoYXNPd25Qcm9wZXJ0eSIsInNldFNlbGVjdGlvblJhbmdlIiwicmVxdWVzdCIsInVybCIsIm1ldGhvZCIsImJvZHkiLCJoZWFkZXJzIiwibXlIZWFkZXJzIiwiSGVhZGVycyIsImFwcGVuZCIsImJ0b2EiLCJmZXRjaCIsInJlZGlyZWN0IiwidGhlbiIsInJlc3BvbnNlIiwidGV4dCIsInJlc3VsdCIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsImZha2VSZXF1ZXN0IiwiY29kZSIsInNlYXJjaFRvSnNvbiIsInBhcnRzIiwicGFpcnMiLCJsb2NhdGlvbiIsInNlYXJjaCIsInN1YnN0cmluZyIsInNwbGl0Iiwib2JqZWN0IiwiaSIsImRlY29kZVVSSUNvbXBvbmVudCIsIiRlbCIsImZsYWciLCJzaG93TG9hZGVyIiwic2hvdyIsIiRsb2FkZXIiLCJyZW1vdmUiLCIkY29kZSIsIiRkaWdpdHMiLCJzdWNjZXNzIiwiZXEiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsIiR0ZXh0Iiwib24iLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJjaGFuZ2VkVG91Y2hlcyIsImZhZGVUbyIsImFuaW1hdGUiLCJsZWZ0IiwicmVsYXRpdmVNb3VzZSIsInNsaWRlUGVyY2VudCIsImNzcyIsImpRdWVyeSIsIiRhZHZpY2VzIiwiJGFkdmljZSIsInNob3dEaWdpdGFsU2lnbiIsIl90eXBlb2YiLCJjbG9zZU1vdmllUGF5bWVudCIsInNoYXJlVGlja2V0IiwicGxheU1vdmllIl0sIm1hcHBpbmdzIjoiOFBBSUEsU0FBQUEsS0FBQUMsR0FDQUMsRUFBQSxhQUVBQyxLQUFBLFdBQ0EsSUFBQUMsRUFBQUYsRUFBQUcsTUFDQUMsRUFBQUYsRUFBQUcsS0FBQSxNQUNBQyxFQUFBUCxFQUFBSyxHQUVBLFdBQUFBLEVBQ0FGLEVBQUFLLEtBQUFDLGFBQUFGLElBQ0EsVUFBQUYsRUFDQSxVQUFBRSxHQUNBRyxXQUFBLFdBQUFDLFdBQUFSLEdBQUEsSUFBQSxLQUdBQSxFQUFBSyxLQUFBRCxLQVVBLFNBQUFLLGFBQUFDLEVBQUFDLEdBQ0FiLEVBQUEsV0FBQWMsU0FBQSxjQUNBRixFQUFBRyxZQUFBLGNBRUFGLElBUUEsU0FBQUwsYUFBQVEsR0FDQSxNQUFBLEtBQUFDLE9BQUFELEdBQUFFLFFBQUEsR0FBQUMsUUFBQSx3QkFBQSxLQU9BLFNBQUFDLGlCQUFBQyxHQUFBLElBQUFDLEVBQUFELEVBQUFDLE9BQUFDLEVBQUFGLEVBQUFFLFFBQ0FDLEVBQUF4QixFQUFBc0IsRUFBQUcsWUFFQSxJQUFBRixFQUNBLEVBQUFDLEVBQUFFLE9BQUFDLFVBQ0FDLEVBQUFKLEVBQUFFLE9B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LG1CQUFBcUQsaUJBQUEsWUFBQSxvQkFBQUEsZ0JBQUEsWUFBQUMsUUFBQUQsbUJBQ0FBLGdCQUFBLFNBQUEvQixHQUNBQSxHQUNBRixNQUFBbEUsU0FBQSxTQUVBSCxhQUFBWCxFQUFBLGtCQUFBLFdBQ0E0RSxZQUFBLE9BR0FBLFlBQUEsR0FDQUksTUFBQWxFLFNBQUEsV0FFQUwsV0FBQSxXQUNBd0UsUUFBQWhGLEtBQUEsV0FBQUQsRUFBQUcsTUFBQTJCLElBQUEsTUFDQW1ELFFBQUFFLEdBQUEsR0FBQXBELFNBQ0EsU0FTQSxRQU1BLElBQUFrRCxRQUFBakYsRUFBQSw2QkFFQWlGLFFBQUFlLEdBQUEsNENBQUE5RCxjQUNBK0MsUUFBQWUsR0FBQSxRQUFBNUUsa0JBRUE2RCxRQUFBRSxHQUFBLEdBQUFwRCxRQUlBL0IsRUFBQSw2QkFBQWdHLEdBQUEsUUFBQSxXQUNBckMsUUFBQUMsSUFBQSwrQkFFQSxtQkFBQXVELG1CQUFBLFlBQUEsb0JBQUFBLGtCQUFBLFlBQUFELFFBQUFDLHFCQUNBQSxzQkFNQW5ILEVBQUEsY0FBQWdHLEdBQUEsUUFBQSxXQUNBckMsUUFBQUMsSUFBQSw4QkFFQSxtQkFBQXdELGFBQUEsWUFBQSxvQkFBQUEsWUFBQSxZQUFBRixRQUFBRSxlQUNBQSxnQkFNQXBILEVBQUEsY0FBQWdHLEdBQUEsUUFBQSxXQUNBckMsUUFBQUMsSUFBQSwwQkFFQSxtQkFBQXlELFdBQUEsWUFBQSxvQkFBQUEsVUFBQSxZQUFBSCxRQUFBRyxhQUNBQSIsImZpbGUiOiJzY3JpcHRzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQmluZCBKU09OIHRvIEhUTUwuXG4gKiBAcGFyYW0ge29iamVjdH0gdmFsdWVzXG4gKi9cbmZ1bmN0aW9uIGJpbmQodmFsdWVzKSB7XG4gICAgY29uc3QgJHRhZ3MgPSAkKCdbZGF0YS1pZF0nKTtcblxuICAgICR0YWdzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCAkdGFnID0gJCh0aGlzKTtcbiAgICAgICAgY29uc3QgaWQgPSAkdGFnLmRhdGEoJ2lkJyk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2lkXTtcblxuICAgICAgICBpZiAoaWQgPT09ICdwcmVjaW8nKSB7XG4gICAgICAgICAgICAkdGFnLmh0bWwoZm9ybWF0QW1vdW50KHZhbHVlKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaWQgPT09ICdzYWxkbycpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJ2ZhbHNlJykge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBzaG93QWR2aWNlKCR0YWcsIHRydWUpOyB9LCA1MDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHRhZy5odG1sKHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG4vKipcbiAqIENoYW5nZSBzY3JlZW4uXG4gKiBAcGFyYW0ge2pRdWVyeX0gJHNjcmVlblxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcbiAqL1xuZnVuY3Rpb24gY2hhbmdlU2NyZWVuKCRzY3JlZW4sIGNhbGxiYWNrKSB7XG4gICAgJCgnLnNjcmVlbicpLmFkZENsYXNzKCduby12aXNpYmxlJyk7XG4gICAgJHNjcmVlbi5yZW1vdmVDbGFzcygnbm8tdmlzaWJsZScpO1xuXG4gICAgY2FsbGJhY2soKTtcbn1cblxuLyoqXG4gKiBHZXQgYW1vdW50IHdpdGggY3VycmVuY3kgZm9ybWF0LlxuICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudCBcbiAqIEByZXR1cm5zIHtzdHJpbmd9XG4gKi9cbmZ1bmN0aW9uIGZvcm1hdEFtb3VudChhbW91bnQpIHtcbiAgICByZXR1cm4gJyQgJyArIE51bWJlcihhbW91bnQpLnRvRml4ZWQoMikucmVwbGFjZSgvXFxCKD89KFxcZHszfSkrKD8hXFxkKSkvZywgJywnKTtcbn1cblxuLyoqXG4gKiBIYW5kbGUgZGlnaXQga2V5dXAgZXZlbnQuXG4gKiBAcGFyYW0ge0tleWJvYXJkRXZlbnR9IGV2ZW50XG4gKi9cbmZ1bmN0aW9uIGhhbmRsZURpZ2l0S2V5dXAoeyB0YXJnZXQsIGtleUNvZGUgfSkge1xuICAgIGNvbnN0ICRwYXJlbnQgPSAkKHRhcmdldC5wYXJlbnROb2RlKTtcblxuICAgIGlmIChrZXlDb2RlID09PSA4KSB7XG4gICAgICAgIGlmICgkcGFyZW50LnByZXYoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCAkaW5wdXQgPSAkcGFyZW50LnByZXYoKS5maW5kKCdpbnB1dCcpO1xuXG4gICAgICAgICAgICAkaW5wdXQudmFsKCcnKTtcbiAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xuICAgICAgICB9XG5cbiAgICB9IGVsc2UgaWYgKGtleUNvZGUgPiA0NyAmJiBrZXlDb2RlIDwgNTgpIHtcbiAgICAgICAgaWYgKHRhcmdldC52YWx1ZSAhPT0gJycpIHtcbiAgICAgICAgICAgIGlmICgkcGFyZW50Lm5leHQoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJHBhcmVudC5uZXh0KCkuZmluZCgnaW5wdXQnKTtcbiAgICAgICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhbGlkYXRlQ29kZSgpO1xufVxuXG4vKipcbiAqIEFwcGx5IG51bWJlciBmaWx0ZXIuXG4gKiBAcGFyYW0ge0V2ZW50fSBldmVudFxuICovXG5mdW5jdGlvbiBudW1iZXJGaWx0ZXIoZXZlbnQpIHtcbiAgICBjb25zdCBmaWx0ZXIgPSAvXlxcZHswLDF9JC87XG5cbiAgICBpZiAoZmlsdGVyLnRlc3QodGhpcy52YWx1ZSkpIHtcbiAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uU3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICB0aGlzLm9sZFNlbGVjdGlvbkVuZCA9IHRoaXMuc2VsZWN0aW9uRW5kO1xuICAgIH0gZWxzZSBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eSgnb2xkVmFsdWUnKSkge1xuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb25SYW5nZSh0aGlzLm9sZFNlbGVjdGlvblN0YXJ0LCB0aGlzLm9sZFNlbGVjdGlvbkVuZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9ICcnO1xuICAgIH1cbn1cblxuLyoqXG4gKiBNYWtlIHJlcXVlc3QuXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsIFxuICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZFxuICogQHBhcmFtIHtvYmplY3R9IGJvZHlcbiAqIEBwYXJhbSB7b2JqZWN0fSBoZWFkZXJzIFxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgXG4gKi9cbmZ1bmN0aW9uIHJlcXVlc3QodXJsLCBtZXRob2QsIGJvZHksIGhlYWRlcnMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIG15SGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XG4gICAgbXlIZWFkZXJzLmFwcGVuZChcIkF1dGhvcml6YXRpb25cIiwgXCJCYXNpYyBcIiArIGJ0b2EoXCIxOGg4dmFudnJoNHB1aTFscm50YzFuaWxqZlwiICsgXCI6XCIgKyBcIjFnZTMxYmhqcmRrOWQwamExNG1mdDhxZXBpNGNsa3Q4MDVqcWIyc3Zxdm1iNHNvMXY0ZzdcIikpO1xuICAgIG15SGVhZGVycy5hcHBlbmQoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIik7XG4gICAgbXlIZWFkZXJzLmFwcGVuZChcIkNvb2tpZVwiLCBcIlhTUkYtVE9LRU49YjRhNTRmMWItYWZlNS00YWVlLTlhNzYtMDBmOTIwNDE4YjZlXCIpO1xuXG4gICAgLyogdmFyIHVybGVuY29kZWQgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgdXJsZW5jb2RlZC5hcHBlbmQoXCJncmFudF90eXBlXCIsIFwiY2xpZW50X2NyZWRlbnRpYWxzXCIpOyAqL1xuXG4gICAgdmFyIHJlcXVlc3RPcHRpb25zID0ge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczogbXlIZWFkZXJzLFxuICAgICAgICBib2R5OiBcImdyYW50X3R5cGU9Y2xpZW50X2NyZWRlbnRpYWxzXCIsXG4gICAgICAgIHJlZGlyZWN0OiAnZm9sbG93J1xuICAgIH07XG5cbiAgICBmZXRjaChcImh0dHBzOi8vb21tNm91ZzVwZy5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9kZXNhcnJvbGxvL29hdXRoMi92MS90b2tlblwiLCByZXF1ZXN0T3B0aW9ucylcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UudGV4dCgpKVxuICAgICAgICAudGhlbihyZXN1bHQgPT4gY29uc29sZS5sb2cocmVzdWx0KSlcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUubG9nKCdlcnJvcicsIGVycm9yKSk7XG59XG5cbi8qKlxuICogRG8gZmFrZSByZXF1ZXN0LlxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcbiAqL1xuZnVuY3Rpb24gZmFrZVJlcXVlc3QoY29kZSwgY2FsbGJhY2spIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY2FsbGJhY2soY29kZSA9PT0gJzAwMDAwMScpO1xuICAgIH0sIDE1MDApO1xufVxuXG4vKipcbiAqIFBhcnNlIGxvY2F0aW9uLnNlYXJjaCB0byBKU09OLlxuICogQHJldHVybnMgb2JqZWN0XG4gKi9cbmZ1bmN0aW9uIHNlYXJjaFRvSnNvbigpIHtcbiAgICBjb25zdCBwYWlycyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSkuc3BsaXQoJyYnKTtcbiAgICBjb25zdCBvYmplY3QgPSB7fTtcbiAgICBsZXQgaSA9IDA7XG5cbiAgICBmb3IgKDsgaSA8IHBhaXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChwYWlyc1tpXSA9PT0gJycpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcGFydHMgPSBwYWlyc1tpXS5zcGxpdCgnPScpO1xuICAgICAgICBvYmplY3RbZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzBdKV0gPSBkZWNvZGVVUklDb21wb25lbnQocGFydHNbMV0pO1xuICAgIH1cblxuICAgIHJldHVybiBvYmplY3Q7XG59XG5cbi8qKlxuICogU2hvdyBvciBoaWRlIGFkdmljZS5cbiAqIEBwYXJhbSB7alF1ZXJ5fSAkZWwgXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGZsYWcgXG4gKi9cbmZ1bmN0aW9uIHNob3dBZHZpY2UoJGVsLCBmbGFnKSB7XG4gICAgaWYgKGZsYWcpIHtcbiAgICAgICAgJGVsLmFkZENsYXNzKCduby12aXNpYmxlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJGVsLnJlbW92ZUNsYXNzKCduby12aXNpYmxlJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIFNob3cgb3IgaGlkZSBsb2FkZXIuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHNob3dcbiAqL1xuZnVuY3Rpb24gc2hvd0xvYWRlcihzaG93KSB7XG4gICAgbGV0ICRsb2FkZXIgPSAkKCcubG9hZGVyJyk7XG5cbiAgICBpZiAoc2hvdykge1xuICAgICAgICBpZiAoJGxvYWRlci5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgJGxvYWRlciA9ICQoJzxkaXYgY2xhc3M9XCJsb2FkZXJcIj4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJGxvYWRlcik7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gJGxvYWRlci5hZGRDbGFzcygnbG9hZGVyLXZpc2libGUnKSwgMTApO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgJGxvYWRlci5yZW1vdmVDbGFzcygnbG9hZGVyLXZpc2libGUnKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiAkbG9hZGVyLnJlbW92ZSgpLCAzNzUpO1xuXG4gICAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIGNvZGUgZnJvbSBjbGllbnQuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVDb2RlKCkge1xuICAgIGNvbnN0ICRjb2RlID0gJCgnLmF1dGgtc2NyZWVuIC5jb2RlJyk7XG4gICAgY29uc3QgJGRpZ2l0cyA9ICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKTtcbiAgICBsZXQgY29kZSA9IFwiXCI7XG5cbiAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICBjb2RlICs9IHRoaXMudmFsdWU7XG4gICAgfSk7XG5cbiAgICBpZiAoY29kZS5sZW5ndGggPT09IDYpIHtcbiAgICAgICAgc2hvd0xvYWRlcih0cnVlKTtcblxuICAgICAgICBmYWtlUmVxdWVzdChjb2RlLCBzdWNjZXNzID0+IHtcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ3ZhbGlkJyk7XG5cbiAgICAgICAgICAgICAgICBjaGFuZ2VTY3JlZW4oJCgnLnJlc3VtZS1zY3JlZW4nKSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XG4gICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ2ludmFsaWQnKTtcblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkgeyAkKHRoaXMpLnZhbCgnJyk7IH0pO1xuICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVxKDApLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJGNvZGUucmVtb3ZlQ2xhc3MoJ3ZhbGlkIGludmFsaWQnKTtcbiAgICB9XG59XG5cblxuLy8gSW5pdGlhbGl6ZSBEZXRhaWwgU2NyZWVuIGNvbXBvbmVudHMuXG5iaW5kKHNlYXJjaFRvSnNvbigpKTtcblxuY29uc3QgJGFkdmljZXMgPSAkKCcuYWR2aWNlLmZpeGVkJyk7XG5cbiRhZHZpY2VzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0ICRhZHZpY2UgPSAkKHRoaXMpO1xuICAgIGNvbnN0ICRjbG9zZUJ0biA9ICRhZHZpY2UuZmluZCgnLmNsb3NlLWJ0bicpO1xuXG4gICAgJGNsb3NlQnRuLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2hvd0FkdmljZSgkYWR2aWNlLCBmYWxzZSk7XG4gICAgfSk7XG59KTtcblxuJCgnLmRldGFpbC1zY3JlZW4gLnN3aXBlLWJ0bicpLnN3aXBlKHtcbiAgICBjYjogZnVuY3Rpb24gKCkge1xuICAgICAgICBzaG93TG9hZGVyKHRydWUpO1xuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IE9wZW4gZGlnaXRhbCBzaWduJylcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzaG93RGlnaXRhbFNpZ24gPT09ICdmdW5jdGlvbicgfHwgdHlwZW9mIHNob3dEaWdpdGFsU2lnbiA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICBzaG93RGlnaXRhbFNpZ24oZnVuY3Rpb24gKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCd2YWxpZCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VTY3JlZW4oJCgnLnJlc3VtZS1zY3JlZW4nKSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCdpbnZhbGlkJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaWdpdHMuZWFjaChmdW5jdGlvbiAoKSB7ICQodGhpcykudmFsKCcnKTsgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lcSgwKS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLyogY2hhbmdlU2NyZWVuKCQoJy5hdXRoLXNjcmVlbicpLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAkKCcuYXV0aC1zY3JlZW4gLmRpZ2l0IGlucHV0JykuZXEoMCkuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB9KTsgKi9cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgNTAwKTtcbiAgICB9XG59KTtcblxuXG4vLyBJbml0aWFsaXplIEF1dGggU2NyZWVuIGNvbXBvbmVudHMuXG5jb25zdCAkZGlnaXRzID0gJCgnLmF1dGgtc2NyZWVuIC5kaWdpdCBpbnB1dCcpO1xuXG4kZGlnaXRzLm9uKCdrZXlwcmVzcyBrZXlkb3duIGtleXVwIGlucHV0IGNoYW5nZSBwYXN0ZScsIG51bWJlckZpbHRlcilcbiRkaWdpdHMub24oJ2tleXVwJywgaGFuZGxlRGlnaXRLZXl1cCk7XG5cbiRkaWdpdHMuZXEoMCkuZm9jdXMoKTtcblxuXG4vLyBJbml0aWFsaXplIGNsb3NlIGJ1dHRvbnMuXG4kKCcuc2NyZWVuIGhlYWRlciAuY2xvc2UtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBDbG9zaW5nIFdlYlZpZXcnKTtcblxuICAgIGlmICh0eXBlb2YgY2xvc2VNb3ZpZVBheW1lbnQgPT09ICdmdW5jdGlvbicgfHwgdHlwZW9mIGNsb3NlTW92aWVQYXltZW50ID09PSAnb2JqZWN0Jykge1xuICAgICAgICBjbG9zZU1vdmllUGF5bWVudCgpO1xuICAgIH1cbn0pO1xuXG5cbi8vIEluaXRpYWxpemUgc2hhcmUgYnV0dG9uLlxuJCgnLnNoYXJlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogU2hhcmluZyB0aWNrZXQnKTtcblxuICAgIGlmICh0eXBlb2Ygc2hhcmVUaWNrZXQgPT09ICdmdW5jdGlvbicgfHwgdHlwZW9mIHNoYXJlVGlja2V0ID09PSAnb2JqZWN0Jykge1xuICAgICAgICBzaGFyZVRpY2tldCgpO1xuICAgIH1cbn0pO1xuXG5cbi8vIEluaXRpYWxpemUgbW92aWUgYnV0dG9uLlxuJCgnLm1vdmllLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogUGxheSBtb3ZpZScpO1xuXG4gICAgaWYgKHR5cGVvZiBwbGF5TW92aWUgPT09ICdmdW5jdGlvbicgfHwgdHlwZW9mIHBsYXlNb3ZpZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgcGxheU1vdmllKCk7XG4gICAgfVxufSk7XG4iLCIvLyBSZWZlcmVuY2U6IGh0dHBzOi8vY29kZXBlbi5pby9ncHJlc3N1dHRvNS9wZW4vTmpKb2JHP2VkaXRvcnM9MDAxMFxuXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAkLmZuLnN3aXBlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHNldHRpbmdzID0gJC5leHRlbmQoe1xuICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzd2lwZSBkb25lJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIG9wdGlvbnMpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgIHZhciBpbml0aWFsTW91c2UgPSAwO1xuICAgICAgICAgICAgdmFyIHNsaWRlTW92ZW1lbnRUb3RhbCA9IDA7XG4gICAgICAgICAgICB2YXIgbW91c2VJc0Rvd24gPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciAkc2xpZGVyID0gJHRoaXMuZmluZCgnLnNsaWRlcicpO1xuICAgICAgICAgICAgdmFyICR0ZXh0ID0gJHRoaXMuZmluZCgnLnRleHQnKTtcblxuICAgICAgICAgICAgJHNsaWRlci5vbignbW91c2Vkb3duIHRvdWNoc3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBtb3VzZUlzRG93biA9IHRydWU7XG4gICAgICAgICAgICAgICAgc2xpZGVNb3ZlbWVudFRvdGFsID0gJHRoaXMud2lkdGgoKSAtICQodGhpcykud2lkdGgoKSArIDEwO1xuICAgICAgICAgICAgICAgIGluaXRpYWxNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VYO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSwgJHNsaWRlcikub24oJ21vdXNldXAgdG91Y2hlbmQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIW1vdXNlSXNEb3duKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgbW91c2VJc0Rvd24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWDtcbiAgICAgICAgICAgICAgICB2YXIgcmVsYXRpdmVNb3VzZSA9IGN1cnJlbnRNb3VzZSAtIGluaXRpYWxNb3VzZTtcblxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlIDwgc2xpZGVNb3ZlbWVudFRvdGFsKSB7XG4gICAgICAgICAgICAgICAgICAgICR0ZXh0LmZhZGVUbygzMDAsIDEpO1xuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogXCItMTBweFwiXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvKiAkc2xpZGVyLmFkZENsYXNzKCd1bmxvY2tlZCcpO1xuICAgICAgICAgICAgICAgICQoJyNsb2NrZXInKS50ZXh0KCdsb2NrX291dGxpbmUnKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5vbignY2xpY2sgdGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISRzbGlkZXIuaGFzQ2xhc3MoJ3VubG9ja2VkJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5yZW1vdmVDbGFzcygndW5sb2NrZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNsb2NrZXInKS50ZXh0KCdsb2NrX29wZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzbGlkZXIub2ZmKCdjbGljayB0YXAnKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgMCk7ICovXG5cbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYigpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSkub24oJ21vdXNlbW92ZSB0b3VjaG1vdmUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIW1vdXNlSXNEb3duKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVg7XG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0aXZlTW91c2UgPSBjdXJyZW50TW91c2UgLSBpbml0aWFsTW91c2U7XG4gICAgICAgICAgICAgICAgdmFyIHNsaWRlUGVyY2VudCA9IDEgLSAocmVsYXRpdmVNb3VzZSAvIHNsaWRlTW92ZW1lbnRUb3RhbCk7XG5cbiAgICAgICAgICAgICAgICAkdGV4dC5mYWRlVG8oMCwgc2xpZGVQZXJjZW50KTtcblxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6ICctMTBweCcgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPj0gc2xpZGVNb3ZlbWVudFRvdGFsICsgMTApIHtcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6IHNsaWRlTW92ZW1lbnRUb3RhbCArICdweCcgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6IHJlbGF0aXZlTW91c2UgLSAxMCB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59KShqUXVlcnkpO1xuIl19

"use strict";function ownKeys(o,e){var a,n=Object.keys(o);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(o),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),n.push.apply(n,a)),n}function _objectSpread(o){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(a),!0).forEach(function(e){_defineProperty(o,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(a,e))})}return o}function _defineProperty(e,o,a){return o in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e}var globalIdPelicula,globalImagenPelicula,globalNombrePelicula,globalNumeroCuentaClienteCadenaBaz,globalBotonPago,globalCompras,globalTokenOperacion,globalHeaders,request={buyMovie:function(e,o,a,n,t){request.send("https://apigateway.superappbaz.com/integracion/superapp/diversion/gestion-peliculas/v1/peliculas/"+e+"/compras","POST",o,a,n)},movieById:function(e,o,a){request.send("https://apigateway.superappbaz.com/integracion/superapp/canal/clientes/gestion-sesiones/v1/portal/operaciones/"+e,"GET",void 0,{"x-sicu":"3bad1290ac4600a569162efaa09117ea","x-id-interaccion":"123e4567-e89b-12d3-a456-426655440000","x-token-usuario":"SRfVZrTYvdm7mzzZmcuiDViACkAx"},o,a)},paymentButton:function(e,o,a,n){request.send("https://apigateway.superappbaz.com/integracion/superapp/pagos/captacion/traspasos/v1/boton-pago","POST",e,o,a,n)},send:function(e,o,a,n,t,i){$.ajax({url:e,method:o,contentType:"application/json",processData:!1,headers:n,data:JSON.stringify(a),success:t,error:i})}};function bind(n){$("[data-id]").each(function(){var e=$(this),o=e.data("id"),a=n[o];"precio"===o?e.html(formatAmount(a)):"saldo"===o?"false"===a&&setTimeout(function(){showAdvice(e,!0)},500):e.html(a)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,o){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),"function"==typeof o&&o()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var o=e.target,a=e.keyCode,n=$(o.parentNode);8===a?0<n.prev().length&&((e=n.prev().find("input")).val(""),e.focus()):47<a&&a<58&&""!==o.value&&0<n.next().length&&n.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function fakeRequest(e,o){setTimeout(function(){o("000001"===e)},1500)}function searchToJson(){for(var e,o=location.search.substring(1).split("&"),a={},n=0;n<o.length;n++)""!==o[n]&&(e=o[n].split("="),a[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return a}function showAdvice(e,o){o?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var o=$(".loader");e?(o.length<=0&&(o=$('<div class="loader">')),$("body").append(o),setTimeout(function(){return o.addClass("loader-visible")},10)):(o.removeClass("loader-visible"),setTimeout(function(){return o.remove()},375))}function showErrorScreen(e,o,a){var n=e.responseJSON,e=n.folio,n=n.mensaje;$(".error-screen").find('[data-id="mensaje"]').text(n),$(".error-screen").find('[data-id="folio"]').text(e),changeScreen($(".error-screen")),showLoader(!1)}function validateCode(){var o=$(".auth-screen .code"),a=$(".auth-screen .digit input"),e="";a.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(o.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),o.addClass("invalid"),setTimeout(function(){a.each(function(){$(this).val("")}),a.eq(0).focus()},100))})):o.removeClass("valid invalid")}var searchJson=searchToJson();showLoader(!0),request.movieById(searchJson.idOperacion,function(s){console.log("%o",s),changeScreen($(".detail-screen"),function(){var e=s.resultado,o=e.datosFlujo,a=o.idPelicula,n=o.imagenPelicula,t=o.nombrePelicula,i=o.numeroCuentaClienteCadenaBaz,r=o.botonPago,c=o.compras,o=o.tokenOperacion,e=e.headers;globalIdPelicula=a,globalImagenPelicula=n,globalNombrePelicula=t,globalNumeroCuentaClienteCadenaBaz=i,globalBotonPago=r.transaccion,globalCompras=c.transaccion,globalTokenOperacion=o,globalHeaders=e,$(".detail-screen").find('[data-id="nombre"]').text(globalNombrePelicula),$(".detail-screen").find('[data-id="precio"]').text(formatAmount(globalBotonPago.detallePago.montoEnvio)),$(".detail-screen").find('[data-id="tarjeta"]').text(globalNumeroCuentaClienteCadenaBaz),showLoader(!1)})},showErrorScreen);var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".rent-button").on("click",function(){console.log("scripts.js: Click rent button.");var e=_objectSpread({},globalHeaders),t=_objectSpread({},globalHeaders);delete t["x-id-operacion-conciliacion"],showLoader(!0),request.paymentButton({transaccion:_objectSpread(_objectSpread({},globalBotonPago),{},{tokenOperacion:globalTokenOperacion})},e,function(e){console.log("scripts.js: Payment button. %o",e);var o=e.resultado,a=o.fechaOperacion,n=o.horaOperacion;request.buyMovie(globalIdPelicula,{transaccion:_objectSpread(_objectSpread({},globalCompras),{},{fechaOperacion:e.resultado.fechaOperacion,numeroMovimiento:e.resultado.numeroMovimiento})},t,function(e){console.log("scripts.js: Buy movie. %o",e);e=e.folio;$(".resume-screen").find('[data-id="fecha"]').text("".concat(a,", ").concat(n)),$(".resume-screen").find('[data-id="precio"]').text(formatAmount(globalBotonPago.detallePago.montoEnvio)),$(".resume-screen").find('[data-id="tarjeta"]').text(globalNumeroCuentaClienteCadenaBaz),$(".resume-screen").find('[data-id="nombre"]').text(globalNombrePelicula),$(".resume-screen").find('[data-id="precio"]').text(formatAmount(globalBotonPago.detallePago.montoEnvio)),$(".resume-screen").find('[data-id="folio"]').text(e),changeScreen($(".resume-screen")),showLoader(!1)},showErrorScreen)},showErrorScreen)});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Go to movie button click."),$(".success-screen").find('[data-id="nombre"]').text(globalNombrePelicula),$(".success-screen").find(".see-movie-href").attr("href","intent://?verPelicula?data=".concat(btoa(globalIdPelicula),"#Intent;scheme=sappdl;action=android.intent.action.VIEW;S.browser_fallback_url=https%3A%2F%2Fplay.google.com/store/apps/details?id=mx.app.baz.superapp;end")),globalImagenPelicula&&$('<img src="'.concat(globalImagenPelicula,'">')).on("load",function(){$(".success-screen").find('[data-id="imagen"]').attr("style","background-image: url(".concat(globalImagenPelicula,")")).addClass("displayed")}),changeScreen($(".success-screen"))});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlcXVlc3QuanMiLCJzY3JpcHRzLmpzIl0sIm5hbWVzIjpbImdsb2JhbElkUGVsaWN1bGEiLCJnbG9iYWxJbWFnZW5QZWxpY3VsYSIsImdsb2JhbE5vbWJyZVBlbGljdWxhIiwiZ2xvYmFsTnVtZXJvQ3VlbnRhQ2xpZW50ZUNhZGVuYUJheiIsImdsb2JhbEJvdG9uUGFnbyIsImdsb2JhbENvbXByYXMiLCJnbG9iYWxUb2tlbk9wZXJhY2lvbiIsImdsb2JhbEhlYWRlcnMiLCJyZXF1ZXN0IiwiYnV5TW92aWUiLCJpZE1vdmllIiwiYm9keSIsImhlYWRlcnMiLCJzdWNjZXNzIiwiZXJyb3IiLCJzZW5kIiwibW92aWVCeUlkIiwiaWRPcGVyYXRpb24iLCJ1bmRlZmluZWQiLCJ4LXNpY3UiLCJ4LWlkLWludGVyYWNjaW9uIiwieC10b2tlbi11c3VhcmlvIiwicGF5bWVudEJ1dHRvbiIsInVybCIsIm1ldGhvZCIsImpzb25IZWFkZXJzIiwiJCIsImFqYXgiLCJjb250ZW50VHlwZSIsInByb2Nlc3NEYXRhIiwiZGF0YSIsIkpTT04iLCJzdHJpbmdpZnkiLCJiaW5kIiwidmFsdWVzIiwiZWFjaCIsIiR0YWciLCJ0aGlzIiwiaWQiLCJ2YWx1ZSIsImh0bWwiLCJmb3JtYXRBbW91bnQiLCJzZXRUaW1lb3V0Iiwic2hvd0FkdmljZSIsImJpbmRGcm9tU3RyIiwic3RySnNvbiIsInBhcnNlIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImNoYW5nZVNjcmVlbiIsIiRzY3JlZW4iLCJjYWxsYmFjayIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJhbW91bnQiLCJOdW1iZXIiLCJ0b0ZpeGVkIiwicmVwbGFjZSIsImhhbmRsZURpZ2l0S2V5dXAiLCJfcmVmIiwidGFyZ2V0Iiwia2V5Q29kZSIsIiRwYXJlbnQiLCJwYXJlbnROb2RlIiwicHJldiIsImxlbmd0aCIsIiRpbnB1dCIsImZpbmQiLCJ2YWwiLCJmb2N1cyIsIm5leHQiLCJ2YWxpZGF0ZUNvZGUiLCJudW1iZXJGaWx0ZXIiLCJldmVudCIsInRlc3QiLCJvbGRWYWx1ZSIsIm9sZFNlbGVjdGlvblN0YXJ0Iiwic2VsZWN0aW9uU3RhcnQiLCJvbGRTZWxlY3Rpb25FbmQiLCJzZWxlY3Rpb25FbmQiLCJoYXNPd25Qcm9wZXJ0eSIsInNldFNlbGVjdGlvblJhbmdlIiwiZmFrZVJlcXVlc3QiLCJjb2RlIiwic2VhcmNoVG9Kc29uIiwicGFydHMiLCJwYWlycyIsImxvY2F0aW9uIiwic2VhcmNoIiwic3Vic3RyaW5nIiwic3BsaXQiLCJvYmplY3QiLCJpIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiJGVsIiwiZmxhZyIsInNob3dMb2FkZXIiLCJzaG93IiwiJGxvYWRlciIsImFwcGVuZCIsInJlbW92ZSIsInNob3dFcnJvclNjcmVlbiIsImpxWEhSIiwidGV4dFN0YXR1cyIsImVycm9yVGhyb3duIiwiX2pxWEhSJHJlc3BvbnNlSlNPTiIsInJlc3BvbnNlSlNPTiIsImZvbGlvIiwibWVuc2FqZSIsInRleHQiLCIkY29kZSIsIiRkaWdpdHMiLCJlcSIsInNlYXJjaEpzb24iLCJfZGF0YSRyZXN1bHRhZG8iLCJyZXN1bHRhZG8iLCJfZGF0YSRyZXN1bHRhZG8kZGF0b3MiLCJkYXRvc0ZsdWpvIiwiaWRQZWxpY3VsYSIsImltYWdlblBlbGljdWxhIiwibm9tYnJlUGVsaWN1bGEiLCJudW1lcm9DdWVudGFDbGllbnRlQ2FkZW5hQmF6IiwiYm90b25QYWdvIiwiY29tcHJhcyIsInRva2VuT3BlcmFjaW9uIiwidHJhbnNhY2Npb24iLCJkZXRhbGxlUGFnbyIsIm1vbnRvRW52aW8iLCIkYWR2aWNlcyIsIiRhZHZpY2UiLCJvbiIsInBheW1lbnRCdXR0b25IZWFkZXJzIiwiX29iamVjdFNwcmVhZCIsImJ1eU1vdmllSGVhZGVycyIsIl9kYXRhJHJlc3VsdGFkbzIiLCJmZWNoYU9wZXJhY2lvbiIsImhvcmFPcGVyYWNpb24iLCJudW1lcm9Nb3ZpbWllbnRvIiwiY29uY2F0IiwiYXR0ciIsImJ0b2EiXSwibWFwcGluZ3MiOiJxdkJBQUEsSUNBQUEsaUJBQUFDLHFCQUFBQyxxQkFBQUMsbUNBQUFDLGdCQUFBQyxjQUFBQyxxQkFBQUMsY0RBQUMsUUFBQSxDQVVBQyxTQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFOLFFBQUFPLEtBREEsb0dBQUFMLEVBQUEsV0FDQSxPQUFBQyxFQUFBQyxFQUFBQyxJQU9BRyxVQUFBLFNBQUFDLEVBQUFKLEVBQUFDLEdBRUFOLFFBQUFPLEtBREEsaUhBQUFFLEVBQ0EsV0FBQUMsRUFBQSxDQUNBQyxTQUFBLG1DQUNBQyxtQkFBQSx1Q0FDQUMsa0JBQUEsZ0NBQ0FSLEVBQUFDLElBVUFRLGNBQUEsU0FBQVgsRUFBQUMsRUFBQUMsRUFBQUMsR0FFQU4sUUFBQU8sS0FEQSxrR0FDQSxPQUFBSixFQUFBQyxFQUFBQyxFQUFBQyxJQVlBQyxLQUFBLFNBQUFRLEVBQUFDLEVBQUFiLEVBQUFjLEVBQUFaLEVBQUFDLEdBQ0FZLEVBQUFDLEtBQUEsQ0FDQUosSUFBQUEsRUFDQUMsT0FBQUEsRUFDQUksWUFBQSxtQkFDQUMsYUFBQSxFQUNBakIsUUFBQWEsRUFDQUssS0FBQUMsS0FBQUMsVUFBQXJCLEdBQ0FFLFFBQUFBLEVBQ0FDLE1BQUFBLE1DcERBLFNBQUFtQixLQUFBQyxHQUNBUixFQUFBLGFBRUFTLEtBQUEsV0FDQSxJQUFBQyxFQUFBVixFQUFBVyxNQUNBQyxFQUFBRixFQUFBTixLQUFBLE1BQ0FTLEVBQUFMLEVBQUFJLEdBRUEsV0FBQUEsRUFDQUYsRUFBQUksS0FBQUMsYUFBQUYsSUFDQSxVQUFBRCxFQUNBLFVBQUFDLEdBQ0FHLFdBQUEsV0FBQUMsV0FBQVAsR0FBQSxJQUFBLEtBR0FBLEVBQUFJLEtBQUFELEtBU0EsU0FBQUssWUFBQUMsR0FDQSxJQUVBWixLQURBRixLQUFBZSxNQUFBRCxJQUVBLE1BQUFFLEdBQUFDLFFBQUFDLElBQUFGLElBUUEsU0FBQUcsYUFBQUMsRUFBQUMsR0FDQTFCLEVBQUEsV0FBQTJCLFNBQUEsY0FDQUYsRUFBQUcsWUFBQSxjQUVBLG1CQUFBRixHQUFBQSxJQVFBLFNBQUFYLGFBQUFjLEdBQ0EsTUFBQSxLQUFBQyxPQUFBRCxHQUFBRSxRQUFBLEdBQUFDLFFBQUEsd0JBQUEsS0FPQSxTQUFBQyxpQkFBQUMsR0FBQSxJQUFBQyxFQUFBRCxFQUFBQyxPQUFBQyxFQUFBRixFQUFBRSxRQUNBQyxFQUFBckMsRUFBQW1DLEVBQUFHLFlBRUEsSUFBQUYsRUFDQSxFQUFBQyxFQUFBRSxPQUFBQyxVQUNBQyxFQUFBSixFQUFBRSxPQUFBRyxLQUFBLFVBRUFDLElBQUEsSUFDQUYsRUFBQUcsU0FHQSxHQUFBUixHQUFBQSxFQUFBLElBQ0EsS0FBQUQsRUFBQXRCLE9BQ0EsRUFBQXdCLEVBQUFRLE9BQUFMLFFBQ0FILEVBQUFRLE9BQUFILEtBQUEsU0FDQUUsUUFLQUUsZUFPQSxTQUFBQyxhQUFBQyxHQUNBLFlBRUFDLEtBQUF0QyxLQUFBRSxRQUNBRixLQUFBdUMsU0FBQXZDLEtBQUFFLE1BQ0FGLEtBQUF3QyxrQkFBQXhDLEtBQUF5QyxlQUNBekMsS0FBQTBDLGdCQUFBMUMsS0FBQTJDLGNBQ0EzQyxLQUFBNEMsZUFBQSxhQUNBNUMsS0FBQUUsTUFBQUYsS0FBQXVDLFNBQ0F2QyxLQUFBNkMsa0JBQUE3QyxLQUFBd0Msa0JBQUF4QyxLQUFBMEMsa0JBRUExQyxLQUFBRSxNQUFBLEdBUUEsU0FBQTRDLFlBQUFDLEVBQUFoQyxHQUNBVixXQUFBLFdBQ0FVLEVBQUEsV0FBQWdDLElBQ0EsTUFPQSxTQUFBQyxlQUtBLElBSkEsSUFTQUMsRUFUQUMsRUFBQUMsU0FBQUMsT0FBQUMsVUFBQSxHQUFBQyxNQUFBLEtBQ0FDLEVBQUEsR0FDQUMsRUFBQSxFQUVBQSxFQUFBTixFQUFBckIsT0FBQTJCLElBQ0EsS0FBQU4sRUFBQU0sS0FJQVAsRUFBQUMsRUFBQU0sR0FBQUYsTUFBQSxLQUNBQyxFQUFBRSxtQkFBQVIsRUFBQSxLQUFBUSxtQkFBQVIsRUFBQSxLQUdBLE9BQUFNLEVBUUEsU0FBQWpELFdBQUFvRCxFQUFBQyxHQUNBQSxFQUNBRCxFQUFBMUMsU0FBQSxjQUVBMEMsRUFBQXpDLFlBQUEsY0FRQSxTQUFBMkMsV0FBQUMsR0FDQSxJQUFBQyxFQUFBekUsRUFBQSxXQUVBd0UsR0FDQUMsRUFBQWpDLFFBQUEsSUFDQWlDLEVBQUF6RSxFQUFBLHlCQUdBQSxFQUFBLFFBQUEwRSxPQUFBRCxHQUNBekQsV0FBQSxXQUFBLE9BQUF5RCxFQUFBOUMsU0FBQSxtQkFBQSxNQUdBOEMsRUFBQTdDLFlBQUEsa0JBQ0FaLFdBQUEsV0FBQSxPQUFBeUQsRUFBQUUsVUFBQSxNQVdBLFNBQUFDLGdCQUFBQyxFQUFBQyxFQUFBQyxHQUNBLElBQUFDLEVBQUFILEVBQUFJLGFBQUFDLEVBQUFGLEVBQUFFLE1BQUFDLEVBQUFILEVBQUFHLFFBRUFuRixFQUFBLGlCQUFBMEMsS0FBQSx1QkFBQTBDLEtBQUFELEdBQ0FuRixFQUFBLGlCQUFBMEMsS0FBQSxxQkFBQTBDLEtBQUFGLEdBRUExRCxhQUFBeEIsRUFBQSxrQkFDQXVFLFlBQUEsR0FPQSxTQUFBekIsZUFDQSxJQUFBdUMsRUFBQXJGLEVBQUEsc0JBQ0FzRixFQUFBdEYsRUFBQSw2QkFDQTBELEVBQUEsR0FFQTRCLEVBQUE3RSxLQUFBLFdBQ0FpRCxHQUFBL0MsS0FBQUUsUUFHQSxJQUFBNkMsRUFBQWxCLFFBQ0ErQixZQUFBLEdBRUFkLFlBQUFDLEVBQUEsU0FBQXZFLEdBQ0FBLEdBQ0FrRyxFQUFBMUQsU0FBQSxTQUVBSCxhQUFBeEIsRUFBQSxrQkFBQSxXQUNBdUUsWUFBQSxPQUdBQSxZQUFBLEdBQ0FjLEVBQUExRCxTQUFBLFdBRUFYLFdBQUEsV0FDQXNFLEVBQUE3RSxLQUFBLFdBQUFULEVBQUFXLE1BQUFnQyxJQUFBLE1BQ0EyQyxFQUFBQyxHQUFBLEdBQUEzQyxTQUNBLFNBSUF5QyxFQUFBekQsWUFBQSxpQkFNQSxJQUFBNEQsV0FBQTdCLGVBRUFZLFlBQUEsR0FDQXpGLFFBQUFRLFVBQUFrRyxXQUFBLFlBQUEsU0FBQXBGLEdBQ0FrQixRQUFBQyxJQUFBLEtBQUFuQixHQUNBb0IsYUFBQXhCLEVBQUEsa0JBQUEsV0FDQSxJQUFBeUYsRUFBQXJGLEVBQUFzRixVQUFBQyxFQUFBRixFQUFBRyxXQUFBQyxFQUFBRixFQUFBRSxXQUFBQyxFQUFBSCxFQUFBRyxlQUFBQyxFQUFBSixFQUFBSSxlQUFBQyxFQUFBTCxFQUFBSyw2QkFBQUMsRUFBQU4sRUFBQU0sVUFBQUMsRUFBQVAsRUFBQU8sUUFBQUMsRUFBQVIsRUFBQVEsZUFBQWpILEVBQUF1RyxFQUFBdkcsUUFFQVosaUJBQUF1SCxFQUNBdEgscUJBQUF1SCxFQUNBdEgscUJBQUF1SCxFQUNBdEgsbUNBQUF1SCxFQUNBdEgsZ0JBQUF1SCxFQUFBRyxZQUNBekgsY0FBQXVILEVBQUFFLFlBQ0F4SCxxQkFBQXVILEVBQ0F0SCxjQUFBSyxFQUdBYyxFQUFBLGtCQUFBMEMsS0FBQSxzQkFBQTBDLEtBQUE1RyxzQkFDQXdCLEVBQUEsa0JBQUEwQyxLQUFBLHNCQUFBMEMsS0FBQXJFLGFBQUFyQyxnQkFBQTJILFlBQUFDLGFBQ0F0RyxFQUFBLGtCQUFBMEMsS0FBQSx1QkFBQTBDLEtBQUEzRyxvQ0FFQThGLFlBQUEsTUFFQUssaUJBRUEsSUFBQTJCLFNBQUF2RyxFQUFBLGlCQUVBdUcsU0FBQTlGLEtBQUEsV0FDQSxJQUFBK0YsRUFBQXhHLEVBQUFXLE1BQ0E2RixFQUFBOUQsS0FBQSxjQUVBK0QsR0FBQSxRQUFBLFdBQ0F4RixXQUFBdUYsR0FBQSxPQUlBeEcsRUFBQSxnQkFBQXlHLEdBQUEsUUFBQSxXQUNBbkYsUUFBQUMsSUFBQSxrQ0FFQSxJQUFBbUYsRUFBQUMsY0FBQSxHQUFBOUgsZUFDQStILEVBQUFELGNBQUEsR0FBQTlILHNCQUVBK0gsRUFBQSwrQkFFQXJDLFlBQUEsR0FDQXpGLFFBQUFjLGNBQUEsQ0FBQXdHLFlBQUFPLGNBQUFBLGNBQUEsR0FBQWpJLGlCQUFBLEdBQUEsQ0FBQXlILGVBQUF2SCx3QkFBQThILEVBQUEsU0FBQXRHLEdBQ0FrQixRQUFBQyxJQUFBLGlDQUFBbkIsR0FFQSxJQUFBeUcsRUFBQXpHLEVBQUFzRixVQUFBb0IsRUFBQUQsRUFBQUMsZUFBQUMsRUFBQUYsRUFBQUUsY0FFQWpJLFFBQUFDLFNBQUFULGlCQUFBLENBQUE4SCxZQUFBTyxjQUFBQSxjQUFBLEdBQUFoSSxlQUFBLEdBQUEsQ0FBQW1JLGVBQUExRyxFQUFBc0YsVUFBQW9CLGVBQUFFLGlCQUFBNUcsRUFBQXNGLFVBQUFzQixvQkFBQUosRUFBQSxTQUFBeEcsR0FDQWtCLFFBQUFDLElBQUEsNEJBQUFuQixHQUVBOEUsRUFBQTlFLEVBQUE4RSxNQUdBbEYsRUFBQSxrQkFBQTBDLEtBQUEscUJBQUEwQyxLQUFBLEdBQUE2QixPQUFBSCxFQUFBLE1BQUFHLE9BQUFGLElBQ0EvRyxFQUFBLGtCQUFBMEMsS0FBQSxzQkFBQTBDLEtBQUFyRSxhQUFBckMsZ0JBQUEySCxZQUFBQyxhQUNBdEcsRUFBQSxrQkFBQTBDLEtBQUEsdUJBQUEwQyxLQUFBM0csb0NBQ0F1QixFQUFBLGtCQUFBMEMsS0FBQSxzQkFBQTBDLEtBQUE1RyxzQkFDQXdCLEVBQUEsa0JBQUEwQyxLQUFBLHNCQUFBMEMsS0FBQXJFLGFBQUFyQyxnQkFBQTJILFlBQUFDLGFBQ0F0RyxFQUFBLGtCQUFBMEMsS0FBQSxxQkFBQTBDLEtBQUFGLEdBRUExRCxhQUFBeEIsRUFBQSxtQkFDQXVFLFlBQUEsSUFDQUssa0JBQ0FBLG1CQUtBLElBQUFVLFFBQUF0RixFQUFBLDZCQUVBc0YsUUFBQW1CLEdBQUEsNENBQUExRCxjQUNBdUMsUUFBQW1CLEdBQUEsUUFBQXhFLGtCQUVBcUQsUUFBQUMsR0FBQSxHQUFBM0MsUUFJQTVDLEVBQUEsY0FBQXlHLEdBQUEsUUFBQSxXQUNBbkYsUUFBQUMsSUFBQSxnQ0FNQXZCLEVBQUEsY0FBQXlHLEdBQUEsUUFBQSxXQUNBbkYsUUFBQUMsSUFBQSx5Q0FFQXZCLEVBQUEsbUJBQUEwQyxLQUFBLHNCQUFBMEMsS0FBQTVHLHNCQUNBd0IsRUFBQSxtQkFBQTBDLEtBQUEsbUJBQUF3RSxLQUFBLE9BQUEsOEJBQUFELE9BQUFFLEtBQUE3SSxrQkFBQSwrSkFHQUMsc0JBQ0F5QixFQUFBLGFBQUFpSCxPQUFBMUkscUJBQUEsT0FBQWtJLEdBQUEsT0FBQSxXQUNBekcsRUFBQSxtQkFBQTBDLEtBQUEsc0JBQUF3RSxLQUFBLFFBQUEseUJBQUFELE9BQUExSSxxQkFBQSxNQUFBb0QsU0FBQSxlQUlBSCxhQUFBeEIsRUFBQSIsImZpbGUiOiJzY3JpcHRzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHJlcXVlc3QgPSB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNYWtlIGEgcGF5bWVudC5cclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpZE1vdmllIFxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGJvZHkgXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gaGVhZGVycyBcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1Y2Nlc3MgXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBlcnJvciBcclxuICAgICAqL1xyXG4gICAgYnV5TW92aWU6IGZ1bmN0aW9uIChpZE1vdmllLCBib2R5LCBoZWFkZXJzLCBzdWNjZXNzLCBlcnJvcikge1xyXG4gICAgICAgIGNvbnN0IHVybCA9ICdodHRwczovL2FwaWdhdGV3YXkuc3VwZXJhcHBiYXouY29tL2ludGVncmFjaW9uL3N1cGVyYXBwL2RpdmVyc2lvbi9nZXN0aW9uLXBlbGljdWxhcy92MS9wZWxpY3VsYXMvJyArIGlkTW92aWUgKyAnL2NvbXByYXMnO1xyXG4gICAgICAgIHJlcXVlc3Quc2VuZCh1cmwsICdQT1NUJywgYm9keSwgaGVhZGVycywgc3VjY2VzcylcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgbW92aWUgYnkgaWQgb3BlcmF0aW9uLlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGlkT3BlcmF0aW9uIFxyXG4gICAgICovXHJcbiAgICBtb3ZpZUJ5SWQ6IGZ1bmN0aW9uKGlkT3BlcmF0aW9uLCBzdWNjZXNzLCBlcnJvcikge1xyXG4gICAgICAgIGNvbnN0IHVybCA9ICdodHRwczovL2FwaWdhdGV3YXkuc3VwZXJhcHBiYXouY29tL2ludGVncmFjaW9uL3N1cGVyYXBwL2NhbmFsL2NsaWVudGVzL2dlc3Rpb24tc2VzaW9uZXMvdjEvcG9ydGFsL29wZXJhY2lvbmVzLycgKyBpZE9wZXJhdGlvbjtcclxuICAgICAgICByZXF1ZXN0LnNlbmQodXJsLCAnR0VUJywgdW5kZWZpbmVkLCB7XHJcbiAgICAgICAgICAgICd4LXNpY3UnOiAnM2JhZDEyOTBhYzQ2MDBhNTY5MTYyZWZhYTA5MTE3ZWEnLFxyXG4gICAgICAgICAgICAneC1pZC1pbnRlcmFjY2lvbic6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2NTU0NDAwMDAnLFxyXG4gICAgICAgICAgICAneC10b2tlbi11c3VhcmlvJzogJ1NSZlZaclRZdmRtN216elptY3VpRFZpQUNrQXgnXHJcbiAgICAgICAgfSwgc3VjY2VzcywgZXJyb3IpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVyIHBheW1lbnQuXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYm9keVxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGhlYWRlcnNcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1Y2Nlc3NcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXHJcbiAgICAgKi9cclxuICAgIHBheW1lbnRCdXR0b246IGZ1bmN0aW9uIChib2R5LCBoZWFkZXJzLCBzdWNjZXNzLCBlcnJvcikge1xyXG4gICAgICAgIGNvbnN0IHVybCA9ICdodHRwczovL2FwaWdhdGV3YXkuc3VwZXJhcHBiYXouY29tL2ludGVncmFjaW9uL3N1cGVyYXBwL3BhZ29zL2NhcHRhY2lvbi90cmFzcGFzb3MvdjEvYm90b24tcGFnbyc7XHJcbiAgICAgICAgcmVxdWVzdC5zZW5kKHVybCwgJ1BPU1QnLCBib2R5LCBoZWFkZXJzLCBzdWNjZXNzLCBlcnJvcik7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogTWFrZSByZXF1ZXN0LlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHVybCBcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtZXRob2RcclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBib2R5XHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0ganNvbkhlYWRlcnMgXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzIFxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZXJyb3JcclxuICAgICAqL1xyXG4gICAgc2VuZDogZnVuY3Rpb24gKHVybCwgbWV0aG9kLCBib2R5LCBqc29uSGVhZGVycywgc3VjY2VzcywgZXJyb3IpIHtcclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmwsIFxyXG4gICAgICAgICAgICBtZXRob2QsXHJcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSwgXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IGpzb25IZWFkZXJzLCBcclxuICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoYm9keSksXHJcbiAgICAgICAgICAgIHN1Y2Nlc3MsXHJcbiAgICAgICAgICAgIGVycm9yXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07IiwibGV0IGdsb2JhbElkUGVsaWN1bGEsIGdsb2JhbEltYWdlblBlbGljdWxhLCBnbG9iYWxOb21icmVQZWxpY3VsYSwgZ2xvYmFsTnVtZXJvQ3VlbnRhQ2xpZW50ZUNhZGVuYUJheiwgZ2xvYmFsQm90b25QYWdvLCBnbG9iYWxDb21wcmFzLCBnbG9iYWxUb2tlbk9wZXJhY2lvbiwgZ2xvYmFsSGVhZGVycztcclxuXHJcbi8qKlxyXG4gKiBCaW5kIEpTT04gdG8gSFRNTC5cclxuICogQHBhcmFtIHtvYmplY3R9IHZhbHVlc1xyXG4gKi9cclxuZnVuY3Rpb24gYmluZCh2YWx1ZXMpIHtcclxuICAgIGNvbnN0ICR0YWdzID0gJCgnW2RhdGEtaWRdJyk7XHJcblxyXG4gICAgJHRhZ3MuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgJHRhZyA9ICQodGhpcyk7XHJcbiAgICAgICAgY29uc3QgaWQgPSAkdGFnLmRhdGEoJ2lkJyk7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbaWRdO1xyXG5cclxuICAgICAgICBpZiAoaWQgPT09ICdwcmVjaW8nKSB7XHJcbiAgICAgICAgICAgICR0YWcuaHRtbChmb3JtYXRBbW91bnQodmFsdWUpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGlkID09PSAnc2FsZG8nKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJ2ZhbHNlJykge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHNob3dBZHZpY2UoJHRhZywgdHJ1ZSk7IH0sIDUwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkdGFnLmh0bWwodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogUGFyc2Ugc3RyaW5nIHRvIG9iamVjdCBhbmQgdGhlbiBiaW5kLlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RySnNvbiBcclxuICovXHJcbmZ1bmN0aW9uIGJpbmRGcm9tU3RyKHN0ckpzb24pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2Uoc3RySnNvbik7XHJcbiAgICAgICAgYmluZChqc29uKTtcclxuICAgIH0gY2F0Y2ggKGVycikgeyBjb25zb2xlLmxvZyhlcnIpOyB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDaGFuZ2Ugc2NyZWVuLlxyXG4gKiBAcGFyYW0ge2pRdWVyeX0gJHNjcmVlblxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xyXG4gKi9cclxuZnVuY3Rpb24gY2hhbmdlU2NyZWVuKCRzY3JlZW4sIGNhbGxiYWNrKSB7XHJcbiAgICAkKCcuc2NyZWVuJykuYWRkQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgICRzY3JlZW4ucmVtb3ZlQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuXHJcbiAgICB0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicgJiYgY2FsbGJhY2soKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBhbW91bnQgd2l0aCBjdXJyZW5jeSBmb3JtYXQuXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBhbW91bnQgXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAqL1xyXG5mdW5jdGlvbiBmb3JtYXRBbW91bnQoYW1vdW50KSB7XHJcbiAgICByZXR1cm4gJyQgJyArIE51bWJlcihhbW91bnQpLnRvRml4ZWQoMikucmVwbGFjZSgvXFxCKD89KFxcZHszfSkrKD8hXFxkKSkvZywgJywnKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEhhbmRsZSBkaWdpdCBrZXl1cCBldmVudC5cclxuICogQHBhcmFtIHtLZXlib2FyZEV2ZW50fSBldmVudFxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlRGlnaXRLZXl1cCh7IHRhcmdldCwga2V5Q29kZSB9KSB7XHJcbiAgICBjb25zdCAkcGFyZW50ID0gJCh0YXJnZXQucGFyZW50Tm9kZSk7XHJcblxyXG4gICAgaWYgKGtleUNvZGUgPT09IDgpIHtcclxuICAgICAgICBpZiAoJHBhcmVudC5wcmV2KCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCAkaW5wdXQgPSAkcGFyZW50LnByZXYoKS5maW5kKCdpbnB1dCcpO1xyXG5cclxuICAgICAgICAgICAgJGlucHV0LnZhbCgnJyk7XHJcbiAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9IGVsc2UgaWYgKGtleUNvZGUgPiA0NyAmJiBrZXlDb2RlIDwgNTgpIHtcclxuICAgICAgICBpZiAodGFyZ2V0LnZhbHVlICE9PSAnJykge1xyXG4gICAgICAgICAgICBpZiAoJHBhcmVudC5uZXh0KCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJHBhcmVudC5uZXh0KCkuZmluZCgnaW5wdXQnKTtcclxuICAgICAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHZhbGlkYXRlQ29kZSgpO1xyXG59XHJcblxyXG4vKipcclxuICogQXBwbHkgbnVtYmVyIGZpbHRlci5cclxuICogQHBhcmFtIHtFdmVudH0gZXZlbnRcclxuICovXHJcbmZ1bmN0aW9uIG51bWJlckZpbHRlcihldmVudCkge1xyXG4gICAgY29uc3QgZmlsdGVyID0gL15cXGR7MCwxfSQvO1xyXG5cclxuICAgIGlmIChmaWx0ZXIudGVzdCh0aGlzLnZhbHVlKSkge1xyXG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xyXG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uU3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xyXG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uRW5kID0gdGhpcy5zZWxlY3Rpb25FbmQ7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoJ29sZFZhbHVlJykpIHtcclxuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcclxuICAgICAgICB0aGlzLnNldFNlbGVjdGlvblJhbmdlKHRoaXMub2xkU2VsZWN0aW9uU3RhcnQsIHRoaXMub2xkU2VsZWN0aW9uRW5kKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9ICcnO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogRG8gZmFrZSByZXF1ZXN0LlxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xyXG4gKi9cclxuZnVuY3Rpb24gZmFrZVJlcXVlc3QoY29kZSwgY2FsbGJhY2spIHtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGNhbGxiYWNrKGNvZGUgPT09ICcwMDAwMDEnKTtcclxuICAgIH0sIDE1MDApO1xyXG59XHJcblxyXG4vKipcclxuICogUGFyc2UgbG9jYXRpb24uc2VhcmNoIHRvIEpTT04uXHJcbiAqIEByZXR1cm5zIG9iamVjdFxyXG4gKi9cclxuZnVuY3Rpb24gc2VhcmNoVG9Kc29uKCkge1xyXG4gICAgY29uc3QgcGFpcnMgPSBsb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpLnNwbGl0KCcmJyk7XHJcbiAgICBjb25zdCBvYmplY3QgPSB7fTtcclxuICAgIGxldCBpID0gMDtcclxuXHJcbiAgICBmb3IgKDsgaSA8IHBhaXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKHBhaXJzW2ldID09PSAnJykge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHBhcnRzID0gcGFpcnNbaV0uc3BsaXQoJz0nKTtcclxuICAgICAgICBvYmplY3RbZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzBdKV0gPSBkZWNvZGVVUklDb21wb25lbnQocGFydHNbMV0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBvYmplY3Q7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTaG93IG9yIGhpZGUgYWR2aWNlLlxyXG4gKiBAcGFyYW0ge2pRdWVyeX0gJGVsIFxyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGZsYWcgXHJcbiAqL1xyXG5mdW5jdGlvbiBzaG93QWR2aWNlKCRlbCwgZmxhZykge1xyXG4gICAgaWYgKGZsYWcpIHtcclxuICAgICAgICAkZWwuYWRkQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGVsLnJlbW92ZUNsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTaG93IG9yIGhpZGUgbG9hZGVyLlxyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHNob3dcclxuICovXHJcbmZ1bmN0aW9uIHNob3dMb2FkZXIoc2hvdykge1xyXG4gICAgbGV0ICRsb2FkZXIgPSAkKCcubG9hZGVyJyk7XHJcblxyXG4gICAgaWYgKHNob3cpIHtcclxuICAgICAgICBpZiAoJGxvYWRlci5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICAkbG9hZGVyID0gJCgnPGRpdiBjbGFzcz1cImxvYWRlclwiPicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJCgnYm9keScpLmFwcGVuZCgkbG9hZGVyKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+ICRsb2FkZXIuYWRkQ2xhc3MoJ2xvYWRlci12aXNpYmxlJyksIDEwKTtcclxuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICRsb2FkZXIucmVtb3ZlQ2xhc3MoJ2xvYWRlci12aXNpYmxlJyk7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiAkbG9hZGVyLnJlbW92ZSgpLCAzNzUpO1xyXG5cclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFNob3cgb3IgaGlkZSBlcnJvciBzY3JlZW4uXHJcbiAqIEBwYXJhbSB7anFYSFJ9IGpxWEhSXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0U3RhdHVzXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBlcnJvclRocm93biBcclxuICovXHJcbmZ1bmN0aW9uIHNob3dFcnJvclNjcmVlbihqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcclxuICAgIGNvbnN0IHsgcmVzcG9uc2VKU09OOiB7IGZvbGlvLCBtZW5zYWplIH0gfSA9IGpxWEhSO1xyXG5cclxuICAgICQoJy5lcnJvci1zY3JlZW4nKS5maW5kKCdbZGF0YS1pZD1cIm1lbnNhamVcIl0nKS50ZXh0KG1lbnNhamUpO1xyXG4gICAgJCgnLmVycm9yLXNjcmVlbicpLmZpbmQoJ1tkYXRhLWlkPVwiZm9saW9cIl0nKS50ZXh0KGZvbGlvKTtcclxuICAgIFxyXG4gICAgY2hhbmdlU2NyZWVuKCQoJy5lcnJvci1zY3JlZW4nKSk7XHJcbiAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFZhbGlkYXRlIGNvZGUgZnJvbSBjbGllbnQuXHJcbiAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gKi9cclxuZnVuY3Rpb24gdmFsaWRhdGVDb2RlKCkge1xyXG4gICAgY29uc3QgJGNvZGUgPSAkKCcuYXV0aC1zY3JlZW4gLmNvZGUnKTtcclxuICAgIGNvbnN0ICRkaWdpdHMgPSAkKCcuYXV0aC1zY3JlZW4gLmRpZ2l0IGlucHV0Jyk7XHJcbiAgICBsZXQgY29kZSA9IFwiXCI7XHJcblxyXG4gICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb2RlICs9IHRoaXMudmFsdWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoY29kZS5sZW5ndGggPT09IDYpIHtcclxuICAgICAgICBzaG93TG9hZGVyKHRydWUpO1xyXG5cclxuICAgICAgICBmYWtlUmVxdWVzdChjb2RlLCBzdWNjZXNzID0+IHtcclxuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCd2YWxpZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNoYW5nZVNjcmVlbigkKCcucmVzdW1lLXNjcmVlbicpLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ2ludmFsaWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkgeyAkKHRoaXMpLnZhbCgnJyk7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICRkaWdpdHMuZXEoMCkuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGNvZGUucmVtb3ZlQ2xhc3MoJ3ZhbGlkIGludmFsaWQnKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgRGV0YWlsIFNjcmVlbiBjb21wb25lbnRzLlxyXG5jb25zdCBzZWFyY2hKc29uID0gc2VhcmNoVG9Kc29uKCk7XHJcblxyXG5zaG93TG9hZGVyKHRydWUpO1xyXG5yZXF1ZXN0Lm1vdmllQnlJZChzZWFyY2hKc29uWydpZE9wZXJhY2lvbiddLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgY29uc29sZS5sb2coJyVvJywgZGF0YSk7XHJcbiAgICBjaGFuZ2VTY3JlZW4oJCgnLmRldGFpbC1zY3JlZW4nKSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0b3NGbHVqbzogeyBpZFBlbGljdWxhLCBpbWFnZW5QZWxpY3VsYSwgbm9tYnJlUGVsaWN1bGEsIG51bWVyb0N1ZW50YUNsaWVudGVDYWRlbmFCYXosIGJvdG9uUGFnbywgY29tcHJhcywgdG9rZW5PcGVyYWNpb24gfSwgaGVhZGVycyB9ID0gZGF0YS5yZXN1bHRhZG87XHJcbiAgICAgICAgXHJcbiAgICAgICAgZ2xvYmFsSWRQZWxpY3VsYSA9IGlkUGVsaWN1bGE7XHJcbiAgICAgICAgZ2xvYmFsSW1hZ2VuUGVsaWN1bGEgPSBpbWFnZW5QZWxpY3VsYTtcclxuICAgICAgICBnbG9iYWxOb21icmVQZWxpY3VsYSA9IG5vbWJyZVBlbGljdWxhO1xyXG4gICAgICAgIGdsb2JhbE51bWVyb0N1ZW50YUNsaWVudGVDYWRlbmFCYXogPSBudW1lcm9DdWVudGFDbGllbnRlQ2FkZW5hQmF6O1xyXG4gICAgICAgIGdsb2JhbEJvdG9uUGFnbyA9IGJvdG9uUGFnby50cmFuc2FjY2lvbjtcclxuICAgICAgICBnbG9iYWxDb21wcmFzID0gY29tcHJhcy50cmFuc2FjY2lvbjtcclxuICAgICAgICBnbG9iYWxUb2tlbk9wZXJhY2lvbiA9IHRva2VuT3BlcmFjaW9uO1xyXG4gICAgICAgIGdsb2JhbEhlYWRlcnMgPSBoZWFkZXJzO1xyXG5cclxuICAgICAgICAvLyBGaWxsIGRldGFpbCBzY3JlZW4uXHJcbiAgICAgICAgJCgnLmRldGFpbC1zY3JlZW4nKS5maW5kKCdbZGF0YS1pZD1cIm5vbWJyZVwiXScpLnRleHQoZ2xvYmFsTm9tYnJlUGVsaWN1bGEpO1xyXG4gICAgICAgICQoJy5kZXRhaWwtc2NyZWVuJykuZmluZCgnW2RhdGEtaWQ9XCJwcmVjaW9cIl0nKS50ZXh0KGZvcm1hdEFtb3VudChnbG9iYWxCb3RvblBhZ28uZGV0YWxsZVBhZ28ubW9udG9FbnZpbykpO1xyXG4gICAgICAgICQoJy5kZXRhaWwtc2NyZWVuJykuZmluZCgnW2RhdGEtaWQ9XCJ0YXJqZXRhXCJdJykudGV4dChnbG9iYWxOdW1lcm9DdWVudGFDbGllbnRlQ2FkZW5hQmF6KTtcclxuICAgICAgICBcclxuICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgIH0pO1xyXG59LCBzaG93RXJyb3JTY3JlZW4pO1xyXG5cclxuY29uc3QgJGFkdmljZXMgPSAkKCcuYWR2aWNlLmZpeGVkJyk7XHJcblxyXG4kYWR2aWNlcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0ICRhZHZpY2UgPSAkKHRoaXMpO1xyXG4gICAgY29uc3QgJGNsb3NlQnRuID0gJGFkdmljZS5maW5kKCcuY2xvc2UtYnRuJyk7XHJcblxyXG4gICAgJGNsb3NlQnRuLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBzaG93QWR2aWNlKCRhZHZpY2UsIGZhbHNlKTtcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbiQoJy5yZW50LWJ1dHRvbicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IENsaWNrIHJlbnQgYnV0dG9uLicpO1xyXG5cclxuICAgIGNvbnN0IHBheW1lbnRCdXR0b25IZWFkZXJzID0geyAuLi5nbG9iYWxIZWFkZXJzIH07XHJcbiAgICBjb25zdCBidXlNb3ZpZUhlYWRlcnMgPSB7IC4uLmdsb2JhbEhlYWRlcnMgfTtcclxuXHJcbiAgICBkZWxldGUgYnV5TW92aWVIZWFkZXJzWyd4LWlkLW9wZXJhY2lvbi1jb25jaWxpYWNpb24nXTtcclxuXHJcbiAgICBzaG93TG9hZGVyKHRydWUpO1xyXG4gICAgcmVxdWVzdC5wYXltZW50QnV0dG9uKHsgXCJ0cmFuc2FjY2lvblwiOiB7IC4uLmdsb2JhbEJvdG9uUGFnbywgdG9rZW5PcGVyYWNpb246IGdsb2JhbFRva2VuT3BlcmFjaW9uIH0gfSwgcGF5bWVudEJ1dHRvbkhlYWRlcnMsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IFBheW1lbnQgYnV0dG9uLiAlbycsIGRhdGEpO1xyXG5cclxuICAgICAgICBjb25zdCB7IHJlc3VsdGFkbzogeyBmZWNoYU9wZXJhY2lvbiwgaG9yYU9wZXJhY2lvbiB9IH0gPSBkYXRhO1xyXG5cclxuICAgICAgICByZXF1ZXN0LmJ1eU1vdmllKGdsb2JhbElkUGVsaWN1bGEsIHsgXCJ0cmFuc2FjY2lvblwiOiB7IC4uLmdsb2JhbENvbXByYXMsIGZlY2hhT3BlcmFjaW9uOiBkYXRhLnJlc3VsdGFkby5mZWNoYU9wZXJhY2lvbiwgbnVtZXJvTW92aW1pZW50bzogZGF0YS5yZXN1bHRhZG8ubnVtZXJvTW92aW1pZW50byB9IH0sIGJ1eU1vdmllSGVhZGVycywgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IEJ1eSBtb3ZpZS4gJW8nLCBkYXRhKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHsgZm9saW8gfSA9IGRhdGE7XHJcblxyXG4gICAgICAgICAgICAvLyBGaWxsIHJlc3VtZSBzY3JlZW4uXHJcbiAgICAgICAgICAgICQoJy5yZXN1bWUtc2NyZWVuJykuZmluZCgnW2RhdGEtaWQ9XCJmZWNoYVwiXScpLnRleHQoYCR7ZmVjaGFPcGVyYWNpb259LCAke2hvcmFPcGVyYWNpb259YCk7XHJcbiAgICAgICAgICAgICQoJy5yZXN1bWUtc2NyZWVuJykuZmluZCgnW2RhdGEtaWQ9XCJwcmVjaW9cIl0nKS50ZXh0KGZvcm1hdEFtb3VudChnbG9iYWxCb3RvblBhZ28uZGV0YWxsZVBhZ28ubW9udG9FbnZpbykpO1xyXG4gICAgICAgICAgICAkKCcucmVzdW1lLXNjcmVlbicpLmZpbmQoJ1tkYXRhLWlkPVwidGFyamV0YVwiXScpLnRleHQoZ2xvYmFsTnVtZXJvQ3VlbnRhQ2xpZW50ZUNhZGVuYUJheik7XHJcbiAgICAgICAgICAgICQoJy5yZXN1bWUtc2NyZWVuJykuZmluZCgnW2RhdGEtaWQ9XCJub21icmVcIl0nKS50ZXh0KGdsb2JhbE5vbWJyZVBlbGljdWxhKTtcclxuICAgICAgICAgICAgJCgnLnJlc3VtZS1zY3JlZW4nKS5maW5kKCdbZGF0YS1pZD1cInByZWNpb1wiXScpLnRleHQoZm9ybWF0QW1vdW50KGdsb2JhbEJvdG9uUGFnby5kZXRhbGxlUGFnby5tb250b0VudmlvKSk7XHJcbiAgICAgICAgICAgICQoJy5yZXN1bWUtc2NyZWVuJykuZmluZCgnW2RhdGEtaWQ9XCJmb2xpb1wiXScpLnRleHQoZm9saW8pO1xyXG5cclxuICAgICAgICAgICAgY2hhbmdlU2NyZWVuKCQoJy5yZXN1bWUtc2NyZWVuJykpO1xyXG4gICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICB9LCBzaG93RXJyb3JTY3JlZW4pO1xyXG4gICAgfSwgc2hvd0Vycm9yU2NyZWVuKTtcclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBBdXRoIFNjcmVlbiBjb21wb25lbnRzLlxyXG5jb25zdCAkZGlnaXRzID0gJCgnLmF1dGgtc2NyZWVuIC5kaWdpdCBpbnB1dCcpO1xyXG5cclxuJGRpZ2l0cy5vbigna2V5cHJlc3Mga2V5ZG93biBrZXl1cCBpbnB1dCBjaGFuZ2UgcGFzdGUnLCBudW1iZXJGaWx0ZXIpXHJcbiRkaWdpdHMub24oJ2tleXVwJywgaGFuZGxlRGlnaXRLZXl1cCk7XHJcblxyXG4kZGlnaXRzLmVxKDApLmZvY3VzKCk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBzaGFyZSBidXR0b24uXHJcbiQoJy5zaGFyZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogU2hhcmluZyB0aWNrZXQnKTtcclxuXHJcbn0pO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgbW92aWUgYnV0dG9uLlxyXG4kKCcubW92aWUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IEdvIHRvIG1vdmllIGJ1dHRvbiBjbGljay4nKTtcclxuXHJcbiAgICAkKCcuc3VjY2Vzcy1zY3JlZW4nKS5maW5kKCdbZGF0YS1pZD1cIm5vbWJyZVwiXScpLnRleHQoZ2xvYmFsTm9tYnJlUGVsaWN1bGEpO1xyXG4gICAgJCgnLnN1Y2Nlc3Mtc2NyZWVuJykuZmluZCgnLnNlZS1tb3ZpZS1ocmVmJykuYXR0cignaHJlZicsIGBpbnRlbnQ6Ly8/dmVyUGVsaWN1bGE/ZGF0YT0ke2J0b2EoZ2xvYmFsSWRQZWxpY3VsYSl9I0ludGVudDtzY2hlbWU9c2FwcGRsO2FjdGlvbj1hbmRyb2lkLmludGVudC5hY3Rpb24uVklFVztTLmJyb3dzZXJfZmFsbGJhY2tfdXJsPWh0dHBzJTNBJTJGJTJGcGxheS5nb29nbGUuY29tL3N0b3JlL2FwcHMvZGV0YWlscz9pZD1teC5hcHAuYmF6LnN1cGVyYXBwO2VuZGApO1xyXG5cclxuICAgIC8vIFdhaXQgZm9yIGltYWdlIGlzIGFscmVhZHkgbG9hZGVkLlxyXG4gICAgaWYgKGdsb2JhbEltYWdlblBlbGljdWxhKSB7XHJcbiAgICAgICAgJChgPGltZyBzcmM9XCIke2dsb2JhbEltYWdlblBlbGljdWxhfVwiPmApLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICQoJy5zdWNjZXNzLXNjcmVlbicpLmZpbmQoJ1tkYXRhLWlkPVwiaW1hZ2VuXCJdJykuYXR0cignc3R5bGUnLCBgYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7Z2xvYmFsSW1hZ2VuUGVsaWN1bGF9KWApLmFkZENsYXNzKCdkaXNwbGF5ZWQnKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjaGFuZ2VTY3JlZW4oJCgnLnN1Y2Nlc3Mtc2NyZWVuJykpO1xyXG59KTtcclxuIl19

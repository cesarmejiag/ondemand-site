"use strict";function ownKeys(o,e){var t,n=Object.keys(o);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(o),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),n.push.apply(n,t)),n}function _objectSpread(o){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){_defineProperty(o,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(t,e))})}return o}function _defineProperty(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}!function(r){r.fn.swipe=function(e){var c=r.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var o=r(this),t=0,n=0,i=!1,a=o.find(".slider"),s=o.find(".text");a.on("mousedown touchstart",function(e){i=!0,n=o.width()-r(this).width()+10,t=e.clientX||e.originalEvent.touches[0].pageX}),r(document.body,a).on("mouseup touchend",function(e){if(i){if(i=!1,(e.clientX||e.changedTouches[0].pageX)-t<n)return s.fadeTo(300,1),void a.animate({left:"-10px"},300);c.cb()}}),r(document.body).on("mousemove touchmove",function(e){var o;i&&(e=1-(o=(e.clientX||e.originalEvent.touches[0].pageX)-t)/n,s.fadeTo(0,e),o<=0?a.css({left:"-10px"}):n+10<=o?a.css({left:n+"px"}):a.css({left:o-10}))})})}}(jQuery);var globalIdPelicula,globalBotonPago,globalCompras,globalHeaders,request={buyMovie:function(e,o,t,n,i){request.send("apigateway.superappbaz.com/integracion/superapp/diversion/gestion-peliculas/v1/peliculas/"+e+"/compras","POST",o,t,n)},movieById:function(e,o,t){request.send("https://apigateway.superappbaz.com/integracion/superapp/canal/clientes/gestion-sesiones/v1/portal/operaciones/"+e,"GET",void 0,{"x-sicu":"3bad1290ac4600a569162efaa09117ea","x-id-interaccion":"123e4567-e89b-12d3-a456-426655440000","x-token-usuario":"SRfVZrTYvdm7mzzZmcuiDViACkAx"},o,t)},paymentButton:function(e,o,t,n){request.send("https://apigateway.superappbaz.com/integracion/superapp/pagos/captacion/traspasos/v1/boton-pago","POST",e,o,t,n)},send:function(e,o,t,n,i,a){$.ajax({url:e,method:o,contentType:"application/json",processData:!1,headers:n,data:JSON.stringify(t),success:i,error:a})}};function bind(n){$("[data-id]").each(function(){var e=$(this),o=e.data("id"),t=n[o];"precio"===o?e.html(formatAmount(t)):"saldo"===o?"false"===t&&setTimeout(function(){showAdvice(e,!0)},500):e.html(t)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,o){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),o()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var o=e.target,t=e.keyCode,n=$(o.parentNode);8===t?0<n.prev().length&&((e=n.prev().find("input")).val(""),e.focus()):47<t&&t<58&&""!==o.value&&0<n.next().length&&n.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function fakeRequest(e,o){setTimeout(function(){o("000001"===e)},1500)}function payMovie(e){}function searchToJson(){for(var e,o=location.search.substring(1).split("&"),t={},n=0;n<o.length;n++)""!==o[n]&&(e=o[n].split("="),t[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return t}function showAdvice(e,o){o?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var o=$(".loader");e?(o.length<=0&&(o=$('<div class="loader">')),$("body").append(o),setTimeout(function(){return o.addClass("loader-visible")},10)):(o.removeClass("loader-visible"),setTimeout(function(){return o.remove()},375))}function validateCode(){var o=$(".auth-screen .code"),t=$(".auth-screen .digit input"),e="";t.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(o.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),o.addClass("invalid"),setTimeout(function(){t.each(function(){$(this).val("")}),t.eq(0).focus()},100))})):o.removeClass("valid invalid")}var searchJson=searchToJson();showLoader(!0),request.movieById(searchJson.idOperacion,function(s){console.log("%o",s),changeScreen($(".detail-screen"),function(){var e=s.resultado,o=e.datosFlujo,t=o.idPelicula,n=o.nombrePelicula,i=o.numeroCuentaClienteCadenaBaz,a=o.botonPago,o=o.compras,e=e.headers;globalIdPelicula=t,globalBotonPago=a.transaccion,globalCompras=o.transaccion,globalHeaders=e,$(".detail-screen").find('[data-id="nombre"]').text(n),$(".detail-screen").find('[data-id="precio"]').text(formatAmount(globalBotonPago.detallePago.montoEnvio)),$(".detail-screen").find('[data-id="tarjeta"]').text(i),showLoader(!1)})},function(){});var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign");var o={"x-sicu":globalHeaders["x-sicu"],"x-id-interaccion":globalHeaders["x-id-interaccion"],"x-token-usuario":globalHeaders["x-token-usuario"],accept:"",Authorization:"Bearer "+globalHeaders["x-token-auth-bearer"],"x-nombre-dispositivo":"","x-id-dispositivo":"","x-sistema-dispositivo":"","x-version-dispositivo":"","x-version-aplicacion":"","x-modelo-dispositivo":"","x-fabricante-dispositivo":"","x-serie-procesador":"","x-operador-telefonia":"","x-latitud":"","x-longitud":"","x-id-operacion-conciliacion":globalHeaders["x-id-operacion-conciliacion"],"x-id-lealtad":""};showLoader(!0),request.paymentButton({transaccion:globalBotonPago},o,function(e){console.log("scripts.js: Payment button. %o",e),request.buyMovie(globalIdPelicula,{transaccion:_objectSpread(_objectSpread({},globalCompras),{},{fechaOperacion:e.resultado.fechaOperacion,numeroMovimiento:e.resultado.fechaOperacion})},o,function(e){console.log("scripts.js: Buy movie. %o",e),changeScreen($(".resume-screen")),showLoader(!1)})})},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView")}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5zd2lwZS5qcyIsInJlcXVlc3QuanMiLCJzY3JpcHRzLmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCJjb25zb2xlIiwibG9nIiwidGhpcyIsImVhY2giLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsImZpbmQiLCIkdGV4dCIsIm9uIiwiZXZlbnQiLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJib2R5IiwiY2hhbmdlZFRvdWNoZXMiLCJmYWRlVG8iLCJhbmltYXRlIiwibGVmdCIsInJlbGF0aXZlTW91c2UiLCJzbGlkZVBlcmNlbnQiLCJjc3MiLCJqUXVlcnkiLCJnbG9iYWxJZFBlbGljdWxhIiwiZ2xvYmFsQm90b25QYWdvIiwiZ2xvYmFsQ29tcHJhcyIsImdsb2JhbEhlYWRlcnMiLCJyZXF1ZXN0IiwiYnV5TW92aWUiLCJpZE1vdmllIiwiaGVhZGVycyIsInN1Y2Nlc3MiLCJlcnJvciIsInNlbmQiLCJtb3ZpZUJ5SWQiLCJpZE9wZXJhdGlvbiIsInVuZGVmaW5lZCIsIngtc2ljdSIsIngtaWQtaW50ZXJhY2Npb24iLCJ4LXRva2VuLXVzdWFyaW8iLCJwYXltZW50QnV0dG9uIiwidXJsIiwibWV0aG9kIiwianNvbkhlYWRlcnMiLCJhamF4IiwiY29udGVudFR5cGUiLCJwcm9jZXNzRGF0YSIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5IiwiYmluZCIsInZhbHVlcyIsIiR0YWciLCJpZCIsInZhbHVlIiwiaHRtbCIsImZvcm1hdEFtb3VudCIsInNldFRpbWVvdXQiLCJzaG93QWR2aWNlIiwiYmluZEZyb21TdHIiLCJzdHJKc29uIiwicGFyc2UiLCJlcnIiLCJjaGFuZ2VTY3JlZW4iLCIkc2NyZWVuIiwiY2FsbGJhY2siLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwiYW1vdW50IiwiTnVtYmVyIiwidG9GaXhlZCIsInJlcGxhY2UiLCJoYW5kbGVEaWdpdEtleXVwIiwiX3JlZiIsInRhcmdldCIsImtleUNvZGUiLCIkcGFyZW50IiwicGFyZW50Tm9kZSIsInByZXYiLCJsZW5ndGgiLCIkaW5wdXQiLCJ2YWwiLCJmb2N1cyIsIm5leHQiLCJ2YWxpZGF0ZUNvZGUiLCJudW1iZXJGaWx0ZXIiLCJ0ZXN0Iiwib2xkVmFsdWUiLCJvbGRTZWxlY3Rpb25TdGFydCIsInNlbGVjdGlvblN0YXJ0Iiwib2xkU2VsZWN0aW9uRW5kIiwic2VsZWN0aW9uRW5kIiwiaGFzT3duUHJvcGVydHkiLCJzZXRTZWxlY3Rpb25SYW5nZSIsImZha2VSZXF1ZXN0IiwiY29kZSIsInBheU1vdmllIiwic2VhcmNoVG9Kc29uIiwicGFydHMiLCJwYWlycyIsImxvY2F0aW9uIiwic2VhcmNoIiwic3Vic3RyaW5nIiwic3BsaXQiLCJvYmplY3QiLCJpIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiJGVsIiwiZmxhZyIsInNob3dMb2FkZXIiLCJzaG93IiwiJGxvYWRlciIsImFwcGVuZCIsInJlbW92ZSIsIiRjb2RlIiwiJGRpZ2l0cyIsImVxIiwic2VhcmNoSnNvbiIsIl9kYXRhJHJlc3VsdGFkbyIsInJlc3VsdGFkbyIsIl9kYXRhJHJlc3VsdGFkbyRkYXRvcyIsImRhdG9zRmx1am8iLCJpZFBlbGljdWxhIiwibm9tYnJlUGVsaWN1bGEiLCJudW1lcm9DdWVudGFDbGllbnRlQ2FkZW5hQmF6IiwiYm90b25QYWdvIiwiY29tcHJhcyIsInRyYW5zYWNjaW9uIiwidGV4dCIsImRldGFsbGVQYWdvIiwibW9udG9FbnZpbyIsIiRhZHZpY2VzIiwiJGFkdmljZSIsImFjY2VwdCIsIkF1dGhvcml6YXRpb24iLCJ4LW5vbWJyZS1kaXNwb3NpdGl2byIsIngtaWQtZGlzcG9zaXRpdm8iLCJ4LXNpc3RlbWEtZGlzcG9zaXRpdm8iLCJ4LXZlcnNpb24tZGlzcG9zaXRpdm8iLCJ4LXZlcnNpb24tYXBsaWNhY2lvbiIsIngtbW9kZWxvLWRpc3Bvc2l0aXZvIiwieC1mYWJyaWNhbnRlLWRpc3Bvc2l0aXZvIiwieC1zZXJpZS1wcm9jZXNhZG9yIiwieC1vcGVyYWRvci10ZWxlZm9uaWEiLCJ4LWxhdGl0dWQiLCJ4LWxvbmdpdHVkIiwieC1pZC1vcGVyYWNpb24tY29uY2lsaWFjaW9uIiwieC1pZC1sZWFsdGFkIiwiX29iamVjdFNwcmVhZCIsImZlY2hhT3BlcmFjaW9uIiwibnVtZXJvTW92aW1pZW50byJdLCJtYXBwaW5ncyI6InN2QkFFQSxTQUFBQSxHQUNBQSxFQUFBQyxHQUFBQyxNQUFBLFNBQUFDLEdBQ0EsSUFBQUMsRUFBQUosRUFBQUssT0FBQSxDQUNBQyxHQUFBLFdBQ0FDLFFBQUFDLElBQUEsZ0JBRUFMLEdBRUEsT0FBQU0sS0FBQUMsS0FBQSxXQUNBLElBQUFDLEVBQUFYLEVBQUFTLE1BQ0FHLEVBQUEsRUFDQUMsRUFBQSxFQUNBQyxHQUFBLEVBQ0FDLEVBQUFKLEVBQUFLLEtBQUEsV0FDQUMsRUFBQU4sRUFBQUssS0FBQSxTQUVBRCxFQUFBRyxHQUFBLHVCQUFBLFNBQUFDLEdBQ0FMLEdBQUEsRUFDQUQsRUFBQUYsRUFBQVMsUUFBQXBCLEVBQUFTLE1BQUFXLFFBQUEsR0FDQVIsRUFBQU8sRUFBQUUsU0FBQUYsRUFBQUcsY0FBQUMsUUFBQSxHQUFBQyxRQUdBeEIsRUFBQXlCLFNBQUFDLEtBQUFYLEdBQUFHLEdBQUEsbUJBQUEsU0FBQUMsR0FDQSxHQUFBTCxFQUFBLENBTUEsR0FKQUEsR0FBQSxHQUNBSyxFQUFBRSxTQUFBRixFQUFBUSxlQUFBLEdBQUFILE9BQ0FaLEVBRUFDLEVBS0EsT0FKQUksRUFBQVcsT0FBQSxJQUFBLFFBQ0FiLEVBQUFjLFFBQUEsQ0FDQUMsS0FBQSxTQUNBLEtBZ0JBMUIsRUFBQUUsUUFJQU4sRUFBQXlCLFNBQUFDLE1BQUFSLEdBQUEsc0JBQUEsU0FBQUMsR0FDQSxJQUlBWSxFQUpBakIsSUFLQWtCLEVBQUEsR0FEQUQsR0FEQVosRUFBQUUs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QUF1RixZQUFBdkcsaUJBQUFNLEVBQUEsU0FBQWlCLEdBQ0FwRCxRQUFBQyxJQUFBLGlDQUFBbUQsR0FDQXBCLFFBQUFDLFNBQUFMLGlCQUFBLENBQUF3RyxZQUFBcUIsY0FBQUEsY0FBQSxHQUFBM0gsZUFBQSxHQUFBLENBQUE0SCxlQUFBdEcsRUFBQXdFLFVBQUE4QixlQUFBQyxpQkFBQXZHLEVBQUF3RSxVQUFBOEIsa0JBQUF2SCxFQUFBLFNBQUFpQixHQUNBcEQsUUFBQUMsSUFBQSw0QkFBQW1ELEdBQ0FnQixhQUFBM0UsRUFBQSxtQkFDQXlILFlBQUEsUUFHQSxRQU1BLElBQUFNLFFBQUEvSCxFQUFBLDZCQUVBK0gsUUFBQTdHLEdBQUEsNENBQUErRSxjQUNBOEIsUUFBQTdHLEdBQUEsUUFBQWtFLGtCQUVBMkMsUUFBQUMsR0FBQSxHQUFBbEMsUUFJQTlGLEVBQUEsNkJBQUFrQixHQUFBLFFBQUEsV0FDQVgsUUFBQUMsSUFBQSxpQ0FNQVIsRUFBQSxjQUFBa0IsR0FBQSxRQUFBLFdBQ0FYLFFBQUFDLElBQUEsZ0NBTUFSLEVBQUEsY0FBQWtCLEdBQUEsUUFBQSxXQUNBWCxRQUFBQyxJQUFBIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gUmVmZXJlbmNlOiBodHRwczovL2NvZGVwZW4uaW8vZ3ByZXNzdXR0bzUvcGVuL05qSm9iRz9lZGl0b3JzPTAwMTBcclxuXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgJC5mbi5zd2lwZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgdmFyIHNldHRpbmdzID0gJC5leHRlbmQoe1xyXG4gICAgICAgICAgICBjYjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc3dpcGUgZG9uZScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgb3B0aW9ucyk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICB2YXIgaW5pdGlhbE1vdXNlID0gMDtcclxuICAgICAgICAgICAgdmFyIHNsaWRlTW92ZW1lbnRUb3RhbCA9IDA7XHJcbiAgICAgICAgICAgIHZhciBtb3VzZUlzRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgJHNsaWRlciA9ICR0aGlzLmZpbmQoJy5zbGlkZXInKTtcclxuICAgICAgICAgICAgdmFyICR0ZXh0ID0gJHRoaXMuZmluZCgnLnRleHQnKTtcclxuXHJcbiAgICAgICAgICAgICRzbGlkZXIub24oJ21vdXNlZG93biB0b3VjaHN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBtb3VzZUlzRG93biA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBzbGlkZU1vdmVtZW50VG90YWwgPSAkdGhpcy53aWR0aCgpIC0gJCh0aGlzKS53aWR0aCgpICsgMTA7XHJcbiAgICAgICAgICAgICAgICBpbml0aWFsTW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXS5wYWdlWDtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKGRvY3VtZW50LmJvZHksICRzbGlkZXIpLm9uKCdtb3VzZXVwIHRvdWNoZW5kJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW1vdXNlSXNEb3duKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIG1vdXNlSXNEb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWDtcclxuICAgICAgICAgICAgICAgIHZhciByZWxhdGl2ZU1vdXNlID0gY3VycmVudE1vdXNlIC0gaW5pdGlhbE1vdXNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlIDwgc2xpZGVNb3ZlbWVudFRvdGFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRleHQuZmFkZVRvKDMwMCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5hbmltYXRlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogXCItMTBweFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLyogJHNsaWRlci5hZGRDbGFzcygndW5sb2NrZWQnKTtcclxuICAgICAgICAgICAgICAgICQoJyNsb2NrZXInKS50ZXh0KCdsb2NrX291dGxpbmUnKTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIub24oJ2NsaWNrIHRhcCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISRzbGlkZXIuaGFzQ2xhc3MoJ3VubG9ja2VkJykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzbGlkZXIucmVtb3ZlQ2xhc3MoJ3VubG9ja2VkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNsb2NrZXInKS50ZXh0KCdsb2NrX29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5vZmYoJ2NsaWNrIHRhcCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSwgMCk7ICovXHJcblxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuY2IoKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSkub24oJ21vdXNlbW92ZSB0b3VjaG1vdmUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghbW91c2VJc0Rvd24pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50TW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXS5wYWdlWDtcclxuICAgICAgICAgICAgICAgIHZhciByZWxhdGl2ZU1vdXNlID0gY3VycmVudE1vdXNlIC0gaW5pdGlhbE1vdXNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNsaWRlUGVyY2VudCA9IDEgLSAocmVsYXRpdmVNb3VzZSAvIHNsaWRlTW92ZW1lbnRUb3RhbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHRleHQuZmFkZVRvKDAsIHNsaWRlUGVyY2VudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIuY3NzKHsgJ2xlZnQnOiAnLTEwcHgnIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlID49IHNsaWRlTW92ZW1lbnRUb3RhbCArIDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6IHNsaWRlTW92ZW1lbnRUb3RhbCArICdweCcgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6IHJlbGF0aXZlTW91c2UgLSAxMCB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pKGpRdWVyeSk7XHJcbiIsImNvbnN0IHJlcXVlc3QgPSB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNYWtlIGEgcGF5bWVudC5cclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpZE1vdmllIFxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGJvZHkgXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gaGVhZGVycyBcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1Y2Nlc3MgXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBlcnJvciBcclxuICAgICAqL1xyXG4gICAgYnV5TW92aWU6IGZ1bmN0aW9uIChpZE1vdmllLCBib2R5LCBoZWFkZXJzLCBzdWNjZXNzLCBlcnJvcikge1xyXG4gICAgICAgIGNvbnN0IHVybCA9ICdhcGlnYXRld2F5LnN1cGVyYXBwYmF6LmNvbS9pbnRlZ3JhY2lvbi9zdXBlcmFwcC9kaXZlcnNpb24vZ2VzdGlvbi1wZWxpY3VsYXMvdjEvcGVsaWN1bGFzLycgKyBpZE1vdmllICsgJy9jb21wcmFzJztcclxuICAgICAgICByZXF1ZXN0LnNlbmQodXJsLCAnUE9TVCcsIGJvZHksIGhlYWRlcnMsIHN1Y2Nlc3MpXHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IG1vdmllIGJ5IGlkIG9wZXJhdGlvbi5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpZE9wZXJhdGlvbiBcclxuICAgICAqL1xyXG4gICAgbW92aWVCeUlkOiBmdW5jdGlvbihpZE9wZXJhdGlvbiwgc3VjY2VzcywgZXJyb3IpIHtcclxuICAgICAgICBjb25zdCB1cmwgPSAnaHR0cHM6Ly9hcGlnYXRld2F5LnN1cGVyYXBwYmF6LmNvbS9pbnRlZ3JhY2lvbi9zdXBlcmFwcC9jYW5hbC9jbGllbnRlcy9nZXN0aW9uLXNlc2lvbmVzL3YxL3BvcnRhbC9vcGVyYWNpb25lcy8nICsgaWRPcGVyYXRpb247XHJcbiAgICAgICAgcmVxdWVzdC5zZW5kKHVybCwgJ0dFVCcsIHVuZGVmaW5lZCwge1xyXG4gICAgICAgICAgICAneC1zaWN1JzogJzNiYWQxMjkwYWM0NjAwYTU2OTE2MmVmYWEwOTExN2VhJyxcclxuICAgICAgICAgICAgJ3gtaWQtaW50ZXJhY2Npb24nOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjU1NDQwMDAwJyxcclxuICAgICAgICAgICAgJ3gtdG9rZW4tdXN1YXJpbyc6ICdTUmZWWnJUWXZkbTdtenpabWN1aURWaUFDa0F4J1xyXG4gICAgICAgIH0sIHN1Y2Nlc3MsIGVycm9yKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZWdpc3RlciBwYXltZW50LlxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGJvZHlcclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBoZWFkZXJzXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBlcnJvclxyXG4gICAgICovXHJcbiAgICBwYXltZW50QnV0dG9uOiBmdW5jdGlvbiAoYm9keSwgaGVhZGVycywgc3VjY2VzcywgZXJyb3IpIHtcclxuICAgICAgICBjb25zdCB1cmwgPSAnaHR0cHM6Ly9hcGlnYXRld2F5LnN1cGVyYXBwYmF6LmNvbS9pbnRlZ3JhY2lvbi9zdXBlcmFwcC9wYWdvcy9jYXB0YWNpb24vdHJhc3Bhc29zL3YxL2JvdG9uLXBhZ28nO1xyXG4gICAgICAgIHJlcXVlc3Quc2VuZCh1cmwsICdQT1NUJywgYm9keSwgaGVhZGVycywgc3VjY2VzcywgZXJyb3IpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIE1ha2UgcmVxdWVzdC5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYm9keVxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGpzb25IZWFkZXJzIFxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2VzcyBcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXHJcbiAgICAgKi9cclxuICAgIHNlbmQ6IGZ1bmN0aW9uICh1cmwsIG1ldGhvZCwgYm9keSwganNvbkhlYWRlcnMsIHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsLCBcclxuICAgICAgICAgICAgbWV0aG9kLFxyXG4gICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsIFxyXG4gICAgICAgICAgICBoZWFkZXJzOiBqc29uSGVhZGVycywgXHJcbiAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGJvZHkpLFxyXG4gICAgICAgICAgICBzdWNjZXNzLFxyXG4gICAgICAgICAgICBlcnJvclxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59OyIsImxldCBnbG9iYWxJZFBlbGljdWxhLCBnbG9iYWxCb3RvblBhZ28sIGdsb2JhbENvbXByYXMsIGdsb2JhbEhlYWRlcnM7XHJcblxyXG4vKipcclxuICogQmluZCBKU09OIHRvIEhUTUwuXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXNcclxuICovXHJcbmZ1bmN0aW9uIGJpbmQodmFsdWVzKSB7XHJcbiAgICBjb25zdCAkdGFncyA9ICQoJ1tkYXRhLWlkXScpO1xyXG5cclxuICAgICR0YWdzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0ICR0YWcgPSAkKHRoaXMpO1xyXG4gICAgICAgIGNvbnN0IGlkID0gJHRhZy5kYXRhKCdpZCcpO1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2lkXTtcclxuXHJcbiAgICAgICAgaWYgKGlkID09PSAncHJlY2lvJykge1xyXG4gICAgICAgICAgICAkdGFnLmh0bWwoZm9ybWF0QW1vdW50KHZhbHVlKSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChpZCA9PT0gJ3NhbGRvJykge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09ICdmYWxzZScpIHtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBzaG93QWR2aWNlKCR0YWcsIHRydWUpOyB9LCA1MDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJHRhZy5odG1sKHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFBhcnNlIHN0cmluZyB0byBvYmplY3QgYW5kIHRoZW4gYmluZC5cclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ckpzb24gXHJcbiAqL1xyXG5mdW5jdGlvbiBiaW5kRnJvbVN0cihzdHJKc29uKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHN0ckpzb24pO1xyXG4gICAgICAgIGJpbmQoanNvbik7XHJcbiAgICB9IGNhdGNoIChlcnIpIHsgY29uc29sZS5sb2coZXJyKTsgfVxyXG59XHJcblxyXG4vKipcclxuICogQ2hhbmdlIHNjcmVlbi5cclxuICogQHBhcmFtIHtqUXVlcnl9ICRzY3JlZW5cclxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcclxuICovXHJcbmZ1bmN0aW9uIGNoYW5nZVNjcmVlbigkc2NyZWVuLCBjYWxsYmFjaykge1xyXG4gICAgJCgnLnNjcmVlbicpLmFkZENsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICAkc2NyZWVuLnJlbW92ZUNsYXNzKCduby12aXNpYmxlJyk7XHJcblxyXG4gICAgY2FsbGJhY2soKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBhbW91bnQgd2l0aCBjdXJyZW5jeSBmb3JtYXQuXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBhbW91bnQgXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAqL1xyXG5mdW5jdGlvbiBmb3JtYXRBbW91bnQoYW1vdW50KSB7XHJcbiAgICByZXR1cm4gJyQgJyArIE51bWJlcihhbW91bnQpLnRvRml4ZWQoMikucmVwbGFjZSgvXFxCKD89KFxcZHszfSkrKD8hXFxkKSkvZywgJywnKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEhhbmRsZSBkaWdpdCBrZXl1cCBldmVudC5cclxuICogQHBhcmFtIHtLZXlib2FyZEV2ZW50fSBldmVudFxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlRGlnaXRLZXl1cCh7IHRhcmdldCwga2V5Q29kZSB9KSB7XHJcbiAgICBjb25zdCAkcGFyZW50ID0gJCh0YXJnZXQucGFyZW50Tm9kZSk7XHJcblxyXG4gICAgaWYgKGtleUNvZGUgPT09IDgpIHtcclxuICAgICAgICBpZiAoJHBhcmVudC5wcmV2KCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCAkaW5wdXQgPSAkcGFyZW50LnByZXYoKS5maW5kKCdpbnB1dCcpO1xyXG5cclxuICAgICAgICAgICAgJGlucHV0LnZhbCgnJyk7XHJcbiAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9IGVsc2UgaWYgKGtleUNvZGUgPiA0NyAmJiBrZXlDb2RlIDwgNTgpIHtcclxuICAgICAgICBpZiAodGFyZ2V0LnZhbHVlICE9PSAnJykge1xyXG4gICAgICAgICAgICBpZiAoJHBhcmVudC5uZXh0KCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJHBhcmVudC5uZXh0KCkuZmluZCgnaW5wdXQnKTtcclxuICAgICAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHZhbGlkYXRlQ29kZSgpO1xyXG59XHJcblxyXG4vKipcclxuICogQXBwbHkgbnVtYmVyIGZpbHRlci5cclxuICogQHBhcmFtIHtFdmVudH0gZXZlbnRcclxuICovXHJcbmZ1bmN0aW9uIG51bWJlckZpbHRlcihldmVudCkge1xyXG4gICAgY29uc3QgZmlsdGVyID0gL15cXGR7MCwxfSQvO1xyXG5cclxuICAgIGlmIChmaWx0ZXIudGVzdCh0aGlzLnZhbHVlKSkge1xyXG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xyXG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uU3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xyXG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uRW5kID0gdGhpcy5zZWxlY3Rpb25FbmQ7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoJ29sZFZhbHVlJykpIHtcclxuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcclxuICAgICAgICB0aGlzLnNldFNlbGVjdGlvblJhbmdlKHRoaXMub2xkU2VsZWN0aW9uU3RhcnQsIHRoaXMub2xkU2VsZWN0aW9uRW5kKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9ICcnO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogRG8gZmFrZSByZXF1ZXN0LlxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xyXG4gKi9cclxuZnVuY3Rpb24gZmFrZVJlcXVlc3QoY29kZSwgY2FsbGJhY2spIHtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGNhbGxiYWNrKGNvZGUgPT09ICcwMDAwMDEnKTtcclxuICAgIH0sIDE1MDApO1xyXG59XHJcblxyXG4vKipcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ckpzb25cclxuICovXHJcbmZ1bmN0aW9uIHBheU1vdmllKHN0ckpzb24pIHtcclxuXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBQYXJzZSBsb2NhdGlvbi5zZWFyY2ggdG8gSlNPTi5cclxuICogQHJldHVybnMgb2JqZWN0XHJcbiAqL1xyXG5mdW5jdGlvbiBzZWFyY2hUb0pzb24oKSB7XHJcbiAgICBjb25zdCBwYWlycyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSkuc3BsaXQoJyYnKTtcclxuICAgIGNvbnN0IG9iamVjdCA9IHt9O1xyXG4gICAgbGV0IGkgPSAwO1xyXG5cclxuICAgIGZvciAoOyBpIDwgcGFpcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpZiAocGFpcnNbaV0gPT09ICcnKSB7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGFydHMgPSBwYWlyc1tpXS5zcGxpdCgnPScpO1xyXG4gICAgICAgIG9iamVjdFtkZWNvZGVVUklDb21wb25lbnQocGFydHNbMF0pXSA9IGRlY29kZVVSSUNvbXBvbmVudChwYXJ0c1sxXSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG9iamVjdDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNob3cgb3IgaGlkZSBhZHZpY2UuXHJcbiAqIEBwYXJhbSB7alF1ZXJ5fSAkZWwgXHJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gZmxhZyBcclxuICovXHJcbmZ1bmN0aW9uIHNob3dBZHZpY2UoJGVsLCBmbGFnKSB7XHJcbiAgICBpZiAoZmxhZykge1xyXG4gICAgICAgICRlbC5hZGRDbGFzcygnbm8tdmlzaWJsZScpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkZWwucmVtb3ZlQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFNob3cgb3IgaGlkZSBsb2FkZXIuXHJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gc2hvd1xyXG4gKi9cclxuZnVuY3Rpb24gc2hvd0xvYWRlcihzaG93KSB7XHJcbiAgICBsZXQgJGxvYWRlciA9ICQoJy5sb2FkZXInKTtcclxuXHJcbiAgICBpZiAoc2hvdykge1xyXG4gICAgICAgIGlmICgkbG9hZGVyLmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgICRsb2FkZXIgPSAkKCc8ZGl2IGNsYXNzPVwibG9hZGVyXCI+Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkKCdib2R5JykuYXBwZW5kKCRsb2FkZXIpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gJGxvYWRlci5hZGRDbGFzcygnbG9hZGVyLXZpc2libGUnKSwgMTApO1xyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGxvYWRlci5yZW1vdmVDbGFzcygnbG9hZGVyLXZpc2libGUnKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+ICRsb2FkZXIucmVtb3ZlKCksIDM3NSk7XHJcblxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogVmFsaWRhdGUgY29kZSBmcm9tIGNsaWVudC5cclxuICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAqL1xyXG5mdW5jdGlvbiB2YWxpZGF0ZUNvZGUoKSB7XHJcbiAgICBjb25zdCAkY29kZSA9ICQoJy5hdXRoLXNjcmVlbiAuY29kZScpO1xyXG4gICAgY29uc3QgJGRpZ2l0cyA9ICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKTtcclxuICAgIGxldCBjb2RlID0gXCJcIjtcclxuXHJcbiAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvZGUgKz0gdGhpcy52YWx1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChjb2RlLmxlbmd0aCA9PT0gNikge1xyXG4gICAgICAgIHNob3dMb2FkZXIodHJ1ZSk7XHJcblxyXG4gICAgICAgIGZha2VSZXF1ZXN0KGNvZGUsIHN1Y2Nlc3MgPT4ge1xyXG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ3ZhbGlkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgY2hhbmdlU2NyZWVuKCQoJy5yZXN1bWUtc2NyZWVuJyksICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAkY29kZS5hZGRDbGFzcygnaW52YWxpZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICRkaWdpdHMuZWFjaChmdW5jdGlvbiAoKSB7ICQodGhpcykudmFsKCcnKTsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lcSgwKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkY29kZS5yZW1vdmVDbGFzcygndmFsaWQgaW52YWxpZCcpO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBEZXRhaWwgU2NyZWVuIGNvbXBvbmVudHMuXHJcbmNvbnN0IHNlYXJjaEpzb24gPSBzZWFyY2hUb0pzb24oKTtcclxuXHJcbnNob3dMb2FkZXIodHJ1ZSk7XHJcbnJlcXVlc3QubW92aWVCeUlkKHNlYXJjaEpzb25bJ2lkT3BlcmFjaW9uJ10sIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICBjb25zb2xlLmxvZygnJW8nLCBkYXRhKTtcclxuICAgIGNoYW5nZVNjcmVlbigkKCcuZGV0YWlsLXNjcmVlbicpLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgeyBkYXRvc0ZsdWpvOiB7IGlkUGVsaWN1bGEsIG5vbWJyZVBlbGljdWxhLCBudW1lcm9DdWVudGFDbGllbnRlQ2FkZW5hQmF6LCBib3RvblBhZ28sIGNvbXByYXMgfSwgaGVhZGVycyB9ID0gZGF0YS5yZXN1bHRhZG87XHJcbiAgICAgICAgXHJcbiAgICAgICAgZ2xvYmFsSWRQZWxpY3VsYSA9IGlkUGVsaWN1bGE7XHJcbiAgICAgICAgZ2xvYmFsQm90b25QYWdvID0gYm90b25QYWdvLnRyYW5zYWNjaW9uO1xyXG4gICAgICAgIGdsb2JhbENvbXByYXMgPSBjb21wcmFzLnRyYW5zYWNjaW9uO1xyXG4gICAgICAgIGdsb2JhbEhlYWRlcnMgPSBoZWFkZXJzO1xyXG5cclxuICAgICAgICAkKCcuZGV0YWlsLXNjcmVlbicpLmZpbmQoJ1tkYXRhLWlkPVwibm9tYnJlXCJdJykudGV4dChub21icmVQZWxpY3VsYSk7XHJcbiAgICAgICAgJCgnLmRldGFpbC1zY3JlZW4nKS5maW5kKCdbZGF0YS1pZD1cInByZWNpb1wiXScpLnRleHQoZm9ybWF0QW1vdW50KGdsb2JhbEJvdG9uUGFnby5kZXRhbGxlUGFnby5tb250b0VudmlvKSk7XHJcbiAgICAgICAgJCgnLmRldGFpbC1zY3JlZW4nKS5maW5kKCdbZGF0YS1pZD1cInRhcmpldGFcIl0nKS50ZXh0KG51bWVyb0N1ZW50YUNsaWVudGVDYWRlbmFCYXopO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xyXG4gICAgfSk7XHJcbn0sIGZ1bmN0aW9uICgpIHtcclxuXHJcbn0pO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5jb25zdCAkYWR2aWNlcyA9ICQoJy5hZHZpY2UuZml4ZWQnKTtcclxuXHJcbiRhZHZpY2VzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3QgJGFkdmljZSA9ICQodGhpcyk7XHJcbiAgICBjb25zdCAkY2xvc2VCdG4gPSAkYWR2aWNlLmZpbmQoJy5jbG9zZS1idG4nKTtcclxuXHJcbiAgICAkY2xvc2VCdG4ub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNob3dBZHZpY2UoJGFkdmljZSwgZmFsc2UpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuJCgnLmRldGFpbC1zY3JlZW4gLnN3aXBlLWJ0bicpLnN3aXBlKHtcclxuICAgIGNiOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc2hvd0xvYWRlcih0cnVlKTtcclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBPcGVuIGRpZ2l0YWwgc2lnbicpO1xyXG4gICAgICAgICAgICBjb25zdCBoZWFkZXJzID0ge1xyXG4gICAgICAgICAgICAgICAgXCJ4LXNpY3VcIjogZ2xvYmFsSGVhZGVyc1sneC1zaWN1J10sXHJcbiAgICAgICAgICAgICAgICBcIngtaWQtaW50ZXJhY2Npb25cIjogZ2xvYmFsSGVhZGVyc1sneC1pZC1pbnRlcmFjY2lvbiddLFxyXG4gICAgICAgICAgICAgICAgXCJ4LXRva2VuLXVzdWFyaW9cIjogZ2xvYmFsSGVhZGVyc1sneC10b2tlbi11c3VhcmlvJ10sXHJcbiAgICAgICAgICAgICAgICBcImFjY2VwdFwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJBdXRob3JpemF0aW9uXCI6IFwiQmVhcmVyIFwiICsgZ2xvYmFsSGVhZGVyc1sneC10b2tlbi1hdXRoLWJlYXJlciddLFxyXG4gICAgICAgICAgICAgICAgXCJ4LW5vbWJyZS1kaXNwb3NpdGl2b1wiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJ4LWlkLWRpc3Bvc2l0aXZvXCI6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIngtc2lzdGVtYS1kaXNwb3NpdGl2b1wiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJ4LXZlcnNpb24tZGlzcG9zaXRpdm9cIjogXCJcIixcclxuICAgICAgICAgICAgICAgIFwieC12ZXJzaW9uLWFwbGljYWNpb25cIjogXCJcIixcclxuICAgICAgICAgICAgICAgIFwieC1tb2RlbG8tZGlzcG9zaXRpdm9cIjogXCJcIixcclxuICAgICAgICAgICAgICAgIFwieC1mYWJyaWNhbnRlLWRpc3Bvc2l0aXZvXCI6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIngtc2VyaWUtcHJvY2VzYWRvclwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJ4LW9wZXJhZG9yLXRlbGVmb25pYVwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJ4LWxhdGl0dWRcIjogXCJcIixcclxuICAgICAgICAgICAgICAgIFwieC1sb25naXR1ZFwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJ4LWlkLW9wZXJhY2lvbi1jb25jaWxpYWNpb25cIjogZ2xvYmFsSGVhZGVyc1sneC1pZC1vcGVyYWNpb24tY29uY2lsaWFjaW9uJ10sXHJcbiAgICAgICAgICAgICAgICBcIngtaWQtbGVhbHRhZFwiOiBcIlwiXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBzaG93TG9hZGVyKHRydWUpO1xyXG4gICAgICAgICAgICByZXF1ZXN0LnBheW1lbnRCdXR0b24oeyBcInRyYW5zYWNjaW9uXCI6IGdsb2JhbEJvdG9uUGFnbyB9LCBoZWFkZXJzLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IFBheW1lbnQgYnV0dG9uLiAlbycsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5idXlNb3ZpZShnbG9iYWxJZFBlbGljdWxhLCB7IFwidHJhbnNhY2Npb25cIjogeyAuLi5nbG9iYWxDb21wcmFzLCBmZWNoYU9wZXJhY2lvbjogZGF0YS5yZXN1bHRhZG8uZmVjaGFPcGVyYWNpb24sIG51bWVyb01vdmltaWVudG86IGRhdGEucmVzdWx0YWRvLmZlY2hhT3BlcmFjaW9uIH0gfSwgaGVhZGVycywgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogQnV5IG1vdmllLiAlbycsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZVNjcmVlbigkKCcucmVzdW1lLXNjcmVlbicpKTtcclxuICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LCA1MDApO1xyXG4gICAgfVxyXG59KTtcclxuXHJcblxyXG4vLyBJbml0aWFsaXplIEF1dGggU2NyZWVuIGNvbXBvbmVudHMuXHJcbmNvbnN0ICRkaWdpdHMgPSAkKCcuYXV0aC1zY3JlZW4gLmRpZ2l0IGlucHV0Jyk7XHJcblxyXG4kZGlnaXRzLm9uKCdrZXlwcmVzcyBrZXlkb3duIGtleXVwIGlucHV0IGNoYW5nZSBwYXN0ZScsIG51bWJlckZpbHRlcilcclxuJGRpZ2l0cy5vbigna2V5dXAnLCBoYW5kbGVEaWdpdEtleXVwKTtcclxuXHJcbiRkaWdpdHMuZXEoMCkuZm9jdXMoKTtcclxuXHJcblxyXG4vLyBJbml0aWFsaXplIGNsb3NlIGJ1dHRvbnMuXHJcbiQoJy5zY3JlZW4gaGVhZGVyIC5jbG9zZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogQ2xvc2luZyBXZWJWaWV3Jyk7XHJcblxyXG59KTtcclxuXHJcblxyXG4vLyBJbml0aWFsaXplIHNoYXJlIGJ1dHRvbi5cclxuJCgnLnNoYXJlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBTaGFyaW5nIHRpY2tldCcpO1xyXG5cclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBtb3ZpZSBidXR0b24uXHJcbiQoJy5tb3ZpZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogUGxheSBtb3ZpZScpO1xyXG5cclxufSk7XHJcbiJdfQ==

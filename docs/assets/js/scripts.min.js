"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(r){r.fn.swipe=function(e){var c=r.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var t=r(this),n=0,o=0,i=!1,s=t.find(".slider"),a=t.find(".text");s.on("mousedown touchstart",function(e){i=!0,o=t.width()-r(this).width()+10,n=e.clientX||e.originalEvent.touches[0].pageX}),r(document.body,s).on("mouseup touchend",function(e){if(i){if(i=!1,(e.clientX||e.changedTouches[0].pageX)-n<o)return a.fadeTo(300,1),void s.animate({left:"-10px"},300);c.cb()}}),r(document.body).on("mousemove touchmove",function(e){var t;i&&(e=1-(t=(e.clientX||e.originalEvent.touches[0].pageX)-n)/o,a.fadeTo(0,e),t<=0?s.css({left:"-10px"}):o+10<=t?s.css({left:o+"px"}):s.css({left:t-10}))})})}}(jQuery);var request={auth:function(e,t){var n={Authorization:"Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7"),"Content-Type":"application/x-www-form-urlencoded",Cookie:"XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"};request.send("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token","POST","grant_type=client_credentials",n,e,t)},pay:function(e,t,n,o,i){n=JSON.stringify(n);t.Authorization="Bearer "+e,request.send("https://apigateway.superappbaz.com/integracion/superapp/pagos/captacion/traspasos/v1/boton-pago","POST",n,t,o,i)},send:function(e,t,n,o,i,s){var a,c=new Headers;for(a in o)c.append(a,o[a]);fetch(e,{method:t,headers:c,body:n,redirect:"follow"}).then(function(e){return e.json()}).then(i).catch(s)}};function bind(o){$("[data-id]").each(function(){var e=$(this),t=e.data("id"),n=o[t];"precio"===t?e.html(formatAmount(n)):"saldo"===t?"false"===n&&setTimeout(function(){showAdvice(e,!0)},500):e.html(n)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,t){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),t()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var t=e.target,n=e.keyCode,o=$(t.parentNode);8===n?0<o.prev().length&&((e=o.prev().find("input")).val(""),e.focus()):47<n&&n<58&&""!==t.value&&0<o.next().length&&o.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function fakeRequest(e,t){setTimeout(function(){t("000001"===e)},1500)}function payMovie(e){function t(e){e="object"===_typeof(e)?e.message:e,console.log(JSON.stringify({message:e}))}try{var n=JSON.parse(e);request.auth(function(e){"string"==typeof e.access_token?request.pay(e.access_token,n.headers,n.transaccion,function(e){"webkit"in window&&window.webkit.messageHandlers.paymentResponse.postMessage("paymentResponse|"+JSON.stringify(e))},t):t(e)},t)}catch(e){t(e)}}function searchToJson(){for(var e,t=location.search.substring(1).split("&"),n={},o=0;o<t.length;o++)""!==t[o]&&(e=t[o].split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return n}function showAdvice(e,t){t?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var t=$(".loader");e?(t.length<=0&&(t=$('<div class="loader">')),$("body").append(t),setTimeout(function(){return t.addClass("loader-visible")},10)):(t.removeClass("loader-visible"),setTimeout(function(){return t.remove()},375))}function validateCode(){var t=$(".auth-screen .code"),n=$(".auth-screen .digit input"),e="";n.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(t.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),t.addClass("invalid"),setTimeout(function(){n.each(function(){$(this).val("")}),n.eq(0).focus()},100))})):t.removeClass("valid invalid")}bind(searchToJson());var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),"webkit"in window&&window.webkit.messageHandlers.showDigitalSign.postMessage("showDigitalSign")},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),"webkit"in window&&window.webkit.messageHandlers.closeMoviePayment.postMessage("closeMoviePayment")}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),"webkit"in window&&window.webkit.messageHandlers.shareTicket.postMessage("shareTicket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),"webkit"in window&&window.webkit.messageHandlers.playMovie.postMessage("playMovie")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5zd2lwZS5qcyIsInJlcXVlc3QuanMiLCJzY3JpcHRzLmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCJjb25zb2xlIiwibG9nIiwidGhpcyIsImVhY2giLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsImZpbmQiLCIkdGV4dCIsIm9uIiwiZXZlbnQiLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJib2R5IiwiY2hhbmdlZFRvdWNoZXMiLCJmYWRlVG8iLCJhbmltYXRlIiwibGVmdCIsInJlbGF0aXZlTW91c2UiLCJzbGlkZVBlcmNlbnQiLCJjc3MiLCJqUXVlcnkiLCJyZXF1ZXN0IiwiYXV0aCIsInN1Y2Nlc3MiLCJlcnJvciIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYnRvYSIsIkNvbnRlbnQtVHlwZSIsIkNvb2tpZSIsInNlbmQiLCJwYXkiLCJhY2Nlc3NUb2tlbiIsInJhdyIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1cmwiLCJtZXRob2QiLCJqc29uSGVhZGVycyIsInByb3AiLCJIZWFkZXJzIiwiYXBwZW5kIiwiZmV0Y2giLCJyZWRpcmVjdCIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJiaW5kIiwidmFsdWVzIiwiJHRhZyIsImlkIiwiZGF0YSIsInZhbHVlIiwiaHRtbCIsImZvcm1hdEFtb3VudCIsInNldFRpbWVvdXQiLCJzaG93QWR2aWNlIiwiYmluZEZyb21TdHIiLCJzdHJKc29uIiwicGFyc2UiLCJlcnIiLCJjaGFuZ2VTY3JlZW4iLCIkc2NyZWVuIiwiY2FsbGJhY2siLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwiYW1vdW50IiwiTnVtYmVyIiwidG9GaXhlZCIsInJlcGxhY2UiLCJoYW5kbGVEaWdpdEtleXVwIiwiX3JlZiIsInRhcmdldCIsImtleUNvZGUiLCIkcGFyZW50IiwicGFyZW50Tm9kZSIsInByZXYiLCJsZW5ndGgiLCIkaW5wdXQiLCJ2YWwiLCJmb2N1cyIsIm5leHQiLCJ2YWxpZGF0ZUNvZGUiLCJudW1iZXJGaWx0ZXIiLCJ0ZXN0Iiwib2xkVmFsdWUiLCJvbGRTZWxlY3Rpb25TdGFydCIsInNlbGVjdGlvblN0YXJ0Iiwib2xkU2VsZWN0aW9uRW5kIiwic2VsZWN0aW9uRW5kIiwiaGFzT3duUHJvcGVydHkiLCJzZXRTZWxlY3Rpb25SYW5nZSIsImZha2VSZXF1ZXN0IiwiY29kZSIsInBheU1vdmllIiwiaGFuZGxlRXJyIiwibWVzc2FnZSIsIl90eXBlb2YiLCJhdXRoUmVzIiwicGF5UmVzIiwid2luZG93Iiwid2Via2l0IiwibWVzc2FnZUhhbmRsZXJzIiwicGF5bWVudFJlc3BvbnNlIiwicG9zdE1lc3NhZ2UiLCJzZWFyY2hUb0pzb24iLCJwYXJ0cyIsInBhaXJzIiwibG9jYXRpb24iLCJzZWFyY2giLCJzdWJzdHJpbmciLCJzcGxpdCIsIm9iamVjdCIsImkiLCJkZWNvZGVVUklDb21wb25lbnQiLCIkZWwiLCJmbGFnIiwic2hvd0xvYWRlciIsInNob3ciLCIkbG9hZGVyIiwicmVtb3ZlIiwiJGNvZGUiLCIkZGlnaXRzIiwiZXEiLCIkYWR2aWNlcyIsIiRhZHZpY2UiLCJzaG93RGlnaXRhbFNpZ24iLCJjbG9zZU1vdmllUGF5bWVudCIsInNoYXJlVGlja2V0IiwicGxheU1vdmllIl0sIm1hcHBpbmdzIjoiK1BBRUEsU0FBQUEsR0FDQUEsRUFBQUMsR0FBQUMsTUFBQSxTQUFBQyxHQUNBLElBQUFDLEVBQUFKLEVBQUFLLE9BQUEsQ0FDQUMsR0FBQSxXQUNBQyxRQUFBQyxJQUFBLGdCQUVBTCxHQUVBLE9BQUFNLEtBQUFDLEtBQUEsV0FDQSxJQUFBQyxFQUFBWCxFQUFBUyxNQUNBRyxFQUFBLEVBQ0FDLEVBQUEsRUFDQUMsR0FBQSxFQUNBQyxFQUFBSixFQUFBSyxLQUFBLFdBQ0FDLEVBQUFO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RUE5RCxXQUFBLFdBQ0E5RCxRQUFBQyxJQUFBLGlDQUVBLFdBQUEwRyxRQUNBQSxPQUFBQyxPQUFBQyxnQkFBQXdCLGdCQUFBdEIsWUFBQSxvQkFFQSxRQU1BLElBQUFrQixRQUFBeEksRUFBQSw2QkFFQXdJLFFBQUF0SCxHQUFBLDRDQUFBK0UsY0FDQXVDLFFBQUF0SCxHQUFBLFFBQUFrRSxrQkFFQW9ELFFBQUFDLEdBQUEsR0FBQTNDLFFBSUE5RixFQUFBLDZCQUFBa0IsR0FBQSxRQUFBLFdBQ0FYLFFBQUFDLElBQUEsK0JBRUEsV0FBQTBHLFFBQ0FBLE9BQUFDLE9BQUFDLGdCQUFBeUIsa0JBQUF2QixZQUFBLHVCQU1BdEgsRUFBQSxjQUFBa0IsR0FBQSxRQUFBLFdBQ0FYLFFBQUFDLElBQUEsOEJBRUEsV0FBQTBHLFFBQ0FBLE9BQUFDLE9BQUFDLGdCQUFBMEIsWUFBQXhCLFlBQUEsaUJBTUF0SCxFQUFBLGNBQUFrQixHQUFBLFFBQUEsV0FDQVgsUUFBQUMsSUFBQSwwQkFFQSxXQUFBMEcsUUFDQUEsT0FBQUMsT0FBQUMsZ0JBQUEyQixVQUFBekIsWUFBQSIsImZpbGUiOiJzY3JpcHRzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFJlZmVyZW5jZTogaHR0cHM6Ly9jb2RlcGVuLmlvL2dwcmVzc3V0dG81L3Blbi9OakpvYkc/ZWRpdG9ycz0wMDEwXHJcblxyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgICQuZm4uc3dpcGUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHtcclxuICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N3aXBlIGRvbmUnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgdmFyIGluaXRpYWxNb3VzZSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBzbGlkZU1vdmVtZW50VG90YWwgPSAwO1xyXG4gICAgICAgICAgICB2YXIgbW91c2VJc0Rvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyICRzbGlkZXIgPSAkdGhpcy5maW5kKCcuc2xpZGVyJyk7XHJcbiAgICAgICAgICAgIHZhciAkdGV4dCA9ICR0aGlzLmZpbmQoJy50ZXh0Jyk7XHJcblxyXG4gICAgICAgICAgICAkc2xpZGVyLm9uKCdtb3VzZWRvd24gdG91Y2hzdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgbW91c2VJc0Rvd24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgc2xpZGVNb3ZlbWVudFRvdGFsID0gJHRoaXMud2lkdGgoKSAtICQodGhpcykud2lkdGgoKSArIDEwO1xyXG4gICAgICAgICAgICAgICAgaW5pdGlhbE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVg7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5LCAkc2xpZGVyKS5vbignbW91c2V1cCB0b3VjaGVuZCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtb3VzZUlzRG93bilcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICBtb3VzZUlzRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVg7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVsYXRpdmVNb3VzZSA9IGN1cnJlbnRNb3VzZSAtIGluaXRpYWxNb3VzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA8IHNsaWRlTW92ZW1lbnRUb3RhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICR0ZXh0LmZhZGVUbygzMDAsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIuYW5pbWF0ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IFwiLTEwcHhcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8qICRzbGlkZXIuYWRkQ2xhc3MoJ3VubG9ja2VkJyk7XHJcbiAgICAgICAgICAgICAgICAkKCcjbG9ja2VyJykudGV4dCgnbG9ja19vdXRsaW5lJyk7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLm9uKCdjbGljayB0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2xpZGVyLmhhc0NsYXNzKCd1bmxvY2tlZCcpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLnJlbW92ZUNsYXNzKCd1bmxvY2tlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjbG9ja2VyJykudGV4dCgnbG9ja19vcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzbGlkZXIub2ZmKCdjbGljayB0YXAnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0sIDApOyAqL1xyXG5cclxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmNiKCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKGRvY3VtZW50LmJvZHkpLm9uKCdtb3VzZW1vdmUgdG91Y2htb3ZlJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW1vdXNlSXNEb3duKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVg7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVsYXRpdmVNb3VzZSA9IGN1cnJlbnRNb3VzZSAtIGluaXRpYWxNb3VzZTtcclxuICAgICAgICAgICAgICAgIHZhciBzbGlkZVBlcmNlbnQgPSAxIC0gKHJlbGF0aXZlTW91c2UgLyBzbGlkZU1vdmVtZW50VG90YWwpO1xyXG5cclxuICAgICAgICAgICAgICAgICR0ZXh0LmZhZGVUbygwLCBzbGlkZVBlcmNlbnQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0JzogJy0xMHB4JyB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA+PSBzbGlkZU1vdmVtZW50VG90YWwgKyAxMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIuY3NzKHsgJ2xlZnQnOiBzbGlkZU1vdmVtZW50VG90YWwgKyAncHgnIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzbGlkZXIuY3NzKHsgJ2xlZnQnOiByZWxhdGl2ZU1vdXNlIC0gMTAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KShqUXVlcnkpO1xyXG4iLCJjb25zdCByZXF1ZXN0ID0ge1xyXG4gICAgLyoqXHJcbiAgICAgKiBBdXRoZW50aWNhdGUuXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBlcnJvclxyXG4gICAgICovXHJcbiAgICBhdXRoOiBmdW5jdGlvbiAoc3VjY2VzcywgZXJyb3IpIHtcclxuICAgICAgICBjb25zdCB1cmwgPSBcImh0dHBzOi8vb21tNm91ZzVwZy5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9kZXNhcnJvbGxvL29hdXRoMi92MS90b2tlblwiO1xyXG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSB7XHJcbiAgICAgICAgICAgIFwiQXV0aG9yaXphdGlvblwiOiBcIkJhc2ljIFwiICsgYnRvYShcIjE4aDh2YW52cmg0cHVpMWxybnRjMW5pbGpmXCIgKyBcIjpcIiArIFwiMWdlMzFiaGpyZGs5ZDBqYTE0bWZ0OHFlcGk0Y2xrdDgwNWpxYjJzdnF2bWI0c28xdjRnN1wiKSxcclxuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIixcclxuICAgICAgICAgICAgXCJDb29raWVcIjogXCJYU1JGLVRPS0VOPWI0YTU0ZjFiLWFmZTUtNGFlZS05YTc2LTAwZjkyMDQxOGI2ZVwiXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBib2R5ID0gXCJncmFudF90eXBlPWNsaWVudF9jcmVkZW50aWFsc1wiO1xyXG5cclxuICAgICAgICByZXF1ZXN0LnNlbmQodXJsLCAnUE9TVCcsIGJvZHksIGhlYWRlcnMsIHN1Y2Nlc3MsIGVycm9yKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQYXkuXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gYWNjZXNzVG9rZW5cclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBoZWFkZXJzXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYm9keVxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2Vzc1xyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZXJyb3JcclxuICAgICAqL1xyXG4gICAgcGF5OiBmdW5jdGlvbiAoYWNjZXNzVG9rZW4sIGhlYWRlcnMsIGJvZHksIHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgY29uc3QgdXJsID0gXCJodHRwczovL2FwaWdhdGV3YXkuc3VwZXJhcHBiYXouY29tL2ludGVncmFjaW9uL3N1cGVyYXBwL3BhZ29zL2NhcHRhY2lvbi90cmFzcGFzb3MvdjEvYm90b24tcGFnb1wiO1xyXG4gICAgICAgIGNvbnN0IHJhdyA9IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xyXG5cclxuICAgICAgICBoZWFkZXJzW1wiQXV0aG9yaXphdGlvblwiXSA9IFwiQmVhcmVyIFwiICsgYWNjZXNzVG9rZW47XHJcbiAgICAgICAgcmVxdWVzdC5zZW5kKHVybCwgJ1BPU1QnLCByYXcsIGhlYWRlcnMsIHN1Y2Nlc3MsIGVycm9yKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNYWtlIHJlcXVlc3QuXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIFxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZFxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGJvZHlcclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBqc29uSGVhZGVycyBcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1Y2Nlc3MgXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBlcnJvclxyXG4gICAgICovXHJcbiAgICBzZW5kOiBmdW5jdGlvbiAodXJsLCBtZXRob2QsIGJvZHksIGpzb25IZWFkZXJzLCBzdWNjZXNzLCBlcnJvcikge1xyXG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBwcm9wIGluIGpzb25IZWFkZXJzKSB7XHJcbiAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kKHByb3AsIGpzb25IZWFkZXJzW3Byb3BdKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZldGNoKHVybCwgeyBtZXRob2QsIGhlYWRlcnMsIGJvZHksIHJlZGlyZWN0OiAnZm9sbG93JyB9KVxyXG4gICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAgICAgICAgIC50aGVuKHN1Y2Nlc3MpXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnJvcik7XHJcbiAgICB9XHJcbn07IiwiLyoqXHJcbiAqIEJpbmQgSlNPTiB0byBIVE1MLlxyXG4gKiBAcGFyYW0ge29iamVjdH0gdmFsdWVzXHJcbiAqL1xyXG5mdW5jdGlvbiBiaW5kKHZhbHVlcykge1xyXG4gICAgY29uc3QgJHRhZ3MgPSAkKCdbZGF0YS1pZF0nKTtcclxuXHJcbiAgICAkdGFncy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCAkdGFnID0gJCh0aGlzKTtcclxuICAgICAgICBjb25zdCBpZCA9ICR0YWcuZGF0YSgnaWQnKTtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbHVlc1tpZF07XHJcblxyXG4gICAgICAgIGlmIChpZCA9PT0gJ3ByZWNpbycpIHtcclxuICAgICAgICAgICAgJHRhZy5odG1sKGZvcm1hdEFtb3VudCh2YWx1ZSkpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoaWQgPT09ICdzYWxkbycpIHtcclxuICAgICAgICAgICAgaWYgKHZhbHVlID09PSAnZmFsc2UnKSB7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgc2hvd0FkdmljZSgkdGFnLCB0cnVlKTsgfSwgNTAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICR0YWcuaHRtbCh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBQYXJzZSBzdHJpbmcgdG8gb2JqZWN0IGFuZCB0aGVuIGJpbmQuXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJKc29uIFxyXG4gKi9cclxuZnVuY3Rpb24gYmluZEZyb21TdHIoc3RySnNvbikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShzdHJKc29uKTtcclxuICAgICAgICBiaW5kKGpzb24pO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7IGNvbnNvbGUubG9nKGVycik7IH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENoYW5nZSBzY3JlZW4uXHJcbiAqIEBwYXJhbSB7alF1ZXJ5fSAkc2NyZWVuXHJcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXHJcbiAqL1xyXG5mdW5jdGlvbiBjaGFuZ2VTY3JlZW4oJHNjcmVlbiwgY2FsbGJhY2spIHtcclxuICAgICQoJy5zY3JlZW4nKS5hZGRDbGFzcygnbm8tdmlzaWJsZScpO1xyXG4gICAgJHNjcmVlbi5yZW1vdmVDbGFzcygnbm8tdmlzaWJsZScpO1xyXG5cclxuICAgIGNhbGxiYWNrKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgYW1vdW50IHdpdGggY3VycmVuY3kgZm9ybWF0LlxyXG4gKiBAcGFyYW0ge251bWJlcn0gYW1vdW50IFxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gKi9cclxuZnVuY3Rpb24gZm9ybWF0QW1vdW50KGFtb3VudCkge1xyXG4gICAgcmV0dXJuICckICcgKyBOdW1iZXIoYW1vdW50KS50b0ZpeGVkKDIpLnJlcGxhY2UoL1xcQig/PShcXGR7M30pKyg/IVxcZCkpL2csICcsJyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBIYW5kbGUgZGlnaXQga2V5dXAgZXZlbnQuXHJcbiAqIEBwYXJhbSB7S2V5Ym9hcmRFdmVudH0gZXZlbnRcclxuICovXHJcbmZ1bmN0aW9uIGhhbmRsZURpZ2l0S2V5dXAoeyB0YXJnZXQsIGtleUNvZGUgfSkge1xyXG4gICAgY29uc3QgJHBhcmVudCA9ICQodGFyZ2V0LnBhcmVudE5vZGUpO1xyXG5cclxuICAgIGlmIChrZXlDb2RlID09PSA4KSB7XHJcbiAgICAgICAgaWYgKCRwYXJlbnQucHJldigpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJHBhcmVudC5wcmV2KCkuZmluZCgnaW5wdXQnKTtcclxuXHJcbiAgICAgICAgICAgICRpbnB1dC52YWwoJycpO1xyXG4gICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSBlbHNlIGlmIChrZXlDb2RlID4gNDcgJiYga2V5Q29kZSA8IDU4KSB7XHJcbiAgICAgICAgaWYgKHRhcmdldC52YWx1ZSAhPT0gJycpIHtcclxuICAgICAgICAgICAgaWYgKCRwYXJlbnQubmV4dCgpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0ICRpbnB1dCA9ICRwYXJlbnQubmV4dCgpLmZpbmQoJ2lucHV0Jyk7XHJcbiAgICAgICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB2YWxpZGF0ZUNvZGUoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEFwcGx5IG51bWJlciBmaWx0ZXIuXHJcbiAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50XHJcbiAqL1xyXG5mdW5jdGlvbiBudW1iZXJGaWx0ZXIoZXZlbnQpIHtcclxuICAgIGNvbnN0IGZpbHRlciA9IC9eXFxkezAsMX0kLztcclxuXHJcbiAgICBpZiAoZmlsdGVyLnRlc3QodGhpcy52YWx1ZSkpIHtcclxuICAgICAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy52YWx1ZTtcclxuICAgICAgICB0aGlzLm9sZFNlbGVjdGlvblN0YXJ0ID0gdGhpcy5zZWxlY3Rpb25TdGFydDtcclxuICAgICAgICB0aGlzLm9sZFNlbGVjdGlvbkVuZCA9IHRoaXMuc2VsZWN0aW9uRW5kO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmhhc093blByb3BlcnR5KCdvbGRWYWx1ZScpKSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMub2xkVmFsdWU7XHJcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb25SYW5nZSh0aGlzLm9sZFNlbGVjdGlvblN0YXJ0LCB0aGlzLm9sZFNlbGVjdGlvbkVuZCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSAnJztcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIERvIGZha2UgcmVxdWVzdC5cclxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcclxuICovXHJcbmZ1bmN0aW9uIGZha2VSZXF1ZXN0KGNvZGUsIGNhbGxiYWNrKSB7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBjYWxsYmFjayhjb2RlID09PSAnMDAwMDAxJyk7XHJcbiAgICB9LCAxNTAwKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJKc29uXHJcbiAqL1xyXG5mdW5jdGlvbiBwYXlNb3ZpZShzdHJKc29uKSB7XHJcbiAgICBjb25zdCBoYW5kbGVFcnIgPSBlcnIgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0eXBlb2YgZXJyID09PSAnb2JqZWN0JyA/IGVyci5tZXNzYWdlIDogZXJyO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZSB9KSk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShzdHJKc29uKTtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5hdXRoKGZ1bmN0aW9uIChhdXRoUmVzKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgYXV0aFJlc1snYWNjZXNzX3Rva2VuJ10gPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnBheShhdXRoUmVzWydhY2Nlc3NfdG9rZW4nXSwganNvblsnaGVhZGVycyddLCBqc29uWyd0cmFuc2FjY2lvbiddLCBmdW5jdGlvbiAocGF5UmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCd3ZWJraXQnIGluIHdpbmRvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5wYXltZW50UmVzcG9uc2UucG9zdE1lc3NhZ2UoXCJwYXltZW50UmVzcG9uc2V8XCIgKyBKU09OLnN0cmluZ2lmeShwYXlSZXMpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCBoYW5kbGVFcnIpO1xyXG4gICAgICAgICAgICB9IGVsc2UgeyBoYW5kbGVFcnIoYXV0aFJlcyk7IH1cclxuICAgICAgICB9LCBoYW5kbGVFcnIpO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycikgeyBoYW5kbGVFcnIoZXJyKTsgfVxyXG59XHJcblxyXG4vKipcclxuICogUGFyc2UgbG9jYXRpb24uc2VhcmNoIHRvIEpTT04uXHJcbiAqIEByZXR1cm5zIG9iamVjdFxyXG4gKi9cclxuZnVuY3Rpb24gc2VhcmNoVG9Kc29uKCkge1xyXG4gICAgY29uc3QgcGFpcnMgPSBsb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpLnNwbGl0KCcmJyk7XHJcbiAgICBjb25zdCBvYmplY3QgPSB7fTtcclxuICAgIGxldCBpID0gMDtcclxuXHJcbiAgICBmb3IgKDsgaSA8IHBhaXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKHBhaXJzW2ldID09PSAnJykge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHBhcnRzID0gcGFpcnNbaV0uc3BsaXQoJz0nKTtcclxuICAgICAgICBvYmplY3RbZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzBdKV0gPSBkZWNvZGVVUklDb21wb25lbnQocGFydHNbMV0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBvYmplY3Q7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTaG93IG9yIGhpZGUgYWR2aWNlLlxyXG4gKiBAcGFyYW0ge2pRdWVyeX0gJGVsIFxyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGZsYWcgXHJcbiAqL1xyXG5mdW5jdGlvbiBzaG93QWR2aWNlKCRlbCwgZmxhZykge1xyXG4gICAgaWYgKGZsYWcpIHtcclxuICAgICAgICAkZWwuYWRkQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGVsLnJlbW92ZUNsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTaG93IG9yIGhpZGUgbG9hZGVyLlxyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHNob3dcclxuICovXHJcbmZ1bmN0aW9uIHNob3dMb2FkZXIoc2hvdykge1xyXG4gICAgbGV0ICRsb2FkZXIgPSAkKCcubG9hZGVyJyk7XHJcblxyXG4gICAgaWYgKHNob3cpIHtcclxuICAgICAgICBpZiAoJGxvYWRlci5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICAkbG9hZGVyID0gJCgnPGRpdiBjbGFzcz1cImxvYWRlclwiPicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJCgnYm9keScpLmFwcGVuZCgkbG9hZGVyKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+ICRsb2FkZXIuYWRkQ2xhc3MoJ2xvYWRlci12aXNpYmxlJyksIDEwKTtcclxuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICRsb2FkZXIucmVtb3ZlQ2xhc3MoJ2xvYWRlci12aXNpYmxlJyk7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiAkbG9hZGVyLnJlbW92ZSgpLCAzNzUpO1xyXG5cclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFZhbGlkYXRlIGNvZGUgZnJvbSBjbGllbnQuXHJcbiAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gKi9cclxuZnVuY3Rpb24gdmFsaWRhdGVDb2RlKCkge1xyXG4gICAgY29uc3QgJGNvZGUgPSAkKCcuYXV0aC1zY3JlZW4gLmNvZGUnKTtcclxuICAgIGNvbnN0ICRkaWdpdHMgPSAkKCcuYXV0aC1zY3JlZW4gLmRpZ2l0IGlucHV0Jyk7XHJcbiAgICBsZXQgY29kZSA9IFwiXCI7XHJcblxyXG4gICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb2RlICs9IHRoaXMudmFsdWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoY29kZS5sZW5ndGggPT09IDYpIHtcclxuICAgICAgICBzaG93TG9hZGVyKHRydWUpO1xyXG5cclxuICAgICAgICBmYWtlUmVxdWVzdChjb2RlLCBzdWNjZXNzID0+IHtcclxuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCd2YWxpZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNoYW5nZVNjcmVlbigkKCcucmVzdW1lLXNjcmVlbicpLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ2ludmFsaWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkgeyAkKHRoaXMpLnZhbCgnJyk7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICRkaWdpdHMuZXEoMCkuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGNvZGUucmVtb3ZlQ2xhc3MoJ3ZhbGlkIGludmFsaWQnKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgRGV0YWlsIFNjcmVlbiBjb21wb25lbnRzLlxyXG5iaW5kKHNlYXJjaFRvSnNvbigpKTtcclxuXHJcbmNvbnN0ICRhZHZpY2VzID0gJCgnLmFkdmljZS5maXhlZCcpO1xyXG5cclxuJGFkdmljZXMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCAkYWR2aWNlID0gJCh0aGlzKTtcclxuICAgIGNvbnN0ICRjbG9zZUJ0biA9ICRhZHZpY2UuZmluZCgnLmNsb3NlLWJ0bicpO1xyXG5cclxuICAgICRjbG9zZUJ0bi5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc2hvd0FkdmljZSgkYWR2aWNlLCBmYWxzZSk7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG4kKCcuZGV0YWlsLXNjcmVlbiAuc3dpcGUtYnRuJykuc3dpcGUoe1xyXG4gICAgY2I6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBzaG93TG9hZGVyKHRydWUpO1xyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IE9wZW4gZGlnaXRhbCBzaWduJylcclxuXHJcbiAgICAgICAgICAgIGlmICgnd2Via2l0JyBpbiB3aW5kb3cpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnNob3dEaWdpdGFsU2lnbi5wb3N0TWVzc2FnZShcInNob3dEaWdpdGFsU2lnblwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIDUwMCk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgQXV0aCBTY3JlZW4gY29tcG9uZW50cy5cclxuY29uc3QgJGRpZ2l0cyA9ICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKTtcclxuXHJcbiRkaWdpdHMub24oJ2tleXByZXNzIGtleWRvd24ga2V5dXAgaW5wdXQgY2hhbmdlIHBhc3RlJywgbnVtYmVyRmlsdGVyKVxyXG4kZGlnaXRzLm9uKCdrZXl1cCcsIGhhbmRsZURpZ2l0S2V5dXApO1xyXG5cclxuJGRpZ2l0cy5lcSgwKS5mb2N1cygpO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgY2xvc2UgYnV0dG9ucy5cclxuJCgnLnNjcmVlbiBoZWFkZXIgLmNsb3NlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBDbG9zaW5nIFdlYlZpZXcnKTtcclxuXHJcbiAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XHJcbiAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuY2xvc2VNb3ZpZVBheW1lbnQucG9zdE1lc3NhZ2UoXCJjbG9zZU1vdmllUGF5bWVudFwiKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBzaGFyZSBidXR0b24uXHJcbiQoJy5zaGFyZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogU2hhcmluZyB0aWNrZXQnKTtcclxuXHJcbiAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XHJcbiAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuc2hhcmVUaWNrZXQucG9zdE1lc3NhZ2UoXCJzaGFyZVRpY2tldFwiKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBtb3ZpZSBidXR0b24uXHJcbiQoJy5tb3ZpZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogUGxheSBtb3ZpZScpO1xyXG5cclxuICAgIGlmICgnd2Via2l0JyBpbiB3aW5kb3cpIHtcclxuICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5wbGF5TW92aWUucG9zdE1lc3NhZ2UoXCJwbGF5TW92aWVcIik7XHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=

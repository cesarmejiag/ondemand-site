!function(c){c.fn.swipe=function(e){var r=c.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var o=c(this),n=0,s=0,t=!1,i=o.find(".slider"),a=o.find(".text");i.on("mousedown touchstart",function(e){t=!0,s=o.width()-c(this).width()+10,n=e.clientX||e.originalEvent.touches[0].pageX}),c(document.body,i).on("mouseup touchend",function(e){if(t){if(t=!1,(e.clientX||e.changedTouches[0].pageX)-n<s)return a.fadeTo(300,1),void i.animate({left:"-10px"},300);r.cb()}}),c(document.body).on("mousemove touchmove",function(e){var o;t&&(e=1-(o=(e.clientX||e.originalEvent.touches[0].pageX)-n)/s,a.fadeTo(0,e),o<=0?i.css({left:"-10px"}):s+10<=o?i.css({left:s+"px"}):i.css({left:o-10}))})})}}(jQuery);var request={auth:function(e,o){var n={Authorization:"Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7"),"Content-Type":"application/x-www-form-urlencoded",Cookie:"XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"};request.send("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token","POST","grant_type=client_credentials",n,e,o)},pay:function(e,o,n,s,t){n=n?"https://api.bazappgs.com/superapp/pagos/captacion/traspasos/v1/boton-pago":"https://apigateway.superappbaz.com/integracion/superapp/pagos/captacion/traspasos/v1/boton-pago",o=JSON.stringify(o);request.send(n,"POST",o,e,s,t)},send:function(e,o,n,s,t,i){var a,r=new Headers;for(a in s)r.append(a,s[a]);fetch(e,{method:o,headers:r,body:n,redirect:"follow"}).then(function(e){return e.json()}).then(t).catch(i)}},environment=!1;function bind(s){$("[data-id]").each(function(){var e=$(this),o=e.data("id"),n=s[o];"precio"===o?e.html(formatAmount(n)):"saldo"===o?"false"===n&&setTimeout(function(){showAdvice(e,!0)},500):e.html(n)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,o){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),o()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var o=e.target,n=e.keyCode,s=$(o.parentNode);8===n?0<s.prev().length&&((e=s.prev().find("input")).val(""),e.focus()):47<n&&n<58&&""!==o.value&&0<s.next().length&&s.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function fakeRequest(e,o){setTimeout(function(){o("000001"===e)},1500)}function payMovie(e){function o(e){console.log(JSON.stringify(e)),window.webkit.messageHandlers.errorPaymentResponse.postMessage("errorPaymentResponse|"+JSON.stringify(e))}try{var n=JSON.parse(e);window.webkit.messageHandlers.showLoader.postMessage("showLoader"),request.pay(n.headers,n.requestBody,environment,function(e){"201"==e.codigo?window.webkit.messageHandlers.paymentResponse.postMessage("paymentResponse|"+JSON.stringify({error:{code:0,data:e}})):o({error:{code:e.codigo,message:e.mensaje},weberror:900,weberrormessage:"Error de servicio."}),window.webkit.messageHandlers.hideLoader.postMessage("hideLoader")},function(e){o({error:{code:500,message:e.message},weberror:901,weberrormessage:"Error en el fetch web."}),window.webkit.messageHandlers.hideLoader.postMessage("hideLoader")})}catch(e){o({error:{code:500,message:e.message},weberror:902,weberrormessage:"Se perdió la conexión a internet."})}}function searchToJson(){for(var e,o=location.search.substring(1).split("&"),n={},s=0;s<o.length;s++)""!==o[s]&&(e=o[s].split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return n}function showAdvice(e,o){o?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var o=$(".loader");e?(o.length<=0&&(o=$('<div class="loader">')),$("body").append(o),setTimeout(function(){return o.addClass("loader-visible")},10)):(o.removeClass("loader-visible"),setTimeout(function(){return o.remove()},375))}function validateCode(){var o=$(".auth-screen .code"),n=$(".auth-screen .digit input"),e="";n.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(o.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),o.addClass("invalid"),setTimeout(function(){n.each(function(){$(this).val("")}),n.eq(0).focus()},100))})):o.removeClass("valid invalid")}var searchJson=searchToJson(),environment="true"===searchJson.environment;bind(searchJson);var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),window.webkit.messageHandlers.showDigitalSign.postMessage("showDigitalSign")},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),window.webkit.messageHandlers.closeMoviePayment.postMessage("closeMoviePayment")}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),window.webkit.messageHandlers.shareTicket.postMessage("shareTicket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),window.webkit.messageHandlers.playMovie.postMessage("playMovie")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5zd2lwZS5qcyIsInJlcXVlc3QuanMiLCJzY3JpcHRzLmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCJjb25zb2xlIiwibG9nIiwidGhpcyIsImVhY2giLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsImZpbmQiLCIkdGV4dCIsIm9uIiwiZXZlbnQiLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJib2R5IiwiY2hhbmdlZFRvdWNoZXMiLCJmYWRlVG8iLCJhbmltYXRlIiwibGVmdCIsInJlbGF0aXZlTW91c2UiLCJzbGlkZVBlcmNlbnQiLCJjc3MiLCJqUXVlcnkiLCJyZXF1ZXN0IiwiYXV0aCIsInN1Y2Nlc3MiLCJlcnJvciIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYnRvYSIsIkNvbnRlbnQtVHlwZSIsIkNvb2tpZSIsInNlbmQiLCJwYXkiLCJwcm9kdWN0aW9uIiwidXJsIiwicmF3IiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGhvZCIsImpzb25IZWFkZXJzIiwicHJvcCIsIkhlYWRlcnMiLCJhcHBlbmQiLCJmZXRjaCIsInJlZGlyZWN0IiwidGhlbiIsInJlc3BvbnNlIiwianNvbiIsImVudmlyb25tZW50IiwiYmluZCIsInZhbHVlcyIsIiR0YWciLCJpZCIsImRhdGEiLCJ2YWx1ZSIsImh0bWwiLCJmb3JtYXRBbW91bnQiLCJzZXRUaW1lb3V0Iiwic2hvd0FkdmljZSIsImJpbmRGcm9tU3RyIiwic3RySnNvbiIsInBhcnNlIiwiZXJyIiwiY2hhbmdlU2NyZWVuIiwiJHNjcmVlbiIsImNhbGxiYWNrIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsImFtb3VudCIsIk51bWJlciIsInRvRml4ZWQiLCJyZXBsYWNlIiwiaGFuZGxlRGlnaXRLZXl1cCIsIl9yZWYiLCJ0YXJnZXQiLCJrZXlDb2RlIiwiJHBhcmVudCIsInBhcmVudE5vZGUiLCJwcmV2IiwibGVuZ3RoIiwiJGlucHV0IiwidmFsIiwiZm9jdXMiLCJuZXh0IiwidmFsaWRhdGVDb2RlIiwibnVtYmVyRmlsdGVyIiwidGVzdCIsIm9sZFZhbHVlIiwib2xkU2VsZWN0aW9uU3RhcnQiLCJzZWxlY3Rpb25TdGFydCIsIm9sZFNlbGVjdGlvbkVuZCIsInNlbGVjdGlvbkVuZCIsImhhc093blByb3BlcnR5Iiwic2V0U2VsZWN0aW9uUmFuZ2UiLCJmYWtlUmVxdWVzdCIsImNvZGUiLCJwYXlNb3ZpZSIsImhhbmRsZUVyciIsIndpbmRvdyIsIndlYmtpdCIsIm1lc3NhZ2VIYW5kbGVycyIsImVycm9yUGF5bWVudFJlc3BvbnNlIiwicG9zdE1lc3NhZ2UiLCJzaG93TG9hZGVyIiwicGF5UmVzIiwiY29kaWdvIiwicGF5bWVudFJlc3BvbnNlIiwibWVzc2FnZSIsIm1lbnNhamUiLCJ3ZWJlcnJvciIsIndlYmVycm9ybWVzc2FnZSIsImhpZGVMb2FkZXIiLCJzZWFyY2hUb0pzb24iLCJwYXJ0cyIsInBhaXJzIiwibG9jYXRpb24iLCJzZWFyY2giLCJzdWJzdHJpbmciLCJzcGxpdCIsIm9iamVjdCIsImkiLCJkZWNvZGVVUklDb21wb25lbnQiLCIkZWwiLCJmbGFnIiwic2hvdyIsIiRsb2FkZXIiLCJyZW1vdmUiLCIkY29kZSIsIiRkaWdpdHMiLCJlcSIsInNlYXJjaEpzb24iLCIkYWR2aWNlcyIsIiRhZHZpY2UiLCJzaG93RGlnaXRhbFNpZ24iLCJjbG9zZU1vdmllUGF5bWVudCIsInNoYXJlVGlja2V0IiwicGxheU1vdmllIl0sIm1hcHBpbmdzIjoiY0FFQSxTQUFBQSxHQUNBQSxFQUFBQyxHQUFBQyxNQUFBLFNBQUFDLEdBQ0EsSUFBQUMsRUFBQUosRUFBQUssT0FBQSxDQUNBQyxHQUFBLFdBQ0FDLFFBQUFDLElBQUEsZ0JBRUFMLEdBRUEsT0FBQU0sS0FBQUMsS0FBQSxX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QyxZQUFBIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gUmVmZXJlbmNlOiBodHRwczovL2NvZGVwZW4uaW8vZ3ByZXNzdXR0bzUvcGVuL05qSm9iRz9lZGl0b3JzPTAwMTBcclxuXHJcbihmdW5jdGlvbiAoJCkge1xyXG4gICAgJC5mbi5zd2lwZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgdmFyIHNldHRpbmdzID0gJC5leHRlbmQoe1xyXG4gICAgICAgICAgICBjYjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc3dpcGUgZG9uZScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgb3B0aW9ucyk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICB2YXIgaW5pdGlhbE1vdXNlID0gMDtcclxuICAgICAgICAgICAgdmFyIHNsaWRlTW92ZW1lbnRUb3RhbCA9IDA7XHJcbiAgICAgICAgICAgIHZhciBtb3VzZUlzRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgJHNsaWRlciA9ICR0aGlzLmZpbmQoJy5zbGlkZXInKTtcclxuICAgICAgICAgICAgdmFyICR0ZXh0ID0gJHRoaXMuZmluZCgnLnRleHQnKTtcclxuXHJcbiAgICAgICAgICAgICRzbGlkZXIub24oJ21vdXNlZG93biB0b3VjaHN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBtb3VzZUlzRG93biA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBzbGlkZU1vdmVtZW50VG90YWwgPSAkdGhpcy53aWR0aCgpIC0gJCh0aGlzKS53aWR0aCgpICsgMTA7XHJcbiAgICAgICAgICAgICAgICBpbml0aWFsTW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXS5wYWdlWDtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKGRvY3VtZW50LmJvZHksICRzbGlkZXIpLm9uKCdtb3VzZXVwIHRvdWNoZW5kJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW1vdXNlSXNEb3duKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIG1vdXNlSXNEb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWDtcclxuICAgICAgICAgICAgICAgIHZhciByZWxhdGl2ZU1vdXNlID0gY3VycmVudE1vdXNlIC0gaW5pdGlhbE1vdXNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlIDwgc2xpZGVNb3ZlbWVudFRvdGFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRleHQuZmFkZVRvKDMwMCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5hbmltYXRlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogXCItMTBweFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLyogJHNsaWRlci5hZGRDbGFzcygndW5sb2NrZWQnKTtcclxuICAgICAgICAgICAgICAgICQoJyNsb2NrZXInKS50ZXh0KCdsb2NrX291dGxpbmUnKTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIub24oJ2NsaWNrIHRhcCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISRzbGlkZXIuaGFzQ2xhc3MoJ3VubG9ja2VkJykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzbGlkZXIucmVtb3ZlQ2xhc3MoJ3VubG9ja2VkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNsb2NrZXInKS50ZXh0KCdsb2NrX29wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5vZmYoJ2NsaWNrIHRhcCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSwgMCk7ICovXHJcblxyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuY2IoKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSkub24oJ21vdXNlbW92ZSB0b3VjaG1vdmUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghbW91c2VJc0Rvd24pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50TW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXS5wYWdlWDtcclxuICAgICAgICAgICAgICAgIHZhciByZWxhdGl2ZU1vdXNlID0gY3VycmVudE1vdXNlIC0gaW5pdGlhbE1vdXNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNsaWRlUGVyY2VudCA9IDEgLSAocmVsYXRpdmVNb3VzZSAvIHNsaWRlTW92ZW1lbnRUb3RhbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHRleHQuZmFkZVRvKDAsIHNsaWRlUGVyY2VudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIuY3NzKHsgJ2xlZnQnOiAnLTEwcHgnIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlID49IHNsaWRlTW92ZW1lbnRUb3RhbCArIDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6IHNsaWRlTW92ZW1lbnRUb3RhbCArICdweCcgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6IHJlbGF0aXZlTW91c2UgLSAxMCB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pKGpRdWVyeSk7XHJcbiIsImNvbnN0IHJlcXVlc3QgPSB7XHJcbiAgICAvKipcclxuICAgICAqIEF1dGhlbnRpY2F0ZS5cclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1Y2Nlc3NcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXHJcbiAgICAgKi9cclxuICAgIGF1dGg6IGZ1bmN0aW9uIChzdWNjZXNzLCBlcnJvcikge1xyXG4gICAgICAgIGNvbnN0IHVybCA9IFwiaHR0cHM6Ly9vbW02b3VnNXBnLmV4ZWN1dGUtYXBpLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL2Rlc2Fycm9sbG8vb2F1dGgyL3YxL3Rva2VuXCI7XHJcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IHtcclxuICAgICAgICAgICAgXCJBdXRob3JpemF0aW9uXCI6IFwiQmFzaWMgXCIgKyBidG9hKFwiMThoOHZhbnZyaDRwdWkxbHJudGMxbmlsamZcIiArIFwiOlwiICsgXCIxZ2UzMWJoanJkazlkMGphMTRtZnQ4cWVwaTRjbGt0ODA1anFiMnN2cXZtYjRzbzF2NGc3XCIpLFxyXG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLFxyXG4gICAgICAgICAgICBcIkNvb2tpZVwiOiBcIlhTUkYtVE9LRU49YjRhNTRmMWItYWZlNS00YWVlLTlhNzYtMDBmOTIwNDE4YjZlXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSBcImdyYW50X3R5cGU9Y2xpZW50X2NyZWRlbnRpYWxzXCI7XHJcblxyXG4gICAgICAgIHJlcXVlc3Quc2VuZCh1cmwsICdQT1NUJywgYm9keSwgaGVhZGVycywgc3VjY2VzcywgZXJyb3IpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIFBheS5cclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBoZWFkZXJzXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYm9keVxyXG4gICAgICogQHBhcmFtIHtib29sZWFufSBwcm9kdWN0aW9uXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBlcnJvclxyXG4gICAgICovXHJcbiAgICBwYXk6IGZ1bmN0aW9uIChoZWFkZXJzLCBib2R5LCBwcm9kdWN0aW9uLCBzdWNjZXNzLCBlcnJvcikge1xyXG4gICAgICAgIGNvbnN0IHVybCA9IHByb2R1Y3Rpb24gXHJcbiAgICAgICAgICAgID8gXCJodHRwczovL2FwaS5iYXphcHBncy5jb20vc3VwZXJhcHAvcGFnb3MvY2FwdGFjaW9uL3RyYXNwYXNvcy92MS9ib3Rvbi1wYWdvXCJcclxuICAgICAgICAgICAgLy8gPyBcImh0dHBzOi8vYXBpLmJhei5hcHAvc3VwZXJhcHAvcGFnb3MvY2FwdGFjaW9uL3RyYXNwYXNvcy92MS9ib3Rvbi1wYWdvXCJcclxuICAgICAgICAgICAgOiBcImh0dHBzOi8vYXBpZ2F0ZXdheS5zdXBlcmFwcGJhei5jb20vaW50ZWdyYWNpb24vc3VwZXJhcHAvcGFnb3MvY2FwdGFjaW9uL3RyYXNwYXNvcy92MS9ib3Rvbi1wYWdvXCI7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHJhdyA9IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xyXG5cclxuICAgICAgICByZXF1ZXN0LnNlbmQodXJsLCAnUE9TVCcsIHJhdywgaGVhZGVycywgc3VjY2VzcywgZXJyb3IpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIE1ha2UgcmVxdWVzdC5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYm9keVxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGpzb25IZWFkZXJzIFxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2VzcyBcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXHJcbiAgICAgKi9cclxuICAgIHNlbmQ6IGZ1bmN0aW9uICh1cmwsIG1ldGhvZCwgYm9keSwganNvbkhlYWRlcnMsIHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IHByb3AgaW4ganNvbkhlYWRlcnMpIHtcclxuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQocHJvcCwganNvbkhlYWRlcnNbcHJvcF0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmV0Y2godXJsLCB7IG1ldGhvZCwgaGVhZGVycywgYm9keSwgcmVkaXJlY3Q6ICdmb2xsb3cnIH0pXHJcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcclxuICAgICAgICAgICAgLnRoZW4oc3VjY2VzcylcclxuICAgICAgICAgICAgLmNhdGNoKGVycm9yKTtcclxuICAgIH1cclxufTsiLCJsZXQgZW52aXJvbm1lbnQgPSBmYWxzZTtcclxuXHJcbi8qKlxyXG4gKiBCaW5kIEpTT04gdG8gSFRNTC5cclxuICogQHBhcmFtIHtvYmplY3R9IHZhbHVlc1xyXG4gKi9cclxuZnVuY3Rpb24gYmluZCh2YWx1ZXMpIHtcclxuICAgIGNvbnN0ICR0YWdzID0gJCgnW2RhdGEtaWRdJyk7XHJcblxyXG4gICAgJHRhZ3MuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgJHRhZyA9ICQodGhpcyk7XHJcbiAgICAgICAgY29uc3QgaWQgPSAkdGFnLmRhdGEoJ2lkJyk7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbaWRdO1xyXG5cclxuICAgICAgICBpZiAoaWQgPT09ICdwcmVjaW8nKSB7XHJcbiAgICAgICAgICAgICR0YWcuaHRtbChmb3JtYXRBbW91bnQodmFsdWUpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGlkID09PSAnc2FsZG8nKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJ2ZhbHNlJykge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHNob3dBZHZpY2UoJHRhZywgdHJ1ZSk7IH0sIDUwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkdGFnLmh0bWwodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogUGFyc2Ugc3RyaW5nIHRvIG9iamVjdCBhbmQgdGhlbiBiaW5kLlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RySnNvbiBcclxuICovXHJcbmZ1bmN0aW9uIGJpbmRGcm9tU3RyKHN0ckpzb24pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2Uoc3RySnNvbik7XHJcbiAgICAgICAgYmluZChqc29uKTtcclxuICAgIH0gY2F0Y2ggKGVycikgeyBjb25zb2xlLmxvZyhlcnIpOyB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDaGFuZ2Ugc2NyZWVuLlxyXG4gKiBAcGFyYW0ge2pRdWVyeX0gJHNjcmVlblxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xyXG4gKi9cclxuZnVuY3Rpb24gY2hhbmdlU2NyZWVuKCRzY3JlZW4sIGNhbGxiYWNrKSB7XHJcbiAgICAkKCcuc2NyZWVuJykuYWRkQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgICRzY3JlZW4ucmVtb3ZlQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuXHJcbiAgICBjYWxsYmFjaygpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGFtb3VudCB3aXRoIGN1cnJlbmN5IGZvcm1hdC5cclxuICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudCBcclxuICogQHJldHVybnMge3N0cmluZ31cclxuICovXHJcbmZ1bmN0aW9uIGZvcm1hdEFtb3VudChhbW91bnQpIHtcclxuICAgIHJldHVybiAnJCAnICsgTnVtYmVyKGFtb3VudCkudG9GaXhlZCgyKS5yZXBsYWNlKC9cXEIoPz0oXFxkezN9KSsoPyFcXGQpKS9nLCAnLCcpO1xyXG59XHJcblxyXG4vKipcclxuICogSGFuZGxlIGRpZ2l0IGtleXVwIGV2ZW50LlxyXG4gKiBAcGFyYW0ge0tleWJvYXJkRXZlbnR9IGV2ZW50XHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVEaWdpdEtleXVwKHsgdGFyZ2V0LCBrZXlDb2RlIH0pIHtcclxuICAgIGNvbnN0ICRwYXJlbnQgPSAkKHRhcmdldC5wYXJlbnROb2RlKTtcclxuXHJcbiAgICBpZiAoa2V5Q29kZSA9PT0gOCkge1xyXG4gICAgICAgIGlmICgkcGFyZW50LnByZXYoKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0ICRpbnB1dCA9ICRwYXJlbnQucHJldigpLmZpbmQoJ2lucHV0Jyk7XHJcblxyXG4gICAgICAgICAgICAkaW5wdXQudmFsKCcnKTtcclxuICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0gZWxzZSBpZiAoa2V5Q29kZSA+IDQ3ICYmIGtleUNvZGUgPCA1OCkge1xyXG4gICAgICAgIGlmICh0YXJnZXQudmFsdWUgIT09ICcnKSB7XHJcbiAgICAgICAgICAgIGlmICgkcGFyZW50Lm5leHQoKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCAkaW5wdXQgPSAkcGFyZW50Lm5leHQoKS5maW5kKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGVDb2RlKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBcHBseSBudW1iZXIgZmlsdGVyLlxyXG4gKiBAcGFyYW0ge0V2ZW50fSBldmVudFxyXG4gKi9cclxuZnVuY3Rpb24gbnVtYmVyRmlsdGVyKGV2ZW50KSB7XHJcbiAgICBjb25zdCBmaWx0ZXIgPSAvXlxcZHswLDF9JC87XHJcblxyXG4gICAgaWYgKGZpbHRlci50ZXN0KHRoaXMudmFsdWUpKSB7XHJcbiAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMudmFsdWU7XHJcbiAgICAgICAgdGhpcy5vbGRTZWxlY3Rpb25TdGFydCA9IHRoaXMuc2VsZWN0aW9uU3RhcnQ7XHJcbiAgICAgICAgdGhpcy5vbGRTZWxlY3Rpb25FbmQgPSB0aGlzLnNlbGVjdGlvbkVuZDtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eSgnb2xkVmFsdWUnKSkge1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLm9sZFZhbHVlO1xyXG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uUmFuZ2UodGhpcy5vbGRTZWxlY3Rpb25TdGFydCwgdGhpcy5vbGRTZWxlY3Rpb25FbmQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnZhbHVlID0gJyc7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEbyBmYWtlIHJlcXVlc3QuXHJcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXHJcbiAqL1xyXG5mdW5jdGlvbiBmYWtlUmVxdWVzdChjb2RlLCBjYWxsYmFjaykge1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgY2FsbGJhY2soY29kZSA9PT0gJzAwMDAwMScpO1xyXG4gICAgfSwgMTUwMCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RySnNvblxyXG4gKi9cclxuZnVuY3Rpb24gcGF5TW92aWUoc3RySnNvbikge1xyXG4gICAgY29uc3QgaGFuZGxlRXJyID0gZXJyID0+IHtcclxuICAgICAgICAvLyBjb25zdCBtZXNzYWdlID0gdHlwZW9mIGVyciA9PT0gJ29iamVjdCcgPyBlcnIubWVzc2FnZSA6IGVycjtcclxuICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShlcnIpKTtcclxuICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5lcnJvclBheW1lbnRSZXNwb25zZS5wb3N0TWVzc2FnZShcImVycm9yUGF5bWVudFJlc3BvbnNlfFwiICsgSlNPTi5zdHJpbmdpZnkoZXJyKSk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShzdHJKc29uKTtcclxuXHJcbiAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuc2hvd0xvYWRlci5wb3N0TWVzc2FnZShcInNob3dMb2FkZXJcIik7XHJcblxyXG4gICAgICAgIHJlcXVlc3QucGF5KGpzb25bJ2hlYWRlcnMnXSwganNvblsncmVxdWVzdEJvZHknXSwgZW52aXJvbm1lbnQsIGZ1bmN0aW9uIChwYXlSZXMpIHtcclxuICAgICAgICAgICAgaWYgKHBheVJlcy5jb2RpZ28gPT0gJzIwMScpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnBheW1lbnRSZXNwb25zZS5wb3N0TWVzc2FnZShcInBheW1lbnRSZXNwb25zZXxcIiArIEpTT04uc3RyaW5naWZ5KHsgZXJyb3I6IHsgY29kZTogMCwgZGF0YTogcGF5UmVzIH0gfSkpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaGFuZGxlRXJyKHsgZXJyb3I6IHsgY29kZTogcGF5UmVzLmNvZGlnbywgbWVzc2FnZTogcGF5UmVzLm1lbnNhamUgfSwgd2ViZXJyb3I6IDkwMCwgd2ViZXJyb3JtZXNzYWdlOiBcIkVycm9yIGRlIHNlcnZpY2lvLlwiIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5oaWRlTG9hZGVyLnBvc3RNZXNzYWdlKFwiaGlkZUxvYWRlclwiKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGhhbmRsZUVycih7IGVycm9yOiB7IGNvZGU6IDUwMCwgbWVzc2FnZTogZXJyLm1lc3NhZ2UgfSwgd2ViZXJyb3I6IDkwMSwgd2ViZXJyb3JtZXNzYWdlOiBcIkVycm9yIGVuIGVsIGZldGNoIHdlYi5cIiB9KTtcclxuICAgICAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuaGlkZUxvYWRlci5wb3N0TWVzc2FnZShcImhpZGVMb2FkZXJcIik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyKSB7IGhhbmRsZUVycih7IGVycm9yOiB7IGNvZGU6IDUwMCwgbWVzc2FnZTogZXJyLm1lc3NhZ2UgfSwgd2ViZXJyb3I6IDkwMiwgd2ViZXJyb3JtZXNzYWdlOiBcIlNlIHBlcmRpw7MgbGEgY29uZXhpw7NuIGEgaW50ZXJuZXQuXCIgfSk7IH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFBhcnNlIGxvY2F0aW9uLnNlYXJjaCB0byBKU09OLlxyXG4gKiBAcmV0dXJucyBvYmplY3RcclxuICovXHJcbmZ1bmN0aW9uIHNlYXJjaFRvSnNvbigpIHtcclxuICAgIGNvbnN0IHBhaXJzID0gbG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKS5zcGxpdCgnJicpO1xyXG4gICAgY29uc3Qgb2JqZWN0ID0ge307XHJcbiAgICBsZXQgaSA9IDA7XHJcblxyXG4gICAgZm9yICg7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGlmIChwYWlyc1tpXSA9PT0gJycpIHtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwYXJ0cyA9IHBhaXJzW2ldLnNwbGl0KCc9Jyk7XHJcbiAgICAgICAgb2JqZWN0W2RlY29kZVVSSUNvbXBvbmVudChwYXJ0c1swXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzFdKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gb2JqZWN0O1xyXG59XHJcblxyXG4vKipcclxuICogU2hvdyBvciBoaWRlIGFkdmljZS5cclxuICogQHBhcmFtIHtqUXVlcnl9ICRlbCBcclxuICogQHBhcmFtIHtib29sZWFufSBmbGFnIFxyXG4gKi9cclxuZnVuY3Rpb24gc2hvd0FkdmljZSgkZWwsIGZsYWcpIHtcclxuICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgJGVsLmFkZENsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICRlbC5yZW1vdmVDbGFzcygnbm8tdmlzaWJsZScpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogU2hvdyBvciBoaWRlIGxvYWRlci5cclxuICogQHBhcmFtIHtib29sZWFufSBzaG93XHJcbiAqL1xyXG5mdW5jdGlvbiBzaG93TG9hZGVyKHNob3cpIHtcclxuICAgIGxldCAkbG9hZGVyID0gJCgnLmxvYWRlcicpO1xyXG5cclxuICAgIGlmIChzaG93KSB7XHJcbiAgICAgICAgaWYgKCRsb2FkZXIubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgJGxvYWRlciA9ICQoJzxkaXYgY2xhc3M9XCJsb2FkZXJcIj4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJGxvYWRlcik7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiAkbG9hZGVyLmFkZENsYXNzKCdsb2FkZXItdmlzaWJsZScpLCAxMCk7XHJcblxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkbG9hZGVyLnJlbW92ZUNsYXNzKCdsb2FkZXItdmlzaWJsZScpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gJGxvYWRlci5yZW1vdmUoKSwgMzc1KTtcclxuXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZGF0ZSBjb2RlIGZyb20gY2xpZW50LlxyXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuICovXHJcbmZ1bmN0aW9uIHZhbGlkYXRlQ29kZSgpIHtcclxuICAgIGNvbnN0ICRjb2RlID0gJCgnLmF1dGgtc2NyZWVuIC5jb2RlJyk7XHJcbiAgICBjb25zdCAkZGlnaXRzID0gJCgnLmF1dGgtc2NyZWVuIC5kaWdpdCBpbnB1dCcpO1xyXG4gICAgbGV0IGNvZGUgPSBcIlwiO1xyXG5cclxuICAgICRkaWdpdHMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29kZSArPSB0aGlzLnZhbHVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGNvZGUubGVuZ3RoID09PSA2KSB7XHJcbiAgICAgICAgc2hvd0xvYWRlcih0cnVlKTtcclxuXHJcbiAgICAgICAgZmFrZVJlcXVlc3QoY29kZSwgc3VjY2VzcyA9PiB7XHJcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAkY29kZS5hZGRDbGFzcygndmFsaWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjaGFuZ2VTY3JlZW4oJCgnLnJlc3VtZS1zY3JlZW4nKSwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCdpbnZhbGlkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHsgJCh0aGlzKS52YWwoJycpOyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVxKDApLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICRjb2RlLnJlbW92ZUNsYXNzKCd2YWxpZCBpbnZhbGlkJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4vLyBJbml0aWFsaXplIERldGFpbCBTY3JlZW4gY29tcG9uZW50cy5cclxuY29uc3Qgc2VhcmNoSnNvbiA9IHNlYXJjaFRvSnNvbigpO1xyXG5cclxuZW52aXJvbm1lbnQgPSBzZWFyY2hKc29uWydlbnZpcm9ubWVudCddID09PSAndHJ1ZSc7XHJcbmJpbmQoc2VhcmNoSnNvbik7XHJcblxyXG5jb25zdCAkYWR2aWNlcyA9ICQoJy5hZHZpY2UuZml4ZWQnKTtcclxuXHJcbiRhZHZpY2VzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3QgJGFkdmljZSA9ICQodGhpcyk7XHJcbiAgICBjb25zdCAkY2xvc2VCdG4gPSAkYWR2aWNlLmZpbmQoJy5jbG9zZS1idG4nKTtcclxuXHJcbiAgICAkY2xvc2VCdG4ub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNob3dBZHZpY2UoJGFkdmljZSwgZmFsc2UpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuJCgnLmRldGFpbC1zY3JlZW4gLnN3aXBlLWJ0bicpLnN3aXBlKHtcclxuICAgIGNiOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc2hvd0xvYWRlcih0cnVlKTtcclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBPcGVuIGRpZ2l0YWwgc2lnbicpO1xyXG4gICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5zaG93RGlnaXRhbFNpZ24ucG9zdE1lc3NhZ2UoXCJzaG93RGlnaXRhbFNpZ25cIik7XHJcbiAgICAgICAgfSwgNTAwKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBBdXRoIFNjcmVlbiBjb21wb25lbnRzLlxyXG5jb25zdCAkZGlnaXRzID0gJCgnLmF1dGgtc2NyZWVuIC5kaWdpdCBpbnB1dCcpO1xyXG5cclxuJGRpZ2l0cy5vbigna2V5cHJlc3Mga2V5ZG93biBrZXl1cCBpbnB1dCBjaGFuZ2UgcGFzdGUnLCBudW1iZXJGaWx0ZXIpXHJcbiRkaWdpdHMub24oJ2tleXVwJywgaGFuZGxlRGlnaXRLZXl1cCk7XHJcblxyXG4kZGlnaXRzLmVxKDApLmZvY3VzKCk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBjbG9zZSBidXR0b25zLlxyXG4kKCcuc2NyZWVuIGhlYWRlciAuY2xvc2UtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IENsb3NpbmcgV2ViVmlldycpO1xyXG4gICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuY2xvc2VNb3ZpZVBheW1lbnQucG9zdE1lc3NhZ2UoXCJjbG9zZU1vdmllUGF5bWVudFwiKTtcclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBzaGFyZSBidXR0b24uXHJcbiQoJy5zaGFyZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogU2hhcmluZyB0aWNrZXQnKTtcclxuICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnNoYXJlVGlja2V0LnBvc3RNZXNzYWdlKFwic2hhcmVUaWNrZXRcIik7XHJcbn0pO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgbW92aWUgYnV0dG9uLlxyXG4kKCcubW92aWUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IFBsYXkgbW92aWUnKTtcclxuICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnBsYXlNb3ZpZS5wb3N0TWVzc2FnZShcInBsYXlNb3ZpZVwiKTtcclxufSk7XHJcbiJdfQ==

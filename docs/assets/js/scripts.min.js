"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(r){r.fn.swipe=function(e){var c=r.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var t=r(this),n=0,o=0,i=!1,s=t.find(".slider"),a=t.find(".text");s.on("mousedown touchstart",function(e){i=!0,o=t.width()-r(this).width()+10,n=e.clientX||e.originalEvent.touches[0].pageX}),r(document.body,s).on("mouseup touchend",function(e){if(i){if(i=!1,(e.clientX||e.changedTouches[0].pageX)-n<o)return a.fadeTo(300,1),void s.animate({left:"-10px"},300);c.cb()}}),r(document.body).on("mousemove touchmove",function(e){var t;i&&(e=1-(t=(e.clientX||e.originalEvent.touches[0].pageX)-n)/o,a.fadeTo(0,e),t<=0?s.css({left:"-10px"}):o+10<=t?s.css({left:o+"px"}):s.css({left:t-10}))})})}}(jQuery);var request={auth:function(e,t){var n={Authorization:"Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7"),"Content-Type":"application/x-www-form-urlencoded",Cookie:"XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"};request.send("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token","POST","grant_type=client_credentials",n,e,t)},pay:function(e,t,n,o,i){n=JSON.stringify(n);t.Authorization="Bearer "+e,request.send("https://apigateway.superappbaz.com/integracion/superapp/pagos/captacion/traspasos/v1/boton-pago","POST",n,t,o,i)},send:function(e,t,n,o,i,s){var a,c=new Headers;for(a in o)c.append(a,o[a]);fetch(e,{method:t,headers:c,body:n,redirect:"follow"}).then(function(e){return e.json()}).then(i).catch(s)}};function bind(o){$("[data-id]").each(function(){var e=$(this),t=e.data("id"),n=o[t];"precio"===t?e.html(formatAmount(n)):"saldo"===t?"false"===n&&setTimeout(function(){showAdvice(e,!0)},500):e.html(n)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,t){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),t()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var t=e.target,n=e.keyCode,o=$(t.parentNode);8===n?0<o.prev().length&&((e=o.prev().find("input")).val(""),e.focus()):47<n&&n<58&&""!==t.value&&0<o.next().length&&o.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function fakeRequest(e,t){setTimeout(function(){t("000001"===e)},1500)}function payMovie(e){function t(e){e="object"===_typeof(e)?e.message:e,console.log(JSON.stringify({message:e})),"webkit"in window&&window.webkit.messageHandlers.errorPaymentResponse.postMessage("errorPaymentResponse|"+JSON.stringify(e))}try{var n=JSON.parse(e);request.auth(function(e){"string"==typeof e.access_token?request.pay(e.access_token,n.headers,n.transaccion,function(e){"webkit"in window&&window.webkit.messageHandlers.paymentResponse.postMessage("paymentResponse|"+JSON.stringify(e))},t):t(e)},t)}catch(e){t(e)}}function searchToJson(){for(var e,t=location.search.substring(1).split("&"),n={},o=0;o<t.length;o++)""!==t[o]&&(e=t[o].split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return n}function showAdvice(e,t){t?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var t=$(".loader");e?(t.length<=0&&(t=$('<div class="loader">')),$("body").append(t),setTimeout(function(){return t.addClass("loader-visible")},10)):(t.removeClass("loader-visible"),setTimeout(function(){return t.remove()},375))}function validateCode(){var t=$(".auth-screen .code"),n=$(".auth-screen .digit input"),e="";n.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(t.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),t.addClass("invalid"),setTimeout(function(){n.each(function(){$(this).val("")}),n.eq(0).focus()},100))})):t.removeClass("valid invalid")}bind(searchToJson());var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),"webkit"in window&&window.webkit.messageHandlers.showDigitalSign.postMessage("showDigitalSign")},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),"webkit"in window&&window.webkit.messageHandlers.closeMoviePayment.postMessage("closeMoviePayment")}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),"webkit"in window&&window.webkit.messageHandlers.shareTicket.postMessage("shareTicket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),"webkit"in window&&window.webkit.messageHandlers.playMovie.postMessage("playMovie")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5zd2lwZS5qcyIsInJlcXVlc3QuanMiLCJzY3JpcHRzLmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCJjb25zb2xlIiwibG9nIiwidGhpcyIsImVhY2giLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsImZpbmQiLCIkdGV4dCIsIm9uIiwiZXZlbnQiLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJib2R5IiwiY2hhbmdlZFRvdWNoZXMiLCJmYWRlVG8iLCJhbmltYXRlIiwibGVmdCIsInJlbGF0aXZlTW91c2UiLCJzbGlkZVBlcmNlbnQiLCJjc3MiLCJqUXVlcnkiLCJyZXF1ZXN0IiwiYXV0aCIsInN1Y2Nlc3MiLCJlcnJvciIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYnRvYSIsIkNvbnRlbnQtVHlwZSIsIkNvb2tpZSIsInNlbmQiLCJwYXkiLCJhY2Nlc3NUb2tlbiIsInJhdyIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1cmwiLCJtZXRob2QiLCJqc29uSGVhZGVycyIsInByb3AiLCJIZWFkZXJzIiwiYXBwZW5kIiwiZmV0Y2giLCJyZWRpcmVjdCIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJiaW5kIiwidmFsdWVzIiwiJHRhZyIsImlkIiwiZGF0YSIsInZhbHVlIiwiaHRtbCIsImZvcm1hdEFtb3VudCIsInNldFRpbWVvdXQiLCJzaG93QWR2aWNlIiwiYmluZEZyb21TdHIiLCJzdHJKc29uIiwicGFyc2UiLCJlcnIiLCJjaGFuZ2VTY3JlZW4iLCIkc2NyZWVuIiwiY2FsbGJhY2siLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwiYW1vdW50IiwiTnVtYmVyIiwidG9GaXhlZCIsInJlcGxhY2UiLCJoYW5kbGVEaWdpdEtleXVwIiwiX3JlZiIsInRhcmdldCIsImtleUNvZGUiLCIkcGFyZW50IiwicGFyZW50Tm9kZSIsInByZXYiLCJsZW5ndGgiLCIkaW5wdXQiLCJ2YWwiLCJmb2N1cyIsIm5leHQiLCJ2YWxpZGF0ZUNvZGUiLCJudW1iZXJGaWx0ZXIiLCJ0ZXN0Iiwib2xkVmFsdWUiLCJvbGRTZWxlY3Rpb25TdGFydCIsInNlbGVjdGlvblN0YXJ0Iiwib2xkU2VsZWN0aW9uRW5kIiwic2VsZWN0aW9uRW5kIiwiaGFzT3duUHJvcGVydHkiLCJzZXRTZWxlY3Rpb25SYW5nZSIsImZha2VSZXF1ZXN0IiwiY29kZSIsInBheU1vdmllIiwiaGFuZGxlRXJyIiwibWVzc2FnZSIsIl90eXBlb2YiLCJ3aW5kb3ciLCJ3ZWJraXQiLCJtZXNzYWdlSGFuZGxlcnMiLCJlcnJvclBheW1lbnRSZXNwb25zZSIsInBvc3RNZXNzYWdlIiwiYXV0aFJlcyIsInBheVJlcyIsInBheW1lbnRSZXNwb25zZSIsInNlYXJjaFRvSnNvbiIsInBhcnRzIiwicGFpcnMiLCJsb2NhdGlvbiIsInNlYXJjaCIsInN1YnN0cmluZyIsInNwbGl0Iiwib2JqZWN0IiwiaSIsImRlY29kZVVSSUNvbXBvbmVudCIsIiRlbCIsImZsYWciLCJzaG93TG9hZGVyIiwic2hvdyIsIiRsb2FkZXIiLCJyZW1vdmUiLCIkY29kZSIsIiRkaWdpdHMiLCJlcSIsIiRhZHZpY2VzIiwiJGFkdmljZSIsInNob3dEaWdpdGFsU2lnbiIsImNsb3NlTW92aWVQYXltZW50Iiwic2hhcmVUaWNrZXQiLCJwbGF5TW92aWUiXSwibWFwcGluZ3MiOiIrUEFFQSxTQUFBQSxHQUNBQSxFQUFBQyxHQUFBQyxNQUFBLFNBQUFDLEdBQ0EsSUFBQUMsRUFBQUosRUFBQUssT0FBQSxDQUNBQyxHQUFBLFdBQ0FDLFFBQUFDLElBQUEsZ0JBRUFMLEdBRUEsT0FBQU0sS0FBQUMsS0FBQSxXQUNBLElBQUFDLEVBQUFYLEVBQUFTLE1BQ0FHLEVBQUEsRUFDQUMsRUFBQSxFQUNBQyxHQUFBLEVBQ0FDLEVBQUFK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NUgsS0FBQSxjQUVBRSxHQUFBLFFBQUEsV0FDQW9ELFdBQUFzRSxHQUFBLE9BSUE1SSxFQUFBLDZCQUFBRSxNQUFBLENBQ0FJLEdBQUEsV0FDQThILFlBQUEsR0FFQS9ELFdBQUEsV0FDQTlELFFBQUFDLElBQUEsaUNBRUEsV0FBQXdHLFFBQ0FBLE9BQUFDLE9BQUFDLGdCQUFBMkIsZ0JBQUF6QixZQUFBLG9CQUVBLFFBTUEsSUFBQXFCLFFBQUF6SSxFQUFBLDZCQUVBeUksUUFBQXZILEdBQUEsNENBQUErRSxjQUNBd0MsUUFBQXZILEdBQUEsUUFBQWtFLGtCQUVBcUQsUUFBQUMsR0FBQSxHQUFBNUMsUUFJQTlGLEVBQUEsNkJBQUFrQixHQUFBLFFBQUEsV0FDQVgsUUFBQUMsSUFBQSwrQkFFQSxXQUFBd0csUUFDQUEsT0FBQUMsT0FBQUMsZ0JBQUE0QixrQkFBQTFCLFlBQUEsdUJBTUFwSCxFQUFBLGNBQUFrQixHQUFBLFFBQUEsV0FDQVgsUUFBQUMsSUFBQSw4QkFFQSxXQUFBd0csUUFDQUEsT0FBQUMsT0FBQUMsZ0JBQUE2QixZQUFBM0IsWUFBQSxpQkFNQXBILEVBQUEsY0FBQWtCLEdBQUEsUUFBQSxXQUNBWCxRQUFBQyxJQUFBLDBCQUVBLFdBQUF3RyxRQUNBQSxPQUFBQyxPQUFBQyxnQkFBQThCLFVBQUE1QixZQUFBIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gUmVmZXJlbmNlOiBodHRwczovL2NvZGVwZW4uaW8vZ3ByZXNzdXR0bzUvcGVuL05qSm9iRz9lZGl0b3JzPTAwMTBcblxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJC5mbi5zd2lwZSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHtcbiAgICAgICAgICAgIGNiOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc3dpcGUgZG9uZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBvcHRpb25zKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgICAgICB2YXIgaW5pdGlhbE1vdXNlID0gMDtcbiAgICAgICAgICAgIHZhciBzbGlkZU1vdmVtZW50VG90YWwgPSAwO1xuICAgICAgICAgICAgdmFyIG1vdXNlSXNEb3duID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgJHNsaWRlciA9ICR0aGlzLmZpbmQoJy5zbGlkZXInKTtcbiAgICAgICAgICAgIHZhciAkdGV4dCA9ICR0aGlzLmZpbmQoJy50ZXh0Jyk7XG5cbiAgICAgICAgICAgICRzbGlkZXIub24oJ21vdXNlZG93biB0b3VjaHN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgbW91c2VJc0Rvd24gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHNsaWRlTW92ZW1lbnRUb3RhbCA9ICR0aGlzLndpZHRoKCkgLSAkKHRoaXMpLndpZHRoKCkgKyAxMDtcbiAgICAgICAgICAgICAgICBpbml0aWFsTW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXS5wYWdlWDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKGRvY3VtZW50LmJvZHksICRzbGlkZXIpLm9uKCdtb3VzZXVwIHRvdWNoZW5kJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFtb3VzZUlzRG93bilcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIG1vdXNlSXNEb3duID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVg7XG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0aXZlTW91c2UgPSBjdXJyZW50TW91c2UgLSBpbml0aWFsTW91c2U7XG5cbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA8IHNsaWRlTW92ZW1lbnRUb3RhbCkge1xuICAgICAgICAgICAgICAgICAgICAkdGV4dC5mYWRlVG8oMzAwLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IFwiLTEwcHhcIlxuICAgICAgICAgICAgICAgICAgICB9LCAzMDApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyogJHNsaWRlci5hZGRDbGFzcygndW5sb2NrZWQnKTtcbiAgICAgICAgICAgICAgICAkKCcjbG9ja2VyJykudGV4dCgnbG9ja19vdXRsaW5lJyk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIub24oJ2NsaWNrIHRhcCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2xpZGVyLmhhc0NsYXNzKCd1bmxvY2tlZCcpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzbGlkZXIucmVtb3ZlQ2xhc3MoJ3VubG9ja2VkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjbG9ja2VyJykudGV4dCgnbG9ja19vcGVuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLm9mZignY2xpY2sgdGFwJyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIDApOyAqL1xuXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuY2IoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKGRvY3VtZW50LmJvZHkpLm9uKCdtb3VzZW1vdmUgdG91Y2htb3ZlJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFtb3VzZUlzRG93bilcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VYO1xuICAgICAgICAgICAgICAgIHZhciByZWxhdGl2ZU1vdXNlID0gY3VycmVudE1vdXNlIC0gaW5pdGlhbE1vdXNlO1xuICAgICAgICAgICAgICAgIHZhciBzbGlkZVBlcmNlbnQgPSAxIC0gKHJlbGF0aXZlTW91c2UgLyBzbGlkZU1vdmVtZW50VG90YWwpO1xuXG4gICAgICAgICAgICAgICAgJHRleHQuZmFkZVRvKDAsIHNsaWRlUGVyY2VudCk7XG5cbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIuY3NzKHsgJ2xlZnQnOiAnLTEwcHgnIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlID49IHNsaWRlTW92ZW1lbnRUb3RhbCArIDEwKSB7XG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIuY3NzKHsgJ2xlZnQnOiBzbGlkZU1vdmVtZW50VG90YWwgKyAncHgnIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICRzbGlkZXIuY3NzKHsgJ2xlZnQnOiByZWxhdGl2ZU1vdXNlIC0gMTAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufSkoalF1ZXJ5KTtcbiIsImNvbnN0IHJlcXVlc3QgPSB7XG4gICAgLyoqXG4gICAgICogQXV0aGVudGljYXRlLlxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1Y2Nlc3NcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBlcnJvclxuICAgICAqL1xuICAgIGF1dGg6IGZ1bmN0aW9uIChzdWNjZXNzLCBlcnJvcikge1xuICAgICAgICBjb25zdCB1cmwgPSBcImh0dHBzOi8vb21tNm91ZzVwZy5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9kZXNhcnJvbGxvL29hdXRoMi92MS90b2tlblwiO1xuICAgICAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgICAgICAgXCJBdXRob3JpemF0aW9uXCI6IFwiQmFzaWMgXCIgKyBidG9hKFwiMThoOHZhbnZyaDRwdWkxbHJudGMxbmlsamZcIiArIFwiOlwiICsgXCIxZ2UzMWJoanJkazlkMGphMTRtZnQ4cWVwaTRjbGt0ODA1anFiMnN2cXZtYjRzbzF2NGc3XCIpLFxuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIixcbiAgICAgICAgICAgIFwiQ29va2llXCI6IFwiWFNSRi1UT0tFTj1iNGE1NGYxYi1hZmU1LTRhZWUtOWE3Ni0wMGY5MjA0MThiNmVcIlxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBib2R5ID0gXCJncmFudF90eXBlPWNsaWVudF9jcmVkZW50aWFsc1wiO1xuXG4gICAgICAgIHJlcXVlc3Quc2VuZCh1cmwsICdQT1NUJywgYm9keSwgaGVhZGVycywgc3VjY2VzcywgZXJyb3IpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBQYXkuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGFjY2Vzc1Rva2VuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGhlYWRlcnNcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYm9keVxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1Y2Nlc3NcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBlcnJvclxuICAgICAqL1xuICAgIHBheTogZnVuY3Rpb24gKGFjY2Vzc1Rva2VuLCBoZWFkZXJzLCBib2R5LCBzdWNjZXNzLCBlcnJvcikge1xuICAgICAgICBjb25zdCB1cmwgPSBcImh0dHBzOi8vYXBpZ2F0ZXdheS5zdXBlcmFwcGJhei5jb20vaW50ZWdyYWNpb24vc3VwZXJhcHAvcGFnb3MvY2FwdGFjaW9uL3RyYXNwYXNvcy92MS9ib3Rvbi1wYWdvXCI7XG4gICAgICAgIGNvbnN0IHJhdyA9IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xuXG4gICAgICAgIGhlYWRlcnNbXCJBdXRob3JpemF0aW9uXCJdID0gXCJCZWFyZXIgXCIgKyBhY2Nlc3NUb2tlbjtcbiAgICAgICAgcmVxdWVzdC5zZW5kKHVybCwgJ1BPU1QnLCByYXcsIGhlYWRlcnMsIHN1Y2Nlc3MsIGVycm9yKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTWFrZSByZXF1ZXN0LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBib2R5XG4gICAgICogQHBhcmFtIHtvYmplY3R9IGpzb25IZWFkZXJzIFxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1Y2Nlc3MgXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZXJyb3JcbiAgICAgKi9cbiAgICBzZW5kOiBmdW5jdGlvbiAodXJsLCBtZXRob2QsIGJvZHksIGpzb25IZWFkZXJzLCBzdWNjZXNzLCBlcnJvcikge1xuICAgICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcblxuICAgICAgICBmb3IgKGxldCBwcm9wIGluIGpzb25IZWFkZXJzKSB7XG4gICAgICAgICAgICBoZWFkZXJzLmFwcGVuZChwcm9wLCBqc29uSGVhZGVyc1twcm9wXSk7XG4gICAgICAgIH1cblxuICAgICAgICBmZXRjaCh1cmwsIHsgbWV0aG9kLCBoZWFkZXJzLCBib2R5LCByZWRpcmVjdDogJ2ZvbGxvdycgfSlcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcbiAgICAgICAgICAgIC50aGVuKHN1Y2Nlc3MpXG4gICAgICAgICAgICAuY2F0Y2goZXJyb3IpO1xuICAgIH1cbn07IiwiLyoqXG4gKiBCaW5kIEpTT04gdG8gSFRNTC5cbiAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXNcbiAqL1xuZnVuY3Rpb24gYmluZCh2YWx1ZXMpIHtcbiAgICBjb25zdCAkdGFncyA9ICQoJ1tkYXRhLWlkXScpO1xuXG4gICAgJHRhZ3MuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0ICR0YWcgPSAkKHRoaXMpO1xuICAgICAgICBjb25zdCBpZCA9ICR0YWcuZGF0YSgnaWQnKTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbaWRdO1xuXG4gICAgICAgIGlmIChpZCA9PT0gJ3ByZWNpbycpIHtcbiAgICAgICAgICAgICR0YWcuaHRtbChmb3JtYXRBbW91bnQodmFsdWUpKTtcbiAgICAgICAgfSBlbHNlIGlmIChpZCA9PT0gJ3NhbGRvJykge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSAnZmFsc2UnKSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHNob3dBZHZpY2UoJHRhZywgdHJ1ZSk7IH0sIDUwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkdGFnLmh0bWwodmFsdWUpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbi8qKlxuICogUGFyc2Ugc3RyaW5nIHRvIG9iamVjdCBhbmQgdGhlbiBiaW5kLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ckpzb24gXG4gKi9cbmZ1bmN0aW9uIGJpbmRGcm9tU3RyKHN0ckpzb24pIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShzdHJKc29uKTtcbiAgICAgICAgYmluZChqc29uKTtcbiAgICB9IGNhdGNoIChlcnIpIHsgY29uc29sZS5sb2coZXJyKTsgfVxufVxuXG4vKipcbiAqIENoYW5nZSBzY3JlZW4uXG4gKiBAcGFyYW0ge2pRdWVyeX0gJHNjcmVlblxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcbiAqL1xuZnVuY3Rpb24gY2hhbmdlU2NyZWVuKCRzY3JlZW4sIGNhbGxiYWNrKSB7XG4gICAgJCgnLnNjcmVlbicpLmFkZENsYXNzKCduby12aXNpYmxlJyk7XG4gICAgJHNjcmVlbi5yZW1vdmVDbGFzcygnbm8tdmlzaWJsZScpO1xuXG4gICAgY2FsbGJhY2soKTtcbn1cblxuLyoqXG4gKiBHZXQgYW1vdW50IHdpdGggY3VycmVuY3kgZm9ybWF0LlxuICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudCBcbiAqIEByZXR1cm5zIHtzdHJpbmd9XG4gKi9cbmZ1bmN0aW9uIGZvcm1hdEFtb3VudChhbW91bnQpIHtcbiAgICByZXR1cm4gJyQgJyArIE51bWJlcihhbW91bnQpLnRvRml4ZWQoMikucmVwbGFjZSgvXFxCKD89KFxcZHszfSkrKD8hXFxkKSkvZywgJywnKTtcbn1cblxuLyoqXG4gKiBIYW5kbGUgZGlnaXQga2V5dXAgZXZlbnQuXG4gKiBAcGFyYW0ge0tleWJvYXJkRXZlbnR9IGV2ZW50XG4gKi9cbmZ1bmN0aW9uIGhhbmRsZURpZ2l0S2V5dXAoeyB0YXJnZXQsIGtleUNvZGUgfSkge1xuICAgIGNvbnN0ICRwYXJlbnQgPSAkKHRhcmdldC5wYXJlbnROb2RlKTtcblxuICAgIGlmIChrZXlDb2RlID09PSA4KSB7XG4gICAgICAgIGlmICgkcGFyZW50LnByZXYoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCAkaW5wdXQgPSAkcGFyZW50LnByZXYoKS5maW5kKCdpbnB1dCcpO1xuXG4gICAgICAgICAgICAkaW5wdXQudmFsKCcnKTtcbiAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xuICAgICAgICB9XG5cbiAgICB9IGVsc2UgaWYgKGtleUNvZGUgPiA0NyAmJiBrZXlDb2RlIDwgNTgpIHtcbiAgICAgICAgaWYgKHRhcmdldC52YWx1ZSAhPT0gJycpIHtcbiAgICAgICAgICAgIGlmICgkcGFyZW50Lm5leHQoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJHBhcmVudC5uZXh0KCkuZmluZCgnaW5wdXQnKTtcbiAgICAgICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhbGlkYXRlQ29kZSgpO1xufVxuXG4vKipcbiAqIEFwcGx5IG51bWJlciBmaWx0ZXIuXG4gKiBAcGFyYW0ge0V2ZW50fSBldmVudFxuICovXG5mdW5jdGlvbiBudW1iZXJGaWx0ZXIoZXZlbnQpIHtcbiAgICBjb25zdCBmaWx0ZXIgPSAvXlxcZHswLDF9JC87XG5cbiAgICBpZiAoZmlsdGVyLnRlc3QodGhpcy52YWx1ZSkpIHtcbiAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uU3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICB0aGlzLm9sZFNlbGVjdGlvbkVuZCA9IHRoaXMuc2VsZWN0aW9uRW5kO1xuICAgIH0gZWxzZSBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eSgnb2xkVmFsdWUnKSkge1xuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb25SYW5nZSh0aGlzLm9sZFNlbGVjdGlvblN0YXJ0LCB0aGlzLm9sZFNlbGVjdGlvbkVuZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9ICcnO1xuICAgIH1cbn1cblxuLyoqXG4gKiBEbyBmYWtlIHJlcXVlc3QuXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xuICovXG5mdW5jdGlvbiBmYWtlUmVxdWVzdChjb2RlLCBjYWxsYmFjaykge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBjYWxsYmFjayhjb2RlID09PSAnMDAwMDAxJyk7XG4gICAgfSwgMTUwMCk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ckpzb25cbiAqL1xuZnVuY3Rpb24gcGF5TW92aWUoc3RySnNvbikge1xuICAgIGNvbnN0IGhhbmRsZUVyciA9IGVyciA9PiB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0eXBlb2YgZXJyID09PSAnb2JqZWN0JyA/IGVyci5tZXNzYWdlIDogZXJyO1xuICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2UgfSkpO1xuICAgICAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XG4gICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5lcnJvclBheW1lbnRSZXNwb25zZS5wb3N0TWVzc2FnZShcImVycm9yUGF5bWVudFJlc3BvbnNlfFwiICsgSlNPTi5zdHJpbmdpZnkobWVzc2FnZSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2Uoc3RySnNvbik7XG5cbiAgICAgICAgcmVxdWVzdC5hdXRoKGZ1bmN0aW9uIChhdXRoUmVzKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGF1dGhSZXNbJ2FjY2Vzc190b2tlbiddID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHJlcXVlc3QucGF5KGF1dGhSZXNbJ2FjY2Vzc190b2tlbiddLCBqc29uWydoZWFkZXJzJ10sIGpzb25bJ3RyYW5zYWNjaW9uJ10sIGZ1bmN0aW9uIChwYXlSZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCd3ZWJraXQnIGluIHdpbmRvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMucGF5bWVudFJlc3BvbnNlLnBvc3RNZXNzYWdlKFwicGF5bWVudFJlc3BvbnNlfFwiICsgSlNPTi5zdHJpbmdpZnkocGF5UmVzKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBoYW5kbGVFcnIpO1xuICAgICAgICAgICAgfSBlbHNlIHsgaGFuZGxlRXJyKGF1dGhSZXMpOyB9XG4gICAgICAgIH0sIGhhbmRsZUVycik7XG5cbiAgICB9IGNhdGNoIChlcnIpIHsgaGFuZGxlRXJyKGVycik7IH1cbn1cblxuLyoqXG4gKiBQYXJzZSBsb2NhdGlvbi5zZWFyY2ggdG8gSlNPTi5cbiAqIEByZXR1cm5zIG9iamVjdFxuICovXG5mdW5jdGlvbiBzZWFyY2hUb0pzb24oKSB7XG4gICAgY29uc3QgcGFpcnMgPSBsb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpLnNwbGl0KCcmJyk7XG4gICAgY29uc3Qgb2JqZWN0ID0ge307XG4gICAgbGV0IGkgPSAwO1xuXG4gICAgZm9yICg7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAocGFpcnNbaV0gPT09ICcnKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBhcnRzID0gcGFpcnNbaV0uc3BsaXQoJz0nKTtcbiAgICAgICAgb2JqZWN0W2RlY29kZVVSSUNvbXBvbmVudChwYXJ0c1swXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzFdKTtcbiAgICB9XG5cbiAgICByZXR1cm4gb2JqZWN0O1xufVxuXG4vKipcbiAqIFNob3cgb3IgaGlkZSBhZHZpY2UuXG4gKiBAcGFyYW0ge2pRdWVyeX0gJGVsIFxuICogQHBhcmFtIHtib29sZWFufSBmbGFnIFxuICovXG5mdW5jdGlvbiBzaG93QWR2aWNlKCRlbCwgZmxhZykge1xuICAgIGlmIChmbGFnKSB7XG4gICAgICAgICRlbC5hZGRDbGFzcygnbm8tdmlzaWJsZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgICRlbC5yZW1vdmVDbGFzcygnbm8tdmlzaWJsZScpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBTaG93IG9yIGhpZGUgbG9hZGVyLlxuICogQHBhcmFtIHtib29sZWFufSBzaG93XG4gKi9cbmZ1bmN0aW9uIHNob3dMb2FkZXIoc2hvdykge1xuICAgIGxldCAkbG9hZGVyID0gJCgnLmxvYWRlcicpO1xuXG4gICAgaWYgKHNob3cpIHtcbiAgICAgICAgaWYgKCRsb2FkZXIubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgICRsb2FkZXIgPSAkKCc8ZGl2IGNsYXNzPVwibG9hZGVyXCI+Jyk7XG4gICAgICAgIH1cblxuICAgICAgICAkKCdib2R5JykuYXBwZW5kKCRsb2FkZXIpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+ICRsb2FkZXIuYWRkQ2xhc3MoJ2xvYWRlci12aXNpYmxlJyksIDEwKTtcblxuICAgIH0gZWxzZSB7XG4gICAgICAgICRsb2FkZXIucmVtb3ZlQ2xhc3MoJ2xvYWRlci12aXNpYmxlJyk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gJGxvYWRlci5yZW1vdmUoKSwgMzc1KTtcblxuICAgIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBjb2RlIGZyb20gY2xpZW50LlxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlQ29kZSgpIHtcbiAgICBjb25zdCAkY29kZSA9ICQoJy5hdXRoLXNjcmVlbiAuY29kZScpO1xuICAgIGNvbnN0ICRkaWdpdHMgPSAkKCcuYXV0aC1zY3JlZW4gLmRpZ2l0IGlucHV0Jyk7XG4gICAgbGV0IGNvZGUgPSBcIlwiO1xuXG4gICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29kZSArPSB0aGlzLnZhbHVlO1xuICAgIH0pO1xuXG4gICAgaWYgKGNvZGUubGVuZ3RoID09PSA2KSB7XG4gICAgICAgIHNob3dMb2FkZXIodHJ1ZSk7XG5cbiAgICAgICAgZmFrZVJlcXVlc3QoY29kZSwgc3VjY2VzcyA9PiB7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCd2YWxpZCcpO1xuXG4gICAgICAgICAgICAgICAgY2hhbmdlU2NyZWVuKCQoJy5yZXN1bWUtc2NyZWVuJyksICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xuICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCdpbnZhbGlkJyk7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHsgJCh0aGlzKS52YWwoJycpOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lcSgwKS5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgICRjb2RlLnJlbW92ZUNsYXNzKCd2YWxpZCBpbnZhbGlkJyk7XG4gICAgfVxufVxuXG5cbi8vIEluaXRpYWxpemUgRGV0YWlsIFNjcmVlbiBjb21wb25lbnRzLlxuYmluZChzZWFyY2hUb0pzb24oKSk7XG5cbmNvbnN0ICRhZHZpY2VzID0gJCgnLmFkdmljZS5maXhlZCcpO1xuXG4kYWR2aWNlcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCAkYWR2aWNlID0gJCh0aGlzKTtcbiAgICBjb25zdCAkY2xvc2VCdG4gPSAkYWR2aWNlLmZpbmQoJy5jbG9zZS1idG4nKTtcblxuICAgICRjbG9zZUJ0bi5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNob3dBZHZpY2UoJGFkdmljZSwgZmFsc2UpO1xuICAgIH0pO1xufSk7XG5cbiQoJy5kZXRhaWwtc2NyZWVuIC5zd2lwZS1idG4nKS5zd2lwZSh7XG4gICAgY2I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2hvd0xvYWRlcih0cnVlKTtcblxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBPcGVuIGRpZ2l0YWwgc2lnbicpXG5cbiAgICAgICAgICAgIGlmICgnd2Via2l0JyBpbiB3aW5kb3cpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5zaG93RGlnaXRhbFNpZ24ucG9zdE1lc3NhZ2UoXCJzaG93RGlnaXRhbFNpZ25cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIDUwMCk7XG4gICAgfVxufSk7XG5cblxuLy8gSW5pdGlhbGl6ZSBBdXRoIFNjcmVlbiBjb21wb25lbnRzLlxuY29uc3QgJGRpZ2l0cyA9ICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKTtcblxuJGRpZ2l0cy5vbigna2V5cHJlc3Mga2V5ZG93biBrZXl1cCBpbnB1dCBjaGFuZ2UgcGFzdGUnLCBudW1iZXJGaWx0ZXIpXG4kZGlnaXRzLm9uKCdrZXl1cCcsIGhhbmRsZURpZ2l0S2V5dXApO1xuXG4kZGlnaXRzLmVxKDApLmZvY3VzKCk7XG5cblxuLy8gSW5pdGlhbGl6ZSBjbG9zZSBidXR0b25zLlxuJCgnLnNjcmVlbiBoZWFkZXIgLmNsb3NlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogQ2xvc2luZyBXZWJWaWV3Jyk7XG5cbiAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XG4gICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLmNsb3NlTW92aWVQYXltZW50LnBvc3RNZXNzYWdlKFwiY2xvc2VNb3ZpZVBheW1lbnRcIik7XG4gICAgfVxufSk7XG5cblxuLy8gSW5pdGlhbGl6ZSBzaGFyZSBidXR0b24uXG4kKCcuc2hhcmUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBTaGFyaW5nIHRpY2tldCcpO1xuXG4gICAgaWYgKCd3ZWJraXQnIGluIHdpbmRvdykge1xuICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5zaGFyZVRpY2tldC5wb3N0TWVzc2FnZShcInNoYXJlVGlja2V0XCIpO1xuICAgIH1cbn0pO1xuXG5cbi8vIEluaXRpYWxpemUgbW92aWUgYnV0dG9uLlxuJCgnLm1vdmllLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogUGxheSBtb3ZpZScpO1xuXG4gICAgaWYgKCd3ZWJraXQnIGluIHdpbmRvdykge1xuICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5wbGF5TW92aWUucG9zdE1lc3NhZ2UoXCJwbGF5TW92aWVcIik7XG4gICAgfVxufSk7XG4iXX0=

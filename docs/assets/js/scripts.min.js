"use strict";!function(c){c.fn.swipe=function(e){var r=c.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var n=c(this),o=0,t=0,s=!1,i=n.find(".slider"),a=n.find(".text");i.on("mousedown touchstart",function(e){s=!0,t=n.width()-c(this).width()+10,o=e.clientX||e.originalEvent.touches[0].pageX}),c(document.body,i).on("mouseup touchend",function(e){if(s){if(s=!1,(e.clientX||e.changedTouches[0].pageX)-o<t)return a.fadeTo(300,1),void i.animate({left:"-10px"},300);r.cb()}}),c(document.body).on("mousemove touchmove",function(e){var n;s&&(e=1-(n=(e.clientX||e.originalEvent.touches[0].pageX)-o)/t,a.fadeTo(0,e),n<=0?i.css({left:"-10px"}):t+10<=n?i.css({left:t+"px"}):i.css({left:n-10}))})})}}(jQuery);var request={auth:function(e,n){var o={Authorization:"Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7"),"Content-Type":"application/x-www-form-urlencoded",Cookie:"XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"};request.send("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token","POST","grant_type=client_credentials",o,e,n)},pay:function(e,n,o,t,s){o=o?"https://api.bazappgs.com/superapp/pagos/captacion/traspasos/v1/boton-pago":"https://apigateway.superappbaz.com/integracion/superapp/pagos/captacion/traspasos/v1/boton-pago",n=JSON.stringify(n);request.send(o,"POST",n,e,t,s)},send:function(e,n,o,t,s,i){var a,r=new Headers;for(a in t)r.append(a,t[a]);fetch(e,{method:n,headers:r,body:o,redirect:"follow"}).then(function(e){return e.json()}).then(s).catch(i)}},environment=!1;function bind(t){$("[data-id]").each(function(){var e=$(this),n=e.data("id"),o=t[n];"precio"===n?e.html(formatAmount(o)):"saldo"===n?"false"===o&&setTimeout(function(){showAdvice(e,!0)},500):e.html(o)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,n){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),n()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var n=e.target,o=e.keyCode,t=$(n.parentNode);8===o?0<t.prev().length&&((e=t.prev().find("input")).val(""),e.focus()):47<o&&o<58&&""!==n.value&&0<t.next().length&&t.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function fakeRequest(e,n){setTimeout(function(){n("000001"===e)},1500)}function payMovie(e){function n(e){console.log(JSON.stringify(e)),window.webkit.messageHandlers.errorPaymentResponse.postMessage("errorPaymentResponse|"+JSON.stringify(e))}try{var o=JSON.parse(e);window.webkit.messageHandlers.showLoader.postMessage("showLoader"),request.pay(o.headers,o.requestBody,environment,function(e){"201"==e.codigo?window.webkit.messageHandlers.paymentResponse.postMessage("paymentResponse|"+JSON.stringify({error:{code:0,data:e}})):n({error:{code:e.codigo,message:e.mensaje}}),window.webkit.messageHandlers.hideLoader.postMessage("hideLoader")},function(e){n({error:{code:500,message:e.message}}),window.webkit.messageHandlers.hideLoader.postMessage("hideLoader")})}catch(e){n({error:{code:500,message:e.message}})}}function searchToJson(){for(var e,n=location.search.substring(1).split("&"),o={},t=0;t<n.length;t++)""!==n[t]&&(e=n[t].split("="),o[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return o}function showAdvice(e,n){n?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var n=$(".loader");e?(n.length<=0&&(n=$('<div class="loader">')),$("body").append(n),setTimeout(function(){return n.addClass("loader-visible")},10)):(n.removeClass("loader-visible"),setTimeout(function(){return n.remove()},375))}function validateCode(){var n=$(".auth-screen .code"),o=$(".auth-screen .digit input"),e="";o.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(n.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),n.addClass("invalid"),setTimeout(function(){o.each(function(){$(this).val("")}),o.eq(0).focus()},100))})):n.removeClass("valid invalid")}var searchJson=searchToJson(),environment="true"===searchJson.environment;bind(searchJson);var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),window.webkit.messageHandlers.showDigitalSign.postMessage("showDigitalSign")},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),window.webkit.messageHandlers.closeMoviePayment.postMessage("closeMoviePayment")}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),window.webkit.messageHandlers.shareTicket.postMessage("shareTicket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),window.webkit.messageHandlers.playMovie.postMessage("playMovie")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5zd2lwZS5qcyIsInJlcXVlc3QuanMiLCJzY3JpcHRzLmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCJjb25zb2xlIiwibG9nIiwidGhpcyIsImVhY2giLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsImZpbmQiLCIkdGV4dCIsIm9uIiwiZXZlbnQiLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJib2R5IiwiY2hhbmdlZFRvdWNoZXMiLCJmYWRlVG8iLCJhbmltYXRlIiwibGVmdCIsInJlbGF0aXZlTW91c2UiLCJzbGlkZVBlcmNlbnQiLCJjc3MiLCJqUXVlcnkiLCJyZXF1ZXN0IiwiYXV0aCIsInN1Y2Nlc3MiLCJlcnJvciIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYnRvYSIsIkNvbnRlbnQtVHlwZSIsIkNvb2tpZSIsInNlbmQiLCJwYXkiLCJwcm9kdWN0aW9uIiwidXJsIiwicmF3IiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGhvZCIsImpzb25IZWFkZXJzIiwicHJvcCIsIkhlYWRlcnMiLCJhcHBlbmQiLCJmZXRjaCIsInJlZGlyZWN0IiwidGhlbiIsInJlc3BvbnNlIiwianNvbiIsImVudmlyb25tZW50IiwiYmluZCIsInZhbHVlcyIsIiR0YWciLCJpZCIsImRhdGEiLCJ2YWx1ZSIsImh0bWwiLCJmb3JtYXRBbW91bnQiLCJzZXRUaW1lb3V0Iiwic2hvd0FkdmljZSIsImJpbmRGcm9tU3RyIiwic3RySnNvbiIsInBhcnNlIiwiZXJyIiwiY2hhbmdlU2NyZWVuIiwiJHNjcmVlbiIsImNhbGxiYWNrIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsImFtb3VudCIsIk51bWJlciIsInRvRml4ZWQiLCJyZXBsYWNlIiwiaGFuZGxlRGlnaXRLZXl1cCIsIl9yZWYiLCJ0YXJnZXQiLCJrZXlDb2RlIiwiJHBhcmVudCIsInBhcmVudE5vZGUiLCJwcmV2IiwibGVuZ3RoIiwiJGlucHV0IiwidmFsIiwiZm9jdXMiLCJuZXh0IiwidmFsaWRhdGVDb2RlIiwibnVtYmVyRmlsdGVyIiwidGVzdCIsIm9sZFZhbHVlIiwib2xkU2VsZWN0aW9uU3RhcnQiLCJzZWxlY3Rpb25TdGFydCIsIm9sZFNlbGVjdGlvbkVuZCIsInNlbGVjdGlvbkVuZCIsImhhc093blByb3BlcnR5Iiwic2V0U2VsZWN0aW9uUmFuZ2UiLCJmYWtlUmVxdWVzdCIsImNvZGUiLCJwYXlNb3ZpZSIsImhhbmRsZUVyciIsIndpbmRvdyIsIndlYmtpdCIsIm1lc3NhZ2VIYW5kbGVycyIsImVycm9yUGF5bWVudFJlc3BvbnNlIiwicG9zdE1lc3NhZ2UiLCJzaG93TG9hZGVyIiwicGF5UmVzIiwiY29kaWdvIiwicGF5bWVudFJlc3BvbnNlIiwibWVzc2FnZSIsIm1lbnNhamUiLCJoaWRlTG9hZGVyIiwic2VhcmNoVG9Kc29uIiwicGFydHMiLCJwYWlycyIsImxvY2F0aW9uIiwic2VhcmNoIiwic3Vic3RyaW5nIiwic3BsaXQiLCJvYmplY3QiLCJpIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiJGVsIiwiZmxhZyIsInNob3ciLCIkbG9hZGVyIiwicmVtb3ZlIiwiJGNvZGUiLCIkZGlnaXRzIiwiZXEiLCJzZWFyY2hKc29uIiwiJGFkdmljZXMiLCIkYWR2aWNlIiwic2hvd0RpZ2l0YWxTaWduIiwiY2xvc2VNb3ZpZVBheW1lbnQiLCJzaGFyZVRpY2tldCIsInBsYXlNb3ZpZSJdLCJtYXBwaW5ncyI6ImNBRUEsU0FBQUEsR0FDQUEsRUFBQUMsR0FBQUMsTUFBQSxTQUFBQyxHQUNBLElBQUFDLEVBQUFKLEVBQUFLLE9BQUEsQ0FDQUMsR0FBQSxXQUNBQyxRQUFBQyxJQUFBLGdCQUVBTCxHQUVBLE9BQUFNLEtBQUFDLEtBQUEsV0FDQSxJQUFBQyxFQUFBWCxFQUFBUyxNQUNBRyxF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QUEsT0FHQUEsWUFBQSxHQUNBc0IsRUFBQTNELFNBQUEsV0FFQVQsV0FBQSxXQUNBcUUsRUFBQWpJLEtBQUEsV0FBQVYsRUFBQVMsTUFBQXFGLElBQUEsTUFDQTZDLEVBQUFDLEdBQUEsR0FBQTdDLFNBQ0EsU0FJQTJDLEVBQUExRCxZQUFBLGlCQU1BLElBQUE2RCxXQUFBbEIsZUFFQTlELFlBQUEsU0FBQWdGLFdBQUEsWUFDQS9FLEtBQUErRSxZQUVBLElBQUFDLFNBQUE5SSxFQUFBLGlCQUVBOEksU0FBQXBJLEtBQUEsV0FDQSxJQUFBcUksRUFBQS9JLEVBQUFTLE1BQ0FzSSxFQUFBL0gsS0FBQSxjQUVBRSxHQUFBLFFBQUEsV0FDQXFELFdBQUF3RSxHQUFBLE9BSUEvSSxFQUFBLDZCQUFBRSxNQUFBLENBQ0FJLEdBQUEsV0FDQThHLFlBQUEsR0FFQTlDLFdBQUEsV0FDQS9ELFFBQUFDLElBQUEsaUNBQ0F1RyxPQUFBQyxPQUFBQyxnQkFBQStCLGdCQUFBN0IsWUFBQSxvQkFDQSxRQU1BLElBQUF3QixRQUFBM0ksRUFBQSw2QkFFQTJJLFFBQUF6SCxHQUFBLDRDQUFBZ0YsY0FDQXlDLFFBQUF6SCxHQUFBLFFBQUFtRSxrQkFFQXNELFFBQUFDLEdBQUEsR0FBQTdDLFFBSUEvRixFQUFBLDZCQUFBa0IsR0FBQSxRQUFBLFdBQ0FYLFFBQUFDLElBQUEsK0JBQ0F1RyxPQUFBQyxPQUFBQyxnQkFBQWdDLGtCQUFBOUIsWUFBQSx1QkFLQW5ILEVBQUEsY0FBQWtCLEdBQUEsUUFBQSxXQUNBWCxRQUFBQyxJQUFBLDhCQUNBdUcsT0FBQUMsT0FBQUMsZ0JBQUFpQyxZQUFBL0IsWUFBQSxpQkFLQW5ILEVBQUEsY0FBQWtCLEdBQUEsUUFBQSxXQUNBWCxRQUFBQyxJQUFBLDBCQUNBdUcsT0FBQUMsT0FBQUMsZ0JBQUFrQyxVQUFBaEMsWUFBQSIsImZpbGUiOiJzY3JpcHRzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFJlZmVyZW5jZTogaHR0cHM6Ly9jb2RlcGVuLmlvL2dwcmVzc3V0dG81L3Blbi9OakpvYkc/ZWRpdG9ycz0wMDEwXHJcblxyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgICQuZm4uc3dpcGUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHtcclxuICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N3aXBlIGRvbmUnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgdmFyIGluaXRpYWxNb3VzZSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBzbGlkZU1vdmVtZW50VG90YWwgPSAwO1xyXG4gICAgICAgICAgICB2YXIgbW91c2VJc0Rvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyICRzbGlkZXIgPSAkdGhpcy5maW5kKCcuc2xpZGVyJyk7XHJcbiAgICAgICAgICAgIHZhciAkdGV4dCA9ICR0aGlzLmZpbmQoJy50ZXh0Jyk7XHJcblxyXG4gICAgICAgICAgICAkc2xpZGVyLm9uKCdtb3VzZWRvd24gdG91Y2hzdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgbW91c2VJc0Rvd24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgc2xpZGVNb3ZlbWVudFRvdGFsID0gJHRoaXMud2lkdGgoKSAtICQodGhpcykud2lkdGgoKSArIDEwO1xyXG4gICAgICAgICAgICAgICAgaW5pdGlhbE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVg7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5LCAkc2xpZGVyKS5vbignbW91c2V1cCB0b3VjaGVuZCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtb3VzZUlzRG93bilcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICBtb3VzZUlzRG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVg7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVsYXRpdmVNb3VzZSA9IGN1cnJlbnRNb3VzZSAtIGluaXRpYWxNb3VzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA8IHNsaWRlTW92ZW1lbnRUb3RhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICR0ZXh0LmZhZGVUbygzMDAsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIuYW5pbWF0ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IFwiLTEwcHhcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8qICRzbGlkZXIuYWRkQ2xhc3MoJ3VubG9ja2VkJyk7XHJcbiAgICAgICAgICAgICAgICAkKCcjbG9ja2VyJykudGV4dCgnbG9ja19vdXRsaW5lJyk7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLm9uKCdjbGljayB0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2xpZGVyLmhhc0NsYXNzKCd1bmxvY2tlZCcpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLnJlbW92ZUNsYXNzKCd1bmxvY2tlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjbG9ja2VyJykudGV4dCgnbG9ja19vcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzbGlkZXIub2ZmKCdjbGljayB0YXAnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0sIDApOyAqL1xyXG5cclxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmNiKCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKGRvY3VtZW50LmJvZHkpLm9uKCdtb3VzZW1vdmUgdG91Y2htb3ZlJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW1vdXNlSXNEb3duKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVg7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVsYXRpdmVNb3VzZSA9IGN1cnJlbnRNb3VzZSAtIGluaXRpYWxNb3VzZTtcclxuICAgICAgICAgICAgICAgIHZhciBzbGlkZVBlcmNlbnQgPSAxIC0gKHJlbGF0aXZlTW91c2UgLyBzbGlkZU1vdmVtZW50VG90YWwpO1xyXG5cclxuICAgICAgICAgICAgICAgICR0ZXh0LmZhZGVUbygwLCBzbGlkZVBlcmNlbnQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0JzogJy0xMHB4JyB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA+PSBzbGlkZU1vdmVtZW50VG90YWwgKyAxMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIuY3NzKHsgJ2xlZnQnOiBzbGlkZU1vdmVtZW50VG90YWwgKyAncHgnIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzbGlkZXIuY3NzKHsgJ2xlZnQnOiByZWxhdGl2ZU1vdXNlIC0gMTAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KShqUXVlcnkpO1xyXG4iLCJjb25zdCByZXF1ZXN0ID0ge1xyXG4gICAgLyoqXHJcbiAgICAgKiBBdXRoZW50aWNhdGUuXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBlcnJvclxyXG4gICAgICovXHJcbiAgICBhdXRoOiBmdW5jdGlvbiAoc3VjY2VzcywgZXJyb3IpIHtcclxuICAgICAgICBjb25zdCB1cmwgPSBcImh0dHBzOi8vb21tNm91ZzVwZy5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9kZXNhcnJvbGxvL29hdXRoMi92MS90b2tlblwiO1xyXG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSB7XHJcbiAgICAgICAgICAgIFwiQXV0aG9yaXphdGlvblwiOiBcIkJhc2ljIFwiICsgYnRvYShcIjE4aDh2YW52cmg0cHVpMWxybnRjMW5pbGpmXCIgKyBcIjpcIiArIFwiMWdlMzFiaGpyZGs5ZDBqYTE0bWZ0OHFlcGk0Y2xrdDgwNWpxYjJzdnF2bWI0c28xdjRnN1wiKSxcclxuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIixcclxuICAgICAgICAgICAgXCJDb29raWVcIjogXCJYU1JGLVRPS0VOPWI0YTU0ZjFiLWFmZTUtNGFlZS05YTc2LTAwZjkyMDQxOGI2ZVwiXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBib2R5ID0gXCJncmFudF90eXBlPWNsaWVudF9jcmVkZW50aWFsc1wiO1xyXG5cclxuICAgICAgICByZXF1ZXN0LnNlbmQodXJsLCAnUE9TVCcsIGJvZHksIGhlYWRlcnMsIHN1Y2Nlc3MsIGVycm9yKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQYXkuXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gaGVhZGVyc1xyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGJvZHlcclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gcHJvZHVjdGlvblxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2Vzc1xyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZXJyb3JcclxuICAgICAqL1xyXG4gICAgcGF5OiBmdW5jdGlvbiAoaGVhZGVycywgYm9keSwgcHJvZHVjdGlvbiwgc3VjY2VzcywgZXJyb3IpIHtcclxuICAgICAgICBjb25zdCB1cmwgPSBwcm9kdWN0aW9uIFxyXG4gICAgICAgICAgICA/IFwiaHR0cHM6Ly9hcGkuYmF6YXBwZ3MuY29tL3N1cGVyYXBwL3BhZ29zL2NhcHRhY2lvbi90cmFzcGFzb3MvdjEvYm90b24tcGFnb1wiXHJcbiAgICAgICAgICAgIC8vID8gXCJodHRwczovL2FwaS5iYXouYXBwL3N1cGVyYXBwL3BhZ29zL2NhcHRhY2lvbi90cmFzcGFzb3MvdjEvYm90b24tcGFnb1wiXHJcbiAgICAgICAgICAgIDogXCJodHRwczovL2FwaWdhdGV3YXkuc3VwZXJhcHBiYXouY29tL2ludGVncmFjaW9uL3N1cGVyYXBwL3BhZ29zL2NhcHRhY2lvbi90cmFzcGFzb3MvdjEvYm90b24tcGFnb1wiO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICBjb25zdCByYXcgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5zZW5kKHVybCwgJ1BPU1QnLCByYXcsIGhlYWRlcnMsIHN1Y2Nlc3MsIGVycm9yKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNYWtlIHJlcXVlc3QuXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIFxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZFxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGJvZHlcclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBqc29uSGVhZGVycyBcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1Y2Nlc3MgXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBlcnJvclxyXG4gICAgICovXHJcbiAgICBzZW5kOiBmdW5jdGlvbiAodXJsLCBtZXRob2QsIGJvZHksIGpzb25IZWFkZXJzLCBzdWNjZXNzLCBlcnJvcikge1xyXG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBwcm9wIGluIGpzb25IZWFkZXJzKSB7XHJcbiAgICAgICAgICAgIGhlYWRlcnMuYXBwZW5kKHByb3AsIGpzb25IZWFkZXJzW3Byb3BdKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZldGNoKHVybCwgeyBtZXRob2QsIGhlYWRlcnMsIGJvZHksIHJlZGlyZWN0OiAnZm9sbG93JyB9KVxyXG4gICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAgICAgICAgIC50aGVuKHN1Y2Nlc3MpXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnJvcik7XHJcbiAgICB9XHJcbn07IiwibGV0IGVudmlyb25tZW50ID0gZmFsc2U7XHJcblxyXG4vKipcclxuICogQmluZCBKU09OIHRvIEhUTUwuXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXNcclxuICovXHJcbmZ1bmN0aW9uIGJpbmQodmFsdWVzKSB7XHJcbiAgICBjb25zdCAkdGFncyA9ICQoJ1tkYXRhLWlkXScpO1xyXG5cclxuICAgICR0YWdzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0ICR0YWcgPSAkKHRoaXMpO1xyXG4gICAgICAgIGNvbnN0IGlkID0gJHRhZy5kYXRhKCdpZCcpO1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2lkXTtcclxuXHJcbiAgICAgICAgaWYgKGlkID09PSAncHJlY2lvJykge1xyXG4gICAgICAgICAgICAkdGFnLmh0bWwoZm9ybWF0QW1vdW50KHZhbHVlKSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChpZCA9PT0gJ3NhbGRvJykge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09ICdmYWxzZScpIHtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBzaG93QWR2aWNlKCR0YWcsIHRydWUpOyB9LCA1MDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJHRhZy5odG1sKHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFBhcnNlIHN0cmluZyB0byBvYmplY3QgYW5kIHRoZW4gYmluZC5cclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ckpzb24gXHJcbiAqL1xyXG5mdW5jdGlvbiBiaW5kRnJvbVN0cihzdHJKc29uKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHN0ckpzb24pO1xyXG4gICAgICAgIGJpbmQoanNvbik7XHJcbiAgICB9IGNhdGNoIChlcnIpIHsgY29uc29sZS5sb2coZXJyKTsgfVxyXG59XHJcblxyXG4vKipcclxuICogQ2hhbmdlIHNjcmVlbi5cclxuICogQHBhcmFtIHtqUXVlcnl9ICRzY3JlZW5cclxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcclxuICovXHJcbmZ1bmN0aW9uIGNoYW5nZVNjcmVlbigkc2NyZWVuLCBjYWxsYmFjaykge1xyXG4gICAgJCgnLnNjcmVlbicpLmFkZENsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICAkc2NyZWVuLnJlbW92ZUNsYXNzKCduby12aXNpYmxlJyk7XHJcblxyXG4gICAgY2FsbGJhY2soKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBhbW91bnQgd2l0aCBjdXJyZW5jeSBmb3JtYXQuXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBhbW91bnQgXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAqL1xyXG5mdW5jdGlvbiBmb3JtYXRBbW91bnQoYW1vdW50KSB7XHJcbiAgICByZXR1cm4gJyQgJyArIE51bWJlcihhbW91bnQpLnRvRml4ZWQoMikucmVwbGFjZSgvXFxCKD89KFxcZHszfSkrKD8hXFxkKSkvZywgJywnKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEhhbmRsZSBkaWdpdCBrZXl1cCBldmVudC5cclxuICogQHBhcmFtIHtLZXlib2FyZEV2ZW50fSBldmVudFxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlRGlnaXRLZXl1cCh7IHRhcmdldCwga2V5Q29kZSB9KSB7XHJcbiAgICBjb25zdCAkcGFyZW50ID0gJCh0YXJnZXQucGFyZW50Tm9kZSk7XHJcblxyXG4gICAgaWYgKGtleUNvZGUgPT09IDgpIHtcclxuICAgICAgICBpZiAoJHBhcmVudC5wcmV2KCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCAkaW5wdXQgPSAkcGFyZW50LnByZXYoKS5maW5kKCdpbnB1dCcpO1xyXG5cclxuICAgICAgICAgICAgJGlucHV0LnZhbCgnJyk7XHJcbiAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9IGVsc2UgaWYgKGtleUNvZGUgPiA0NyAmJiBrZXlDb2RlIDwgNTgpIHtcclxuICAgICAgICBpZiAodGFyZ2V0LnZhbHVlICE9PSAnJykge1xyXG4gICAgICAgICAgICBpZiAoJHBhcmVudC5uZXh0KCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJHBhcmVudC5uZXh0KCkuZmluZCgnaW5wdXQnKTtcclxuICAgICAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHZhbGlkYXRlQ29kZSgpO1xyXG59XHJcblxyXG4vKipcclxuICogQXBwbHkgbnVtYmVyIGZpbHRlci5cclxuICogQHBhcmFtIHtFdmVudH0gZXZlbnRcclxuICovXHJcbmZ1bmN0aW9uIG51bWJlckZpbHRlcihldmVudCkge1xyXG4gICAgY29uc3QgZmlsdGVyID0gL15cXGR7MCwxfSQvO1xyXG5cclxuICAgIGlmIChmaWx0ZXIudGVzdCh0aGlzLnZhbHVlKSkge1xyXG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xyXG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uU3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xyXG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uRW5kID0gdGhpcy5zZWxlY3Rpb25FbmQ7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoJ29sZFZhbHVlJykpIHtcclxuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcclxuICAgICAgICB0aGlzLnNldFNlbGVjdGlvblJhbmdlKHRoaXMub2xkU2VsZWN0aW9uU3RhcnQsIHRoaXMub2xkU2VsZWN0aW9uRW5kKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9ICcnO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogRG8gZmFrZSByZXF1ZXN0LlxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xyXG4gKi9cclxuZnVuY3Rpb24gZmFrZVJlcXVlc3QoY29kZSwgY2FsbGJhY2spIHtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGNhbGxiYWNrKGNvZGUgPT09ICcwMDAwMDEnKTtcclxuICAgIH0sIDE1MDApO1xyXG59XHJcblxyXG4vKipcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ckpzb25cclxuICovXHJcbmZ1bmN0aW9uIHBheU1vdmllKHN0ckpzb24pIHtcclxuICAgIGNvbnN0IGhhbmRsZUVyciA9IGVyciA9PiB7XHJcbiAgICAgICAgLy8gY29uc3QgbWVzc2FnZSA9IHR5cGVvZiBlcnIgPT09ICdvYmplY3QnID8gZXJyLm1lc3NhZ2UgOiBlcnI7XHJcbiAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoZXJyKSk7XHJcbiAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuZXJyb3JQYXltZW50UmVzcG9uc2UucG9zdE1lc3NhZ2UoXCJlcnJvclBheW1lbnRSZXNwb25zZXxcIiArIEpTT04uc3RyaW5naWZ5KGVycikpO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2Uoc3RySnNvbik7XHJcblxyXG4gICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnNob3dMb2FkZXIucG9zdE1lc3NhZ2UoXCJzaG93TG9hZGVyXCIpO1xyXG5cclxuICAgICAgICByZXF1ZXN0LnBheShqc29uWydoZWFkZXJzJ10sIGpzb25bJ3JlcXVlc3RCb2R5J10sIGVudmlyb25tZW50LCBmdW5jdGlvbiAocGF5UmVzKSB7XHJcbiAgICAgICAgICAgIGlmIChwYXlSZXMuY29kaWdvID09ICcyMDEnKSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5wYXltZW50UmVzcG9uc2UucG9zdE1lc3NhZ2UoXCJwYXltZW50UmVzcG9uc2V8XCIgKyBKU09OLnN0cmluZ2lmeSh7IGVycm9yOiB7IGNvZGU6IDAsIGRhdGE6IHBheVJlcyB9IH0pKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGhhbmRsZUVycih7IGVycm9yOiB7IGNvZGU6IHBheVJlcy5jb2RpZ28sIG1lc3NhZ2U6IHBheVJlcy5tZW5zYWplIH0gfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLmhpZGVMb2FkZXIucG9zdE1lc3NhZ2UoXCJoaWRlTG9hZGVyXCIpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgaGFuZGxlRXJyKHsgZXJyb3I6IHsgY29kZTogNTAwLCBtZXNzYWdlOiBlcnIubWVzc2FnZSB9IH0pO1xyXG4gICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5oaWRlTG9hZGVyLnBvc3RNZXNzYWdlKFwiaGlkZUxvYWRlclwiKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnIpIHsgaGFuZGxlRXJyKHsgZXJyb3I6IHsgY29kZTogNTAwLCBtZXNzYWdlOiBlcnIubWVzc2FnZSB9IH0pOyB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBQYXJzZSBsb2NhdGlvbi5zZWFyY2ggdG8gSlNPTi5cclxuICogQHJldHVybnMgb2JqZWN0XHJcbiAqL1xyXG5mdW5jdGlvbiBzZWFyY2hUb0pzb24oKSB7XHJcbiAgICBjb25zdCBwYWlycyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSkuc3BsaXQoJyYnKTtcclxuICAgIGNvbnN0IG9iamVjdCA9IHt9O1xyXG4gICAgbGV0IGkgPSAwO1xyXG5cclxuICAgIGZvciAoOyBpIDwgcGFpcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpZiAocGFpcnNbaV0gPT09ICcnKSB7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGFydHMgPSBwYWlyc1tpXS5zcGxpdCgnPScpO1xyXG4gICAgICAgIG9iamVjdFtkZWNvZGVVUklDb21wb25lbnQocGFydHNbMF0pXSA9IGRlY29kZVVSSUNvbXBvbmVudChwYXJ0c1sxXSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG9iamVjdDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNob3cgb3IgaGlkZSBhZHZpY2UuXHJcbiAqIEBwYXJhbSB7alF1ZXJ5fSAkZWwgXHJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gZmxhZyBcclxuICovXHJcbmZ1bmN0aW9uIHNob3dBZHZpY2UoJGVsLCBmbGFnKSB7XHJcbiAgICBpZiAoZmxhZykge1xyXG4gICAgICAgICRlbC5hZGRDbGFzcygnbm8tdmlzaWJsZScpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkZWwucmVtb3ZlQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFNob3cgb3IgaGlkZSBsb2FkZXIuXHJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gc2hvd1xyXG4gKi9cclxuZnVuY3Rpb24gc2hvd0xvYWRlcihzaG93KSB7XHJcbiAgICBsZXQgJGxvYWRlciA9ICQoJy5sb2FkZXInKTtcclxuXHJcbiAgICBpZiAoc2hvdykge1xyXG4gICAgICAgIGlmICgkbG9hZGVyLmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgICRsb2FkZXIgPSAkKCc8ZGl2IGNsYXNzPVwibG9hZGVyXCI+Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkKCdib2R5JykuYXBwZW5kKCRsb2FkZXIpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gJGxvYWRlci5hZGRDbGFzcygnbG9hZGVyLXZpc2libGUnKSwgMTApO1xyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGxvYWRlci5yZW1vdmVDbGFzcygnbG9hZGVyLXZpc2libGUnKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+ICRsb2FkZXIucmVtb3ZlKCksIDM3NSk7XHJcblxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogVmFsaWRhdGUgY29kZSBmcm9tIGNsaWVudC5cclxuICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAqL1xyXG5mdW5jdGlvbiB2YWxpZGF0ZUNvZGUoKSB7XHJcbiAgICBjb25zdCAkY29kZSA9ICQoJy5hdXRoLXNjcmVlbiAuY29kZScpO1xyXG4gICAgY29uc3QgJGRpZ2l0cyA9ICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKTtcclxuICAgIGxldCBjb2RlID0gXCJcIjtcclxuXHJcbiAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvZGUgKz0gdGhpcy52YWx1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChjb2RlLmxlbmd0aCA9PT0gNikge1xyXG4gICAgICAgIHNob3dMb2FkZXIodHJ1ZSk7XHJcblxyXG4gICAgICAgIGZha2VSZXF1ZXN0KGNvZGUsIHN1Y2Nlc3MgPT4ge1xyXG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ3ZhbGlkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgY2hhbmdlU2NyZWVuKCQoJy5yZXN1bWUtc2NyZWVuJyksICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAkY29kZS5hZGRDbGFzcygnaW52YWxpZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICRkaWdpdHMuZWFjaChmdW5jdGlvbiAoKSB7ICQodGhpcykudmFsKCcnKTsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lcSgwKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkY29kZS5yZW1vdmVDbGFzcygndmFsaWQgaW52YWxpZCcpO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBEZXRhaWwgU2NyZWVuIGNvbXBvbmVudHMuXHJcbmNvbnN0IHNlYXJjaEpzb24gPSBzZWFyY2hUb0pzb24oKTtcclxuXHJcbmVudmlyb25tZW50ID0gc2VhcmNoSnNvblsnZW52aXJvbm1lbnQnXSA9PT0gJ3RydWUnO1xyXG5iaW5kKHNlYXJjaEpzb24pO1xyXG5cclxuY29uc3QgJGFkdmljZXMgPSAkKCcuYWR2aWNlLmZpeGVkJyk7XHJcblxyXG4kYWR2aWNlcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0ICRhZHZpY2UgPSAkKHRoaXMpO1xyXG4gICAgY29uc3QgJGNsb3NlQnRuID0gJGFkdmljZS5maW5kKCcuY2xvc2UtYnRuJyk7XHJcblxyXG4gICAgJGNsb3NlQnRuLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBzaG93QWR2aWNlKCRhZHZpY2UsIGZhbHNlKTtcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbiQoJy5kZXRhaWwtc2NyZWVuIC5zd2lwZS1idG4nKS5zd2lwZSh7XHJcbiAgICBjYjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNob3dMb2FkZXIodHJ1ZSk7XHJcblxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogT3BlbiBkaWdpdGFsIHNpZ24nKTtcclxuICAgICAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuc2hvd0RpZ2l0YWxTaWduLnBvc3RNZXNzYWdlKFwic2hvd0RpZ2l0YWxTaWduXCIpO1xyXG4gICAgICAgIH0sIDUwMCk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgQXV0aCBTY3JlZW4gY29tcG9uZW50cy5cclxuY29uc3QgJGRpZ2l0cyA9ICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKTtcclxuXHJcbiRkaWdpdHMub24oJ2tleXByZXNzIGtleWRvd24ga2V5dXAgaW5wdXQgY2hhbmdlIHBhc3RlJywgbnVtYmVyRmlsdGVyKVxyXG4kZGlnaXRzLm9uKCdrZXl1cCcsIGhhbmRsZURpZ2l0S2V5dXApO1xyXG5cclxuJGRpZ2l0cy5lcSgwKS5mb2N1cygpO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgY2xvc2UgYnV0dG9ucy5cclxuJCgnLnNjcmVlbiBoZWFkZXIgLmNsb3NlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBDbG9zaW5nIFdlYlZpZXcnKTtcclxuICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLmNsb3NlTW92aWVQYXltZW50LnBvc3RNZXNzYWdlKFwiY2xvc2VNb3ZpZVBheW1lbnRcIik7XHJcbn0pO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgc2hhcmUgYnV0dG9uLlxyXG4kKCcuc2hhcmUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IFNoYXJpbmcgdGlja2V0Jyk7XHJcbiAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5zaGFyZVRpY2tldC5wb3N0TWVzc2FnZShcInNoYXJlVGlja2V0XCIpO1xyXG59KTtcclxuXHJcblxyXG4vLyBJbml0aWFsaXplIG1vdmllIGJ1dHRvbi5cclxuJCgnLm1vdmllLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBQbGF5IG1vdmllJyk7XHJcbiAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5wbGF5TW92aWUucG9zdE1lc3NhZ2UoXCJwbGF5TW92aWVcIik7XHJcbn0pO1xyXG4iXX0=

"use strict";function ownKeys(o,e){var a,t=Object.keys(o);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(o),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})),t.push.apply(t,a)),t}function _objectSpread(o){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(a),!0).forEach(function(e){_defineProperty(o,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(a,e))})}return o}function _defineProperty(e,o,a){return o in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e}var globalIdPelicula,globalImagenPelicula,globalNombrePelicula,globalNumeroCuentaClienteCadenaBaz,globalBotonPago,globalCompras,globalTokenOperacion,globalHeaders,request={buyMovie:function(e,o,a,t,n){request.send("https://apigateway.superappbaz.com/integracion/superapp/diversion/gestion-peliculas/v1/peliculas/"+e+"/compras","POST",o,a,t)},movieById:function(e,o,a){request.send("https://apigateway.superappbaz.com/integracion/superapp/canal/clientes/gestion-sesiones/v1/portal/operaciones/"+e,"GET",void 0,{"x-sicu":"3bad1290ac4600a569162efaa09117ea","x-id-interaccion":"123e4567-e89b-12d3-a456-426655440000","x-token-usuario":"SRfVZrTYvdm7mzzZmcuiDViACkAx"},o,a)},paymentButton:function(e,o,a,t){request.send("https://apigateway.superappbaz.com/integracion/superapp/pagos/captacion/traspasos/v1/boton-pago","POST",e,o,a,t)},send:function(e,o,a,t,n,i){$.ajax({url:e,method:o,contentType:"application/json",processData:!1,headers:t,data:JSON.stringify(a),success:n,error:i})}};function bind(t){$("[data-id]").each(function(){var e=$(this),o=e.data("id"),a=t[o];"precio"===o?e.html(formatAmount(a)):"saldo"===o?"false"===a&&setTimeout(function(){showAdvice(e,!0)},500):e.html(a)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,o){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),"function"==typeof o&&o()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var o=e.target,a=e.keyCode,t=$(o.parentNode);8===a?0<t.prev().length&&((e=t.prev().find("input")).val(""),e.focus()):47<a&&a<58&&""!==o.value&&0<t.next().length&&t.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function fakeRequest(e,o){setTimeout(function(){o("000001"===e)},1500)}function searchToJson(){for(var e,o=location.search.substring(1).split("&"),a={},t=0;t<o.length;t++)""!==o[t]&&(e=o[t].split("="),a[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return a}function showAdvice(e,o){o?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var o=$(".loader");e?(o.length<=0&&(o=$('<div class="loader">')),$("body").append(o),setTimeout(function(){return o.addClass("loader-visible")},10)):(o.removeClass("loader-visible"),setTimeout(function(){return o.remove()},375))}function showErrorScreen(e,o,a){var t=e.responseJSON,e=t.folio,t=t.mensaje;$(".error-screen").find('[data-id="mensaje"]').text(t),$(".error-screen").find('[data-id="folio"]').text(e),changeScreen($(".error-screen")),showLoader(!1)}function validateCode(){var o=$(".auth-screen .code"),a=$(".auth-screen .digit input"),e="";a.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(o.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),o.addClass("invalid"),setTimeout(function(){a.each(function(){$(this).val("")}),a.eq(0).focus()},100))})):o.removeClass("valid invalid")}var searchJson=searchToJson();showLoader(!0),request.movieById(searchJson.idOperacion,function(c){console.log("%o",c),changeScreen($(".detail-screen"),function(){var e=c.resultado,o=e.datosFlujo,a=o.idPelicula,t=o.imagenPelicula,n=o.nombrePelicula,i=o.numeroCuentaClienteCadenaBaz,r=o.botonPago,s=o.compras,o=o.tokenOperacion,e=e.headers;globalIdPelicula=a,globalImagenPelicula=t,globalNombrePelicula=n,globalNumeroCuentaClienteCadenaBaz=i,globalBotonPago=r.transaccion,globalCompras=s.transaccion,globalTokenOperacion=o,globalHeaders=e,$(".detail-screen").find('[data-id="nombre"]').text(globalNombrePelicula),$(".detail-screen").find('[data-id="precio"]').text(formatAmount(globalBotonPago.detallePago.montoEnvio)),$(".detail-screen").find('[data-id="tarjeta"]').text(globalNumeroCuentaClienteCadenaBaz),showLoader(!1)})},showErrorScreen);var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".rent-button").on("click",function(){console.log("scripts.js: Click rent button.");var e=_objectSpread({},globalHeaders),n=_objectSpread({},globalHeaders);delete n["x-id-operacion-conciliacion"],showLoader(!0),request.paymentButton({transaccion:_objectSpread(_objectSpread({},globalBotonPago),{},{tokenOperacion:globalTokenOperacion})},e,function(e){console.log("scripts.js: Payment button. %o",e);var o=e.resultado,a=o.fechaOperacion,t=o.horaOperacion;request.buyMovie(globalIdPelicula,{transaccion:_objectSpread(_objectSpread({},globalCompras),{},{fechaOperacion:e.resultado.fechaOperacion,numeroMovimiento:e.resultado.numeroMovimiento})},n,function(e){console.log("scripts.js: Buy movie. %o",e);e=e.folio;$(".resume-screen").find('[data-id="fecha"]').text("".concat(a,", ").concat(t)),$(".resume-screen").find('[data-id="precio"]').text(formatAmount(globalBotonPago.detallePago.montoEnvio)),$(".resume-screen").find('[data-id="tarjeta"]').text(globalNumeroCuentaClienteCadenaBaz),$(".resume-screen").find('[data-id="nombre"]').text(globalNombrePelicula),$(".resume-screen").find('[data-id="precio"]').text(formatAmount(globalBotonPago.detallePago.montoEnvio)),$(".resume-screen").find('[data-id="folio"]').text(e),$(".resume-screen").find(".see-movie-href").attr("href","intent://?verPelicula?data=".concat(btoa(globalIdPelicula),"#Intent;scheme=sappdl;action=android.intent.action.VIEW;S.browser_fallback_url=https%3A%2F%2Fplay.google.com/store/apps/details?id=mx.app.baz.superapp;end")),changeScreen($(".resume-screen")),showLoader(!1)},showErrorScreen)},showErrorScreen)});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlcXVlc3QuanMiLCJzY3JpcHRzLmpzIl0sIm5hbWVzIjpbImdsb2JhbElkUGVsaWN1bGEiLCJnbG9iYWxJbWFnZW5QZWxpY3VsYSIsImdsb2JhbE5vbWJyZVBlbGljdWxhIiwiZ2xvYmFsTnVtZXJvQ3VlbnRhQ2xpZW50ZUNhZGVuYUJheiIsImdsb2JhbEJvdG9uUGFnbyIsImdsb2JhbENvbXByYXMiLCJnbG9iYWxUb2tlbk9wZXJhY2lvbiIsImdsb2JhbEhlYWRlcnMiLCJyZXF1ZXN0IiwiYnV5TW92aWUiLCJpZE1vdmllIiwiYm9keSIsImhlYWRlcnMiLCJzdWNjZXNzIiwiZXJyb3IiLCJzZW5kIiwibW92aWVCeUlkIiwiaWRPcGVyYXRpb24iLCJ1bmRlZmluZWQiLCJ4LXNpY3UiLCJ4LWlkLWludGVyYWNjaW9uIiwieC10b2tlbi11c3VhcmlvIiwicGF5bWVudEJ1dHRvbiIsInVybCIsIm1ldGhvZCIsImpzb25IZWFkZXJzIiwiJCIsImFqYXgiLCJjb250ZW50VHlwZSIsInByb2Nlc3NEYXRhIiwiZGF0YSIsIkpTT04iLCJzdHJpbmdpZnkiLCJiaW5kIiwidmFsdWVzIiwiZWFjaCIsIiR0YWciLCJ0aGlzIiwiaWQiLCJ2YWx1ZSIsImh0bWwiLCJmb3JtYXRBbW91bnQiLCJzZXRUaW1lb3V0Iiwic2hvd0FkdmljZSIsImJpbmRGcm9tU3RyIiwic3RySnNvbiIsInBhcnNlIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImNoYW5nZVNjcmVlbiIsIiRzY3JlZW4iLCJjYWxsYmFjayIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJhbW91bnQiLCJOdW1iZXIiLCJ0b0ZpeGVkIiwicmVwbGFjZSIsImhhbmRsZURpZ2l0S2V5dXAiLCJfcmVmIiwidGFyZ2V0Iiwia2V5Q29kZSIsIiRwYXJlbnQiLCJwYXJlbnROb2RlIiwicHJldiIsImxlbmd0aCIsIiRpbnB1dCIsImZpbmQiLCJ2YWwiLCJmb2N1cyIsIm5leHQiLCJ2YWxpZGF0ZUNvZGUiLCJudW1iZXJGaWx0ZXIiLCJldmVudCIsInRlc3QiLCJvbGRWYWx1ZSIsIm9sZFNlbGVjdGlvblN0YXJ0Iiwic2VsZWN0aW9uU3RhcnQiLCJvbGRTZWxlY3Rpb25FbmQiLCJzZWxlY3Rpb25FbmQiLCJoYXNPd25Qcm9wZXJ0eSIsInNldFNlbGVjdGlvblJhbmdlIiwiZmFrZVJlcXVlc3QiLCJjb2RlIiwic2VhcmNoVG9Kc29uIiwicGFydHMiLCJwYWlycyIsImxvY2F0aW9uIiwic2VhcmNoIiwic3Vic3RyaW5nIiwic3BsaXQiLCJvYmplY3QiLCJpIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiJGVsIiwiZmxhZyIsInNob3dMb2FkZXIiLCJzaG93IiwiJGxvYWRlciIsImFwcGVuZCIsInJlbW92ZSIsInNob3dFcnJvclNjcmVlbiIsImpxWEhSIiwidGV4dFN0YXR1cyIsImVycm9yVGhyb3duIiwiX2pxWEhSJHJlc3BvbnNlSlNPTiIsInJlc3BvbnNlSlNPTiIsImZvbGlvIiwibWVuc2FqZSIsInRleHQiLCIkY29kZSIsIiRkaWdpdHMiLCJlcSIsInNlYXJjaEpzb24iLCJfZGF0YSRyZXN1bHRhZG8iLCJyZXN1bHRhZG8iLCJfZGF0YSRyZXN1bHRhZG8kZGF0b3MiLCJkYXRvc0ZsdWpvIiwiaWRQZWxpY3VsYSIsImltYWdlblBlbGljdWxhIiwibm9tYnJlUGVsaWN1bGEiLCJudW1lcm9DdWVudGFDbGllbnRlQ2FkZW5hQmF6IiwiYm90b25QYWdvIiwiY29tcHJhcyIsInRva2VuT3BlcmFjaW9uIiwidHJhbnNhY2Npb24iLCJkZXRhbGxlUGFnbyIsIm1vbnRvRW52aW8iLCIkYWR2aWNlcyIsIiRhZHZpY2UiLCJvbiIsInBheW1lbnRCdXR0b25IZWFkZXJzIiwiX29iamVjdFNwcmVhZCIsImJ1eU1vdmllSGVhZGVycyIsIl9kYXRhJHJlc3VsdGFkbzIiLCJmZWNoYU9wZXJhY2lvbiIsImhvcmFPcGVyYWNpb24iLCJudW1lcm9Nb3ZpbWllbnRvIiwiY29uY2F0IiwiYXR0ciIsImJ0b2EiXSwibWFwcGluZ3MiOiJxdkJBQUEsSUNBQUEsaUJBQUFDLHFCQUFBQyxxQkFBQUMsbUNBQUFDLGdCQUFBQyxjQUFBQyxxQkFBQUMsY0RBQUMsUUFBQSxDQVVBQyxTQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFOLFFBQUFPLEtBREEsb0dBQUFMLEVBQUEsV0FDQSxPQUFBQyxFQUFBQyxFQUFBQyxJQU9BRyxVQUFBLFNBQUFDLEVBQUFKLEVBQUFDLEdBRUFOLFFBQUFPLEtBREEsaUhBQUFFLEVBQ0EsV0FBQUMsRUFBQSxDQUNBQyxTQUFBLG1DQUNBQyxtQkFBQSx1Q0FDQUMsa0JBQUEsZ0NBQ0FSLEVBQUFDLElBVUFRLGNBQUEsU0FBQVgsRUFBQUMsRUFBQUMsRUFBQUMsR0FFQU4sUUFBQU8sS0FEQSxrR0FDQSxPQUFBSixFQUFBQyxFQUFBQyxFQUFBQyxJQVlBQyxLQUFBLFNBQUFRLEVBQUFDLEVBQUFiLEVBQUFjLEVBQUFaLEVBQUFDLEdBQ0FZLEVBQUFDLEtBQUEsQ0FDQUosSUFBQUEsRUFDQUMsT0FBQUEsRUFDQUksWUFBQSxtQkFDQUMsYUFBQSxFQUNBakIsUUFBQWEsRUFDQUssS0FBQUMsS0FBQUMsVUFBQXJCLEdBQ0FFLFFBQUFBLEVBQ0FDLE1BQUFBLE1DcERBLFNBQUFtQixLQUFBQyxHQUNBUixFQUFBLGFBRUFTLEtBQUEsV0FDQSxJQUFBQyxFQUFBVixFQUFBVyxNQUNBQyxFQUFBRixFQUFBTixLQUFBLE1BQ0FTLEVBQUFMLEVBQUFJLEdBRUEsV0FBQUEsRUFDQUYsRUFBQUksS0FBQUMsYUFBQUYsSUFDQSxVQUFBRCxFQUNBLFVBQUFDLEdBQ0FHLFdBQUEsV0FBQUMsV0FBQVAsR0FBQSxJQUFBLEtBR0FBLEVBQUFJLEtBQUFELEtBU0EsU0FBQUssWUFBQUMsR0FDQSxJQUVBWixLQURBRixLQUFBZSxNQUFBRCxJQUVBLE1BQUFFLEdBQUFDLFFBQUFDLElBQUFGLElBUUEsU0FBQUcsYUFBQUMsRUFBQUMsR0FDQTFCLEVBQUEsV0FBQTJCLFNBQUEsY0FDQUYsRUFBQUcsWUFBQSxjQUVBLG1CQUFBRixHQUFBQSxJQVFBLFNBQUFYLGFBQUFjLEdBQ0EsTUFBQSxLQUFBQyxPQUFBRCxHQUFBRSxRQUFBLEdBQUFDLFFBQUEsd0JBQUEsS0FPQSxTQUFBQyxpQkFBQUMsR0FBQSxJQUFBQyxFQUFBRCxFQUFBQyxPQUFBQyxFQUFBRixFQUFBRSxRQUNBQyxFQUFBckMsRUFBQW1DLEVBQUFHLFlBRUEsSUFBQUYsRUFDQSxFQUFBQyxFQUFBRSxPQUFBQyxVQUNBQyxFQUFBSixFQUFBRSxPQUFBRyxLQUFBLFVBRUFDLElBQUEsSUFDQUYsRUFBQUcsU0FHQSxHQUFBUixHQUFBQSxFQUFBLElBQ0EsS0FBQUQsRUFBQXRCLE9BQ0EsRUFBQXdCLEVBQUFRLE9BQUFMLFFBQ0FILEVBQUFRLE9BQUFILEtBQUEsU0FDQUUsUUFLQUUsZUFPQSxTQUFBQyxhQUFBQyxHQUNBLFlBRUFDLEtBQUF0QyxLQUFBRSxRQUNBRixLQUFBdUMsU0FBQXZDLEtBQUFFLE1BQ0FGLEtBQUF3QyxrQkFBQXhDLEtBQUF5QyxlQUNBekMsS0FBQTBDLGdCQUFBMUMsS0FBQTJDLGNBQ0EzQyxLQUFBNEMsZUFBQSxhQUNBNUMsS0FBQUUsTUFBQUYsS0FBQXVDLFNBQ0F2QyxLQUFBNkMsa0JBQUE3QyxLQUFBd0Msa0JBQUF4QyxLQUFBMEMsa0JBRUExQyxLQUFBRSxNQUFBLEdBUUEsU0FBQTRDLFlBQUFDLEVBQUFoQyxHQUNBVixXQUFBLFdBQ0FVLEVBQUEsV0FBQWdDLElBQ0EsTUFPQSxTQUFBQyxlQUtBLElBSkEsSUFTQUMsRUFUQUMsRUFBQUMsU0FBQUMsT0FBQUMsVUFBQSxHQUFBQyxNQUFBLEtBQ0FDLEVBQUEsR0FDQUMsRUFBQSxFQUVBQSxFQUFBTixFQUFBckIsT0FBQTJCLElBQ0EsS0FBQU4sRUFBQU0sS0FJQVAsRUFBQUMsRUFBQU0sR0FBQUYsTUFBQSxLQUNBQyxFQUFBRSxtQkFBQVIsRUFBQSxLQUFBUSxtQkFBQVIsRUFBQSxLQUdBLE9BQUFNLEVBUUEsU0FBQWpELFdBQUFvRCxFQUFBQyxHQUNBQSxFQUNBRCxFQUFBMUMsU0FBQSxjQUVBMEMsRUFBQXpDLFlBQUEsY0FRQSxTQUFBMkMsV0FBQUMsR0FDQSxJQUFBQyxFQUFBekUsRUFBQSxXQUVBd0UsR0FDQUMsRUFBQWpDLFFBQUEsSUFDQWlDLEVBQUF6RSxFQUFBLHlCQUdBQSxFQUFBLFFBQUEwRSxPQUFBRCxHQUNBekQsV0FBQSxXQUFBLE9BQUF5RCxFQUFBOUMsU0FBQSxtQkFBQSxNQUdBOEMsRUFBQTdDLFlBQUEsa0JBQ0FaLFdBQUEsV0FBQSxPQUFBeUQsRUFBQUUsVUFBQSxNQVdBLFNBQUFDLGdCQUFBQyxFQUFBQyxFQUFBQyxHQUNBLElBQUFDLEVBQUFILEVBQUFJLGFBQUFDLEVBQUFGLEVBQUFFLE1BQUFDLEVBQUFILEVBQUFHLFFBRUFuRixFQUFBLGlCQUFBMEMsS0FBQSx1QkFBQTBDLEtBQUFELEdBQ0FuRixFQUFBLGlCQUFBMEMsS0FBQSxxQkFBQTBDLEtBQUFGLEdBRUExRCxhQUFBeEIsRUFBQSxrQkFDQXVFLFlBQUEsR0FPQSxTQUFBekIsZUFDQSxJQUFBdUMsRUFBQXJGLEVBQUEsc0JBQ0FzRixFQUFBdEYsRUFBQSw2QkFDQTBELEVBQUEsR0FFQTRCLEVBQUE3RSxLQUFBLFdBQ0FpRCxHQUFBL0MsS0FBQUUsUUFHQSxJQUFBNkMsRUFBQWxCLFFBQ0ErQixZQUFBLEdBRUFkLFlBQUFDLEVBQUEsU0FBQXZFLEdBQ0FBLEdBQ0FrRyxFQUFBMUQsU0FBQSxTQUVBSCxhQUFBeEIsRUFBQSxrQkFBQSxXQUNBdUUsWUFBQSxPQUdBQSxZQUFBLEdBQ0FjLEVBQUExRCxTQUFBLFdBRUFYLFdBQUEsV0FDQXNFLEVBQUE3RSxLQUFBLFdBQUFULEVBQUFXLE1BQUFnQyxJQUFBLE1BQ0EyQyxFQUFBQyxHQUFBLEdBQUEzQyxTQUNBLFNBSUF5QyxFQUFBekQsWUFBQSxpQkFNQSxJQUFBNEQsV0FBQTdCLGVBRUFZLFlBQUEsR0FDQXpGLFFBQUFRLFVBQUFrRyxXQUFBLFlBQUEsU0FBQXBGLEdBQ0FrQixRQUFBQyxJQUFBLEtBQUFuQixHQUNBb0IsYUFBQXhCLEVBQUEsa0JBQUEsV0FDQSxJQUFBeUYsRUFBQXJGLEVBQUFzRixVQUFBQyxFQUFBRixFQUFBRyxXQUFBQyxFQUFBRixFQUFBRSxXQUFBQyxFQUFBSCxFQUFBRyxlQUFBQyxFQUFBSixFQUFBSSxlQUFBQyxFQUFBTCxFQUFBSyw2QkFBQUMsRUFBQU4sRUFBQU0sVUFBQUMsRUFBQVAsRUFBQU8sUUFBQUMsRUFBQVIsRUFBQVEsZUFBQWpILEVBQUF1RyxFQUFBdkcsUUFFQVosaUJBQUF1SCxFQUNBdEgscUJBQUF1SCxFQUNBdEgscUJBQUF1SCxFQUNBdEgsbUNBQUF1SCxFQUNBdEgsZ0JBQUF1SCxFQUFBRyxZQUNBekgsY0FBQXVILEVBQUFFLFlBQ0F4SCxxQkFBQXVILEVBQ0F0SCxjQUFBSyxFQUdBYyxFQUFBLGtCQUFBMEMsS0FBQSxzQkFBQTBDLEtBQUE1RyxzQkFDQXdCLEVBQUEsa0JBQUEwQyxLQUFBLHNCQUFBMEMsS0FBQXJFLGFBQUFyQyxnQkFBQTJILFlBQUFDLGFBQ0F0RyxFQUFBLGtCQUFBMEMsS0FBQSx1QkFBQTBDLEtBQUEzRyxvQ0FFQThGLFlBQUEsTUFFQUssaUJBRUEsSUFBQTJCLFNBQUF2RyxFQUFBLGlCQUVBdUcsU0FBQTlGLEtBQUEsV0FDQSxJQUFBK0YsRUFBQXhHLEVBQUFXLE1BQ0E2RixFQUFBOUQsS0FBQSxjQUVBK0QsR0FBQSxRQUFBLFdBQ0F4RixXQUFBdUYsR0FBQSxPQUlBeEcsRUFBQSxnQkFBQXlHLEdBQUEsUUFBQSxXQUNBbkYsUUFBQUMsSUFBQSxrQ0FFQSxJQUFBbUYsRUFBQUMsY0FBQSxHQUFBOUgsZUFDQStILEVBQUFELGNBQUEsR0FBQTlILHNCQUVBK0gsRUFBQSwrQkFFQXJDLFlBQUEsR0FDQXpGLFFBQUFjLGNBQUEsQ0FBQXdHLFlBQUFPLGNBQUFBLGNBQUEsR0FBQWpJLGlCQUFBLEdBQUEsQ0FBQXlILGVBQUF2SCx3QkFBQThILEVBQUEsU0FBQXRHLEdBQ0FrQixRQUFBQyxJQUFBLGlDQUFBbkIsR0FFQSxJQUFBeUcsRUFBQXpHLEVBQUFzRixVQUFBb0IsRUFBQUQsRUFBQUMsZUFBQUMsRUFBQUYsRUFBQUUsY0FFQWpJLFFBQUFDLFNBQUFULGlCQUFBLENBQUE4SCxZQUFBTyxjQUFBQSxjQUFBLEdBQUFoSSxlQUFBLEdBQUEsQ0FBQW1JLGVBQUExRyxFQUFBc0YsVUFBQW9CLGVBQUFFLGlCQUFBNUcsRUFBQXNGLFVBQUFzQixvQkFBQUosRUFBQSxTQUFBeEcsR0FDQWtCLFFBQUFDLElBQUEsNEJBQUFuQixHQUVBOEUsRUFBQTlFLEVBQUE4RSxNQUdBbEYsRUFBQSxrQkFBQTBDLEtBQUEscUJBQUEwQyxLQUFBLEdBQUE2QixPQUFBSCxFQUFBLE1BQUFHLE9BQUFGLElBQ0EvRyxFQUFBLGtCQUFBMEMsS0FBQSxzQkFBQTBDLEtBQUFyRSxhQUFBckMsZ0JBQUEySCxZQUFBQyxhQUNBdEcsRUFBQSxrQkFBQTBDLEtBQUEsdUJBQUEwQyxLQUFBM0csb0NBQ0F1QixFQUFBLGtCQUFBMEMsS0FBQSxzQkFBQTBDLEtBQUE1RyxzQkFDQXdCLEVBQUEsa0JBQUEwQyxLQUFBLHNCQUFBMEMsS0FBQXJFLGFBQUFyQyxnQkFBQTJILFlBQUFDLGFBQ0F0RyxFQUFBLGtCQUFBMEMsS0FBQSxxQkFBQTBDLEtBQUFGLEdBRUFsRixFQUFBLGtCQUFBMEMsS0FBQSxtQkFBQXdFLEtBQUEsT0FBQSw4QkFBQUQsT0FBQUUsS0FBQTdJLGtCQUFBLCtKQUVBa0QsYUFBQXhCLEVBQUEsbUJBQ0F1RSxZQUFBLElBQ0FLLGtCQUNBQSxtQkFLQSxJQUFBVSxRQUFBdEYsRUFBQSw2QkFFQXNGLFFBQUFtQixHQUFBLDRDQUFBMUQsY0FDQXVDLFFBQUFtQixHQUFBLFFBQUF4RSxrQkFFQXFELFFBQUFDLEdBQUEsR0FBQTNDLFFBSUE1QyxFQUFBLGNBQUF5RyxHQUFBLFFBQUEsV0FDQW5GLFFBQUFDLElBQUEsZ0NBTUF2QixFQUFBLGNBQUF5RyxHQUFBLFFBQUEsV0FDQW5GLFFBQUFDLElBQUEiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCByZXF1ZXN0ID0ge1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogTWFrZSBhIHBheW1lbnQuXHJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gaWRNb3ZpZSBcclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBib2R5IFxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGhlYWRlcnMgXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzIFxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZXJyb3IgXHJcbiAgICAgKi9cclxuICAgIGJ1eU1vdmllOiBmdW5jdGlvbiAoaWRNb3ZpZSwgYm9keSwgaGVhZGVycywgc3VjY2VzcywgZXJyb3IpIHtcclxuICAgICAgICBjb25zdCB1cmwgPSAnaHR0cHM6Ly9hcGlnYXRld2F5LnN1cGVyYXBwYmF6LmNvbS9pbnRlZ3JhY2lvbi9zdXBlcmFwcC9kaXZlcnNpb24vZ2VzdGlvbi1wZWxpY3VsYXMvdjEvcGVsaWN1bGFzLycgKyBpZE1vdmllICsgJy9jb21wcmFzJztcclxuICAgICAgICByZXF1ZXN0LnNlbmQodXJsLCAnUE9TVCcsIGJvZHksIGhlYWRlcnMsIHN1Y2Nlc3MpXHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IG1vdmllIGJ5IGlkIG9wZXJhdGlvbi5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpZE9wZXJhdGlvbiBcclxuICAgICAqL1xyXG4gICAgbW92aWVCeUlkOiBmdW5jdGlvbihpZE9wZXJhdGlvbiwgc3VjY2VzcywgZXJyb3IpIHtcclxuICAgICAgICBjb25zdCB1cmwgPSAnaHR0cHM6Ly9hcGlnYXRld2F5LnN1cGVyYXBwYmF6LmNvbS9pbnRlZ3JhY2lvbi9zdXBlcmFwcC9jYW5hbC9jbGllbnRlcy9nZXN0aW9uLXNlc2lvbmVzL3YxL3BvcnRhbC9vcGVyYWNpb25lcy8nICsgaWRPcGVyYXRpb247XHJcbiAgICAgICAgcmVxdWVzdC5zZW5kKHVybCwgJ0dFVCcsIHVuZGVmaW5lZCwge1xyXG4gICAgICAgICAgICAneC1zaWN1JzogJzNiYWQxMjkwYWM0NjAwYTU2OTE2MmVmYWEwOTExN2VhJyxcclxuICAgICAgICAgICAgJ3gtaWQtaW50ZXJhY2Npb24nOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjU1NDQwMDAwJyxcclxuICAgICAgICAgICAgJ3gtdG9rZW4tdXN1YXJpbyc6ICdTUmZWWnJUWXZkbTdtenpabWN1aURWaUFDa0F4J1xyXG4gICAgICAgIH0sIHN1Y2Nlc3MsIGVycm9yKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZWdpc3RlciBwYXltZW50LlxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGJvZHlcclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBoZWFkZXJzXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBlcnJvclxyXG4gICAgICovXHJcbiAgICBwYXltZW50QnV0dG9uOiBmdW5jdGlvbiAoYm9keSwgaGVhZGVycywgc3VjY2VzcywgZXJyb3IpIHtcclxuICAgICAgICBjb25zdCB1cmwgPSAnaHR0cHM6Ly9hcGlnYXRld2F5LnN1cGVyYXBwYmF6LmNvbS9pbnRlZ3JhY2lvbi9zdXBlcmFwcC9wYWdvcy9jYXB0YWNpb24vdHJhc3Bhc29zL3YxL2JvdG9uLXBhZ28nO1xyXG4gICAgICAgIHJlcXVlc3Quc2VuZCh1cmwsICdQT1NUJywgYm9keSwgaGVhZGVycywgc3VjY2VzcywgZXJyb3IpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIE1ha2UgcmVxdWVzdC5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYm9keVxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGpzb25IZWFkZXJzIFxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2VzcyBcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXHJcbiAgICAgKi9cclxuICAgIHNlbmQ6IGZ1bmN0aW9uICh1cmwsIG1ldGhvZCwgYm9keSwganNvbkhlYWRlcnMsIHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsLCBcclxuICAgICAgICAgICAgbWV0aG9kLFxyXG4gICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsIFxyXG4gICAgICAgICAgICBoZWFkZXJzOiBqc29uSGVhZGVycywgXHJcbiAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGJvZHkpLFxyXG4gICAgICAgICAgICBzdWNjZXNzLFxyXG4gICAgICAgICAgICBlcnJvclxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59OyIsImxldCBnbG9iYWxJZFBlbGljdWxhLCBnbG9iYWxJbWFnZW5QZWxpY3VsYSwgZ2xvYmFsTm9tYnJlUGVsaWN1bGEsIGdsb2JhbE51bWVyb0N1ZW50YUNsaWVudGVDYWRlbmFCYXosIGdsb2JhbEJvdG9uUGFnbywgZ2xvYmFsQ29tcHJhcywgZ2xvYmFsVG9rZW5PcGVyYWNpb24sIGdsb2JhbEhlYWRlcnM7XHJcblxyXG4vKipcclxuICogQmluZCBKU09OIHRvIEhUTUwuXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXNcclxuICovXHJcbmZ1bmN0aW9uIGJpbmQodmFsdWVzKSB7XHJcbiAgICBjb25zdCAkdGFncyA9ICQoJ1tkYXRhLWlkXScpO1xyXG5cclxuICAgICR0YWdzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0ICR0YWcgPSAkKHRoaXMpO1xyXG4gICAgICAgIGNvbnN0IGlkID0gJHRhZy5kYXRhKCdpZCcpO1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2lkXTtcclxuXHJcbiAgICAgICAgaWYgKGlkID09PSAncHJlY2lvJykge1xyXG4gICAgICAgICAgICAkdGFnLmh0bWwoZm9ybWF0QW1vdW50KHZhbHVlKSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChpZCA9PT0gJ3NhbGRvJykge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09ICdmYWxzZScpIHtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBzaG93QWR2aWNlKCR0YWcsIHRydWUpOyB9LCA1MDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJHRhZy5odG1sKHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFBhcnNlIHN0cmluZyB0byBvYmplY3QgYW5kIHRoZW4gYmluZC5cclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ckpzb24gXHJcbiAqL1xyXG5mdW5jdGlvbiBiaW5kRnJvbVN0cihzdHJKc29uKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHN0ckpzb24pO1xyXG4gICAgICAgIGJpbmQoanNvbik7XHJcbiAgICB9IGNhdGNoIChlcnIpIHsgY29uc29sZS5sb2coZXJyKTsgfVxyXG59XHJcblxyXG4vKipcclxuICogQ2hhbmdlIHNjcmVlbi5cclxuICogQHBhcmFtIHtqUXVlcnl9ICRzY3JlZW5cclxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcclxuICovXHJcbmZ1bmN0aW9uIGNoYW5nZVNjcmVlbigkc2NyZWVuLCBjYWxsYmFjaykge1xyXG4gICAgJCgnLnNjcmVlbicpLmFkZENsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICAkc2NyZWVuLnJlbW92ZUNsYXNzKCduby12aXNpYmxlJyk7XHJcblxyXG4gICAgdHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nICYmIGNhbGxiYWNrKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgYW1vdW50IHdpdGggY3VycmVuY3kgZm9ybWF0LlxyXG4gKiBAcGFyYW0ge251bWJlcn0gYW1vdW50IFxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gKi9cclxuZnVuY3Rpb24gZm9ybWF0QW1vdW50KGFtb3VudCkge1xyXG4gICAgcmV0dXJuICckICcgKyBOdW1iZXIoYW1vdW50KS50b0ZpeGVkKDIpLnJlcGxhY2UoL1xcQig/PShcXGR7M30pKyg/IVxcZCkpL2csICcsJyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBIYW5kbGUgZGlnaXQga2V5dXAgZXZlbnQuXHJcbiAqIEBwYXJhbSB7S2V5Ym9hcmRFdmVudH0gZXZlbnRcclxuICovXHJcbmZ1bmN0aW9uIGhhbmRsZURpZ2l0S2V5dXAoeyB0YXJnZXQsIGtleUNvZGUgfSkge1xyXG4gICAgY29uc3QgJHBhcmVudCA9ICQodGFyZ2V0LnBhcmVudE5vZGUpO1xyXG5cclxuICAgIGlmIChrZXlDb2RlID09PSA4KSB7XHJcbiAgICAgICAgaWYgKCRwYXJlbnQucHJldigpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJHBhcmVudC5wcmV2KCkuZmluZCgnaW5wdXQnKTtcclxuXHJcbiAgICAgICAgICAgICRpbnB1dC52YWwoJycpO1xyXG4gICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSBlbHNlIGlmIChrZXlDb2RlID4gNDcgJiYga2V5Q29kZSA8IDU4KSB7XHJcbiAgICAgICAgaWYgKHRhcmdldC52YWx1ZSAhPT0gJycpIHtcclxuICAgICAgICAgICAgaWYgKCRwYXJlbnQubmV4dCgpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0ICRpbnB1dCA9ICRwYXJlbnQubmV4dCgpLmZpbmQoJ2lucHV0Jyk7XHJcbiAgICAgICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB2YWxpZGF0ZUNvZGUoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEFwcGx5IG51bWJlciBmaWx0ZXIuXHJcbiAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50XHJcbiAqL1xyXG5mdW5jdGlvbiBudW1iZXJGaWx0ZXIoZXZlbnQpIHtcclxuICAgIGNvbnN0IGZpbHRlciA9IC9eXFxkezAsMX0kLztcclxuXHJcbiAgICBpZiAoZmlsdGVyLnRlc3QodGhpcy52YWx1ZSkpIHtcclxuICAgICAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy52YWx1ZTtcclxuICAgICAgICB0aGlzLm9sZFNlbGVjdGlvblN0YXJ0ID0gdGhpcy5zZWxlY3Rpb25TdGFydDtcclxuICAgICAgICB0aGlzLm9sZFNlbGVjdGlvbkVuZCA9IHRoaXMuc2VsZWN0aW9uRW5kO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmhhc093blByb3BlcnR5KCdvbGRWYWx1ZScpKSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMub2xkVmFsdWU7XHJcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb25SYW5nZSh0aGlzLm9sZFNlbGVjdGlvblN0YXJ0LCB0aGlzLm9sZFNlbGVjdGlvbkVuZCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSAnJztcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIERvIGZha2UgcmVxdWVzdC5cclxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcclxuICovXHJcbmZ1bmN0aW9uIGZha2VSZXF1ZXN0KGNvZGUsIGNhbGxiYWNrKSB7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBjYWxsYmFjayhjb2RlID09PSAnMDAwMDAxJyk7XHJcbiAgICB9LCAxNTAwKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFBhcnNlIGxvY2F0aW9uLnNlYXJjaCB0byBKU09OLlxyXG4gKiBAcmV0dXJucyBvYmplY3RcclxuICovXHJcbmZ1bmN0aW9uIHNlYXJjaFRvSnNvbigpIHtcclxuICAgIGNvbnN0IHBhaXJzID0gbG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKS5zcGxpdCgnJicpO1xyXG4gICAgY29uc3Qgb2JqZWN0ID0ge307XHJcbiAgICBsZXQgaSA9IDA7XHJcblxyXG4gICAgZm9yICg7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGlmIChwYWlyc1tpXSA9PT0gJycpIHtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwYXJ0cyA9IHBhaXJzW2ldLnNwbGl0KCc9Jyk7XHJcbiAgICAgICAgb2JqZWN0W2RlY29kZVVSSUNvbXBvbmVudChwYXJ0c1swXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzFdKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gb2JqZWN0O1xyXG59XHJcblxyXG4vKipcclxuICogU2hvdyBvciBoaWRlIGFkdmljZS5cclxuICogQHBhcmFtIHtqUXVlcnl9ICRlbCBcclxuICogQHBhcmFtIHtib29sZWFufSBmbGFnIFxyXG4gKi9cclxuZnVuY3Rpb24gc2hvd0FkdmljZSgkZWwsIGZsYWcpIHtcclxuICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgJGVsLmFkZENsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICRlbC5yZW1vdmVDbGFzcygnbm8tdmlzaWJsZScpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogU2hvdyBvciBoaWRlIGxvYWRlci5cclxuICogQHBhcmFtIHtib29sZWFufSBzaG93XHJcbiAqL1xyXG5mdW5jdGlvbiBzaG93TG9hZGVyKHNob3cpIHtcclxuICAgIGxldCAkbG9hZGVyID0gJCgnLmxvYWRlcicpO1xyXG5cclxuICAgIGlmIChzaG93KSB7XHJcbiAgICAgICAgaWYgKCRsb2FkZXIubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgJGxvYWRlciA9ICQoJzxkaXYgY2xhc3M9XCJsb2FkZXJcIj4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJGxvYWRlcik7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiAkbG9hZGVyLmFkZENsYXNzKCdsb2FkZXItdmlzaWJsZScpLCAxMCk7XHJcblxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkbG9hZGVyLnJlbW92ZUNsYXNzKCdsb2FkZXItdmlzaWJsZScpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gJGxvYWRlci5yZW1vdmUoKSwgMzc1KTtcclxuXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTaG93IG9yIGhpZGUgZXJyb3Igc2NyZWVuLlxyXG4gKiBAcGFyYW0ge2pxWEhSfSBqcVhIUlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dFN0YXR1c1xyXG4gKiBAcGFyYW0ge3N0cmluZ30gZXJyb3JUaHJvd24gXHJcbiAqL1xyXG5mdW5jdGlvbiBzaG93RXJyb3JTY3JlZW4oanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XHJcbiAgICBjb25zdCB7IHJlc3BvbnNlSlNPTjogeyBmb2xpbywgbWVuc2FqZSB9IH0gPSBqcVhIUjtcclxuXHJcbiAgICAkKCcuZXJyb3Itc2NyZWVuJykuZmluZCgnW2RhdGEtaWQ9XCJtZW5zYWplXCJdJykudGV4dChtZW5zYWplKTtcclxuICAgICQoJy5lcnJvci1zY3JlZW4nKS5maW5kKCdbZGF0YS1pZD1cImZvbGlvXCJdJykudGV4dChmb2xpbyk7XHJcbiAgICBcclxuICAgIGNoYW5nZVNjcmVlbigkKCcuZXJyb3Itc2NyZWVuJykpO1xyXG4gICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZGF0ZSBjb2RlIGZyb20gY2xpZW50LlxyXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuICovXHJcbmZ1bmN0aW9uIHZhbGlkYXRlQ29kZSgpIHtcclxuICAgIGNvbnN0ICRjb2RlID0gJCgnLmF1dGgtc2NyZWVuIC5jb2RlJyk7XHJcbiAgICBjb25zdCAkZGlnaXRzID0gJCgnLmF1dGgtc2NyZWVuIC5kaWdpdCBpbnB1dCcpO1xyXG4gICAgbGV0IGNvZGUgPSBcIlwiO1xyXG5cclxuICAgICRkaWdpdHMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29kZSArPSB0aGlzLnZhbHVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGNvZGUubGVuZ3RoID09PSA2KSB7XHJcbiAgICAgICAgc2hvd0xvYWRlcih0cnVlKTtcclxuXHJcbiAgICAgICAgZmFrZVJlcXVlc3QoY29kZSwgc3VjY2VzcyA9PiB7XHJcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAkY29kZS5hZGRDbGFzcygndmFsaWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjaGFuZ2VTY3JlZW4oJCgnLnJlc3VtZS1zY3JlZW4nKSwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCdpbnZhbGlkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHsgJCh0aGlzKS52YWwoJycpOyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVxKDApLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICRjb2RlLnJlbW92ZUNsYXNzKCd2YWxpZCBpbnZhbGlkJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4vLyBJbml0aWFsaXplIERldGFpbCBTY3JlZW4gY29tcG9uZW50cy5cclxuY29uc3Qgc2VhcmNoSnNvbiA9IHNlYXJjaFRvSnNvbigpO1xyXG5cclxuc2hvd0xvYWRlcih0cnVlKTtcclxucmVxdWVzdC5tb3ZpZUJ5SWQoc2VhcmNoSnNvblsnaWRPcGVyYWNpb24nXSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgIGNvbnNvbGUubG9nKCclbycsIGRhdGEpO1xyXG4gICAgY2hhbmdlU2NyZWVuKCQoJy5kZXRhaWwtc2NyZWVuJyksIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zdCB7IGRhdG9zRmx1am86IHsgaWRQZWxpY3VsYSwgaW1hZ2VuUGVsaWN1bGEsIG5vbWJyZVBlbGljdWxhLCBudW1lcm9DdWVudGFDbGllbnRlQ2FkZW5hQmF6LCBib3RvblBhZ28sIGNvbXByYXMsIHRva2VuT3BlcmFjaW9uIH0sIGhlYWRlcnMgfSA9IGRhdGEucmVzdWx0YWRvO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGdsb2JhbElkUGVsaWN1bGEgPSBpZFBlbGljdWxhO1xyXG4gICAgICAgIGdsb2JhbEltYWdlblBlbGljdWxhID0gaW1hZ2VuUGVsaWN1bGE7XHJcbiAgICAgICAgZ2xvYmFsTm9tYnJlUGVsaWN1bGEgPSBub21icmVQZWxpY3VsYTtcclxuICAgICAgICBnbG9iYWxOdW1lcm9DdWVudGFDbGllbnRlQ2FkZW5hQmF6ID0gbnVtZXJvQ3VlbnRhQ2xpZW50ZUNhZGVuYUJhejtcclxuICAgICAgICBnbG9iYWxCb3RvblBhZ28gPSBib3RvblBhZ28udHJhbnNhY2Npb247XHJcbiAgICAgICAgZ2xvYmFsQ29tcHJhcyA9IGNvbXByYXMudHJhbnNhY2Npb247XHJcbiAgICAgICAgZ2xvYmFsVG9rZW5PcGVyYWNpb24gPSB0b2tlbk9wZXJhY2lvbjtcclxuICAgICAgICBnbG9iYWxIZWFkZXJzID0gaGVhZGVycztcclxuXHJcbiAgICAgICAgLy8gRmlsbCBkZXRhaWwgc2NyZWVuLlxyXG4gICAgICAgICQoJy5kZXRhaWwtc2NyZWVuJykuZmluZCgnW2RhdGEtaWQ9XCJub21icmVcIl0nKS50ZXh0KGdsb2JhbE5vbWJyZVBlbGljdWxhKTtcclxuICAgICAgICAkKCcuZGV0YWlsLXNjcmVlbicpLmZpbmQoJ1tkYXRhLWlkPVwicHJlY2lvXCJdJykudGV4dChmb3JtYXRBbW91bnQoZ2xvYmFsQm90b25QYWdvLmRldGFsbGVQYWdvLm1vbnRvRW52aW8pKTtcclxuICAgICAgICAkKCcuZGV0YWlsLXNjcmVlbicpLmZpbmQoJ1tkYXRhLWlkPVwidGFyamV0YVwiXScpLnRleHQoZ2xvYmFsTnVtZXJvQ3VlbnRhQ2xpZW50ZUNhZGVuYUJheik7XHJcbiAgICAgICAgXHJcbiAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbiAgICB9KTtcclxufSwgc2hvd0Vycm9yU2NyZWVuKTtcclxuXHJcbmNvbnN0ICRhZHZpY2VzID0gJCgnLmFkdmljZS5maXhlZCcpO1xyXG5cclxuJGFkdmljZXMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCAkYWR2aWNlID0gJCh0aGlzKTtcclxuICAgIGNvbnN0ICRjbG9zZUJ0biA9ICRhZHZpY2UuZmluZCgnLmNsb3NlLWJ0bicpO1xyXG5cclxuICAgICRjbG9zZUJ0bi5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc2hvd0FkdmljZSgkYWR2aWNlLCBmYWxzZSk7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG4kKCcucmVudC1idXR0b24nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBDbGljayByZW50IGJ1dHRvbi4nKTtcclxuXHJcbiAgICBjb25zdCBwYXltZW50QnV0dG9uSGVhZGVycyA9IHsgLi4uZ2xvYmFsSGVhZGVycyB9O1xyXG4gICAgY29uc3QgYnV5TW92aWVIZWFkZXJzID0geyAuLi5nbG9iYWxIZWFkZXJzIH07XHJcblxyXG4gICAgZGVsZXRlIGJ1eU1vdmllSGVhZGVyc1sneC1pZC1vcGVyYWNpb24tY29uY2lsaWFjaW9uJ107XHJcblxyXG4gICAgc2hvd0xvYWRlcih0cnVlKTtcclxuICAgIHJlcXVlc3QucGF5bWVudEJ1dHRvbih7IFwidHJhbnNhY2Npb25cIjogeyAuLi5nbG9iYWxCb3RvblBhZ28sIHRva2VuT3BlcmFjaW9uOiBnbG9iYWxUb2tlbk9wZXJhY2lvbiB9IH0sIHBheW1lbnRCdXR0b25IZWFkZXJzLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBQYXltZW50IGJ1dHRvbi4gJW8nLCBkYXRhKTtcclxuXHJcbiAgICAgICAgY29uc3QgeyByZXN1bHRhZG86IHsgZmVjaGFPcGVyYWNpb24sIGhvcmFPcGVyYWNpb24gfSB9ID0gZGF0YTtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5idXlNb3ZpZShnbG9iYWxJZFBlbGljdWxhLCB7IFwidHJhbnNhY2Npb25cIjogeyAuLi5nbG9iYWxDb21wcmFzLCBmZWNoYU9wZXJhY2lvbjogZGF0YS5yZXN1bHRhZG8uZmVjaGFPcGVyYWNpb24sIG51bWVyb01vdmltaWVudG86IGRhdGEucmVzdWx0YWRvLm51bWVyb01vdmltaWVudG8gfSB9LCBidXlNb3ZpZUhlYWRlcnMsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBCdXkgbW92aWUuICVvJywgZGF0YSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB7IGZvbGlvIH0gPSBkYXRhO1xyXG5cclxuICAgICAgICAgICAgLy8gRmlsbCByZXN1bWUgc2NyZWVuLlxyXG4gICAgICAgICAgICAkKCcucmVzdW1lLXNjcmVlbicpLmZpbmQoJ1tkYXRhLWlkPVwiZmVjaGFcIl0nKS50ZXh0KGAke2ZlY2hhT3BlcmFjaW9ufSwgJHtob3JhT3BlcmFjaW9ufWApO1xyXG4gICAgICAgICAgICAkKCcucmVzdW1lLXNjcmVlbicpLmZpbmQoJ1tkYXRhLWlkPVwicHJlY2lvXCJdJykudGV4dChmb3JtYXRBbW91bnQoZ2xvYmFsQm90b25QYWdvLmRldGFsbGVQYWdvLm1vbnRvRW52aW8pKTtcclxuICAgICAgICAgICAgJCgnLnJlc3VtZS1zY3JlZW4nKS5maW5kKCdbZGF0YS1pZD1cInRhcmpldGFcIl0nKS50ZXh0KGdsb2JhbE51bWVyb0N1ZW50YUNsaWVudGVDYWRlbmFCYXopO1xyXG4gICAgICAgICAgICAkKCcucmVzdW1lLXNjcmVlbicpLmZpbmQoJ1tkYXRhLWlkPVwibm9tYnJlXCJdJykudGV4dChnbG9iYWxOb21icmVQZWxpY3VsYSk7XHJcbiAgICAgICAgICAgICQoJy5yZXN1bWUtc2NyZWVuJykuZmluZCgnW2RhdGEtaWQ9XCJwcmVjaW9cIl0nKS50ZXh0KGZvcm1hdEFtb3VudChnbG9iYWxCb3RvblBhZ28uZGV0YWxsZVBhZ28ubW9udG9FbnZpbykpO1xyXG4gICAgICAgICAgICAkKCcucmVzdW1lLXNjcmVlbicpLmZpbmQoJ1tkYXRhLWlkPVwiZm9saW9cIl0nKS50ZXh0KGZvbGlvKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICQoJy5yZXN1bWUtc2NyZWVuJykuZmluZCgnLnNlZS1tb3ZpZS1ocmVmJykuYXR0cignaHJlZicsIGBpbnRlbnQ6Ly8/dmVyUGVsaWN1bGE/ZGF0YT0ke2J0b2EoZ2xvYmFsSWRQZWxpY3VsYSl9I0ludGVudDtzY2hlbWU9c2FwcGRsO2FjdGlvbj1hbmRyb2lkLmludGVudC5hY3Rpb24uVklFVztTLmJyb3dzZXJfZmFsbGJhY2tfdXJsPWh0dHBzJTNBJTJGJTJGcGxheS5nb29nbGUuY29tL3N0b3JlL2FwcHMvZGV0YWlscz9pZD1teC5hcHAuYmF6LnN1cGVyYXBwO2VuZGApO1xyXG5cclxuICAgICAgICAgICAgY2hhbmdlU2NyZWVuKCQoJy5yZXN1bWUtc2NyZWVuJykpO1xyXG4gICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICB9LCBzaG93RXJyb3JTY3JlZW4pO1xyXG4gICAgfSwgc2hvd0Vycm9yU2NyZWVuKTtcclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBBdXRoIFNjcmVlbiBjb21wb25lbnRzLlxyXG5jb25zdCAkZGlnaXRzID0gJCgnLmF1dGgtc2NyZWVuIC5kaWdpdCBpbnB1dCcpO1xyXG5cclxuJGRpZ2l0cy5vbigna2V5cHJlc3Mga2V5ZG93biBrZXl1cCBpbnB1dCBjaGFuZ2UgcGFzdGUnLCBudW1iZXJGaWx0ZXIpXHJcbiRkaWdpdHMub24oJ2tleXVwJywgaGFuZGxlRGlnaXRLZXl1cCk7XHJcblxyXG4kZGlnaXRzLmVxKDApLmZvY3VzKCk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBzaGFyZSBidXR0b24uXHJcbiQoJy5zaGFyZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogU2hhcmluZyB0aWNrZXQnKTtcclxuXHJcbn0pO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgbW92aWUgYnV0dG9uLlxyXG4kKCcubW92aWUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IFBsYXkgbW92aWUnKTtcclxuXHJcbn0pO1xyXG4iXX0=

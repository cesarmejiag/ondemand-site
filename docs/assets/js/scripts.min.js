"use strict";!function(c){c.fn.swipe=function(e){var r=c.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var o=c(this),s=0,n=0,t=!1,i=o.find(".slider"),a=o.find(".text");i.on("mousedown touchstart",function(e){t=!0,n=o.width()-c(this).width()+10,s=e.clientX||e.originalEvent.touches[0].pageX}),c(document.body,i).on("mouseup touchend",function(e){if(t){if(t=!1,(e.clientX||e.changedTouches[0].pageX)-s<n)return a.fadeTo(300,1),void i.animate({left:"-10px"},300);r.cb()}}),c(document.body).on("mousemove touchmove",function(e){var o;t&&(e=1-(o=(e.clientX||e.originalEvent.touches[0].pageX)-s)/n,a.fadeTo(0,e),o<=0?i.css({left:"-10px"}):n+10<=o?i.css({left:n+"px"}):i.css({left:o-10}))})})}}(jQuery);var request={auth:function(e,o){var s={Authorization:"Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7"),"Content-Type":"application/x-www-form-urlencoded",Cookie:"XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"};request.send("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token","POST","grant_type=client_credentials",s,e,o)},movieById:function(e,o,s){request.send("https://apigateway.superappbaz.com/integracion/superapp/canal/clientes/gestion-sesiones/v1/portal/operaciones/"+e,"GET",void 0,{"x-sicu":"3bad1290ac4600a569162efaa09117ea","x-id-interaccion":"123e4567-e89b-12d3-a456-426655440000","x-token-usuario":"SRfVZrTYvdm7mzzZmcuiDViACkAx"},o,s)},pay:function(e,o,s,n,t){s=s?"https://api.bazappgs.com/superapp/pagos/captacion/traspasos/v1/boton-pago":"https://apigateway.superappbaz.com/integracion/superapp/pagos/captacion/traspasos/v1/boton-pago",o=JSON.stringify(o);request.send(s,"POST",o,e,n,t)},send:function(e,o,s,n,t,i){$.ajax({url:e,method:o,contentType:"application/json",processData:!1,headers:n,data:s,success:t,error:i})}},environment=!1;function bind(n){$("[data-id]").each(function(){var e=$(this),o=e.data("id"),s=n[o];"precio"===o?e.html(formatAmount(s)):"saldo"===o?"false"===s&&setTimeout(function(){showAdvice(e,!0)},500):e.html(s)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,o){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),o()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var o=e.target,s=e.keyCode,n=$(o.parentNode);8===s?0<n.prev().length&&((e=n.prev().find("input")).val(""),e.focus()):47<s&&s<58&&""!==o.value&&0<n.next().length&&n.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function fakeRequest(e,o){setTimeout(function(){o("000001"===e)},1500)}function payMovie(e){function n(e){console.log(JSON.stringify(e)),window.webkit.messageHandlers.errorPaymentResponse.postMessage("errorPaymentResponse|"+JSON.stringify(e))}window.webkit.messageHandlers.showLoader.postMessage("showLoader");try{var o=JSON.parse(e);request.pay(o.headers,o.requestBody,environment,function(e){"201"==e.codigo?window.webkit.messageHandlers.paymentResponse.postMessage("paymentResponse|"+JSON.stringify({error:{code:0,data:e}})):n({error:{code:e.codigo,message:e.mensaje},weberror:900,weberrormessage:"El error lo envío el servicio"}),window.webkit.messageHandlers.hideLoader.postMessage("hideLoader")},function(e,o,s){n({error:{code:500,message:s},weberror:901,weberrormessage:s}),window.webkit.messageHandlers.hideLoader.postMessage("hideLoader")})}catch(e){n({error:{code:500,message:e.message},weberror:902,weberrormessage:"Error al hacer la petición"}),window.webkit.messageHandlers.hideLoader.postMessage("hideLoader")}}function searchToJson(){for(var e,o=location.search.substring(1).split("&"),s={},n=0;n<o.length;n++)""!==o[n]&&(e=o[n].split("="),s[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return s}function showAdvice(e,o){o?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var o=$(".loader");e?(o.length<=0&&(o=$('<div class="loader">')),$("body").append(o),setTimeout(function(){return o.addClass("loader-visible")},10)):(o.removeClass("loader-visible"),setTimeout(function(){return o.remove()},375))}function validateCode(){var o=$(".auth-screen .code"),s=$(".auth-screen .digit input"),e="";s.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(o.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),o.addClass("invalid"),setTimeout(function(){s.each(function(){$(this).val("")}),s.eq(0).focus()},100))})):o.removeClass("valid invalid")}var searchJson=searchToJson(),environment="true"===searchJson.environment;console.log(searchJson);var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),window.webkit.messageHandlers.showDigitalSign.postMessage("showDigitalSign")},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),window.webkit.messageHandlers.closeMoviePayment.postMessage("closeMoviePayment")}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),window.webkit.messageHandlers.shareTicket.postMessage("shareTicket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),window.webkit.messageHandlers.playMovie.postMessage("playMovie")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5zd2lwZS5qcyIsInJlcXVlc3QuanMiLCJzY3JpcHRzLmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCJjb25zb2xlIiwibG9nIiwidGhpcyIsImVhY2giLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsImZpbmQiLCIkdGV4dCIsIm9uIiwiZXZlbnQiLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJib2R5IiwiY2hhbmdlZFRvdWNoZXMiLCJmYWRlVG8iLCJhbmltYXRlIiwibGVmdCIsInJlbGF0aXZlTW91c2UiLCJzbGlkZVBlcmNlbnQiLCJjc3MiLCJqUXVlcnkiLCJyZXF1ZXN0IiwiYXV0aCIsInN1Y2Nlc3MiLCJlcnJvciIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYnRvYSIsIkNvbnRlbnQtVHlwZSIsIkNvb2tpZSIsInNlbmQiLCJtb3ZpZUJ5SWQiLCJpZE9wZXJhdGlvbiIsInVuZGVmaW5lZCIsIngtc2ljdSIsIngtaWQtaW50ZXJhY2Npb24iLCJ4LXRva2VuLXVzdWFyaW8iLCJwYXkiLCJwcm9kdWN0aW9uIiwidXJsIiwicmF3IiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGhvZCIsImpzb25IZWFkZXJzIiwiYWpheCIsImNvbnRlbnRUeXBlIiwicHJvY2Vzc0RhdGEiLCJkYXRhIiwiZW52aXJvbm1lbnQiLCJiaW5kIiwidmFsdWVzIiwiJHRhZyIsImlkIiwidmFsdWUiLCJodG1sIiwiZm9ybWF0QW1vdW50Iiwic2V0VGltZW91dCIsInNob3dBZHZpY2UiLCJiaW5kRnJvbVN0ciIsInN0ckpzb24iLCJwYXJzZSIsImVyciIsImNoYW5nZVNjcmVlbiIsIiRzY3JlZW4iLCJjYWxsYmFjayIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJhbW91bnQiLCJOdW1iZXIiLCJ0b0ZpeGVkIiwicmVwbGFjZSIsImhhbmRsZURpZ2l0S2V5dXAiLCJfcmVmIiwidGFyZ2V0Iiwia2V5Q29kZSIsIiRwYXJlbnQiLCJwYXJlbnROb2RlIiwicHJldiIsImxlbmd0aCIsIiRpbnB1dCIsInZhbCIsImZvY3VzIiwibmV4dCIsInZhbGlkYXRlQ29kZSIsIm51bWJlckZpbHRlciIsInRlc3QiLCJvbGRWYWx1ZSIsIm9sZFNlbGVjdGlvblN0YXJ0Iiwic2VsZWN0aW9uU3RhcnQiLCJvbGRTZWxlY3Rpb25FbmQiLCJzZWxlY3Rpb25FbmQiLCJoYXNPd25Qcm9wZXJ0eSIsInNldFNlbGVjdGlvblJhbmdlIiwiZmFrZVJlcXVlc3QiLCJjb2RlIiwicGF5TW92aWUiLCJoYW5kbGVFcnIiLCJ3aW5kb3ciLCJ3ZWJraXQiLCJtZXNzYWdlSGFuZGxlcnMiLCJlcnJvclBheW1lbnRSZXNwb25zZSIsInBvc3RNZXNzYWdlIiwic2hvd0xvYWRlciIsImpzb24iLCJwYXlSZXMiLCJjb2RpZ28iLCJwYXltZW50UmVzcG9uc2UiLCJtZXNzYWdlIiwibWVuc2FqZSIsIndlYmVycm9yIiwid2ViZXJyb3JtZXNzYWdlIiwiaGlkZUxvYWRlciIsImpxWEhSIiwidGV4dFN0YXR1cyIsImVycm9yVGhyb3duIiwic2VhcmNoVG9Kc29uIiwicGFydHMiLCJwYWlycyIsImxvY2F0aW9uIiwic2VhcmNoIiwic3Vic3RyaW5nIiwic3BsaXQiLCJvYmplY3QiLCJpIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiJGVsIiwiZmxhZyIsInNob3ciLCIkbG9hZGVyIiwiYXBwZW5kIiwicmVtb3ZlIiwiJGNvZGUiLCIkZGlnaXRzIiwiZXEiLCJzZWFyY2hKc29uIiwiJGFkdmljZXMiLCIkYWR2aWNlIiwic2hvd0RpZ2l0YWxTaWduIiwiY2xvc2VNb3ZpZVBheW1lbnQiLCJzaGFyZVRpY2tldCIsInBsYXlNb3ZpZSJdLCJtYXBwaW5ncyI6ImNBRUEsU0FBQUEsR0FDQUEsRUFBQUMsR0FB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Z0JBQUF1QyxrQkFBQXJDLFlBQUEsdUJBS0FwSCxFQUFBLGNBQUFrQixHQUFBLFFBQUEsV0FDQVgsUUFBQUMsSUFBQSw4QkFDQXdHLE9BQUFDLE9BQUFDLGdCQUFBd0MsWUFBQXRDLFlBQUEsaUJBS0FwSCxFQUFBLGNBQUFrQixHQUFBLFFBQUEsV0FDQVgsUUFBQUMsSUFBQSwwQkFDQXdHLE9BQUFDLE9BQUFDLGdCQUFBeUMsVUFBQXZDLFlBQUEiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBSZWZlcmVuY2U6IGh0dHBzOi8vY29kZXBlbi5pby9ncHJlc3N1dHRvNS9wZW4vTmpKb2JHP2VkaXRvcnM9MDAxMFxuXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAkLmZuLnN3aXBlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHNldHRpbmdzID0gJC5leHRlbmQoe1xuICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzd2lwZSBkb25lJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIG9wdGlvbnMpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgIHZhciBpbml0aWFsTW91c2UgPSAwO1xuICAgICAgICAgICAgdmFyIHNsaWRlTW92ZW1lbnRUb3RhbCA9IDA7XG4gICAgICAgICAgICB2YXIgbW91c2VJc0Rvd24gPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciAkc2xpZGVyID0gJHRoaXMuZmluZCgnLnNsaWRlcicpO1xuICAgICAgICAgICAgdmFyICR0ZXh0ID0gJHRoaXMuZmluZCgnLnRleHQnKTtcblxuICAgICAgICAgICAgJHNsaWRlci5vbignbW91c2Vkb3duIHRvdWNoc3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBtb3VzZUlzRG93biA9IHRydWU7XG4gICAgICAgICAgICAgICAgc2xpZGVNb3ZlbWVudFRvdGFsID0gJHRoaXMud2lkdGgoKSAtICQodGhpcykud2lkdGgoKSArIDEwO1xuICAgICAgICAgICAgICAgIGluaXRpYWxNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VYO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSwgJHNsaWRlcikub24oJ21vdXNldXAgdG91Y2hlbmQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIW1vdXNlSXNEb3duKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgbW91c2VJc0Rvd24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWDtcbiAgICAgICAgICAgICAgICB2YXIgcmVsYXRpdmVNb3VzZSA9IGN1cnJlbnRNb3VzZSAtIGluaXRpYWxNb3VzZTtcblxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlIDwgc2xpZGVNb3ZlbWVudFRvdGFsKSB7XG4gICAgICAgICAgICAgICAgICAgICR0ZXh0LmZhZGVUbygzMDAsIDEpO1xuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogXCItMTBweFwiXG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvKiAkc2xpZGVyLmFkZENsYXNzKCd1bmxvY2tlZCcpO1xuICAgICAgICAgICAgICAgICQoJyNsb2NrZXInKS50ZXh0KCdsb2NrX291dGxpbmUnKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5vbignY2xpY2sgdGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISRzbGlkZXIuaGFzQ2xhc3MoJ3VubG9ja2VkJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5yZW1vdmVDbGFzcygndW5sb2NrZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNsb2NrZXInKS50ZXh0KCdsb2NrX29wZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzbGlkZXIub2ZmKCdjbGljayB0YXAnKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgMCk7ICovXG5cbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYigpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSkub24oJ21vdXNlbW92ZSB0b3VjaG1vdmUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIW1vdXNlSXNEb3duKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVg7XG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0aXZlTW91c2UgPSBjdXJyZW50TW91c2UgLSBpbml0aWFsTW91c2U7XG4gICAgICAgICAgICAgICAgdmFyIHNsaWRlUGVyY2VudCA9IDEgLSAocmVsYXRpdmVNb3VzZSAvIHNsaWRlTW92ZW1lbnRUb3RhbCk7XG5cbiAgICAgICAgICAgICAgICAkdGV4dC5mYWRlVG8oMCwgc2xpZGVQZXJjZW50KTtcblxuICAgICAgICAgICAgICAgIGlmIChyZWxhdGl2ZU1vdXNlIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6ICctMTBweCcgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPj0gc2xpZGVNb3ZlbWVudFRvdGFsICsgMTApIHtcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6IHNsaWRlTW92ZW1lbnRUb3RhbCArICdweCcgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6IHJlbGF0aXZlTW91c2UgLSAxMCB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59KShqUXVlcnkpO1xuIiwiY29uc3QgcmVxdWVzdCA9IHtcbiAgICAvKipcbiAgICAgKiBBdXRoZW50aWNhdGUuXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2Vzc1xuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXG4gICAgICovXG4gICAgYXV0aDogZnVuY3Rpb24gKHN1Y2Nlc3MsIGVycm9yKSB7XG4gICAgICAgIGNvbnN0IHVybCA9IFwiaHR0cHM6Ly9vbW02b3VnNXBnLmV4ZWN1dGUtYXBpLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL2Rlc2Fycm9sbG8vb2F1dGgyL3YxL3Rva2VuXCI7XG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICAgICAgICBcIkF1dGhvcml6YXRpb25cIjogXCJCYXNpYyBcIiArIGJ0b2EoXCIxOGg4dmFudnJoNHB1aTFscm50YzFuaWxqZlwiICsgXCI6XCIgKyBcIjFnZTMxYmhqcmRrOWQwamExNG1mdDhxZXBpNGNsa3Q4MDVqcWIyc3Zxdm1iNHNvMXY0ZzdcIiksXG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLFxuICAgICAgICAgICAgXCJDb29raWVcIjogXCJYU1JGLVRPS0VOPWI0YTU0ZjFiLWFmZTUtNGFlZS05YTc2LTAwZjkyMDQxOGI2ZVwiXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGJvZHkgPSBcImdyYW50X3R5cGU9Y2xpZW50X2NyZWRlbnRpYWxzXCI7XG5cbiAgICAgICAgcmVxdWVzdC5zZW5kKHVybCwgJ1BPU1QnLCBib2R5LCBoZWFkZXJzLCBzdWNjZXNzLCBlcnJvcik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdldCBtb3ZpZSBieSBpZCBvcGVyYXRpb24uXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGlkT3BlcmF0aW9uIFxuICAgICAqL1xuICAgIG1vdmllQnlJZDogZnVuY3Rpb24oaWRPcGVyYXRpb24sIHN1Y2Nlc3MsIGVycm9yKSB7XG4gICAgICAgIGNvbnN0IHVybCA9ICdodHRwczovL2FwaWdhdGV3YXkuc3VwZXJhcHBiYXouY29tL2ludGVncmFjaW9uL3N1cGVyYXBwL2NhbmFsL2NsaWVudGVzL2dlc3Rpb24tc2VzaW9uZXMvdjEvcG9ydGFsL29wZXJhY2lvbmVzLycgKyBpZE9wZXJhdGlvbjtcbiAgICAgICAgcmVxdWVzdC5zZW5kKHVybCwgJ0dFVCcsIHVuZGVmaW5lZCwge1xuICAgICAgICAgICAgJ3gtc2ljdSc6ICczYmFkMTI5MGFjNDYwMGE1NjkxNjJlZmFhMDkxMTdlYScsXG4gICAgICAgICAgICAneC1pZC1pbnRlcmFjY2lvbic6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2NTU0NDAwMDAnLFxuICAgICAgICAgICAgJ3gtdG9rZW4tdXN1YXJpbyc6ICdTUmZWWnJUWXZkbTdtenpabWN1aURWaUFDa0F4J1xuICAgICAgICB9LCBzdWNjZXNzLCBlcnJvcik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFBheS5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gaGVhZGVyc1xuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBib2R5XG4gICAgICogQHBhcmFtIHtib29sZWFufSBwcm9kdWN0aW9uXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2Vzc1xuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXG4gICAgICovXG4gICAgcGF5OiBmdW5jdGlvbiAoaGVhZGVycywgYm9keSwgcHJvZHVjdGlvbiwgc3VjY2VzcywgZXJyb3IpIHtcbiAgICAgICAgY29uc3QgdXJsID0gcHJvZHVjdGlvbiBcbiAgICAgICAgICAgID8gXCJodHRwczovL2FwaS5iYXphcHBncy5jb20vc3VwZXJhcHAvcGFnb3MvY2FwdGFjaW9uL3RyYXNwYXNvcy92MS9ib3Rvbi1wYWdvXCJcbiAgICAgICAgICAgIC8vID8gXCJodHRwczovL2FwaS5iYXouYXBwL3N1cGVyYXBwL3BhZ29zL2NhcHRhY2lvbi90cmFzcGFzb3MvdjEvYm90b24tcGFnb1wiXG4gICAgICAgICAgICA6IFwiaHR0cHM6Ly9hcGlnYXRld2F5LnN1cGVyYXBwYmF6LmNvbS9pbnRlZ3JhY2lvbi9zdXBlcmFwcC9wYWdvcy9jYXB0YWNpb24vdHJhc3Bhc29zL3YxL2JvdG9uLXBhZ29cIjtcbiAgICAgICAgICAgIC8vIDogXCJodHRwOi8vMTI3LjAuMC4xOjMwMDBcIlxuICAgICAgICAgICAgXG4gICAgICAgIGNvbnN0IHJhdyA9IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xuXG4gICAgICAgIHJlcXVlc3Quc2VuZCh1cmwsICdQT1NUJywgcmF3LCBoZWFkZXJzLCBzdWNjZXNzLCBlcnJvcik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIE1ha2UgcmVxdWVzdC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtZXRob2RcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYm9keVxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBqc29uSGVhZGVycyBcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzIFxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXG4gICAgICovXG4gICAgc2VuZDogZnVuY3Rpb24gKHVybCwgbWV0aG9kLCBib2R5LCBqc29uSGVhZGVycywgc3VjY2VzcywgZXJyb3IpIHtcbiAgICAgICAgLyogY29uc3QgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XG5cbiAgICAgICAgZm9yIChsZXQgcHJvcCBpbiBqc29uSGVhZGVycykge1xuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQocHJvcCwganNvbkhlYWRlcnNbcHJvcF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZmV0Y2godXJsLCB7IG1ldGhvZCwgaGVhZGVycywgYm9keSwgcmVkaXJlY3Q6ICdmb2xsb3cnIH0pXG4gICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgICAgICAgICAudGhlbihzdWNjZXNzKVxuICAgICAgICAgICAgLmNhdGNoKGVycm9yKTsgKi9cbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybCwgXG4gICAgICAgICAgICBtZXRob2QsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLCBcbiAgICAgICAgICAgIGhlYWRlcnM6IGpzb25IZWFkZXJzLCBcbiAgICAgICAgICAgIGRhdGE6IGJvZHksXG4gICAgICAgICAgICBzdWNjZXNzLFxuICAgICAgICAgICAgZXJyb3JcbiAgICAgICAgfSk7XG4gICAgfVxufTsiLCJsZXQgZW52aXJvbm1lbnQgPSBmYWxzZTtcblxuLyoqXG4gKiBCaW5kIEpTT04gdG8gSFRNTC5cbiAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXNcbiAqL1xuZnVuY3Rpb24gYmluZCh2YWx1ZXMpIHtcbiAgICBjb25zdCAkdGFncyA9ICQoJ1tkYXRhLWlkXScpO1xuXG4gICAgJHRhZ3MuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0ICR0YWcgPSAkKHRoaXMpO1xuICAgICAgICBjb25zdCBpZCA9ICR0YWcuZGF0YSgnaWQnKTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbaWRdO1xuXG4gICAgICAgIGlmIChpZCA9PT0gJ3ByZWNpbycpIHtcbiAgICAgICAgICAgICR0YWcuaHRtbChmb3JtYXRBbW91bnQodmFsdWUpKTtcbiAgICAgICAgfSBlbHNlIGlmIChpZCA9PT0gJ3NhbGRvJykge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSAnZmFsc2UnKSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHNob3dBZHZpY2UoJHRhZywgdHJ1ZSk7IH0sIDUwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkdGFnLmh0bWwodmFsdWUpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbi8qKlxuICogUGFyc2Ugc3RyaW5nIHRvIG9iamVjdCBhbmQgdGhlbiBiaW5kLlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ckpzb24gXG4gKi9cbmZ1bmN0aW9uIGJpbmRGcm9tU3RyKHN0ckpzb24pIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShzdHJKc29uKTtcbiAgICAgICAgYmluZChqc29uKTtcbiAgICB9IGNhdGNoIChlcnIpIHsgY29uc29sZS5sb2coZXJyKTsgfVxufVxuXG4vKipcbiAqIENoYW5nZSBzY3JlZW4uXG4gKiBAcGFyYW0ge2pRdWVyeX0gJHNjcmVlblxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcbiAqL1xuZnVuY3Rpb24gY2hhbmdlU2NyZWVuKCRzY3JlZW4sIGNhbGxiYWNrKSB7XG4gICAgJCgnLnNjcmVlbicpLmFkZENsYXNzKCduby12aXNpYmxlJyk7XG4gICAgJHNjcmVlbi5yZW1vdmVDbGFzcygnbm8tdmlzaWJsZScpO1xuXG4gICAgY2FsbGJhY2soKTtcbn1cblxuLyoqXG4gKiBHZXQgYW1vdW50IHdpdGggY3VycmVuY3kgZm9ybWF0LlxuICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudCBcbiAqIEByZXR1cm5zIHtzdHJpbmd9XG4gKi9cbmZ1bmN0aW9uIGZvcm1hdEFtb3VudChhbW91bnQpIHtcbiAgICByZXR1cm4gJyQgJyArIE51bWJlcihhbW91bnQpLnRvRml4ZWQoMikucmVwbGFjZSgvXFxCKD89KFxcZHszfSkrKD8hXFxkKSkvZywgJywnKTtcbn1cblxuLyoqXG4gKiBIYW5kbGUgZGlnaXQga2V5dXAgZXZlbnQuXG4gKiBAcGFyYW0ge0tleWJvYXJkRXZlbnR9IGV2ZW50XG4gKi9cbmZ1bmN0aW9uIGhhbmRsZURpZ2l0S2V5dXAoeyB0YXJnZXQsIGtleUNvZGUgfSkge1xuICAgIGNvbnN0ICRwYXJlbnQgPSAkKHRhcmdldC5wYXJlbnROb2RlKTtcblxuICAgIGlmIChrZXlDb2RlID09PSA4KSB7XG4gICAgICAgIGlmICgkcGFyZW50LnByZXYoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCAkaW5wdXQgPSAkcGFyZW50LnByZXYoKS5maW5kKCdpbnB1dCcpO1xuXG4gICAgICAgICAgICAkaW5wdXQudmFsKCcnKTtcbiAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xuICAgICAgICB9XG5cbiAgICB9IGVsc2UgaWYgKGtleUNvZGUgPiA0NyAmJiBrZXlDb2RlIDwgNTgpIHtcbiAgICAgICAgaWYgKHRhcmdldC52YWx1ZSAhPT0gJycpIHtcbiAgICAgICAgICAgIGlmICgkcGFyZW50Lm5leHQoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJHBhcmVudC5uZXh0KCkuZmluZCgnaW5wdXQnKTtcbiAgICAgICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhbGlkYXRlQ29kZSgpO1xufVxuXG4vKipcbiAqIEFwcGx5IG51bWJlciBmaWx0ZXIuXG4gKiBAcGFyYW0ge0V2ZW50fSBldmVudFxuICovXG5mdW5jdGlvbiBudW1iZXJGaWx0ZXIoZXZlbnQpIHtcbiAgICBjb25zdCBmaWx0ZXIgPSAvXlxcZHswLDF9JC87XG5cbiAgICBpZiAoZmlsdGVyLnRlc3QodGhpcy52YWx1ZSkpIHtcbiAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uU3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICB0aGlzLm9sZFNlbGVjdGlvbkVuZCA9IHRoaXMuc2VsZWN0aW9uRW5kO1xuICAgIH0gZWxzZSBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eSgnb2xkVmFsdWUnKSkge1xuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb25SYW5nZSh0aGlzLm9sZFNlbGVjdGlvblN0YXJ0LCB0aGlzLm9sZFNlbGVjdGlvbkVuZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9ICcnO1xuICAgIH1cbn1cblxuLyoqXG4gKiBEbyBmYWtlIHJlcXVlc3QuXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xuICovXG5mdW5jdGlvbiBmYWtlUmVxdWVzdChjb2RlLCBjYWxsYmFjaykge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBjYWxsYmFjayhjb2RlID09PSAnMDAwMDAxJyk7XG4gICAgfSwgMTUwMCk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0ckpzb25cbiAqL1xuZnVuY3Rpb24gcGF5TW92aWUoc3RySnNvbikge1xuICAgIGNvbnN0IGhhbmRsZUVyciA9IGVyciA9PiB7XG4gICAgICAgIC8vIGNvbnN0IG1lc3NhZ2UgPSB0eXBlb2YgZXJyID09PSAnb2JqZWN0JyA/IGVyci5tZXNzYWdlIDogZXJyO1xuICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShlcnIpKTtcbiAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuZXJyb3JQYXltZW50UmVzcG9uc2UucG9zdE1lc3NhZ2UoXCJlcnJvclBheW1lbnRSZXNwb25zZXxcIiArIEpTT04uc3RyaW5naWZ5KGVycikpO1xuICAgIH1cblxuICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnNob3dMb2FkZXIucG9zdE1lc3NhZ2UoXCJzaG93TG9hZGVyXCIpO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2Uoc3RySnNvbik7XG5cbiAgICAgICAgcmVxdWVzdC5wYXkoanNvblsnaGVhZGVycyddLCBqc29uWydyZXF1ZXN0Qm9keSddLCBlbnZpcm9ubWVudCwgZnVuY3Rpb24gKHBheVJlcykge1xuICAgICAgICAgICAgaWYgKHBheVJlcy5jb2RpZ28gPT0gJzIwMScpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5wYXltZW50UmVzcG9uc2UucG9zdE1lc3NhZ2UoXCJwYXltZW50UmVzcG9uc2V8XCIgKyBKU09OLnN0cmluZ2lmeSh7IGVycm9yOiB7IGNvZGU6IDAsIGRhdGE6IHBheVJlcyB9IH0pKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlRXJyKHsgZXJyb3I6IHsgY29kZTogcGF5UmVzLmNvZGlnbywgbWVzc2FnZTogcGF5UmVzLm1lbnNhamUgfSwgd2ViZXJyb3I6IDkwMCwgd2ViZXJyb3JtZXNzYWdlOiBcIkVsIGVycm9yIGxvIGVudsOtbyBlbCBzZXJ2aWNpb1wiIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5oaWRlTG9hZGVyLnBvc3RNZXNzYWdlKFwiaGlkZUxvYWRlclwiKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikge1xuICAgICAgICAgICAgaGFuZGxlRXJyKHsgZXJyb3I6IHsgY29kZTogNTAwLCBtZXNzYWdlOiBlcnJvclRocm93biB9LCB3ZWJlcnJvcjogOTAxLCB3ZWJlcnJvcm1lc3NhZ2U6IGVycm9yVGhyb3duIH0pO1xuICAgICAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuaGlkZUxvYWRlci5wb3N0TWVzc2FnZShcImhpZGVMb2FkZXJcIik7XG4gICAgICAgIH0pO1xuXG4gICAgfSBjYXRjaCAoZXJyKSB7IFxuICAgICAgICBoYW5kbGVFcnIoeyBlcnJvcjogeyBjb2RlOiA1MDAsIG1lc3NhZ2U6IGVyci5tZXNzYWdlIH0sIHdlYmVycm9yOiA5MDIsIHdlYmVycm9ybWVzc2FnZTogXCJFcnJvciBhbCBoYWNlciBsYSBwZXRpY2nDs25cIiB9KTsgXG4gICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLmhpZGVMb2FkZXIucG9zdE1lc3NhZ2UoXCJoaWRlTG9hZGVyXCIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBQYXJzZSBsb2NhdGlvbi5zZWFyY2ggdG8gSlNPTi5cbiAqIEByZXR1cm5zIG9iamVjdFxuICovXG5mdW5jdGlvbiBzZWFyY2hUb0pzb24oKSB7XG4gICAgY29uc3QgcGFpcnMgPSBsb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpLnNwbGl0KCcmJyk7XG4gICAgY29uc3Qgb2JqZWN0ID0ge307XG4gICAgbGV0IGkgPSAwO1xuXG4gICAgZm9yICg7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAocGFpcnNbaV0gPT09ICcnKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBhcnRzID0gcGFpcnNbaV0uc3BsaXQoJz0nKTtcbiAgICAgICAgb2JqZWN0W2RlY29kZVVSSUNvbXBvbmVudChwYXJ0c1swXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzFdKTtcbiAgICB9XG5cbiAgICByZXR1cm4gb2JqZWN0O1xufVxuXG4vKipcbiAqIFNob3cgb3IgaGlkZSBhZHZpY2UuXG4gKiBAcGFyYW0ge2pRdWVyeX0gJGVsIFxuICogQHBhcmFtIHtib29sZWFufSBmbGFnIFxuICovXG5mdW5jdGlvbiBzaG93QWR2aWNlKCRlbCwgZmxhZykge1xuICAgIGlmIChmbGFnKSB7XG4gICAgICAgICRlbC5hZGRDbGFzcygnbm8tdmlzaWJsZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgICRlbC5yZW1vdmVDbGFzcygnbm8tdmlzaWJsZScpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBTaG93IG9yIGhpZGUgbG9hZGVyLlxuICogQHBhcmFtIHtib29sZWFufSBzaG93XG4gKi9cbmZ1bmN0aW9uIHNob3dMb2FkZXIoc2hvdykge1xuICAgIGxldCAkbG9hZGVyID0gJCgnLmxvYWRlcicpO1xuXG4gICAgaWYgKHNob3cpIHtcbiAgICAgICAgaWYgKCRsb2FkZXIubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgICRsb2FkZXIgPSAkKCc8ZGl2IGNsYXNzPVwibG9hZGVyXCI+Jyk7XG4gICAgICAgIH1cblxuICAgICAgICAkKCdib2R5JykuYXBwZW5kKCRsb2FkZXIpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+ICRsb2FkZXIuYWRkQ2xhc3MoJ2xvYWRlci12aXNpYmxlJyksIDEwKTtcblxuICAgIH0gZWxzZSB7XG4gICAgICAgICRsb2FkZXIucmVtb3ZlQ2xhc3MoJ2xvYWRlci12aXNpYmxlJyk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gJGxvYWRlci5yZW1vdmUoKSwgMzc1KTtcblxuICAgIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBjb2RlIGZyb20gY2xpZW50LlxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlQ29kZSgpIHtcbiAgICBjb25zdCAkY29kZSA9ICQoJy5hdXRoLXNjcmVlbiAuY29kZScpO1xuICAgIGNvbnN0ICRkaWdpdHMgPSAkKCcuYXV0aC1zY3JlZW4gLmRpZ2l0IGlucHV0Jyk7XG4gICAgbGV0IGNvZGUgPSBcIlwiO1xuXG4gICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29kZSArPSB0aGlzLnZhbHVlO1xuICAgIH0pO1xuXG4gICAgaWYgKGNvZGUubGVuZ3RoID09PSA2KSB7XG4gICAgICAgIHNob3dMb2FkZXIodHJ1ZSk7XG5cbiAgICAgICAgZmFrZVJlcXVlc3QoY29kZSwgc3VjY2VzcyA9PiB7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCd2YWxpZCcpO1xuXG4gICAgICAgICAgICAgICAgY2hhbmdlU2NyZWVuKCQoJy5yZXN1bWUtc2NyZWVuJyksICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xuICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCdpbnZhbGlkJyk7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHsgJCh0aGlzKS52YWwoJycpOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lcSgwKS5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgICRjb2RlLnJlbW92ZUNsYXNzKCd2YWxpZCBpbnZhbGlkJyk7XG4gICAgfVxufVxuXG5cbi8vIEluaXRpYWxpemUgRGV0YWlsIFNjcmVlbiBjb21wb25lbnRzLlxuY29uc3Qgc2VhcmNoSnNvbiA9IHNlYXJjaFRvSnNvbigpO1xuXG5lbnZpcm9ubWVudCA9IHNlYXJjaEpzb25bJ2Vudmlyb25tZW50J10gPT09ICd0cnVlJztcbi8vIGJpbmQoc2VhcmNoSnNvbik7XG5jb25zb2xlLmxvZyhzZWFyY2hKc29uKTtcblxuY29uc3QgJGFkdmljZXMgPSAkKCcuYWR2aWNlLmZpeGVkJyk7XG5cbiRhZHZpY2VzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0ICRhZHZpY2UgPSAkKHRoaXMpO1xuICAgIGNvbnN0ICRjbG9zZUJ0biA9ICRhZHZpY2UuZmluZCgnLmNsb3NlLWJ0bicpO1xuXG4gICAgJGNsb3NlQnRuLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2hvd0FkdmljZSgkYWR2aWNlLCBmYWxzZSk7XG4gICAgfSk7XG59KTtcblxuJCgnLmRldGFpbC1zY3JlZW4gLnN3aXBlLWJ0bicpLnN3aXBlKHtcbiAgICBjYjogZnVuY3Rpb24gKCkge1xuICAgICAgICBzaG93TG9hZGVyKHRydWUpO1xuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IE9wZW4gZGlnaXRhbCBzaWduJyk7XG4gICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5zaG93RGlnaXRhbFNpZ24ucG9zdE1lc3NhZ2UoXCJzaG93RGlnaXRhbFNpZ25cIik7XG4gICAgICAgIH0sIDUwMCk7XG4gICAgfVxufSk7XG5cblxuLy8gSW5pdGlhbGl6ZSBBdXRoIFNjcmVlbiBjb21wb25lbnRzLlxuY29uc3QgJGRpZ2l0cyA9ICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKTtcblxuJGRpZ2l0cy5vbigna2V5cHJlc3Mga2V5ZG93biBrZXl1cCBpbnB1dCBjaGFuZ2UgcGFzdGUnLCBudW1iZXJGaWx0ZXIpXG4kZGlnaXRzLm9uKCdrZXl1cCcsIGhhbmRsZURpZ2l0S2V5dXApO1xuXG4kZGlnaXRzLmVxKDApLmZvY3VzKCk7XG5cblxuLy8gSW5pdGlhbGl6ZSBjbG9zZSBidXR0b25zLlxuJCgnLnNjcmVlbiBoZWFkZXIgLmNsb3NlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogQ2xvc2luZyBXZWJWaWV3Jyk7XG4gICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuY2xvc2VNb3ZpZVBheW1lbnQucG9zdE1lc3NhZ2UoXCJjbG9zZU1vdmllUGF5bWVudFwiKTtcbn0pO1xuXG5cbi8vIEluaXRpYWxpemUgc2hhcmUgYnV0dG9uLlxuJCgnLnNoYXJlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogU2hhcmluZyB0aWNrZXQnKTtcbiAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5zaGFyZVRpY2tldC5wb3N0TWVzc2FnZShcInNoYXJlVGlja2V0XCIpO1xufSk7XG5cblxuLy8gSW5pdGlhbGl6ZSBtb3ZpZSBidXR0b24uXG4kKCcubW92aWUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBQbGF5IG1vdmllJyk7XG4gICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMucGxheU1vdmllLnBvc3RNZXNzYWdlKFwicGxheU1vdmllXCIpO1xufSk7XG4iXX0=

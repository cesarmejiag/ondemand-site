"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(r){r.fn.swipe=function(e){var c=r.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var t=r(this),n=0,o=0,i=!1,s=t.find(".slider"),a=t.find(".text");s.on("mousedown touchstart",function(e){i=!0,o=t.width()-r(this).width()+10,n=e.clientX||e.originalEvent.touches[0].pageX}),r(document.body,s).on("mouseup touchend",function(e){if(i){if(i=!1,(e.clientX||e.changedTouches[0].pageX)-n<o)return a.fadeTo(300,1),void s.animate({left:"-10px"},300);c.cb()}}),r(document.body).on("mousemove touchmove",function(e){var t;i&&(e=1-(t=(e.clientX||e.originalEvent.touches[0].pageX)-n)/o,a.fadeTo(0,e),t<=0?s.css({left:"-10px"}):o+10<=t?s.css({left:o+"px"}):s.css({left:t-10}))})})}}(jQuery);var request={auth:function(e,t){var n={Authorization:"Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7"),"Content-Type":"application/x-www-form-urlencoded",Cookie:"XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"};request.send("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token","POST","grant_type=client_credentials",n,e,t)},pay:function(e,t,n,o,i){n=JSON.stringify(n);t.Authorization="Bearer "+e,request.send("https://apigateway.superappbaz.com/integracion/superapp/pagos/captacion/traspasos/v1/boton-pago","POST",n,t,o,i)},send:function(e,t,n,o,i,s){var a,c=new Headers;for(a in o)c.append(a,o[a]);fetch(e,{method:t,headers:c,body:n,redirect:"follow"}).then(function(e){return e.json()}).then(i).catch(s)}};function bind(o){$("[data-id]").each(function(){var e=$(this),t=e.data("id"),n=o[t];"precio"===t?e.html(formatAmount(n)):"saldo"===t?"false"===n&&setTimeout(function(){showAdvice(e,!0)},500):e.html(n)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,t){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),t()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var t=e.target,n=e.keyCode,o=$(t.parentNode);8===n?0<o.prev().length&&((e=o.prev().find("input")).val(""),e.focus()):47<n&&n<58&&""!==t.value&&0<o.next().length&&o.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function fakeRequest(e,t){setTimeout(function(){t("000001"===e)},1500)}function payMovie(e){function t(e){e="object"===_typeof(e)?e.message:e,console.log(JSON.stringify({message:e}))}try{var n=JSON.parse(e);request.auth(function(e){"string"==typeof e.access_token?request.pay(e.access_token,n.headers,n.transaccion,function(e){"webkit"in window&&window.webkit.messageHandlers.paymentResponse.postMessage("paymentResponse|"+JSON.stringify(e))},t):t(e)},t)}catch(e){t(e)}}function searchToJson(){for(var e,t=location.search.substring(1).split("&"),n={},o=0;o<t.length;o++)""!==t[o]&&(e=t[o].split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return n}function showAdvice(e,t){t?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var t=$(".loader");e?(t.length<=0&&(t=$('<div class="loader">')),$("body").append(t),setTimeout(function(){return t.addClass("loader-visible")},10)):(t.removeClass("loader-visible"),setTimeout(function(){return t.remove()},375))}function validateCode(){var t=$(".auth-screen .code"),n=$(".auth-screen .digit input"),e="";n.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(t.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),t.addClass("invalid"),setTimeout(function(){n.each(function(){$(this).val("")}),n.eq(0).focus()},100))})):t.removeClass("valid invalid")}bind(searchToJson());var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),"webkit"in window&&window.webkit.messageHandlers.showDigitalSign.postMessage("showDigitalSign")},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),"webkit"in window&&window.webkit.messageHandlers.closeMoviePayment.postMessage("closeMoviePayment")}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),"webkit"in window&&window.webkit.messageHandlers.shareTicket.postMessage("shareTicket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),"webkit"in window&&window.webkit.messageHandlers.playMovie.postMessage("playMovie")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5zd2lwZS5qcyIsInJlcXVlc3QuanMiLCJzY3JpcHRzLmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCJjb25zb2xlIiwibG9nIiwidGhpcyIsImVhY2giLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsImZpbmQiLCIkdGV4dCIsIm9uIiwiZXZlbnQiLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJib2R5IiwiY2hhbmdlZFRvdWNoZXMiLCJmYWRlVG8iLCJhbmltYXRlIiwibGVmdCIsInJlbGF0aXZlTW91c2UiLCJzbGlkZVBlcmNlbnQiLCJjc3MiLCJqUXVlcnkiLCJyZXF1ZXN0IiwiYXV0aCIsInN1Y2Nlc3MiLCJlcnJvciIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYnRvYSIsIkNvbnRlbnQtVHlwZSIsIkNvb2tpZSIsInNlbmQiLCJwYXkiLCJhY2Nlc3NUb2tlbiIsInJhdyIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1cmwiLCJtZXRob2QiLCJqc29uSGVhZGVycyIsInByb3AiLCJIZWFkZXJzIiwiYXBwZW5kIiwiZmV0Y2giLCJyZWRpcmVjdCIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJiaW5kIiwidmFsdWVzIiwiJHRhZyIsImlkIiwiZGF0YSIsInZhbHVlIiwiaHRtbCIsImZvcm1hdEFtb3VudCIsInNldFRpbWVvdXQiLCJzaG93QWR2aWNlIiwiYmluZEZyb21TdHIiLCJzdHJKc29uIiwicGFyc2UiLCJlcnIiLCJjaGFuZ2VTY3JlZW4iLCIkc2NyZWVuIiwiY2FsbGJhY2siLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwiYW1vdW50IiwiTnVtYmVyIiwidG9GaXhlZCIsInJlcGxhY2UiLCJoYW5kbGVEaWdpdEtleXVwIiwiX3JlZiIsInRhcmdldCIsImtleUNvZGUiLCIkcGFyZW50IiwicGFyZW50Tm9kZSIsInByZXYiLCJsZW5ndGgiLCIkaW5wdXQiLCJ2YWwiLCJmb2N1cyIsIm5leHQiLCJ2YWxpZGF0ZUNvZGUiLCJudW1iZXJGaWx0ZXIiLCJ0ZXN0Iiwib2xkVmFsdWUiLCJvbGRTZWxlY3Rpb25TdGFydCIsInNlbGVjdGlvblN0YXJ0Iiwib2xkU2VsZWN0aW9uRW5kIiwic2VsZWN0aW9uRW5kIiwiaGFzT3duUHJvcGVydHkiLCJzZXRTZWxlY3Rpb25SYW5nZSIsImZha2VSZXF1ZXN0IiwiY29kZSIsInBheU1vdmllIiwiaGFuZGxlRXJyIiwibWVzc2FnZSIsIl90eXBlb2YiLCJhdXRoUmVzIiwicGF5UmVzIiwid2luZG93Iiwid2Via2l0IiwibWVzc2FnZUhhbmRsZXJzIiwicGF5bWVudFJlc3BvbnNlIiwicG9zdE1lc3NhZ2UiLCJzZWFyY2hUb0pzb24iLCJwYXJ0cyIsInBhaXJzIiwibG9jYXRpb24iLCJzZWFyY2giLCJzdWJzdHJpbmciLCJzcGxpdCIsIm9iamVjdCIsImkiLCJkZWNvZGVVUklDb21wb25lbnQiLCIkZWwiLCJmbGFnIiwic2hvd0xvYWRlciIsInNob3ciLCIkbG9hZGVyIiwicmVtb3ZlIiwiJGNvZGUiLCIkZGlnaXRzIiwiZXEiLCIkYWR2aWNlcyIsIiRhZHZpY2UiLCJzaG93RGlnaXRhbFNpZ24iLCJjbG9zZU1vdmllUGF5bWVudCIsInNoYXJlVGlja2V0IiwicGxheU1vdmllIl0sIm1hcHBpbmdzIjoiK1BBRUEsU0FBQUEsR0FDQUEsRUFBQUMsR0FBQUMsTUFBQSxTQUFBQyxHQUNBLElBQUFDLEVBQUFKLEVBQUFLLE9BQUEsQ0FDQUMsR0FBQSxXQUNBQyxRQUFBQyxJQUFBLGdCQUVBTCxHQUVBLE9BQUFNLEtBQUFDLEtBQUEsV0FDQSxJQUFBQyxFQUFBWCxFQUFBUyxNQUNBRyxFQUFBLEVBQ0FDLEVBQUEsRUFDQUMsR0FBQSxFQUNBQyxFQUFBSixFQUFBSyxLQUFBLFdBQ0FDLEVBQUFO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RUE5RCxXQUFBLFdBQ0E5RCxRQUFBQyxJQUFBLGlDQUVBLFdBQUEwRyxRQUNBQSxPQUFBQyxPQUFBQyxnQkFBQXdCLGdCQUFBdEIsWUFBQSxvQkFFQSxRQU1BLElBQUFrQixRQUFBeEksRUFBQSw2QkFFQXdJLFFBQUF0SCxHQUFBLDRDQUFBK0UsY0FDQXVDLFFBQUF0SCxHQUFBLFFBQUFrRSxrQkFFQW9ELFFBQUFDLEdBQUEsR0FBQTNDLFFBSUE5RixFQUFBLDZCQUFBa0IsR0FBQSxRQUFBLFdBQ0FYLFFBQUFDLElBQUEsK0JBRUEsV0FBQTBHLFFBQ0FBLE9BQUFDLE9BQUFDLGdCQUFBeUIsa0JBQUF2QixZQUFBLHVCQU1BdEgsRUFBQSxjQUFBa0IsR0FBQSxRQUFBLFdBQ0FYLFFBQUFDLElBQUEsOEJBRUEsV0FBQTBHLFFBQ0FBLE9BQUFDLE9BQUFDLGdCQUFBMEIsWUFBQXhCLFlBQUEsaUJBTUF0SCxFQUFBLGNBQUFrQixHQUFBLFFBQUEsV0FDQVgsUUFBQUMsSUFBQSwwQkFFQSxXQUFBMEcsUUFDQUEsT0FBQUMsT0FBQUMsZ0JBQUEyQixVQUFBekIsWUFBQSIsImZpbGUiOiJzY3JpcHRzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFJlZmVyZW5jZTogaHR0cHM6Ly9jb2RlcGVuLmlvL2dwcmVzc3V0dG81L3Blbi9OakpvYkc/ZWRpdG9ycz0wMDEwXG5cbihmdW5jdGlvbiAoJCkge1xuICAgICQuZm4uc3dpcGUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7XG4gICAgICAgICAgICBjYjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N3aXBlIGRvbmUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgb3B0aW9ucyk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgdmFyIGluaXRpYWxNb3VzZSA9IDA7XG4gICAgICAgICAgICB2YXIgc2xpZGVNb3ZlbWVudFRvdGFsID0gMDtcbiAgICAgICAgICAgIHZhciBtb3VzZUlzRG93biA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyICRzbGlkZXIgPSAkdGhpcy5maW5kKCcuc2xpZGVyJyk7XG4gICAgICAgICAgICB2YXIgJHRleHQgPSAkdGhpcy5maW5kKCcudGV4dCcpO1xuXG4gICAgICAgICAgICAkc2xpZGVyLm9uKCdtb3VzZWRvd24gdG91Y2hzdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIG1vdXNlSXNEb3duID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzbGlkZU1vdmVtZW50VG90YWwgPSAkdGhpcy53aWR0aCgpIC0gJCh0aGlzKS53aWR0aCgpICsgMTA7XG4gICAgICAgICAgICAgICAgaW5pdGlhbE1vdXNlID0gZXZlbnQuY2xpZW50WCB8fCBldmVudC5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVg7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5LCAkc2xpZGVyKS5vbignbW91c2V1cCB0b3VjaGVuZCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIGlmICghbW91c2VJc0Rvd24pXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBtb3VzZUlzRG93biA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50TW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYO1xuICAgICAgICAgICAgICAgIHZhciByZWxhdGl2ZU1vdXNlID0gY3VycmVudE1vdXNlIC0gaW5pdGlhbE1vdXNlO1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPCBzbGlkZU1vdmVtZW50VG90YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgJHRleHQuZmFkZVRvKDMwMCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICRzbGlkZXIuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBcIi0xMHB4XCJcbiAgICAgICAgICAgICAgICAgICAgfSwgMzAwKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8qICRzbGlkZXIuYWRkQ2xhc3MoJ3VubG9ja2VkJyk7XG4gICAgICAgICAgICAgICAgJCgnI2xvY2tlcicpLnRleHQoJ2xvY2tfb3V0bGluZScpO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLm9uKCdjbGljayB0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHNsaWRlci5oYXNDbGFzcygndW5sb2NrZWQnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLnJlbW92ZUNsYXNzKCd1bmxvY2tlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2xvY2tlcicpLnRleHQoJ2xvY2tfb3BlbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5vZmYoJ2NsaWNrIHRhcCcpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCAwKTsgKi9cblxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmNiKCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5KS5vbignbW91c2Vtb3ZlIHRvdWNobW92ZScsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIGlmICghbW91c2VJc0Rvd24pXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50TW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXS5wYWdlWDtcbiAgICAgICAgICAgICAgICB2YXIgcmVsYXRpdmVNb3VzZSA9IGN1cnJlbnRNb3VzZSAtIGluaXRpYWxNb3VzZTtcbiAgICAgICAgICAgICAgICB2YXIgc2xpZGVQZXJjZW50ID0gMSAtIChyZWxhdGl2ZU1vdXNlIC8gc2xpZGVNb3ZlbWVudFRvdGFsKTtcblxuICAgICAgICAgICAgICAgICR0ZXh0LmZhZGVUbygwLCBzbGlkZVBlcmNlbnQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0JzogJy0xMHB4JyB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA+PSBzbGlkZU1vdmVtZW50VG90YWwgKyAxMCkge1xuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0Jzogc2xpZGVNb3ZlbWVudFRvdGFsICsgJ3B4JyB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0JzogcmVsYXRpdmVNb3VzZSAtIDEwIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pKGpRdWVyeSk7XG4iLCJjb25zdCByZXF1ZXN0ID0ge1xuICAgIC8qKlxuICAgICAqIEF1dGhlbnRpY2F0ZS5cbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZXJyb3JcbiAgICAgKi9cbiAgICBhdXRoOiBmdW5jdGlvbiAoc3VjY2VzcywgZXJyb3IpIHtcbiAgICAgICAgY29uc3QgdXJsID0gXCJodHRwczovL29tbTZvdWc1cGcuZXhlY3V0ZS1hcGkudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vZGVzYXJyb2xsby9vYXV0aDIvdjEvdG9rZW5cIjtcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IHtcbiAgICAgICAgICAgIFwiQXV0aG9yaXphdGlvblwiOiBcIkJhc2ljIFwiICsgYnRvYShcIjE4aDh2YW52cmg0cHVpMWxybnRjMW5pbGpmXCIgKyBcIjpcIiArIFwiMWdlMzFiaGpyZGs5ZDBqYTE0bWZ0OHFlcGk0Y2xrdDgwNWpxYjJzdnF2bWI0c28xdjRnN1wiKSxcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIsXG4gICAgICAgICAgICBcIkNvb2tpZVwiOiBcIlhTUkYtVE9LRU49YjRhNTRmMWItYWZlNS00YWVlLTlhNzYtMDBmOTIwNDE4YjZlXCJcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgYm9keSA9IFwiZ3JhbnRfdHlwZT1jbGllbnRfY3JlZGVudGlhbHNcIjtcblxuICAgICAgICByZXF1ZXN0LnNlbmQodXJsLCAnUE9TVCcsIGJvZHksIGhlYWRlcnMsIHN1Y2Nlc3MsIGVycm9yKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUGF5LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBhY2Nlc3NUb2tlblxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBoZWFkZXJzXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGJvZHlcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZXJyb3JcbiAgICAgKi9cbiAgICBwYXk6IGZ1bmN0aW9uIChhY2Nlc3NUb2tlbiwgaGVhZGVycywgYm9keSwgc3VjY2VzcywgZXJyb3IpIHtcbiAgICAgICAgY29uc3QgdXJsID0gXCJodHRwczovL2FwaWdhdGV3YXkuc3VwZXJhcHBiYXouY29tL2ludGVncmFjaW9uL3N1cGVyYXBwL3BhZ29zL2NhcHRhY2lvbi90cmFzcGFzb3MvdjEvYm90b24tcGFnb1wiO1xuICAgICAgICBjb25zdCByYXcgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcblxuICAgICAgICBoZWFkZXJzW1wiQXV0aG9yaXphdGlvblwiXSA9IFwiQmVhcmVyIFwiICsgYWNjZXNzVG9rZW47XG4gICAgICAgIHJlcXVlc3Quc2VuZCh1cmwsICdQT1NUJywgcmF3LCBoZWFkZXJzLCBzdWNjZXNzLCBlcnJvcik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIE1ha2UgcmVxdWVzdC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtZXRob2RcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYm9keVxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBqc29uSGVhZGVycyBcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBzdWNjZXNzIFxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXG4gICAgICovXG4gICAgc2VuZDogZnVuY3Rpb24gKHVybCwgbWV0aG9kLCBib2R5LCBqc29uSGVhZGVycywgc3VjY2VzcywgZXJyb3IpIHtcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XG5cbiAgICAgICAgZm9yIChsZXQgcHJvcCBpbiBqc29uSGVhZGVycykge1xuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQocHJvcCwganNvbkhlYWRlcnNbcHJvcF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZmV0Y2godXJsLCB7IG1ldGhvZCwgaGVhZGVycywgYm9keSwgcmVkaXJlY3Q6ICdmb2xsb3cnIH0pXG4gICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgICAgICAgICAudGhlbihzdWNjZXNzKVxuICAgICAgICAgICAgLmNhdGNoKGVycm9yKTtcbiAgICB9XG59OyIsIi8qKlxuICogQmluZCBKU09OIHRvIEhUTUwuXG4gKiBAcGFyYW0ge29iamVjdH0gdmFsdWVzXG4gKi9cbmZ1bmN0aW9uIGJpbmQodmFsdWVzKSB7XG4gICAgY29uc3QgJHRhZ3MgPSAkKCdbZGF0YS1pZF0nKTtcblxuICAgICR0YWdzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCAkdGFnID0gJCh0aGlzKTtcbiAgICAgICAgY29uc3QgaWQgPSAkdGFnLmRhdGEoJ2lkJyk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2lkXTtcblxuICAgICAgICBpZiAoaWQgPT09ICdwcmVjaW8nKSB7XG4gICAgICAgICAgICAkdGFnLmh0bWwoZm9ybWF0QW1vdW50KHZhbHVlKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaWQgPT09ICdzYWxkbycpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJ2ZhbHNlJykge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBzaG93QWR2aWNlKCR0YWcsIHRydWUpOyB9LCA1MDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHRhZy5odG1sKHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG4vKipcbiAqIFBhcnNlIHN0cmluZyB0byBvYmplY3QgYW5kIHRoZW4gYmluZC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJKc29uIFxuICovXG5mdW5jdGlvbiBiaW5kRnJvbVN0cihzdHJKc29uKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2Uoc3RySnNvbik7XG4gICAgICAgIGJpbmQoanNvbik7XG4gICAgfSBjYXRjaCAoZXJyKSB7IGNvbnNvbGUubG9nKGVycik7IH1cbn1cblxuLyoqXG4gKiBDaGFuZ2Ugc2NyZWVuLlxuICogQHBhcmFtIHtqUXVlcnl9ICRzY3JlZW5cbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXG4gKi9cbmZ1bmN0aW9uIGNoYW5nZVNjcmVlbigkc2NyZWVuLCBjYWxsYmFjaykge1xuICAgICQoJy5zY3JlZW4nKS5hZGRDbGFzcygnbm8tdmlzaWJsZScpO1xuICAgICRzY3JlZW4ucmVtb3ZlQ2xhc3MoJ25vLXZpc2libGUnKTtcblxuICAgIGNhbGxiYWNrKCk7XG59XG5cbi8qKlxuICogR2V0IGFtb3VudCB3aXRoIGN1cnJlbmN5IGZvcm1hdC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBhbW91bnQgXG4gKiBAcmV0dXJucyB7c3RyaW5nfVxuICovXG5mdW5jdGlvbiBmb3JtYXRBbW91bnQoYW1vdW50KSB7XG4gICAgcmV0dXJuICckICcgKyBOdW1iZXIoYW1vdW50KS50b0ZpeGVkKDIpLnJlcGxhY2UoL1xcQig/PShcXGR7M30pKyg/IVxcZCkpL2csICcsJyk7XG59XG5cbi8qKlxuICogSGFuZGxlIGRpZ2l0IGtleXVwIGV2ZW50LlxuICogQHBhcmFtIHtLZXlib2FyZEV2ZW50fSBldmVudFxuICovXG5mdW5jdGlvbiBoYW5kbGVEaWdpdEtleXVwKHsgdGFyZ2V0LCBrZXlDb2RlIH0pIHtcbiAgICBjb25zdCAkcGFyZW50ID0gJCh0YXJnZXQucGFyZW50Tm9kZSk7XG5cbiAgICBpZiAoa2V5Q29kZSA9PT0gOCkge1xuICAgICAgICBpZiAoJHBhcmVudC5wcmV2KCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJHBhcmVudC5wcmV2KCkuZmluZCgnaW5wdXQnKTtcblxuICAgICAgICAgICAgJGlucHV0LnZhbCgnJyk7XG4gICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTtcbiAgICAgICAgfVxuXG4gICAgfSBlbHNlIGlmIChrZXlDb2RlID4gNDcgJiYga2V5Q29kZSA8IDU4KSB7XG4gICAgICAgIGlmICh0YXJnZXQudmFsdWUgIT09ICcnKSB7XG4gICAgICAgICAgICBpZiAoJHBhcmVudC5uZXh0KCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0ICRpbnB1dCA9ICRwYXJlbnQubmV4dCgpLmZpbmQoJ2lucHV0Jyk7XG4gICAgICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YWxpZGF0ZUNvZGUoKTtcbn1cblxuLyoqXG4gKiBBcHBseSBudW1iZXIgZmlsdGVyLlxuICogQHBhcmFtIHtFdmVudH0gZXZlbnRcbiAqL1xuZnVuY3Rpb24gbnVtYmVyRmlsdGVyKGV2ZW50KSB7XG4gICAgY29uc3QgZmlsdGVyID0gL15cXGR7MCwxfSQvO1xuXG4gICAgaWYgKGZpbHRlci50ZXN0KHRoaXMudmFsdWUpKSB7XG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgICAgICB0aGlzLm9sZFNlbGVjdGlvblN0YXJ0ID0gdGhpcy5zZWxlY3Rpb25TdGFydDtcbiAgICAgICAgdGhpcy5vbGRTZWxlY3Rpb25FbmQgPSB0aGlzLnNlbGVjdGlvbkVuZDtcbiAgICB9IGVsc2UgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoJ29sZFZhbHVlJykpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMub2xkVmFsdWU7XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uUmFuZ2UodGhpcy5vbGRTZWxlY3Rpb25TdGFydCwgdGhpcy5vbGRTZWxlY3Rpb25FbmQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSAnJztcbiAgICB9XG59XG5cbi8qKlxuICogRG8gZmFrZSByZXF1ZXN0LlxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcbiAqL1xuZnVuY3Rpb24gZmFrZVJlcXVlc3QoY29kZSwgY2FsbGJhY2spIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY2FsbGJhY2soY29kZSA9PT0gJzAwMDAwMScpO1xuICAgIH0sIDE1MDApO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJKc29uXG4gKi9cbmZ1bmN0aW9uIHBheU1vdmllKHN0ckpzb24pIHtcbiAgICBjb25zdCBoYW5kbGVFcnIgPSBlcnIgPT4ge1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gdHlwZW9mIGVyciA9PT0gJ29iamVjdCcgPyBlcnIubWVzc2FnZSA6IGVycjtcbiAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlIH0pKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShzdHJKc29uKTtcblxuICAgICAgICByZXF1ZXN0LmF1dGgoZnVuY3Rpb24gKGF1dGhSZXMpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgYXV0aFJlc1snYWNjZXNzX3Rva2VuJ10gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdC5wYXkoYXV0aFJlc1snYWNjZXNzX3Rva2VuJ10sIGpzb25bJ2hlYWRlcnMnXSwganNvblsndHJhbnNhY2Npb24nXSwgZnVuY3Rpb24gKHBheVJlcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5wYXltZW50UmVzcG9uc2UucG9zdE1lc3NhZ2UoXCJwYXltZW50UmVzcG9uc2V8XCIgKyBKU09OLnN0cmluZ2lmeShwYXlSZXMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGhhbmRsZUVycik7XG4gICAgICAgICAgICB9IGVsc2UgeyBoYW5kbGVFcnIoYXV0aFJlcyk7IH1cbiAgICAgICAgfSwgaGFuZGxlRXJyKTtcblxuICAgIH0gY2F0Y2ggKGVycikgeyBoYW5kbGVFcnIoZXJyKTsgfVxufVxuXG4vKipcbiAqIFBhcnNlIGxvY2F0aW9uLnNlYXJjaCB0byBKU09OLlxuICogQHJldHVybnMgb2JqZWN0XG4gKi9cbmZ1bmN0aW9uIHNlYXJjaFRvSnNvbigpIHtcbiAgICBjb25zdCBwYWlycyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSkuc3BsaXQoJyYnKTtcbiAgICBjb25zdCBvYmplY3QgPSB7fTtcbiAgICBsZXQgaSA9IDA7XG5cbiAgICBmb3IgKDsgaSA8IHBhaXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChwYWlyc1tpXSA9PT0gJycpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcGFydHMgPSBwYWlyc1tpXS5zcGxpdCgnPScpO1xuICAgICAgICBvYmplY3RbZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzBdKV0gPSBkZWNvZGVVUklDb21wb25lbnQocGFydHNbMV0pO1xuICAgIH1cblxuICAgIHJldHVybiBvYmplY3Q7XG59XG5cbi8qKlxuICogU2hvdyBvciBoaWRlIGFkdmljZS5cbiAqIEBwYXJhbSB7alF1ZXJ5fSAkZWwgXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGZsYWcgXG4gKi9cbmZ1bmN0aW9uIHNob3dBZHZpY2UoJGVsLCBmbGFnKSB7XG4gICAgaWYgKGZsYWcpIHtcbiAgICAgICAgJGVsLmFkZENsYXNzKCduby12aXNpYmxlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJGVsLnJlbW92ZUNsYXNzKCduby12aXNpYmxlJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIFNob3cgb3IgaGlkZSBsb2FkZXIuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHNob3dcbiAqL1xuZnVuY3Rpb24gc2hvd0xvYWRlcihzaG93KSB7XG4gICAgbGV0ICRsb2FkZXIgPSAkKCcubG9hZGVyJyk7XG5cbiAgICBpZiAoc2hvdykge1xuICAgICAgICBpZiAoJGxvYWRlci5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgJGxvYWRlciA9ICQoJzxkaXYgY2xhc3M9XCJsb2FkZXJcIj4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJGxvYWRlcik7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gJGxvYWRlci5hZGRDbGFzcygnbG9hZGVyLXZpc2libGUnKSwgMTApO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgJGxvYWRlci5yZW1vdmVDbGFzcygnbG9hZGVyLXZpc2libGUnKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiAkbG9hZGVyLnJlbW92ZSgpLCAzNzUpO1xuXG4gICAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIGNvZGUgZnJvbSBjbGllbnQuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVDb2RlKCkge1xuICAgIGNvbnN0ICRjb2RlID0gJCgnLmF1dGgtc2NyZWVuIC5jb2RlJyk7XG4gICAgY29uc3QgJGRpZ2l0cyA9ICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKTtcbiAgICBsZXQgY29kZSA9IFwiXCI7XG5cbiAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICBjb2RlICs9IHRoaXMudmFsdWU7XG4gICAgfSk7XG5cbiAgICBpZiAoY29kZS5sZW5ndGggPT09IDYpIHtcbiAgICAgICAgc2hvd0xvYWRlcih0cnVlKTtcblxuICAgICAgICBmYWtlUmVxdWVzdChjb2RlLCBzdWNjZXNzID0+IHtcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ3ZhbGlkJyk7XG5cbiAgICAgICAgICAgICAgICBjaGFuZ2VTY3JlZW4oJCgnLnJlc3VtZS1zY3JlZW4nKSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XG4gICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ2ludmFsaWQnKTtcblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkgeyAkKHRoaXMpLnZhbCgnJyk7IH0pO1xuICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVxKDApLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgJGNvZGUucmVtb3ZlQ2xhc3MoJ3ZhbGlkIGludmFsaWQnKTtcbiAgICB9XG59XG5cblxuLy8gSW5pdGlhbGl6ZSBEZXRhaWwgU2NyZWVuIGNvbXBvbmVudHMuXG5iaW5kKHNlYXJjaFRvSnNvbigpKTtcblxuY29uc3QgJGFkdmljZXMgPSAkKCcuYWR2aWNlLmZpeGVkJyk7XG5cbiRhZHZpY2VzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0ICRhZHZpY2UgPSAkKHRoaXMpO1xuICAgIGNvbnN0ICRjbG9zZUJ0biA9ICRhZHZpY2UuZmluZCgnLmNsb3NlLWJ0bicpO1xuXG4gICAgJGNsb3NlQnRuLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2hvd0FkdmljZSgkYWR2aWNlLCBmYWxzZSk7XG4gICAgfSk7XG59KTtcblxuJCgnLmRldGFpbC1zY3JlZW4gLnN3aXBlLWJ0bicpLnN3aXBlKHtcbiAgICBjYjogZnVuY3Rpb24gKCkge1xuICAgICAgICBzaG93TG9hZGVyKHRydWUpO1xuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IE9wZW4gZGlnaXRhbCBzaWduJylcblxuICAgICAgICAgICAgaWYgKCd3ZWJraXQnIGluIHdpbmRvdykge1xuICAgICAgICAgICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnNob3dEaWdpdGFsU2lnbi5wb3N0TWVzc2FnZShcInNob3dEaWdpdGFsU2lnblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgNTAwKTtcbiAgICB9XG59KTtcblxuXG4vLyBJbml0aWFsaXplIEF1dGggU2NyZWVuIGNvbXBvbmVudHMuXG5jb25zdCAkZGlnaXRzID0gJCgnLmF1dGgtc2NyZWVuIC5kaWdpdCBpbnB1dCcpO1xuXG4kZGlnaXRzLm9uKCdrZXlwcmVzcyBrZXlkb3duIGtleXVwIGlucHV0IGNoYW5nZSBwYXN0ZScsIG51bWJlckZpbHRlcilcbiRkaWdpdHMub24oJ2tleXVwJywgaGFuZGxlRGlnaXRLZXl1cCk7XG5cbiRkaWdpdHMuZXEoMCkuZm9jdXMoKTtcblxuXG4vLyBJbml0aWFsaXplIGNsb3NlIGJ1dHRvbnMuXG4kKCcuc2NyZWVuIGhlYWRlciAuY2xvc2UtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBDbG9zaW5nIFdlYlZpZXcnKTtcblxuICAgIGlmICgnd2Via2l0JyBpbiB3aW5kb3cpIHtcbiAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuY2xvc2VNb3ZpZVBheW1lbnQucG9zdE1lc3NhZ2UoXCJjbG9zZU1vdmllUGF5bWVudFwiKTtcbiAgICB9XG59KTtcblxuXG4vLyBJbml0aWFsaXplIHNoYXJlIGJ1dHRvbi5cbiQoJy5zaGFyZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IFNoYXJpbmcgdGlja2V0Jyk7XG5cbiAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XG4gICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnNoYXJlVGlja2V0LnBvc3RNZXNzYWdlKFwic2hhcmVUaWNrZXRcIik7XG4gICAgfVxufSk7XG5cblxuLy8gSW5pdGlhbGl6ZSBtb3ZpZSBidXR0b24uXG4kKCcubW92aWUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBQbGF5IG1vdmllJyk7XG5cbiAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XG4gICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnBsYXlNb3ZpZS5wb3N0TWVzc2FnZShcInBsYXlNb3ZpZVwiKTtcbiAgICB9XG59KTtcbiJdfQ==

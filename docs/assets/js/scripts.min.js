"use strict";!function(c){c.fn.swipe=function(e){var r=c.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var n=c(this),o=0,t=0,s=!1,i=n.find(".slider"),a=n.find(".text");i.on("mousedown touchstart",function(e){s=!0,t=n.width()-c(this).width()+10,o=e.clientX||e.originalEvent.touches[0].pageX}),c(document.body,i).on("mouseup touchend",function(e){if(s){if(s=!1,(e.clientX||e.changedTouches[0].pageX)-o<t)return a.fadeTo(300,1),void i.animate({left:"-10px"},300);r.cb()}}),c(document.body).on("mousemove touchmove",function(e){var n;s&&(e=1-(n=(e.clientX||e.originalEvent.touches[0].pageX)-o)/t,a.fadeTo(0,e),n<=0?i.css({left:"-10px"}):t+10<=n?i.css({left:t+"px"}):i.css({left:n-10}))})})}}(jQuery);var request={auth:function(e,n){var o={Authorization:"Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7"),"Content-Type":"application/x-www-form-urlencoded",Cookie:"XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"};request.send("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token","POST","grant_type=client_credentials",o,e,n)},pay:function(e,n,o,t,s,i){t=t?"https://api.appbazgs.com/superapp/pagos/captacion/traspasos/v1/boton-pago":"https://apigateway.superappbaz.com/integracion/superapp/pagos/captacion/traspasos/v1/boton-pago",o=JSON.stringify(o);request.send(t,"POST",o,n,s,i)},send:function(e,n,o,t,s,i){var a,r=new Headers;for(a in t)r.append(a,t[a]);fetch(e,{method:n,headers:r,body:o,redirect:"follow"}).then(function(e){return e.json()}).then(s).catch(i)}},environment=!1;function bind(t){$("[data-id]").each(function(){var e=$(this),n=e.data("id"),o=t[n];"precio"===n?e.html(formatAmount(o)):"saldo"===n?"false"===o&&setTimeout(function(){showAdvice(e,!0)},500):e.html(o)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,n){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),n()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var n=e.target,o=e.keyCode,t=$(n.parentNode);8===o?0<t.prev().length&&((e=t.prev().find("input")).val(""),e.focus()):47<o&&o<58&&""!==n.value&&0<t.next().length&&t.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function fakeRequest(e,n){setTimeout(function(){n("000001"===e)},1500)}function payMovie(e){function n(e){console.log(JSON.stringify(e)),window.webkit.messageHandlers.errorPaymentResponse.postMessage("errorPaymentResponse|"+JSON.stringify(e))}try{var o=JSON.parse(e);window.webkit.messageHandlers.showLoader.postMessage("showLoader"),request.pay("",o.headers,o.requestBody,environment,function(e){"201"==e.codigo?window.webkit.messageHandlers.paymentResponse.postMessage("paymentResponse|"+JSON.stringify({error:{code:0,data:e}})):n({error:{code:e.codigo,message:e.mensaje}}),window.webkit.messageHandlers.hideLoader.postMessage("hideLoader")},function(e){n({error:{code:500,message:e.message}}),window.webkit.messageHandlers.hideLoader.postMessage("hideLoader")})}catch(e){n(e)}}function searchToJson(){for(var e,n=location.search.substring(1).split("&"),o={},t=0;t<n.length;t++)""!==n[t]&&(e=n[t].split("="),o[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return o}function showAdvice(e,n){n?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var n=$(".loader");e?(n.length<=0&&(n=$('<div class="loader">')),$("body").append(n),setTimeout(function(){return n.addClass("loader-visible")},10)):(n.removeClass("loader-visible"),setTimeout(function(){return n.remove()},375))}function validateCode(){var n=$(".auth-screen .code"),o=$(".auth-screen .digit input"),e="";o.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(n.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),n.addClass("invalid"),setTimeout(function(){o.each(function(){$(this).val("")}),o.eq(0).focus()},100))})):n.removeClass("valid invalid")}var searchJson=searchToJson(),environment="true"===searchJson.environment;bind(searchJson);var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),window.webkit.messageHandlers.showDigitalSign.postMessage("showDigitalSign")},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),window.webkit.messageHandlers.closeMoviePayment.postMessage("closeMoviePayment")}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),window.webkit.messageHandlers.shareTicket.postMessage("shareTicket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),window.webkit.messageHandlers.playMovie.postMessage("playMovie")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5zd2lwZS5qcyIsInJlcXVlc3QuanMiLCJzY3JpcHRzLmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCJjb25zb2xlIiwibG9nIiwidGhpcyIsImVhY2giLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsImZpbmQiLCIkdGV4dCIsIm9uIiwiZXZlbnQiLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJib2R5IiwiY2hhbmdlZFRvdWNoZXMiLCJmYWRlVG8iLCJhbmltYXRlIiwibGVmdCIsInJlbGF0aXZlTW91c2UiLCJzbGlkZVBlcmNlbnQiLCJjc3MiLCJqUXVlcnkiLCJyZXF1ZXN0IiwiYXV0aCIsInN1Y2Nlc3MiLCJlcnJvciIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYnRvYSIsIkNvbnRlbnQtVHlwZSIsIkNvb2tpZSIsInNlbmQiLCJwYXkiLCJhY2Nlc3NUb2tlbiIsInByb2R1Y3Rpb24iLCJ1cmwiLCJyYXciLCJKU09OIiwic3RyaW5naWZ5IiwibWV0aG9kIiwianNvbkhlYWRlcnMiLCJwcm9wIiwiSGVhZGVycyIsImFwcGVuZCIsImZldGNoIiwicmVkaXJlY3QiLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwiZW52aXJvbm1lbnQiLCJiaW5kIiwidmFsdWVzIiwiJHRhZyIsImlkIiwiZGF0YSIsInZhbHVlIiwiaHRtbCIsImZvcm1hdEFtb3VudCIsInNldFRpbWVvdXQiLCJzaG93QWR2aWNlIiwiYmluZEZyb21TdHIiLCJzdHJKc29uIiwicGFyc2UiLCJlcnIiLCJjaGFuZ2VTY3JlZW4iLCIkc2NyZWVuIiwiY2FsbGJhY2siLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwiYW1vdW50IiwiTnVtYmVyIiwidG9GaXhlZCIsInJlcGxhY2UiLCJoYW5kbGVEaWdpdEtleXVwIiwiX3JlZiIsInRhcmdldCIsImtleUNvZGUiLCIkcGFyZW50IiwicGFyZW50Tm9kZSIsInByZXYiLCJsZW5ndGgiLCIkaW5wdXQiLCJ2YWwiLCJmb2N1cyIsIm5leHQiLCJ2YWxpZGF0ZUNvZGUiLCJudW1iZXJGaWx0ZXIiLCJ0ZXN0Iiwib2xkVmFsdWUiLCJvbGRTZWxlY3Rpb25TdGFydCIsInNlbGVjdGlvblN0YXJ0Iiwib2xkU2VsZWN0aW9uRW5kIiwic2VsZWN0aW9uRW5kIiwiaGFzT3duUHJvcGVydHkiLCJzZXRTZWxlY3Rpb25SYW5nZSIsImZha2VSZXF1ZXN0IiwiY29kZSIsInBheU1vdmllIiwiaGFuZGxlRXJyIiwid2luZG93Iiwid2Via2l0IiwibWVzc2FnZUhhbmRsZXJzIiwiZXJyb3JQYXltZW50UmVzcG9uc2UiLCJwb3N0TWVzc2FnZSIsInNob3dMb2FkZXIiLCJwYXlSZXMiLCJjb2RpZ28iLCJwYXltZW50UmVzcG9uc2UiLCJtZXNzYWdlIiwibWVuc2FqZSIsImhpZGVMb2FkZXIiLCJzZWFyY2hUb0pzb24iLCJwYXJ0cyIsInBhaXJzIiwibG9jYXRpb24iLCJzZWFyY2giLCJzdWJzdHJpbmciLCJzcGxpdCIsIm9iamVjdCIsImkiLCJkZWNvZGVVUklDb21wb25lbnQiLCIkZWwiLCJmbGFnIiwic2hvdyIsIiRsb2FkZXIiLCJyZW1vdmUiLCIkY29kZSIsIiRkaWdpdHMiLCJlcSIsInNlYXJjaEpzb24iLCIkYWR2aWNlcyIsIiRhZHZpY2UiLCJzaG93RGlnaXRhbFNpZ24iLCJjbG9zZU1vdmllUGF5bWVudCIsInNoYXJlVGlja2V0IiwicGxheU1vdmllIl0sIm1hcHBpbmdzIjoiY0FFQSxTQUFBQSxHQUNBQSxFQUFBQyxHQUFBQyxNQUFBLFNBQUFDLEdBQ0EsSUFBQUMsRUFBQUosRUFBQUssT0FBQSxDQUNBQyxHQUFBLFdBQ0FDLFFBQUFDLElBQUEsZ0JBRUFMLEdBRUEsT0FBQU0sS0FBQUMsS0FBQSxXQUNBLElBQUFDLEVBQUFY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QUEsR0FDQXNCLEVBQUEzRCxTQUFBLFdBRUFULFdBQUEsV0FDQXFFLEVBQUFsSSxLQUFBLFdBQUFWLEVBQUFTLE1BQUFzRixJQUFBLE1BQ0E2QyxFQUFBQyxHQUFBLEdBQUE3QyxTQUNBLFNBSUEyQyxFQUFBMUQsWUFBQSxpQkFNQSxJQUFBNkQsV0FBQWxCLGVBRUE5RCxZQUFBLFNBQUFnRixXQUFBLFlBQ0EvRSxLQUFBK0UsWUFFQSxJQUFBQyxTQUFBL0ksRUFBQSxpQkFFQStJLFNBQUFySSxLQUFBLFdBQ0EsSUFBQXNJLEVBQUFoSixFQUFBUyxNQUNBdUksRUFBQWhJLEtBQUEsY0FFQUUsR0FBQSxRQUFBLFdBQ0FzRCxXQUFBd0UsR0FBQSxPQUlBaEosRUFBQSw2QkFBQUUsTUFBQSxDQUNBSSxHQUFBLFdBQ0ErRyxZQUFBLEdBRUE5QyxXQUFBLFdBQ0FoRSxRQUFBQyxJQUFBLGlDQUNBd0csT0FBQUMsT0FBQUMsZ0JBQUErQixnQkFBQTdCLFlBQUEsb0JBQ0EsUUFNQSxJQUFBd0IsUUFBQTVJLEVBQUEsNkJBRUE0SSxRQUFBMUgsR0FBQSw0Q0FBQWlGLGNBQ0F5QyxRQUFBMUgsR0FBQSxRQUFBb0Usa0JBRUFzRCxRQUFBQyxHQUFBLEdBQUE3QyxRQUlBaEcsRUFBQSw2QkFBQWtCLEdBQUEsUUFBQSxXQUNBWCxRQUFBQyxJQUFBLCtCQUNBd0csT0FBQUMsT0FBQUMsZ0JBQUFnQyxrQkFBQTlCLFlBQUEsdUJBS0FwSCxFQUFBLGNBQUFrQixHQUFBLFFBQUEsV0FDQVgsUUFBQUMsSUFBQSw4QkFDQXdHLE9BQUFDLE9BQUFDLGdCQUFBaUMsWUFBQS9CLFlBQUEsaUJBS0FwSCxFQUFBLGNBQUFrQixHQUFBLFFBQUEsV0FDQVgsUUFBQUMsSUFBQSwwQkFDQXdHLE9BQUFDLE9BQUFDLGdCQUFBa0MsVUFBQWhDLFlBQUEiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBSZWZlcmVuY2U6IGh0dHBzOi8vY29kZXBlbi5pby9ncHJlc3N1dHRvNS9wZW4vTmpKb2JHP2VkaXRvcnM9MDAxMFxyXG5cclxuKGZ1bmN0aW9uICgkKSB7XHJcbiAgICAkLmZuLnN3aXBlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7XHJcbiAgICAgICAgICAgIGNiOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzd2lwZSBkb25lJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBpbml0aWFsTW91c2UgPSAwO1xyXG4gICAgICAgICAgICB2YXIgc2xpZGVNb3ZlbWVudFRvdGFsID0gMDtcclxuICAgICAgICAgICAgdmFyIG1vdXNlSXNEb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciAkc2xpZGVyID0gJHRoaXMuZmluZCgnLnNsaWRlcicpO1xyXG4gICAgICAgICAgICB2YXIgJHRleHQgPSAkdGhpcy5maW5kKCcudGV4dCcpO1xyXG5cclxuICAgICAgICAgICAgJHNsaWRlci5vbignbW91c2Vkb3duIHRvdWNoc3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIG1vdXNlSXNEb3duID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHNsaWRlTW92ZW1lbnRUb3RhbCA9ICR0aGlzLndpZHRoKCkgLSAkKHRoaXMpLndpZHRoKCkgKyAxMDtcclxuICAgICAgICAgICAgICAgIGluaXRpYWxNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSwgJHNsaWRlcikub24oJ21vdXNldXAgdG91Y2hlbmQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghbW91c2VJc0Rvd24pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgbW91c2VJc0Rvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50TW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0aXZlTW91c2UgPSBjdXJyZW50TW91c2UgLSBpbml0aWFsTW91c2U7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPCBzbGlkZU1vdmVtZW50VG90YWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdGV4dC5mYWRlVG8oMzAwLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmFuaW1hdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBcIi0xMHB4XCJcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvKiAkc2xpZGVyLmFkZENsYXNzKCd1bmxvY2tlZCcpO1xyXG4gICAgICAgICAgICAgICAgJCgnI2xvY2tlcicpLnRleHQoJ2xvY2tfb3V0bGluZScpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5vbignY2xpY2sgdGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHNsaWRlci5oYXNDbGFzcygndW5sb2NrZWQnKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5yZW1vdmVDbGFzcygndW5sb2NrZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2xvY2tlcicpLnRleHQoJ2xvY2tfb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLm9mZignY2xpY2sgdGFwJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9LCAwKTsgKi9cclxuXHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYigpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5KS5vbignbW91c2Vtb3ZlIHRvdWNobW92ZScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtb3VzZUlzRG93bilcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0aXZlTW91c2UgPSBjdXJyZW50TW91c2UgLSBpbml0aWFsTW91c2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2xpZGVQZXJjZW50ID0gMSAtIChyZWxhdGl2ZU1vdXNlIC8gc2xpZGVNb3ZlbWVudFRvdGFsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkdGV4dC5mYWRlVG8oMCwgc2xpZGVQZXJjZW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6ICctMTBweCcgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPj0gc2xpZGVNb3ZlbWVudFRvdGFsICsgMTApIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0Jzogc2xpZGVNb3ZlbWVudFRvdGFsICsgJ3B4JyB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0JzogcmVsYXRpdmVNb3VzZSAtIDEwIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSkoalF1ZXJ5KTtcclxuIiwiY29uc3QgcmVxdWVzdCA9IHtcclxuICAgIC8qKlxyXG4gICAgICogQXV0aGVudGljYXRlLlxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2Vzc1xyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZXJyb3JcclxuICAgICAqL1xyXG4gICAgYXV0aDogZnVuY3Rpb24gKHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgY29uc3QgdXJsID0gXCJodHRwczovL29tbTZvdWc1cGcuZXhlY3V0ZS1hcGkudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vZGVzYXJyb2xsby9vYXV0aDIvdjEvdG9rZW5cIjtcclxuICAgICAgICBjb25zdCBoZWFkZXJzID0ge1xyXG4gICAgICAgICAgICBcIkF1dGhvcml6YXRpb25cIjogXCJCYXNpYyBcIiArIGJ0b2EoXCIxOGg4dmFudnJoNHB1aTFscm50YzFuaWxqZlwiICsgXCI6XCIgKyBcIjFnZTMxYmhqcmRrOWQwamExNG1mdDhxZXBpNGNsa3Q4MDVqcWIyc3Zxdm1iNHNvMXY0ZzdcIiksXHJcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIsXHJcbiAgICAgICAgICAgIFwiQ29va2llXCI6IFwiWFNSRi1UT0tFTj1iNGE1NGYxYi1hZmU1LTRhZWUtOWE3Ni0wMGY5MjA0MThiNmVcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgYm9keSA9IFwiZ3JhbnRfdHlwZT1jbGllbnRfY3JlZGVudGlhbHNcIjtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5zZW5kKHVybCwgJ1BPU1QnLCBib2R5LCBoZWFkZXJzLCBzdWNjZXNzLCBlcnJvcik7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUGF5LlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGFjY2Vzc1Rva2VuXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gaGVhZGVyc1xyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGJvZHlcclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gcHJvZHVjdGlvblxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2Vzc1xyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZXJyb3JcclxuICAgICAqL1xyXG4gICAgcGF5OiBmdW5jdGlvbiAoYWNjZXNzVG9rZW4sIGhlYWRlcnMsIGJvZHksIHByb2R1Y3Rpb24sIHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgY29uc3QgdXJsID0gcHJvZHVjdGlvbiBcclxuICAgICAgICAgICAgPyBcImh0dHBzOi8vYXBpLmFwcGJhemdzLmNvbS9zdXBlcmFwcC9wYWdvcy9jYXB0YWNpb24vdHJhc3Bhc29zL3YxL2JvdG9uLXBhZ29cIlxyXG4gICAgICAgICAgICA6IFwiaHR0cHM6Ly9hcGlnYXRld2F5LnN1cGVyYXBwYmF6LmNvbS9pbnRlZ3JhY2lvbi9zdXBlcmFwcC9wYWdvcy9jYXB0YWNpb24vdHJhc3Bhc29zL3YxL2JvdG9uLXBhZ29cIjtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgY29uc3QgcmF3ID0gSlNPTi5zdHJpbmdpZnkoYm9keSk7XHJcblxyXG4gICAgICAgIC8vIGhlYWRlcnNbXCJBdXRob3JpemF0aW9uXCJdID0gXCJCZWFyZXIgXCIgKyBhY2Nlc3NUb2tlbjtcclxuICAgICAgICByZXF1ZXN0LnNlbmQodXJsLCAnUE9TVCcsIHJhdywgaGVhZGVycywgc3VjY2VzcywgZXJyb3IpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIE1ha2UgcmVxdWVzdC5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYm9keVxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGpzb25IZWFkZXJzIFxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2VzcyBcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXHJcbiAgICAgKi9cclxuICAgIHNlbmQ6IGZ1bmN0aW9uICh1cmwsIG1ldGhvZCwgYm9keSwganNvbkhlYWRlcnMsIHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IHByb3AgaW4ganNvbkhlYWRlcnMpIHtcclxuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQocHJvcCwganNvbkhlYWRlcnNbcHJvcF0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmV0Y2godXJsLCB7IG1ldGhvZCwgaGVhZGVycywgYm9keSwgcmVkaXJlY3Q6ICdmb2xsb3cnIH0pXHJcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcclxuICAgICAgICAgICAgLnRoZW4oc3VjY2VzcylcclxuICAgICAgICAgICAgLmNhdGNoKGVycm9yKTtcclxuICAgIH1cclxufTsiLCJsZXQgZW52aXJvbm1lbnQgPSBmYWxzZTtcclxuXHJcbi8qKlxyXG4gKiBCaW5kIEpTT04gdG8gSFRNTC5cclxuICogQHBhcmFtIHtvYmplY3R9IHZhbHVlc1xyXG4gKi9cclxuZnVuY3Rpb24gYmluZCh2YWx1ZXMpIHtcclxuICAgIGNvbnN0ICR0YWdzID0gJCgnW2RhdGEtaWRdJyk7XHJcblxyXG4gICAgJHRhZ3MuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgJHRhZyA9ICQodGhpcyk7XHJcbiAgICAgICAgY29uc3QgaWQgPSAkdGFnLmRhdGEoJ2lkJyk7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbaWRdO1xyXG5cclxuICAgICAgICBpZiAoaWQgPT09ICdwcmVjaW8nKSB7XHJcbiAgICAgICAgICAgICR0YWcuaHRtbChmb3JtYXRBbW91bnQodmFsdWUpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGlkID09PSAnc2FsZG8nKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJ2ZhbHNlJykge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHNob3dBZHZpY2UoJHRhZywgdHJ1ZSk7IH0sIDUwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkdGFnLmh0bWwodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogUGFyc2Ugc3RyaW5nIHRvIG9iamVjdCBhbmQgdGhlbiBiaW5kLlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RySnNvbiBcclxuICovXHJcbmZ1bmN0aW9uIGJpbmRGcm9tU3RyKHN0ckpzb24pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2Uoc3RySnNvbik7XHJcbiAgICAgICAgYmluZChqc29uKTtcclxuICAgIH0gY2F0Y2ggKGVycikgeyBjb25zb2xlLmxvZyhlcnIpOyB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDaGFuZ2Ugc2NyZWVuLlxyXG4gKiBAcGFyYW0ge2pRdWVyeX0gJHNjcmVlblxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xyXG4gKi9cclxuZnVuY3Rpb24gY2hhbmdlU2NyZWVuKCRzY3JlZW4sIGNhbGxiYWNrKSB7XHJcbiAgICAkKCcuc2NyZWVuJykuYWRkQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgICRzY3JlZW4ucmVtb3ZlQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuXHJcbiAgICBjYWxsYmFjaygpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGFtb3VudCB3aXRoIGN1cnJlbmN5IGZvcm1hdC5cclxuICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudCBcclxuICogQHJldHVybnMge3N0cmluZ31cclxuICovXHJcbmZ1bmN0aW9uIGZvcm1hdEFtb3VudChhbW91bnQpIHtcclxuICAgIHJldHVybiAnJCAnICsgTnVtYmVyKGFtb3VudCkudG9GaXhlZCgyKS5yZXBsYWNlKC9cXEIoPz0oXFxkezN9KSsoPyFcXGQpKS9nLCAnLCcpO1xyXG59XHJcblxyXG4vKipcclxuICogSGFuZGxlIGRpZ2l0IGtleXVwIGV2ZW50LlxyXG4gKiBAcGFyYW0ge0tleWJvYXJkRXZlbnR9IGV2ZW50XHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVEaWdpdEtleXVwKHsgdGFyZ2V0LCBrZXlDb2RlIH0pIHtcclxuICAgIGNvbnN0ICRwYXJlbnQgPSAkKHRhcmdldC5wYXJlbnROb2RlKTtcclxuXHJcbiAgICBpZiAoa2V5Q29kZSA9PT0gOCkge1xyXG4gICAgICAgIGlmICgkcGFyZW50LnByZXYoKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0ICRpbnB1dCA9ICRwYXJlbnQucHJldigpLmZpbmQoJ2lucHV0Jyk7XHJcblxyXG4gICAgICAgICAgICAkaW5wdXQudmFsKCcnKTtcclxuICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0gZWxzZSBpZiAoa2V5Q29kZSA+IDQ3ICYmIGtleUNvZGUgPCA1OCkge1xyXG4gICAgICAgIGlmICh0YXJnZXQudmFsdWUgIT09ICcnKSB7XHJcbiAgICAgICAgICAgIGlmICgkcGFyZW50Lm5leHQoKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCAkaW5wdXQgPSAkcGFyZW50Lm5leHQoKS5maW5kKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGVDb2RlKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBcHBseSBudW1iZXIgZmlsdGVyLlxyXG4gKiBAcGFyYW0ge0V2ZW50fSBldmVudFxyXG4gKi9cclxuZnVuY3Rpb24gbnVtYmVyRmlsdGVyKGV2ZW50KSB7XHJcbiAgICBjb25zdCBmaWx0ZXIgPSAvXlxcZHswLDF9JC87XHJcblxyXG4gICAgaWYgKGZpbHRlci50ZXN0KHRoaXMudmFsdWUpKSB7XHJcbiAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMudmFsdWU7XHJcbiAgICAgICAgdGhpcy5vbGRTZWxlY3Rpb25TdGFydCA9IHRoaXMuc2VsZWN0aW9uU3RhcnQ7XHJcbiAgICAgICAgdGhpcy5vbGRTZWxlY3Rpb25FbmQgPSB0aGlzLnNlbGVjdGlvbkVuZDtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eSgnb2xkVmFsdWUnKSkge1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLm9sZFZhbHVlO1xyXG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uUmFuZ2UodGhpcy5vbGRTZWxlY3Rpb25TdGFydCwgdGhpcy5vbGRTZWxlY3Rpb25FbmQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnZhbHVlID0gJyc7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEbyBmYWtlIHJlcXVlc3QuXHJcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXHJcbiAqL1xyXG5mdW5jdGlvbiBmYWtlUmVxdWVzdChjb2RlLCBjYWxsYmFjaykge1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgY2FsbGJhY2soY29kZSA9PT0gJzAwMDAwMScpO1xyXG4gICAgfSwgMTUwMCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RySnNvblxyXG4gKi9cclxuZnVuY3Rpb24gcGF5TW92aWUoc3RySnNvbikge1xyXG4gICAgY29uc3QgaGFuZGxlRXJyID0gZXJyID0+IHtcclxuICAgICAgICAvLyBjb25zdCBtZXNzYWdlID0gdHlwZW9mIGVyciA9PT0gJ29iamVjdCcgPyBlcnIubWVzc2FnZSA6IGVycjtcclxuICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShlcnIpKTtcclxuICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5lcnJvclBheW1lbnRSZXNwb25zZS5wb3N0TWVzc2FnZShcImVycm9yUGF5bWVudFJlc3BvbnNlfFwiICsgSlNPTi5zdHJpbmdpZnkoZXJyKSk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShzdHJKc29uKTtcclxuXHJcbiAgICAgICAgLyogcmVxdWVzdC5hdXRoKGZ1bmN0aW9uIChhdXRoUmVzKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgYXV0aFJlc1snYWNjZXNzX3Rva2VuJ10gPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnBheShhdXRoUmVzWydhY2Nlc3NfdG9rZW4nXSwganNvblsnaGVhZGVycyddLCBqc29uWydyZXF1ZXN0Qm9keSddLCBmdW5jdGlvbiAocGF5UmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBheVJlcy5jb2RpZ28gPT0gJzIwMScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCd3ZWJraXQnIGluIHdpbmRvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMucGF5bWVudFJlc3BvbnNlLnBvc3RNZXNzYWdlKFwicGF5bWVudFJlc3BvbnNlfFwiICsgSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogeyBjb2RlOiAwLCBtZXNzYWdlOiBwYXlSZXMubWVuc2FqZSB9IH0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUVycih7IGVycm9yOiB7IGNvZGU6IHBheVJlcy5jb2RpZ28sIG1lc3NhZ2U6IHBheVJlcy5tZW5zYWplIH0gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlRXJyKHsgZXJyb3I6IHsgY29kZTogNTAwLCBtZXNzYWdlOiBlcnIubWVzc2FnZSB9IH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7IFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlRXJyKHsgZXJyb3I6IHsgY29kZTogLTEsIG1lc3NhZ2U6IGF1dGhSZXMubWVuc2FqZSB9IH0pOyBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBoYW5kbGVFcnIoeyBlcnJvcjogeyBjb2RlOiA1MDAsIG1lc3NhZ2U6IGVyci5tZXNzYWdlIH0gfSk7XHJcbiAgICAgICAgfSk7ICovXHJcblxyXG4gICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnNob3dMb2FkZXIucG9zdE1lc3NhZ2UoXCJzaG93TG9hZGVyXCIpO1xyXG5cclxuICAgICAgICByZXF1ZXN0LnBheSgnJywganNvblsnaGVhZGVycyddLCBqc29uWydyZXF1ZXN0Qm9keSddLCBlbnZpcm9ubWVudCwgZnVuY3Rpb24gKHBheVJlcykge1xyXG4gICAgICAgICAgICBpZiAocGF5UmVzLmNvZGlnbyA9PSAnMjAxJykge1xyXG4gICAgICAgICAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMucGF5bWVudFJlc3BvbnNlLnBvc3RNZXNzYWdlKFwicGF5bWVudFJlc3BvbnNlfFwiICsgSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogeyBjb2RlOiAwLCBkYXRhOiBwYXlSZXMgfSB9KSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBoYW5kbGVFcnIoeyBlcnJvcjogeyBjb2RlOiBwYXlSZXMuY29kaWdvLCBtZXNzYWdlOiBwYXlSZXMubWVuc2FqZSB9IH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5oaWRlTG9hZGVyLnBvc3RNZXNzYWdlKFwiaGlkZUxvYWRlclwiKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGhhbmRsZUVycih7IGVycm9yOiB7IGNvZGU6IDUwMCwgbWVzc2FnZTogZXJyLm1lc3NhZ2UgfSB9KTtcclxuICAgICAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuaGlkZUxvYWRlci5wb3N0TWVzc2FnZShcImhpZGVMb2FkZXJcIik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyKSB7IGhhbmRsZUVycihlcnIpOyB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBQYXJzZSBsb2NhdGlvbi5zZWFyY2ggdG8gSlNPTi5cclxuICogQHJldHVybnMgb2JqZWN0XHJcbiAqL1xyXG5mdW5jdGlvbiBzZWFyY2hUb0pzb24oKSB7XHJcbiAgICBjb25zdCBwYWlycyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSkuc3BsaXQoJyYnKTtcclxuICAgIGNvbnN0IG9iamVjdCA9IHt9O1xyXG4gICAgbGV0IGkgPSAwO1xyXG5cclxuICAgIGZvciAoOyBpIDwgcGFpcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpZiAocGFpcnNbaV0gPT09ICcnKSB7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGFydHMgPSBwYWlyc1tpXS5zcGxpdCgnPScpO1xyXG4gICAgICAgIG9iamVjdFtkZWNvZGVVUklDb21wb25lbnQocGFydHNbMF0pXSA9IGRlY29kZVVSSUNvbXBvbmVudChwYXJ0c1sxXSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG9iamVjdDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNob3cgb3IgaGlkZSBhZHZpY2UuXHJcbiAqIEBwYXJhbSB7alF1ZXJ5fSAkZWwgXHJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gZmxhZyBcclxuICovXHJcbmZ1bmN0aW9uIHNob3dBZHZpY2UoJGVsLCBmbGFnKSB7XHJcbiAgICBpZiAoZmxhZykge1xyXG4gICAgICAgICRlbC5hZGRDbGFzcygnbm8tdmlzaWJsZScpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkZWwucmVtb3ZlQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFNob3cgb3IgaGlkZSBsb2FkZXIuXHJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gc2hvd1xyXG4gKi9cclxuZnVuY3Rpb24gc2hvd0xvYWRlcihzaG93KSB7XHJcbiAgICBsZXQgJGxvYWRlciA9ICQoJy5sb2FkZXInKTtcclxuXHJcbiAgICBpZiAoc2hvdykge1xyXG4gICAgICAgIGlmICgkbG9hZGVyLmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgICRsb2FkZXIgPSAkKCc8ZGl2IGNsYXNzPVwibG9hZGVyXCI+Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkKCdib2R5JykuYXBwZW5kKCRsb2FkZXIpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gJGxvYWRlci5hZGRDbGFzcygnbG9hZGVyLXZpc2libGUnKSwgMTApO1xyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGxvYWRlci5yZW1vdmVDbGFzcygnbG9hZGVyLXZpc2libGUnKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+ICRsb2FkZXIucmVtb3ZlKCksIDM3NSk7XHJcblxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogVmFsaWRhdGUgY29kZSBmcm9tIGNsaWVudC5cclxuICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAqL1xyXG5mdW5jdGlvbiB2YWxpZGF0ZUNvZGUoKSB7XHJcbiAgICBjb25zdCAkY29kZSA9ICQoJy5hdXRoLXNjcmVlbiAuY29kZScpO1xyXG4gICAgY29uc3QgJGRpZ2l0cyA9ICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKTtcclxuICAgIGxldCBjb2RlID0gXCJcIjtcclxuXHJcbiAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvZGUgKz0gdGhpcy52YWx1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChjb2RlLmxlbmd0aCA9PT0gNikge1xyXG4gICAgICAgIHNob3dMb2FkZXIodHJ1ZSk7XHJcblxyXG4gICAgICAgIGZha2VSZXF1ZXN0KGNvZGUsIHN1Y2Nlc3MgPT4ge1xyXG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ3ZhbGlkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgY2hhbmdlU2NyZWVuKCQoJy5yZXN1bWUtc2NyZWVuJyksICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAkY29kZS5hZGRDbGFzcygnaW52YWxpZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICRkaWdpdHMuZWFjaChmdW5jdGlvbiAoKSB7ICQodGhpcykudmFsKCcnKTsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lcSgwKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfSwgMTAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkY29kZS5yZW1vdmVDbGFzcygndmFsaWQgaW52YWxpZCcpO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBEZXRhaWwgU2NyZWVuIGNvbXBvbmVudHMuXHJcbmNvbnN0IHNlYXJjaEpzb24gPSBzZWFyY2hUb0pzb24oKTtcclxuXHJcbmVudmlyb25tZW50ID0gc2VhcmNoSnNvblsnZW52aXJvbm1lbnQnXSA9PT0gJ3RydWUnO1xyXG5iaW5kKHNlYXJjaEpzb24pO1xyXG5cclxuY29uc3QgJGFkdmljZXMgPSAkKCcuYWR2aWNlLmZpeGVkJyk7XHJcblxyXG4kYWR2aWNlcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0ICRhZHZpY2UgPSAkKHRoaXMpO1xyXG4gICAgY29uc3QgJGNsb3NlQnRuID0gJGFkdmljZS5maW5kKCcuY2xvc2UtYnRuJyk7XHJcblxyXG4gICAgJGNsb3NlQnRuLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBzaG93QWR2aWNlKCRhZHZpY2UsIGZhbHNlKTtcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbiQoJy5kZXRhaWwtc2NyZWVuIC5zd2lwZS1idG4nKS5zd2lwZSh7XHJcbiAgICBjYjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNob3dMb2FkZXIodHJ1ZSk7XHJcblxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogT3BlbiBkaWdpdGFsIHNpZ24nKTtcclxuICAgICAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuc2hvd0RpZ2l0YWxTaWduLnBvc3RNZXNzYWdlKFwic2hvd0RpZ2l0YWxTaWduXCIpO1xyXG4gICAgICAgIH0sIDUwMCk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgQXV0aCBTY3JlZW4gY29tcG9uZW50cy5cclxuY29uc3QgJGRpZ2l0cyA9ICQoJy5hdXRoLXNjcmVlbiAuZGlnaXQgaW5wdXQnKTtcclxuXHJcbiRkaWdpdHMub24oJ2tleXByZXNzIGtleWRvd24ga2V5dXAgaW5wdXQgY2hhbmdlIHBhc3RlJywgbnVtYmVyRmlsdGVyKVxyXG4kZGlnaXRzLm9uKCdrZXl1cCcsIGhhbmRsZURpZ2l0S2V5dXApO1xyXG5cclxuJGRpZ2l0cy5lcSgwKS5mb2N1cygpO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgY2xvc2UgYnV0dG9ucy5cclxuJCgnLnNjcmVlbiBoZWFkZXIgLmNsb3NlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBDbG9zaW5nIFdlYlZpZXcnKTtcclxuICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLmNsb3NlTW92aWVQYXltZW50LnBvc3RNZXNzYWdlKFwiY2xvc2VNb3ZpZVBheW1lbnRcIik7XHJcbn0pO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgc2hhcmUgYnV0dG9uLlxyXG4kKCcuc2hhcmUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IFNoYXJpbmcgdGlja2V0Jyk7XHJcbiAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5zaGFyZVRpY2tldC5wb3N0TWVzc2FnZShcInNoYXJlVGlja2V0XCIpO1xyXG59KTtcclxuXHJcblxyXG4vLyBJbml0aWFsaXplIG1vdmllIGJ1dHRvbi5cclxuJCgnLm1vdmllLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBQbGF5IG1vdmllJyk7XHJcbiAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5wbGF5TW92aWUucG9zdE1lc3NhZ2UoXCJwbGF5TW92aWVcIik7XHJcbn0pO1xyXG4iXX0=

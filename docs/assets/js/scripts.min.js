"use strict";function bind(i){$("[data-id]").each(function(){var e=$(this),n=e.data("id"),t=i[n];"precio"===n?e.html(formatAmount(t)):"saldo"===n?"false"===t&&setTimeout(function(){showAdvice(e,!0)},500):e.html(t)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,n){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),n()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var n=e.target,t=e.keyCode,i=$(n.parentNode);8===t?0<i.prev().length&&((e=i.prev().find("input")).val(""),e.focus()):47<t&&t<58&&""!==n.value&&0<i.next().length&&i.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function request(e,n,t,i,o){var s=new Headers;s.append("Authorization","Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7")),s.append("Content-Type","application/x-www-form-urlencoded"),s.append("Cookie","XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"),fetch("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token",{method:"POST",headers:s,body:"grant_type=client_credentials",redirect:"follow"}).then(function(e){return e.text()}).then(function(e){return console.log(e)}).catch(function(e){return console.log("error",e)})}function fakeRequest(e,n){setTimeout(function(){n("000001"===e)},1500)}function searchToJson(){for(var e,n=location.search.substring(1).split("&"),t={},i=0;i<n.length;i++)""!==n[i]&&(e=n[i].split("="),t[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return t}function showAdvice(e,n){n?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var n=$(".loader");e?(n.length<=0&&(n=$('<div class="loader">')),$("body").append(n),setTimeout(function(){return n.addClass("loader-visible")},10)):(n.removeClass("loader-visible"),setTimeout(function(){return n.remove()},375))}function validateCode(){var n=$(".auth-screen .code"),t=$(".auth-screen .digit input"),e="";t.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(n.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),n.addClass("invalid"),setTimeout(function(){t.each(function(){$(this).val("")}),t.eq(0).focus()},100))})):n.removeClass("valid invalid")}!function(d){d.fn.swipe=function(e){var c=d.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var n=d(this),t=0,i=0,o=!1,s=n.find(".slider"),a=n.find(".text");s.on("mousedown touchstart",function(e){o=!0,i=n.width()-d(this).width()+10,t=e.clientX||e.originalEvent.touches[0].pageX}),d(document.body,s).on("mouseup touchend",function(e){if(o){if(o=!1,(e.clientX||e.changedTouches[0].pageX)-t<i)return a.fadeTo(300,1),void s.animate({left:"-10px"},300);c.cb()}}),d(document.body).on("mousemove touchmove",function(e){var n;o&&(e=1-(n=(e.clientX||e.originalEvent.touches[0].pageX)-t)/i,a.fadeTo(0,e),n<=0?s.css({left:"-10px"}):i+10<=n?s.css({left:i+"px"}):s.css({left:n-10}))})})}}(jQuery),bind(searchToJson());var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),"webkit"in window&&window.webkit.messageHandlers.showDigitalSign.postMessage("showDigitalSign")},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),"webkit"in window&&window.webkit.messageHandlers.closeMoviePayment.postMessage("closeMoviePayment")}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),"webkit"in window&&window.webkit.messageHandlers.shareTicket.postMessage("shareTicket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),"webkit"in window&&window.webkit.messageHandlers.playMovie.postMessage("playMovie")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMuanMiLCJqcXVlcnkuc3dpcGUuanMiXSwibmFtZXMiOlsiYmluZCIsInZhbHVlcyIsIiQiLCJlYWNoIiwiJHRhZyIsInRoaXMiLCJpZCIsImRhdGEiLCJ2YWx1ZSIsImh0bWwiLCJmb3JtYXRBbW91bnQiLCJzZXRUaW1lb3V0Iiwic2hvd0FkdmljZSIsImJpbmRGcm9tU3RyIiwic3RySnNvbiIsIkpTT04iLCJwYXJzZSIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJjaGFuZ2VTY3JlZW4iLCIkc2NyZWVuIiwiY2FsbGJhY2siLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwiYW1vdW50IiwiTnVtYmVyIiwidG9GaXhlZCIsInJlcGxhY2UiLCJoYW5kbGVEaWdpdEtleXVwIiwiX3JlZiIsInRhcmdldCIsImtleUNvZGUiLCIkcGFyZW50IiwicGFyZW50Tm9kZSIsInByZXYiLCJsZW5ndGgiLCIkaW5wdXQiLCJmaW5kIiwidmFsIiwiZm9jdXMiLCJuZXh0IiwidmFsaWRhdGVDb2RlIiwibnVtYmVyRmlsdGVyIiwiZXZlbnQiLCJ0ZXN0Iiwib2xkVmFsdWUiLCJvbGRTZWxlY3Rpb25TdGFydCIsInNlbGVjdGlvblN0YXJ0Iiwib2xkU2VsZWN0aW9uRW5kIiwic2VsZWN0aW9uRW5kIiwiaGFzT3duUHJvcGVydHkiLCJzZXRTZWxlY3Rpb25SYW5nZSIsInJlcXVlc3QiLCJ1cmwiLCJtZXRob2QiLCJib2R5IiwiaGVhZGVycyIsIm15SGVhZGVycyIsIkhlYWRlcnMiLCJhcHBlbmQiLCJidG9hIiwiZmV0Y2giLCJyZWRpcmVjdCIsInRoZW4iLCJyZXNwb25zZSIsInRleHQiLCJyZXN1bHQiLCJlcnJvciIsImZha2VSZXF1ZXN0IiwiY29kZSIsInNlYXJjaFRvSnNvbiIsInBhcnRzIiwicGFpcnMiLCJsb2NhdGlvbiIsInNlYXJjaCIsInN1YnN0cmluZyIsInNwbGl0Iiwib2JqZWN0IiwiaSIsImRlY29kZVVSSUNvbXBvbmVudCIsIiRlbCIsImZsYWciLCJzaG93TG9hZGVyIiwic2hvdyIsIiRsb2FkZXIiLCJyZW1vdmUiLCIkY29kZSIsIiRkaWdpdHMiLCJzdWNjZXNzIiwiZXEiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsIiR0ZXh0Iiwib24iLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJjaGFuZ2VkVG91Y2hlcyIsImZhZGVUbyIsImFuaW1hdGUiLCJsZWZ0IiwicmVsYXRpdmVNb3VzZSIsInNsaWRlUGVyY2VudCIsImNzcyIsImpRdWVyeSIsIiRhZHZpY2VzIiwiJGFkdmljZSIsIndpbmRvdyIsIndlYmtpdCIsIm1lc3NhZ2VIYW5kbGVycyIsInNob3dEaWdpdGFsU2lnbiIsInBvc3RNZXNzYWdlIiwiY2xvc2VNb3ZpZVBheW1lbnQiLCJzaGFyZVRpY2tldCIsInBsYXlNb3ZpZSJdLCJtYXBwaW5ncyI6ImFBSUEsU0FBQUEsS0FBQUMsR0FDQUMsRUFBQSxhQUVBQyxLQUFBLFdBQ0EsSUFBQUMsRUFBQUYsRUFBQUcsTUFDQUMsRUFBQUYsRUFBQUcsS0FBQSxNQUNBQyxFQUFBUCxFQUFBSyxHQUVBLFdBQUFBLEVBQ0FGLEVBQUFLLEtBQUFDLGFBQUFGLElBQ0EsVUFBQUYsRUFDQSxVQUFBRSxHQUNBRyxXQUFBLFdBQUFDLFdBQUFSLEdBQUEsSUFBQSxLQUdBQSxFQUFBSyxLQUFBRCxLQVNBLFNBQUFLLFlBQUFDLEdBQ0EsSUFFQWQsS0FEQWUsS0FBQUMsTUFBQUYsSUFFQSxNQUFBRyxHQUFBQyxRQUFBQyxJQUFBRixJQVFBLFNBQUFHLGFBQUFDLEVBQUFDLEdBQ0FwQixFQUFBLFdBQUFxQixTQUFBLGNBQ0FGLEVBQUFHLFlBQUEsY0FFQUYsSUFRQSxTQUFBWixhQUFBZSxHQUNBLE1BQUEsS0FBQUMsT0FBQUQsR0FBQUUs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S0FBQSxXQUNBLElBQUFvSCxFQUFBckgsRUFBQUcsTUFDQWtILEVBQUFqRixLQUFBLGNBRUFpRSxHQUFBLFFBQUEsV0FDQTNGLFdBQUEyRyxHQUFBLE9BSUFySCxFQUFBLDZCQUFBMEYsTUFBQSxDQUNBSSxHQUFBLFdBQ0FiLFlBQUEsR0FFQXhFLFdBQUEsV0FDQU8sUUFBQUMsSUFBQSxpQ0FFQSxXQUFBcUcsUUFDQUEsT0FBQUMsT0FBQUMsZ0JBQUFDLGdCQUFBQyxZQUFBLG9CQTJCQSxRQU1BLElBQUFwQyxRQUFBdEYsRUFBQSw2QkFFQXNGLFFBQUFlLEdBQUEsNENBQUE1RCxjQUNBNkMsUUFBQWUsR0FBQSxRQUFBMUUsa0JBRUEyRCxRQUFBRSxHQUFBLEdBQUFsRCxRQUlBdEMsRUFBQSw2QkFBQXFHLEdBQUEsUUFBQSxXQUNBckYsUUFBQUMsSUFBQSwrQkFFQSxXQUFBcUcsUUFDQUEsT0FBQUMsT0FBQUMsZ0JBQUFHLGtCQUFBRCxZQUFBLHVCQU1BMUgsRUFBQSxjQUFBcUcsR0FBQSxRQUFBLFdBQ0FyRixRQUFBQyxJQUFBLDhCQUVBLFdBQUFxRyxRQUNBQSxPQUFBQyxPQUFBQyxnQkFBQUksWUFBQUYsWUFBQSxpQkFNQTFILEVBQUEsY0FBQXFHLEdBQUEsUUFBQSxXQUNBckYsUUFBQUMsSUFBQSwwQkFFQSxXQUFBcUcsUUFDQUEsT0FBQUMsT0FBQUMsZ0JBQUFLLFVBQUFILFlBQUEiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQmluZCBKU09OIHRvIEhUTUwuXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZXNcclxuICovXHJcbmZ1bmN0aW9uIGJpbmQodmFsdWVzKSB7XHJcbiAgICBjb25zdCAkdGFncyA9ICQoJ1tkYXRhLWlkXScpO1xyXG5cclxuICAgICR0YWdzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0ICR0YWcgPSAkKHRoaXMpO1xyXG4gICAgICAgIGNvbnN0IGlkID0gJHRhZy5kYXRhKCdpZCcpO1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2lkXTtcclxuXHJcbiAgICAgICAgaWYgKGlkID09PSAncHJlY2lvJykge1xyXG4gICAgICAgICAgICAkdGFnLmh0bWwoZm9ybWF0QW1vdW50KHZhbHVlKSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChpZCA9PT0gJ3NhbGRvJykge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09ICdmYWxzZScpIHtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBzaG93QWR2aWNlKCR0YWcsIHRydWUpOyB9LCA1MDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJHRhZy5odG1sKHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFBhcnNlIHN0cmluZyB0byBvYmplY3QgYW5kIHRoZW4gYmluZC5cclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ckpzb24gXHJcbiAqL1xyXG5mdW5jdGlvbiBiaW5kRnJvbVN0cihzdHJKc29uKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHN0ckpzb24pO1xyXG4gICAgICAgIGJpbmQoanNvbik7XHJcbiAgICB9IGNhdGNoIChlcnIpIHsgY29uc29sZS5sb2coZXJyKTsgfVxyXG59XHJcblxyXG4vKipcclxuICogQ2hhbmdlIHNjcmVlbi5cclxuICogQHBhcmFtIHtqUXVlcnl9ICRzY3JlZW5cclxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcclxuICovXHJcbmZ1bmN0aW9uIGNoYW5nZVNjcmVlbigkc2NyZWVuLCBjYWxsYmFjaykge1xyXG4gICAgJCgnLnNjcmVlbicpLmFkZENsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICAkc2NyZWVuLnJlbW92ZUNsYXNzKCduby12aXNpYmxlJyk7XHJcblxyXG4gICAgY2FsbGJhY2soKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBhbW91bnQgd2l0aCBjdXJyZW5jeSBmb3JtYXQuXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBhbW91bnQgXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAqL1xyXG5mdW5jdGlvbiBmb3JtYXRBbW91bnQoYW1vdW50KSB7XHJcbiAgICByZXR1cm4gJyQgJyArIE51bWJlcihhbW91bnQpLnRvRml4ZWQoMikucmVwbGFjZSgvXFxCKD89KFxcZHszfSkrKD8hXFxkKSkvZywgJywnKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEhhbmRsZSBkaWdpdCBrZXl1cCBldmVudC5cclxuICogQHBhcmFtIHtLZXlib2FyZEV2ZW50fSBldmVudFxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlRGlnaXRLZXl1cCh7IHRhcmdldCwga2V5Q29kZSB9KSB7XHJcbiAgICBjb25zdCAkcGFyZW50ID0gJCh0YXJnZXQucGFyZW50Tm9kZSk7XHJcblxyXG4gICAgaWYgKGtleUNvZGUgPT09IDgpIHtcclxuICAgICAgICBpZiAoJHBhcmVudC5wcmV2KCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCAkaW5wdXQgPSAkcGFyZW50LnByZXYoKS5maW5kKCdpbnB1dCcpO1xyXG5cclxuICAgICAgICAgICAgJGlucHV0LnZhbCgnJyk7XHJcbiAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9IGVsc2UgaWYgKGtleUNvZGUgPiA0NyAmJiBrZXlDb2RlIDwgNTgpIHtcclxuICAgICAgICBpZiAodGFyZ2V0LnZhbHVlICE9PSAnJykge1xyXG4gICAgICAgICAgICBpZiAoJHBhcmVudC5uZXh0KCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgJGlucHV0ID0gJHBhcmVudC5uZXh0KCkuZmluZCgnaW5wdXQnKTtcclxuICAgICAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHZhbGlkYXRlQ29kZSgpO1xyXG59XHJcblxyXG4vKipcclxuICogQXBwbHkgbnVtYmVyIGZpbHRlci5cclxuICogQHBhcmFtIHtFdmVudH0gZXZlbnRcclxuICovXHJcbmZ1bmN0aW9uIG51bWJlckZpbHRlcihldmVudCkge1xyXG4gICAgY29uc3QgZmlsdGVyID0gL15cXGR7MCwxfSQvO1xyXG5cclxuICAgIGlmIChmaWx0ZXIudGVzdCh0aGlzLnZhbHVlKSkge1xyXG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xyXG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uU3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xyXG4gICAgICAgIHRoaXMub2xkU2VsZWN0aW9uRW5kID0gdGhpcy5zZWxlY3Rpb25FbmQ7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoJ29sZFZhbHVlJykpIHtcclxuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcclxuICAgICAgICB0aGlzLnNldFNlbGVjdGlvblJhbmdlKHRoaXMub2xkU2VsZWN0aW9uU3RhcnQsIHRoaXMub2xkU2VsZWN0aW9uRW5kKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9ICcnO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogTWFrZSByZXF1ZXN0LlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsIFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBib2R5XHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBoZWFkZXJzIFxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBcclxuICovXHJcbmZ1bmN0aW9uIHJlcXVlc3QodXJsLCBtZXRob2QsIGJvZHksIGhlYWRlcnMsIGNhbGxiYWNrKSB7XHJcbiAgICB2YXIgbXlIZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcclxuICAgIG15SGVhZGVycy5hcHBlbmQoXCJBdXRob3JpemF0aW9uXCIsIFwiQmFzaWMgXCIgKyBidG9hKFwiMThoOHZhbnZyaDRwdWkxbHJudGMxbmlsamZcIiArIFwiOlwiICsgXCIxZ2UzMWJoanJkazlkMGphMTRtZnQ4cWVwaTRjbGt0ODA1anFiMnN2cXZtYjRzbzF2NGc3XCIpKTtcclxuICAgIG15SGVhZGVycy5hcHBlbmQoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIik7XHJcbiAgICBteUhlYWRlcnMuYXBwZW5kKFwiQ29va2llXCIsIFwiWFNSRi1UT0tFTj1iNGE1NGYxYi1hZmU1LTRhZWUtOWE3Ni0wMGY5MjA0MThiNmVcIik7XHJcblxyXG4gICAgLyogdmFyIHVybGVuY29kZWQgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XHJcbiAgICB1cmxlbmNvZGVkLmFwcGVuZChcImdyYW50X3R5cGVcIiwgXCJjbGllbnRfY3JlZGVudGlhbHNcIik7ICovXHJcblxyXG4gICAgdmFyIHJlcXVlc3RPcHRpb25zID0ge1xyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIGhlYWRlcnM6IG15SGVhZGVycyxcclxuICAgICAgICBib2R5OiBcImdyYW50X3R5cGU9Y2xpZW50X2NyZWRlbnRpYWxzXCIsXHJcbiAgICAgICAgcmVkaXJlY3Q6ICdmb2xsb3cnXHJcbiAgICB9O1xyXG5cclxuICAgIGZldGNoKFwiaHR0cHM6Ly9vbW02b3VnNXBnLmV4ZWN1dGUtYXBpLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL2Rlc2Fycm9sbG8vb2F1dGgyL3YxL3Rva2VuXCIsIHJlcXVlc3RPcHRpb25zKVxyXG4gICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLnRleHQoKSlcclxuICAgICAgICAudGhlbihyZXN1bHQgPT4gY29uc29sZS5sb2cocmVzdWx0KSlcclxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5sb2coJ2Vycm9yJywgZXJyb3IpKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIERvIGZha2UgcmVxdWVzdC5cclxuICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2tcclxuICovXHJcbmZ1bmN0aW9uIGZha2VSZXF1ZXN0KGNvZGUsIGNhbGxiYWNrKSB7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBjYWxsYmFjayhjb2RlID09PSAnMDAwMDAxJyk7XHJcbiAgICB9LCAxNTAwKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFBhcnNlIGxvY2F0aW9uLnNlYXJjaCB0byBKU09OLlxyXG4gKiBAcmV0dXJucyBvYmplY3RcclxuICovXHJcbmZ1bmN0aW9uIHNlYXJjaFRvSnNvbigpIHtcclxuICAgIGNvbnN0IHBhaXJzID0gbG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKS5zcGxpdCgnJicpO1xyXG4gICAgY29uc3Qgb2JqZWN0ID0ge307XHJcbiAgICBsZXQgaSA9IDA7XHJcblxyXG4gICAgZm9yICg7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGlmIChwYWlyc1tpXSA9PT0gJycpIHtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwYXJ0cyA9IHBhaXJzW2ldLnNwbGl0KCc9Jyk7XHJcbiAgICAgICAgb2JqZWN0W2RlY29kZVVSSUNvbXBvbmVudChwYXJ0c1swXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzFdKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gb2JqZWN0O1xyXG59XHJcblxyXG4vKipcclxuICogU2hvdyBvciBoaWRlIGFkdmljZS5cclxuICogQHBhcmFtIHtqUXVlcnl9ICRlbCBcclxuICogQHBhcmFtIHtib29sZWFufSBmbGFnIFxyXG4gKi9cclxuZnVuY3Rpb24gc2hvd0FkdmljZSgkZWwsIGZsYWcpIHtcclxuICAgIGlmIChmbGFnKSB7XHJcbiAgICAgICAgJGVsLmFkZENsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICRlbC5yZW1vdmVDbGFzcygnbm8tdmlzaWJsZScpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogU2hvdyBvciBoaWRlIGxvYWRlci5cclxuICogQHBhcmFtIHtib29sZWFufSBzaG93XHJcbiAqL1xyXG5mdW5jdGlvbiBzaG93TG9hZGVyKHNob3cpIHtcclxuICAgIGxldCAkbG9hZGVyID0gJCgnLmxvYWRlcicpO1xyXG5cclxuICAgIGlmIChzaG93KSB7XHJcbiAgICAgICAgaWYgKCRsb2FkZXIubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgJGxvYWRlciA9ICQoJzxkaXYgY2xhc3M9XCJsb2FkZXJcIj4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJGxvYWRlcik7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiAkbG9hZGVyLmFkZENsYXNzKCdsb2FkZXItdmlzaWJsZScpLCAxMCk7XHJcblxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAkbG9hZGVyLnJlbW92ZUNsYXNzKCdsb2FkZXItdmlzaWJsZScpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gJGxvYWRlci5yZW1vdmUoKSwgMzc1KTtcclxuXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBWYWxpZGF0ZSBjb2RlIGZyb20gY2xpZW50LlxyXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuICovXHJcbmZ1bmN0aW9uIHZhbGlkYXRlQ29kZSgpIHtcclxuICAgIGNvbnN0ICRjb2RlID0gJCgnLmF1dGgtc2NyZWVuIC5jb2RlJyk7XHJcbiAgICBjb25zdCAkZGlnaXRzID0gJCgnLmF1dGgtc2NyZWVuIC5kaWdpdCBpbnB1dCcpO1xyXG4gICAgbGV0IGNvZGUgPSBcIlwiO1xyXG5cclxuICAgICRkaWdpdHMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29kZSArPSB0aGlzLnZhbHVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGNvZGUubGVuZ3RoID09PSA2KSB7XHJcbiAgICAgICAgc2hvd0xvYWRlcih0cnVlKTtcclxuXHJcbiAgICAgICAgZmFrZVJlcXVlc3QoY29kZSwgc3VjY2VzcyA9PiB7XHJcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAkY29kZS5hZGRDbGFzcygndmFsaWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjaGFuZ2VTY3JlZW4oJCgnLnJlc3VtZS1zY3JlZW4nKSwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCdpbnZhbGlkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHsgJCh0aGlzKS52YWwoJycpOyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVxKDApLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICRjb2RlLnJlbW92ZUNsYXNzKCd2YWxpZCBpbnZhbGlkJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4vLyBJbml0aWFsaXplIERldGFpbCBTY3JlZW4gY29tcG9uZW50cy5cclxuYmluZChzZWFyY2hUb0pzb24oKSk7XHJcblxyXG5jb25zdCAkYWR2aWNlcyA9ICQoJy5hZHZpY2UuZml4ZWQnKTtcclxuXHJcbiRhZHZpY2VzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3QgJGFkdmljZSA9ICQodGhpcyk7XHJcbiAgICBjb25zdCAkY2xvc2VCdG4gPSAkYWR2aWNlLmZpbmQoJy5jbG9zZS1idG4nKTtcclxuXHJcbiAgICAkY2xvc2VCdG4ub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNob3dBZHZpY2UoJGFkdmljZSwgZmFsc2UpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuJCgnLmRldGFpbC1zY3JlZW4gLnN3aXBlLWJ0bicpLnN3aXBlKHtcclxuICAgIGNiOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc2hvd0xvYWRlcih0cnVlKTtcclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBPcGVuIGRpZ2l0YWwgc2lnbicpXHJcblxyXG4gICAgICAgICAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5zaG93RGlnaXRhbFNpZ24ucG9zdE1lc3NhZ2UoXCJzaG93RGlnaXRhbFNpZ25cIik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8qIGlmICh0eXBlb2Ygc2hvd0RpZ2l0YWxTaWduID09PSAnZnVuY3Rpb24nIHx8IHR5cGVvZiBzaG93RGlnaXRhbFNpZ24gPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICBzaG93RGlnaXRhbFNpZ24oZnVuY3Rpb24gKHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkY29kZS5hZGRDbGFzcygndmFsaWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZVNjcmVlbigkKCcucmVzdW1lLXNjcmVlbicpLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93TG9hZGVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCdpbnZhbGlkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaWdpdHMuZWFjaChmdW5jdGlvbiAoKSB7ICQodGhpcykudmFsKCcnKTsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVxKDApLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gKi9cclxuXHJcbiAgICAgICAgICAgIC8qIGNoYW5nZVNjcmVlbigkKCcuYXV0aC1zY3JlZW4nKSwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAkKCcuYXV0aC1zY3JlZW4gLmRpZ2l0IGlucHV0JykuZXEoMCkuZm9jdXMoKTtcclxuICAgICAgICAgICAgfSk7ICovXHJcbiAgICAgICAgfSwgNTAwKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBBdXRoIFNjcmVlbiBjb21wb25lbnRzLlxyXG5jb25zdCAkZGlnaXRzID0gJCgnLmF1dGgtc2NyZWVuIC5kaWdpdCBpbnB1dCcpO1xyXG5cclxuJGRpZ2l0cy5vbigna2V5cHJlc3Mga2V5ZG93biBrZXl1cCBpbnB1dCBjaGFuZ2UgcGFzdGUnLCBudW1iZXJGaWx0ZXIpXHJcbiRkaWdpdHMub24oJ2tleXVwJywgaGFuZGxlRGlnaXRLZXl1cCk7XHJcblxyXG4kZGlnaXRzLmVxKDApLmZvY3VzKCk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBjbG9zZSBidXR0b25zLlxyXG4kKCcuc2NyZWVuIGhlYWRlciAuY2xvc2UtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IENsb3NpbmcgV2ViVmlldycpO1xyXG4gICAgXHJcbiAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XHJcbiAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuY2xvc2VNb3ZpZVBheW1lbnQucG9zdE1lc3NhZ2UoXCJjbG9zZU1vdmllUGF5bWVudFwiKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBzaGFyZSBidXR0b24uXHJcbiQoJy5zaGFyZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogU2hhcmluZyB0aWNrZXQnKTtcclxuXHJcbiAgICBpZiAoJ3dlYmtpdCcgaW4gd2luZG93KSB7XHJcbiAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuc2hhcmVUaWNrZXQucG9zdE1lc3NhZ2UoXCJzaGFyZVRpY2tldFwiKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBtb3ZpZSBidXR0b24uXHJcbiQoJy5tb3ZpZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogUGxheSBtb3ZpZScpO1xyXG5cclxuICAgIGlmICgnd2Via2l0JyBpbiB3aW5kb3cpIHtcclxuICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5wbGF5TW92aWUucG9zdE1lc3NhZ2UoXCJwbGF5TW92aWVcIik7XHJcbiAgICB9XHJcbn0pO1xyXG4iLCIvLyBSZWZlcmVuY2U6IGh0dHBzOi8vY29kZXBlbi5pby9ncHJlc3N1dHRvNS9wZW4vTmpKb2JHP2VkaXRvcnM9MDAxMFxyXG5cclxuKGZ1bmN0aW9uICgkKSB7XHJcbiAgICAkLmZuLnN3aXBlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7XHJcbiAgICAgICAgICAgIGNiOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzd2lwZSBkb25lJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBpbml0aWFsTW91c2UgPSAwO1xyXG4gICAgICAgICAgICB2YXIgc2xpZGVNb3ZlbWVudFRvdGFsID0gMDtcclxuICAgICAgICAgICAgdmFyIG1vdXNlSXNEb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciAkc2xpZGVyID0gJHRoaXMuZmluZCgnLnNsaWRlcicpO1xyXG4gICAgICAgICAgICB2YXIgJHRleHQgPSAkdGhpcy5maW5kKCcudGV4dCcpO1xyXG5cclxuICAgICAgICAgICAgJHNsaWRlci5vbignbW91c2Vkb3duIHRvdWNoc3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIG1vdXNlSXNEb3duID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHNsaWRlTW92ZW1lbnRUb3RhbCA9ICR0aGlzLndpZHRoKCkgLSAkKHRoaXMpLndpZHRoKCkgKyAxMDtcclxuICAgICAgICAgICAgICAgIGluaXRpYWxNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSwgJHNsaWRlcikub24oJ21vdXNldXAgdG91Y2hlbmQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghbW91c2VJc0Rvd24pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgbW91c2VJc0Rvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50TW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0aXZlTW91c2UgPSBjdXJyZW50TW91c2UgLSBpbml0aWFsTW91c2U7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPCBzbGlkZU1vdmVtZW50VG90YWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdGV4dC5mYWRlVG8oMzAwLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmFuaW1hdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBcIi0xMHB4XCJcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvKiAkc2xpZGVyLmFkZENsYXNzKCd1bmxvY2tlZCcpO1xyXG4gICAgICAgICAgICAgICAgJCgnI2xvY2tlcicpLnRleHQoJ2xvY2tfb3V0bGluZScpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5vbignY2xpY2sgdGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHNsaWRlci5oYXNDbGFzcygndW5sb2NrZWQnKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5yZW1vdmVDbGFzcygndW5sb2NrZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2xvY2tlcicpLnRleHQoJ2xvY2tfb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLm9mZignY2xpY2sgdGFwJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9LCAwKTsgKi9cclxuXHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYigpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5KS5vbignbW91c2Vtb3ZlIHRvdWNobW92ZScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtb3VzZUlzRG93bilcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0aXZlTW91c2UgPSBjdXJyZW50TW91c2UgLSBpbml0aWFsTW91c2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2xpZGVQZXJjZW50ID0gMSAtIChyZWxhdGl2ZU1vdXNlIC8gc2xpZGVNb3ZlbWVudFRvdGFsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkdGV4dC5mYWRlVG8oMCwgc2xpZGVQZXJjZW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6ICctMTBweCcgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPj0gc2xpZGVNb3ZlbWVudFRvdGFsICsgMTApIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0Jzogc2xpZGVNb3ZlbWVudFRvdGFsICsgJ3B4JyB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0JzogcmVsYXRpdmVNb3VzZSAtIDEwIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSkoalF1ZXJ5KTtcclxuIl19

"use strict";!function(c){c.fn.swipe=function(e){var r=c.extend({cb:function(){console.log("swipe done")}},e);return this.each(function(){var o=c(this),s=0,n=0,t=!1,i=o.find(".slider"),a=o.find(".text");i.on("mousedown touchstart",function(e){t=!0,n=o.width()-c(this).width()+10,s=e.clientX||e.originalEvent.touches[0].pageX}),c(document.body,i).on("mouseup touchend",function(e){if(t){if(t=!1,(e.clientX||e.changedTouches[0].pageX)-s<n)return a.fadeTo(300,1),void i.animate({left:"-10px"},300);r.cb()}}),c(document.body).on("mousemove touchmove",function(e){var o;t&&(e=1-(o=(e.clientX||e.originalEvent.touches[0].pageX)-s)/n,a.fadeTo(0,e),o<=0?i.css({left:"-10px"}):n+10<=o?i.css({left:n+"px"}):i.css({left:o-10}))})})}}(jQuery);var request={auth:function(e,o){var s={Authorization:"Basic "+btoa("18h8vanvrh4pui1lrntc1niljf:1ge31bhjrdk9d0ja14mft8qepi4clkt805jqb2svqvmb4so1v4g7"),"Content-Type":"application/x-www-form-urlencoded",Cookie:"XSRF-TOKEN=b4a54f1b-afe5-4aee-9a76-00f920418b6e"};request.send("https://omm6oug5pg.execute-api.us-east-1.amazonaws.com/desarrollo/oauth2/v1/token","POST","grant_type=client_credentials",s,e,o)},pay:function(e,o,s,n,t){s=s?"https://api.bazappgs.com/superapp/pagos/captacion/traspasos/v1/boton-pago":"https://apigateway.superappbaz.com/integracion/superapp/pagos/captacion/traspasos/v1/boton-pago",o=JSON.stringify(o);request.send(s,"POST",o,e,n,t)},send:function(e,o,s,n,t,i){$.ajax({url:e,method:o,contentType:"application/json",processData:!1,headers:n,data:s,success:t,error:i})}},environment=!1;function bind(n){$("[data-id]").each(function(){var e=$(this),o=e.data("id"),s=n[o];"precio"===o?e.html(formatAmount(s)):"saldo"===o?"false"===s&&setTimeout(function(){showAdvice(e,!0)},500):e.html(s)})}function bindFromStr(e){try{bind(JSON.parse(e))}catch(e){console.log(e)}}function changeScreen(e,o){$(".screen").addClass("no-visible"),e.removeClass("no-visible"),o()}function formatAmount(e){return"$ "+Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function handleDigitKeyup(e){var o=e.target,s=e.keyCode,n=$(o.parentNode);8===s?0<n.prev().length&&((e=n.prev().find("input")).val(""),e.focus()):47<s&&s<58&&""!==o.value&&0<n.next().length&&n.next().find("input").focus(),validateCode()}function numberFilter(e){/^\d{0,1}$/.test(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""}function fakeRequest(e,o){setTimeout(function(){o("000001"===e)},1500)}function payMovie(e){function n(e){console.log(JSON.stringify(e)),window.webkit.messageHandlers.errorPaymentResponse.postMessage("errorPaymentResponse|"+JSON.stringify(e))}window.webkit.messageHandlers.showLoader.postMessage("showLoader");try{var o=JSON.parse(e);request.pay(o.headers,o.requestBody,environment,function(e){"201"==e.codigo?window.webkit.messageHandlers.paymentResponse.postMessage("paymentResponse|"+JSON.stringify({error:{code:0,data:e}})):n({error:{code:e.codigo,message:e.mensaje},weberror:900,weberrormessage:"El error lo envío el servicio"}),window.webkit.messageHandlers.hideLoader.postMessage("hideLoader")},function(e,o,s){n({error:{code:500,message:s},weberror:901,weberrormessage:s}),window.webkit.messageHandlers.hideLoader.postMessage("hideLoader")})}catch(e){n({error:{code:500,message:e.message},weberror:902,weberrormessage:"Error al hacer la petición"}),window.webkit.messageHandlers.hideLoader.postMessage("hideLoader")}}function searchToJson(){for(var e,o=location.search.substring(1).split("&"),s={},n=0;n<o.length;n++)""!==o[n]&&(e=o[n].split("="),s[decodeURIComponent(e[0])]=decodeURIComponent(e[1]));return s}function showAdvice(e,o){o?e.addClass("no-visible"):e.removeClass("no-visible")}function showLoader(e){var o=$(".loader");e?(o.length<=0&&(o=$('<div class="loader">')),$("body").append(o),setTimeout(function(){return o.addClass("loader-visible")},10)):(o.removeClass("loader-visible"),setTimeout(function(){return o.remove()},375))}function validateCode(){var o=$(".auth-screen .code"),s=$(".auth-screen .digit input"),e="";s.each(function(){e+=this.value}),6===e.length?(showLoader(!0),fakeRequest(e,function(e){e?(o.addClass("valid"),changeScreen($(".resume-screen"),function(){showLoader(!1)})):(showLoader(!1),o.addClass("invalid"),setTimeout(function(){s.each(function(){$(this).val("")}),s.eq(0).focus()},100))})):o.removeClass("valid invalid")}var searchJson=searchToJson(),environment="true"===searchJson.environment;console.log(searchJson);var $advices=$(".advice.fixed");$advices.each(function(){var e=$(this);e.find(".close-btn").on("click",function(){showAdvice(e,!1)})}),$(".detail-screen .swipe-btn").swipe({cb:function(){showLoader(!0),setTimeout(function(){console.log("scripts.js: Open digital sign"),window.webkit.messageHandlers.showDigitalSign.postMessage("showDigitalSign")},500)}});var $digits=$(".auth-screen .digit input");$digits.on("keypress keydown keyup input change paste",numberFilter),$digits.on("keyup",handleDigitKeyup),$digits.eq(0).focus(),$(".screen header .close-btn").on("click",function(){console.log("scripts.js: Closing WebView"),window.webkit.messageHandlers.closeMoviePayment.postMessage("closeMoviePayment")}),$(".share-btn").on("click",function(){console.log("scripts.js: Sharing ticket"),window.webkit.messageHandlers.shareTicket.postMessage("shareTicket")}),$(".movie-btn").on("click",function(){console.log("scripts.js: Play movie"),window.webkit.messageHandlers.playMovie.postMessage("playMovie")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5zd2lwZS5qcyIsInJlcXVlc3QuanMiLCJzY3JpcHRzLmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsInN3aXBlIiwib3B0aW9ucyIsInNldHRpbmdzIiwiZXh0ZW5kIiwiY2IiLCJjb25zb2xlIiwibG9nIiwidGhpcyIsImVhY2giLCIkdGhpcyIsImluaXRpYWxNb3VzZSIsInNsaWRlTW92ZW1lbnRUb3RhbCIsIm1vdXNlSXNEb3duIiwiJHNsaWRlciIsImZpbmQiLCIkdGV4dCIsIm9uIiwiZXZlbnQiLCJ3aWR0aCIsImNsaWVudFgiLCJvcmlnaW5hbEV2ZW50IiwidG91Y2hlcyIsInBhZ2VYIiwiZG9jdW1lbnQiLCJib2R5IiwiY2hhbmdlZFRvdWNoZXMiLCJmYWRlVG8iLCJhbmltYXRlIiwibGVmdCIsInJlbGF0aXZlTW91c2UiLCJzbGlkZVBlcmNlbnQiLCJjc3MiLCJqUXVlcnkiLCJyZXF1ZXN0IiwiYXV0aCIsInN1Y2Nlc3MiLCJlcnJvciIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYnRvYSIsIkNvbnRlbnQtVHlwZSIsIkNvb2tpZSIsInNlbmQiLCJwYXkiLCJwcm9kdWN0aW9uIiwidXJsIiwicmF3IiwiSlNPTiIsInN0cmluZ2lmeSIsIm1ldGhvZCIsImpzb25IZWFkZXJzIiwiYWpheCIsImNvbnRlbnRUeXBlIiwicHJvY2Vzc0RhdGEiLCJkYXRhIiwiZW52aXJvbm1lbnQiLCJiaW5kIiwidmFsdWVzIiwiJHRhZyIsImlkIiwidmFsdWUiLCJodG1sIiwiZm9ybWF0QW1vdW50Iiwic2V0VGltZW91dCIsInNob3dBZHZpY2UiLCJiaW5kRnJvbVN0ciIsInN0ckpzb24iLCJwYXJzZSIsImVyciIsImNoYW5nZVNjcmVlbiIsIiRzY3JlZW4iLCJjYWxsYmFjayIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJhbW91bnQiLCJOdW1iZXIiLCJ0b0ZpeGVkIiwicmVwbGFjZSIsImhhbmRsZURpZ2l0S2V5dXAiLCJfcmVmIiwidGFyZ2V0Iiwia2V5Q29kZSIsIiRwYXJlbnQiLCJwYXJlbnROb2RlIiwicHJldiIsImxlbmd0aCIsIiRpbnB1dCIsInZhbCIsImZvY3VzIiwibmV4dCIsInZhbGlkYXRlQ29kZSIsIm51bWJlckZpbHRlciIsInRlc3QiLCJvbGRWYWx1ZSIsIm9sZFNlbGVjdGlvblN0YXJ0Iiwic2VsZWN0aW9uU3RhcnQiLCJvbGRTZWxlY3Rpb25FbmQiLCJzZWxlY3Rpb25FbmQiLCJoYXNPd25Qcm9wZXJ0eSIsInNldFNlbGVjdGlvblJhbmdlIiwiZmFrZVJlcXVlc3QiLCJjb2RlIiwicGF5TW92aWUiLCJoYW5kbGVFcnIiLCJ3aW5kb3ciLCJ3ZWJraXQiLCJtZXNzYWdlSGFuZGxlcnMiLCJlcnJvclBheW1lbnRSZXNwb25zZSIsInBvc3RNZXNzYWdlIiwic2hvd0xvYWRlciIsImpzb24iLCJwYXlSZXMiLCJjb2RpZ28iLCJwYXltZW50UmVzcG9uc2UiLCJtZXNzYWdlIiwibWVuc2FqZSIsIndlYmVycm9yIiwid2ViZXJyb3JtZXNzYWdlIiwiaGlkZUxvYWRlciIsImpxWEhSIiwidGV4dFN0YXR1cyIsImVycm9yVGhyb3duIiwic2VhcmNoVG9Kc29uIiwicGFydHMiLCJwYWlycyIsImxvY2F0aW9uIiwic2VhcmNoIiwic3Vic3RyaW5nIiwic3BsaXQiLCJvYmplY3QiLCJpIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiJGVsIiwiZmxhZyIsInNob3ciLCIkbG9hZGVyIiwiYXBwZW5kIiwicmVtb3ZlIiwiJGNvZGUiLCIkZGlnaXRzIiwiZXEiLCJzZWFyY2hKc29uIiwiJGFkdmljZXMiLCIkYWR2aWNlIiwic2hvd0RpZ2l0YWxTaWduIiwiY2xvc2VNb3ZpZVBheW1lbnQiLCJzaGFyZVRpY2tldCIsInBsYXlNb3ZpZSJdLCJtYXBwaW5ncyI6ImNBRUEsU0FBQUEsR0FDQUEsRUFBQUMsR0FBQUMsTUFBQSxTQUFBQyxHQUNBLElBQUFDLEVBQUFKLEVBQUFLLE9BQUEsQ0FDQUMsR0FBQSxXQUNBQyxRQUFBQyxJQUFBLGdCQUVBTCxHQUVBLE9B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aXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBSZWZlcmVuY2U6IGh0dHBzOi8vY29kZXBlbi5pby9ncHJlc3N1dHRvNS9wZW4vTmpKb2JHP2VkaXRvcnM9MDAxMFxyXG5cclxuKGZ1bmN0aW9uICgkKSB7XHJcbiAgICAkLmZuLnN3aXBlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICAgICAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7XHJcbiAgICAgICAgICAgIGNiOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzd2lwZSBkb25lJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBpbml0aWFsTW91c2UgPSAwO1xyXG4gICAgICAgICAgICB2YXIgc2xpZGVNb3ZlbWVudFRvdGFsID0gMDtcclxuICAgICAgICAgICAgdmFyIG1vdXNlSXNEb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciAkc2xpZGVyID0gJHRoaXMuZmluZCgnLnNsaWRlcicpO1xyXG4gICAgICAgICAgICB2YXIgJHRleHQgPSAkdGhpcy5maW5kKCcudGV4dCcpO1xyXG5cclxuICAgICAgICAgICAgJHNsaWRlci5vbignbW91c2Vkb3duIHRvdWNoc3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIG1vdXNlSXNEb3duID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHNsaWRlTW92ZW1lbnRUb3RhbCA9ICR0aGlzLndpZHRoKCkgLSAkKHRoaXMpLndpZHRoKCkgKyAxMDtcclxuICAgICAgICAgICAgICAgIGluaXRpYWxNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSwgJHNsaWRlcikub24oJ21vdXNldXAgdG91Y2hlbmQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghbW91c2VJc0Rvd24pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgbW91c2VJc0Rvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50TW91c2UgPSBldmVudC5jbGllbnRYIHx8IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0aXZlTW91c2UgPSBjdXJyZW50TW91c2UgLSBpbml0aWFsTW91c2U7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPCBzbGlkZU1vdmVtZW50VG90YWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdGV4dC5mYWRlVG8oMzAwLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmFuaW1hdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBcIi0xMHB4XCJcclxuICAgICAgICAgICAgICAgICAgICB9LCAzMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvKiAkc2xpZGVyLmFkZENsYXNzKCd1bmxvY2tlZCcpO1xyXG4gICAgICAgICAgICAgICAgJCgnI2xvY2tlcicpLnRleHQoJ2xvY2tfb3V0bGluZScpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5vbignY2xpY2sgdGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHNsaWRlci5oYXNDbGFzcygndW5sb2NrZWQnKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5yZW1vdmVDbGFzcygndW5sb2NrZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2xvY2tlcicpLnRleHQoJ2xvY2tfb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLm9mZignY2xpY2sgdGFwJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9LCAwKTsgKi9cclxuXHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYigpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJChkb2N1bWVudC5ib2R5KS5vbignbW91c2Vtb3ZlIHRvdWNobW92ZScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFtb3VzZUlzRG93bilcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRNb3VzZSA9IGV2ZW50LmNsaWVudFggfHwgZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VYO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlbGF0aXZlTW91c2UgPSBjdXJyZW50TW91c2UgLSBpbml0aWFsTW91c2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2xpZGVQZXJjZW50ID0gMSAtIChyZWxhdGl2ZU1vdXNlIC8gc2xpZGVNb3ZlbWVudFRvdGFsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkdGV4dC5mYWRlVG8oMCwgc2xpZGVQZXJjZW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVsYXRpdmVNb3VzZSA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNsaWRlci5jc3MoeyAnbGVmdCc6ICctMTBweCcgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0aXZlTW91c2UgPj0gc2xpZGVNb3ZlbWVudFRvdGFsICsgMTApIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0Jzogc2xpZGVNb3ZlbWVudFRvdGFsICsgJ3B4JyB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2xpZGVyLmNzcyh7ICdsZWZ0JzogcmVsYXRpdmVNb3VzZSAtIDEwIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSkoalF1ZXJ5KTtcclxuIiwiY29uc3QgcmVxdWVzdCA9IHtcclxuICAgIC8qKlxyXG4gICAgICogQXV0aGVudGljYXRlLlxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2Vzc1xyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZXJyb3JcclxuICAgICAqL1xyXG4gICAgYXV0aDogZnVuY3Rpb24gKHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgY29uc3QgdXJsID0gXCJodHRwczovL29tbTZvdWc1cGcuZXhlY3V0ZS1hcGkudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vZGVzYXJyb2xsby9vYXV0aDIvdjEvdG9rZW5cIjtcclxuICAgICAgICBjb25zdCBoZWFkZXJzID0ge1xyXG4gICAgICAgICAgICBcIkF1dGhvcml6YXRpb25cIjogXCJCYXNpYyBcIiArIGJ0b2EoXCIxOGg4dmFudnJoNHB1aTFscm50YzFuaWxqZlwiICsgXCI6XCIgKyBcIjFnZTMxYmhqcmRrOWQwamExNG1mdDhxZXBpNGNsa3Q4MDVqcWIyc3Zxdm1iNHNvMXY0ZzdcIiksXHJcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIsXHJcbiAgICAgICAgICAgIFwiQ29va2llXCI6IFwiWFNSRi1UT0tFTj1iNGE1NGYxYi1hZmU1LTRhZWUtOWE3Ni0wMGY5MjA0MThiNmVcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgYm9keSA9IFwiZ3JhbnRfdHlwZT1jbGllbnRfY3JlZGVudGlhbHNcIjtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5zZW5kKHVybCwgJ1BPU1QnLCBib2R5LCBoZWFkZXJzLCBzdWNjZXNzLCBlcnJvcik7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUGF5LlxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGhlYWRlcnNcclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBib2R5XHJcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHByb2R1Y3Rpb25cclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHN1Y2Nlc3NcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXHJcbiAgICAgKi9cclxuICAgIHBheTogZnVuY3Rpb24gKGhlYWRlcnMsIGJvZHksIHByb2R1Y3Rpb24sIHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgY29uc3QgdXJsID0gcHJvZHVjdGlvbiBcclxuICAgICAgICAgICAgPyBcImh0dHBzOi8vYXBpLmJhemFwcGdzLmNvbS9zdXBlcmFwcC9wYWdvcy9jYXB0YWNpb24vdHJhc3Bhc29zL3YxL2JvdG9uLXBhZ29cIlxyXG4gICAgICAgICAgICAvLyA/IFwiaHR0cHM6Ly9hcGkuYmF6LmFwcC9zdXBlcmFwcC9wYWdvcy9jYXB0YWNpb24vdHJhc3Bhc29zL3YxL2JvdG9uLXBhZ29cIlxyXG4gICAgICAgICAgICA6IFwiaHR0cHM6Ly9hcGlnYXRld2F5LnN1cGVyYXBwYmF6LmNvbS9pbnRlZ3JhY2lvbi9zdXBlcmFwcC9wYWdvcy9jYXB0YWNpb24vdHJhc3Bhc29zL3YxL2JvdG9uLXBhZ29cIjtcclxuICAgICAgICAgICAgLy8gOiBcImh0dHA6Ly8xMjcuMC4wLjE6MzAwMFwiXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHJhdyA9IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xyXG5cclxuICAgICAgICByZXF1ZXN0LnNlbmQodXJsLCAnUE9TVCcsIHJhdywgaGVhZGVycywgc3VjY2VzcywgZXJyb3IpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIE1ha2UgcmVxdWVzdC5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kXHJcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gYm9keVxyXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGpzb25IZWFkZXJzIFxyXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gc3VjY2VzcyBcclxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGVycm9yXHJcbiAgICAgKi9cclxuICAgIHNlbmQ6IGZ1bmN0aW9uICh1cmwsIG1ldGhvZCwgYm9keSwganNvbkhlYWRlcnMsIHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgLyogY29uc3QgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IHByb3AgaW4ganNvbkhlYWRlcnMpIHtcclxuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQocHJvcCwganNvbkhlYWRlcnNbcHJvcF0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmV0Y2godXJsLCB7IG1ldGhvZCwgaGVhZGVycywgYm9keSwgcmVkaXJlY3Q6ICdmb2xsb3cnIH0pXHJcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcclxuICAgICAgICAgICAgLnRoZW4oc3VjY2VzcylcclxuICAgICAgICAgICAgLmNhdGNoKGVycm9yKTsgKi9cclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmwsIFxyXG4gICAgICAgICAgICBtZXRob2QsXHJcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSwgXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IGpzb25IZWFkZXJzLCBcclxuICAgICAgICAgICAgZGF0YTogYm9keSxcclxuICAgICAgICAgICAgc3VjY2VzcyxcclxuICAgICAgICAgICAgZXJyb3JcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTsiLCJsZXQgZW52aXJvbm1lbnQgPSBmYWxzZTtcclxuXHJcbi8qKlxyXG4gKiBCaW5kIEpTT04gdG8gSFRNTC5cclxuICogQHBhcmFtIHtvYmplY3R9IHZhbHVlc1xyXG4gKi9cclxuZnVuY3Rpb24gYmluZCh2YWx1ZXMpIHtcclxuICAgIGNvbnN0ICR0YWdzID0gJCgnW2RhdGEtaWRdJyk7XHJcblxyXG4gICAgJHRhZ3MuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgJHRhZyA9ICQodGhpcyk7XHJcbiAgICAgICAgY29uc3QgaWQgPSAkdGFnLmRhdGEoJ2lkJyk7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbaWRdO1xyXG5cclxuICAgICAgICBpZiAoaWQgPT09ICdwcmVjaW8nKSB7XHJcbiAgICAgICAgICAgICR0YWcuaHRtbChmb3JtYXRBbW91bnQodmFsdWUpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGlkID09PSAnc2FsZG8nKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJ2ZhbHNlJykge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHNob3dBZHZpY2UoJHRhZywgdHJ1ZSk7IH0sIDUwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkdGFnLmh0bWwodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogUGFyc2Ugc3RyaW5nIHRvIG9iamVjdCBhbmQgdGhlbiBiaW5kLlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RySnNvbiBcclxuICovXHJcbmZ1bmN0aW9uIGJpbmRGcm9tU3RyKHN0ckpzb24pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2Uoc3RySnNvbik7XHJcbiAgICAgICAgYmluZChqc29uKTtcclxuICAgIH0gY2F0Y2ggKGVycikgeyBjb25zb2xlLmxvZyhlcnIpOyB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDaGFuZ2Ugc2NyZWVuLlxyXG4gKiBAcGFyYW0ge2pRdWVyeX0gJHNjcmVlblxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xyXG4gKi9cclxuZnVuY3Rpb24gY2hhbmdlU2NyZWVuKCRzY3JlZW4sIGNhbGxiYWNrKSB7XHJcbiAgICAkKCcuc2NyZWVuJykuYWRkQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgICRzY3JlZW4ucmVtb3ZlQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuXHJcbiAgICBjYWxsYmFjaygpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGFtb3VudCB3aXRoIGN1cnJlbmN5IGZvcm1hdC5cclxuICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudCBcclxuICogQHJldHVybnMge3N0cmluZ31cclxuICovXHJcbmZ1bmN0aW9uIGZvcm1hdEFtb3VudChhbW91bnQpIHtcclxuICAgIHJldHVybiAnJCAnICsgTnVtYmVyKGFtb3VudCkudG9GaXhlZCgyKS5yZXBsYWNlKC9cXEIoPz0oXFxkezN9KSsoPyFcXGQpKS9nLCAnLCcpO1xyXG59XHJcblxyXG4vKipcclxuICogSGFuZGxlIGRpZ2l0IGtleXVwIGV2ZW50LlxyXG4gKiBAcGFyYW0ge0tleWJvYXJkRXZlbnR9IGV2ZW50XHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVEaWdpdEtleXVwKHsgdGFyZ2V0LCBrZXlDb2RlIH0pIHtcclxuICAgIGNvbnN0ICRwYXJlbnQgPSAkKHRhcmdldC5wYXJlbnROb2RlKTtcclxuXHJcbiAgICBpZiAoa2V5Q29kZSA9PT0gOCkge1xyXG4gICAgICAgIGlmICgkcGFyZW50LnByZXYoKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0ICRpbnB1dCA9ICRwYXJlbnQucHJldigpLmZpbmQoJ2lucHV0Jyk7XHJcblxyXG4gICAgICAgICAgICAkaW5wdXQudmFsKCcnKTtcclxuICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0gZWxzZSBpZiAoa2V5Q29kZSA+IDQ3ICYmIGtleUNvZGUgPCA1OCkge1xyXG4gICAgICAgIGlmICh0YXJnZXQudmFsdWUgIT09ICcnKSB7XHJcbiAgICAgICAgICAgIGlmICgkcGFyZW50Lm5leHQoKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCAkaW5wdXQgPSAkcGFyZW50Lm5leHQoKS5maW5kKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGVDb2RlKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBcHBseSBudW1iZXIgZmlsdGVyLlxyXG4gKiBAcGFyYW0ge0V2ZW50fSBldmVudFxyXG4gKi9cclxuZnVuY3Rpb24gbnVtYmVyRmlsdGVyKGV2ZW50KSB7XHJcbiAgICBjb25zdCBmaWx0ZXIgPSAvXlxcZHswLDF9JC87XHJcblxyXG4gICAgaWYgKGZpbHRlci50ZXN0KHRoaXMudmFsdWUpKSB7XHJcbiAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMudmFsdWU7XHJcbiAgICAgICAgdGhpcy5vbGRTZWxlY3Rpb25TdGFydCA9IHRoaXMuc2VsZWN0aW9uU3RhcnQ7XHJcbiAgICAgICAgdGhpcy5vbGRTZWxlY3Rpb25FbmQgPSB0aGlzLnNlbGVjdGlvbkVuZDtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eSgnb2xkVmFsdWUnKSkge1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLm9sZFZhbHVlO1xyXG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uUmFuZ2UodGhpcy5vbGRTZWxlY3Rpb25TdGFydCwgdGhpcy5vbGRTZWxlY3Rpb25FbmQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnZhbHVlID0gJyc7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEbyBmYWtlIHJlcXVlc3QuXHJcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrXHJcbiAqL1xyXG5mdW5jdGlvbiBmYWtlUmVxdWVzdChjb2RlLCBjYWxsYmFjaykge1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgY2FsbGJhY2soY29kZSA9PT0gJzAwMDAwMScpO1xyXG4gICAgfSwgMTUwMCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RySnNvblxyXG4gKi9cclxuZnVuY3Rpb24gcGF5TW92aWUoc3RySnNvbikge1xyXG4gICAgY29uc3QgaGFuZGxlRXJyID0gZXJyID0+IHtcclxuICAgICAgICAvLyBjb25zdCBtZXNzYWdlID0gdHlwZW9mIGVyciA9PT0gJ29iamVjdCcgPyBlcnIubWVzc2FnZSA6IGVycjtcclxuICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShlcnIpKTtcclxuICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5lcnJvclBheW1lbnRSZXNwb25zZS5wb3N0TWVzc2FnZShcImVycm9yUGF5bWVudFJlc3BvbnNlfFwiICsgSlNPTi5zdHJpbmdpZnkoZXJyKSk7XHJcbiAgICB9XHJcblxyXG4gICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuc2hvd0xvYWRlci5wb3N0TWVzc2FnZShcInNob3dMb2FkZXJcIik7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShzdHJKc29uKTtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5wYXkoanNvblsnaGVhZGVycyddLCBqc29uWydyZXF1ZXN0Qm9keSddLCBlbnZpcm9ubWVudCwgZnVuY3Rpb24gKHBheVJlcykge1xyXG4gICAgICAgICAgICBpZiAocGF5UmVzLmNvZGlnbyA9PSAnMjAxJykge1xyXG4gICAgICAgICAgICAgICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMucGF5bWVudFJlc3BvbnNlLnBvc3RNZXNzYWdlKFwicGF5bWVudFJlc3BvbnNlfFwiICsgSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogeyBjb2RlOiAwLCBkYXRhOiBwYXlSZXMgfSB9KSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBoYW5kbGVFcnIoeyBlcnJvcjogeyBjb2RlOiBwYXlSZXMuY29kaWdvLCBtZXNzYWdlOiBwYXlSZXMubWVuc2FqZSB9LCB3ZWJlcnJvcjogOTAwLCB3ZWJlcnJvcm1lc3NhZ2U6IFwiRWwgZXJyb3IgbG8gZW52w61vIGVsIHNlcnZpY2lvXCIgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLmhpZGVMb2FkZXIucG9zdE1lc3NhZ2UoXCJoaWRlTG9hZGVyXCIpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcclxuICAgICAgICAgICAgaGFuZGxlRXJyKHsgZXJyb3I6IHsgY29kZTogNTAwLCBtZXNzYWdlOiBlcnJvclRocm93biB9LCB3ZWJlcnJvcjogOTAxLCB3ZWJlcnJvcm1lc3NhZ2U6IGVycm9yVGhyb3duIH0pO1xyXG4gICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5oaWRlTG9hZGVyLnBvc3RNZXNzYWdlKFwiaGlkZUxvYWRlclwiKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnIpIHsgXHJcbiAgICAgICAgaGFuZGxlRXJyKHsgZXJyb3I6IHsgY29kZTogNTAwLCBtZXNzYWdlOiBlcnIubWVzc2FnZSB9LCB3ZWJlcnJvcjogOTAyLCB3ZWJlcnJvcm1lc3NhZ2U6IFwiRXJyb3IgYWwgaGFjZXIgbGEgcGV0aWNpw7NuXCIgfSk7IFxyXG4gICAgICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLmhpZGVMb2FkZXIucG9zdE1lc3NhZ2UoXCJoaWRlTG9hZGVyXCIpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogUGFyc2UgbG9jYXRpb24uc2VhcmNoIHRvIEpTT04uXHJcbiAqIEByZXR1cm5zIG9iamVjdFxyXG4gKi9cclxuZnVuY3Rpb24gc2VhcmNoVG9Kc29uKCkge1xyXG4gICAgY29uc3QgcGFpcnMgPSBsb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpLnNwbGl0KCcmJyk7XHJcbiAgICBjb25zdCBvYmplY3QgPSB7fTtcclxuICAgIGxldCBpID0gMDtcclxuXHJcbiAgICBmb3IgKDsgaSA8IHBhaXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKHBhaXJzW2ldID09PSAnJykge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHBhcnRzID0gcGFpcnNbaV0uc3BsaXQoJz0nKTtcclxuICAgICAgICBvYmplY3RbZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzBdKV0gPSBkZWNvZGVVUklDb21wb25lbnQocGFydHNbMV0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBvYmplY3Q7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTaG93IG9yIGhpZGUgYWR2aWNlLlxyXG4gKiBAcGFyYW0ge2pRdWVyeX0gJGVsIFxyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGZsYWcgXHJcbiAqL1xyXG5mdW5jdGlvbiBzaG93QWR2aWNlKCRlbCwgZmxhZykge1xyXG4gICAgaWYgKGZsYWcpIHtcclxuICAgICAgICAkZWwuYWRkQ2xhc3MoJ25vLXZpc2libGUnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGVsLnJlbW92ZUNsYXNzKCduby12aXNpYmxlJyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTaG93IG9yIGhpZGUgbG9hZGVyLlxyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHNob3dcclxuICovXHJcbmZ1bmN0aW9uIHNob3dMb2FkZXIoc2hvdykge1xyXG4gICAgbGV0ICRsb2FkZXIgPSAkKCcubG9hZGVyJyk7XHJcblxyXG4gICAgaWYgKHNob3cpIHtcclxuICAgICAgICBpZiAoJGxvYWRlci5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgICAgICAkbG9hZGVyID0gJCgnPGRpdiBjbGFzcz1cImxvYWRlclwiPicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJCgnYm9keScpLmFwcGVuZCgkbG9hZGVyKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+ICRsb2FkZXIuYWRkQ2xhc3MoJ2xvYWRlci12aXNpYmxlJyksIDEwKTtcclxuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgICRsb2FkZXIucmVtb3ZlQ2xhc3MoJ2xvYWRlci12aXNpYmxlJyk7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiAkbG9hZGVyLnJlbW92ZSgpLCAzNzUpO1xyXG5cclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFZhbGlkYXRlIGNvZGUgZnJvbSBjbGllbnQuXHJcbiAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gKi9cclxuZnVuY3Rpb24gdmFsaWRhdGVDb2RlKCkge1xyXG4gICAgY29uc3QgJGNvZGUgPSAkKCcuYXV0aC1zY3JlZW4gLmNvZGUnKTtcclxuICAgIGNvbnN0ICRkaWdpdHMgPSAkKCcuYXV0aC1zY3JlZW4gLmRpZ2l0IGlucHV0Jyk7XHJcbiAgICBsZXQgY29kZSA9IFwiXCI7XHJcblxyXG4gICAgJGRpZ2l0cy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb2RlICs9IHRoaXMudmFsdWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoY29kZS5sZW5ndGggPT09IDYpIHtcclxuICAgICAgICBzaG93TG9hZGVyKHRydWUpO1xyXG5cclxuICAgICAgICBmYWtlUmVxdWVzdChjb2RlLCBzdWNjZXNzID0+IHtcclxuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICRjb2RlLmFkZENsYXNzKCd2YWxpZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNoYW5nZVNjcmVlbigkKCcucmVzdW1lLXNjcmVlbicpLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd0xvYWRlcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNob3dMb2FkZXIoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgJGNvZGUuYWRkQ2xhc3MoJ2ludmFsaWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAkZGlnaXRzLmVhY2goZnVuY3Rpb24gKCkgeyAkKHRoaXMpLnZhbCgnJyk7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICRkaWdpdHMuZXEoMCkuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGNvZGUucmVtb3ZlQ2xhc3MoJ3ZhbGlkIGludmFsaWQnKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgRGV0YWlsIFNjcmVlbiBjb21wb25lbnRzLlxyXG5jb25zdCBzZWFyY2hKc29uID0gc2VhcmNoVG9Kc29uKCk7XHJcblxyXG5lbnZpcm9ubWVudCA9IHNlYXJjaEpzb25bJ2Vudmlyb25tZW50J10gPT09ICd0cnVlJztcclxuLy8gYmluZChzZWFyY2hKc29uKTtcclxuY29uc29sZS5sb2coc2VhcmNoSnNvbik7XHJcblxyXG5jb25zdCAkYWR2aWNlcyA9ICQoJy5hZHZpY2UuZml4ZWQnKTtcclxuXHJcbiRhZHZpY2VzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3QgJGFkdmljZSA9ICQodGhpcyk7XHJcbiAgICBjb25zdCAkY2xvc2VCdG4gPSAkYWR2aWNlLmZpbmQoJy5jbG9zZS1idG4nKTtcclxuXHJcbiAgICAkY2xvc2VCdG4ub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNob3dBZHZpY2UoJGFkdmljZSwgZmFsc2UpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuJCgnLmRldGFpbC1zY3JlZW4gLnN3aXBlLWJ0bicpLnN3aXBlKHtcclxuICAgIGNiOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc2hvd0xvYWRlcih0cnVlKTtcclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzY3JpcHRzLmpzOiBPcGVuIGRpZ2l0YWwgc2lnbicpO1xyXG4gICAgICAgICAgICB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycy5zaG93RGlnaXRhbFNpZ24ucG9zdE1lc3NhZ2UoXCJzaG93RGlnaXRhbFNpZ25cIik7XHJcbiAgICAgICAgfSwgNTAwKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBBdXRoIFNjcmVlbiBjb21wb25lbnRzLlxyXG5jb25zdCAkZGlnaXRzID0gJCgnLmF1dGgtc2NyZWVuIC5kaWdpdCBpbnB1dCcpO1xyXG5cclxuJGRpZ2l0cy5vbigna2V5cHJlc3Mga2V5ZG93biBrZXl1cCBpbnB1dCBjaGFuZ2UgcGFzdGUnLCBudW1iZXJGaWx0ZXIpXHJcbiRkaWdpdHMub24oJ2tleXVwJywgaGFuZGxlRGlnaXRLZXl1cCk7XHJcblxyXG4kZGlnaXRzLmVxKDApLmZvY3VzKCk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBjbG9zZSBidXR0b25zLlxyXG4kKCcuc2NyZWVuIGhlYWRlciAuY2xvc2UtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IENsb3NpbmcgV2ViVmlldycpO1xyXG4gICAgd2luZG93LndlYmtpdC5tZXNzYWdlSGFuZGxlcnMuY2xvc2VNb3ZpZVBheW1lbnQucG9zdE1lc3NhZ2UoXCJjbG9zZU1vdmllUGF5bWVudFwiKTtcclxufSk7XHJcblxyXG5cclxuLy8gSW5pdGlhbGl6ZSBzaGFyZSBidXR0b24uXHJcbiQoJy5zaGFyZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnc2NyaXB0cy5qczogU2hhcmluZyB0aWNrZXQnKTtcclxuICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnNoYXJlVGlja2V0LnBvc3RNZXNzYWdlKFwic2hhcmVUaWNrZXRcIik7XHJcbn0pO1xyXG5cclxuXHJcbi8vIEluaXRpYWxpemUgbW92aWUgYnV0dG9uLlxyXG4kKCcubW92aWUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5sb2coJ3NjcmlwdHMuanM6IFBsYXkgbW92aWUnKTtcclxuICAgIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzLnBsYXlNb3ZpZS5wb3N0TWVzc2FnZShcInBsYXlNb3ZpZVwiKTtcclxufSk7XHJcbiJdfQ==
